function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,t){return rstr2any(rstr_md5(str2rstr_utf8(e)),t)}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_md5(e,t){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_md5(e,t,s){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)),s)}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}function rstr_hmac_md5(e,t){var s=rstr2binl(e);16<s.length&&(s=binl_md5(s,8*e.length));for(var i=Array(16),r=Array(16),n=0;16>n;n++)i[n]=909522486^s[n],r[n]=1549556828^s[n];return s=binl_md5(i.concat(rstr2binl(t)),512+8*t.length),binl2rstr(binl_md5(r.concat(s),640))}function rstr2hex(e){try{}catch(t){hexcase=0}for(var s,i=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",n=0;n<e.length;n++)s=e.charCodeAt(n),r+=i.charAt(s>>>4&15)+i.charAt(15&s);return r}function rstr2b64(e){try{}catch(t){b64pad=""}for(var s="",i=e.length,r=0;i>r;r+=3)for(var n=e.charCodeAt(r)<<16|(i>r+1?e.charCodeAt(r+1)<<8:0)|(i>r+2?e.charCodeAt(r+2):0),o=0;4>o;o++)s=8*r+6*o>8*e.length?s+b64pad:s+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6*(3-o)&63);return s}function rstr2any(e,t){var s,i,r,n,o,a=t.length,S=Array(Math.ceil(e.length/2));for(s=0;s<S.length;s++)S[s]=e.charCodeAt(2*s)<<8|e.charCodeAt(2*s+1);var u=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),_=Array(u);for(i=0;u>i;i++){for(o=[],s=n=0;s<S.length;s++)n=(n<<16)+S[s],r=Math.floor(n/a),n-=r*a,(0<o.length||r>0)&&(o[o.length]=r);_[i]=n,S=o}for(a="",s=_.length-1;s>=0;s--)a+=t.charAt(_[s]);return a}function str2rstr_utf8(e){for(var t,s,i="",r=-1;++r<e.length;)t=e.charCodeAt(r),s=r+1<e.length?e.charCodeAt(r+1):0,t>=55296&&56319>=t&&s>=56320&&57343>=s&&(t=65536+((1023&t)<<10)+(1023&s),r++),127>=t?i+=String.fromCharCode(t):2047>=t?i+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?i+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(i+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return i}function str2rstr_utf16le(e){for(var t="",s=0;s<e.length;s++)t+=String.fromCharCode(255&e.charCodeAt(s),e.charCodeAt(s)>>>8&255);return t}function str2rstr_utf16be(e){for(var t="",s=0;s<e.length;s++)t+=String.fromCharCode(e.charCodeAt(s)>>>8&255,255&e.charCodeAt(s));return t}function rstr2binl(e){for(var t=Array(e.length>>2),s=0;s<t.length;s++)t[s]=0;for(s=0;s<8*e.length;s+=8)t[s>>5]|=(255&e.charCodeAt(s/8))<<s%32;return t}function binl2rstr(e){for(var t="",s=0;s<32*e.length;s+=8)t+=String.fromCharCode(e[s>>5]>>>s%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var s=1732584193,i=-271733879,r=-1732584194,n=271733878,o=0;o<e.length;o+=16)var a=s,S=i,u=r,_=n,s=md5_ff(s,i,r,n,e[o+0],7,-680876936),n=md5_ff(n,s,i,r,e[o+1],12,-389564586),r=md5_ff(r,n,s,i,e[o+2],17,606105819),i=md5_ff(i,r,n,s,e[o+3],22,-1044525330),s=md5_ff(s,i,r,n,e[o+4],7,-176418897),n=md5_ff(n,s,i,r,e[o+5],12,1200080426),r=md5_ff(r,n,s,i,e[o+6],17,-1473231341),i=md5_ff(i,r,n,s,e[o+7],22,-45705983),s=md5_ff(s,i,r,n,e[o+8],7,1770035416),n=md5_ff(n,s,i,r,e[o+9],12,-1958414417),r=md5_ff(r,n,s,i,e[o+10],17,-42063),i=md5_ff(i,r,n,s,e[o+11],22,-1990404162),s=md5_ff(s,i,r,n,e[o+12],7,1804603682),n=md5_ff(n,s,i,r,e[o+13],12,-40341101),r=md5_ff(r,n,s,i,e[o+14],17,-1502002290),i=md5_ff(i,r,n,s,e[o+15],22,1236535329),s=md5_gg(s,i,r,n,e[o+1],5,-165796510),n=md5_gg(n,s,i,r,e[o+6],9,-1069501632),r=md5_gg(r,n,s,i,e[o+11],14,643717713),i=md5_gg(i,r,n,s,e[o+0],20,-373897302),s=md5_gg(s,i,r,n,e[o+5],5,-701558691),n=md5_gg(n,s,i,r,e[o+10],9,38016083),r=md5_gg(r,n,s,i,e[o+15],14,-660478335),i=md5_gg(i,r,n,s,e[o+4],20,-405537848),s=md5_gg(s,i,r,n,e[o+9],5,568446438),n=md5_gg(n,s,i,r,e[o+14],9,-1019803690),r=md5_gg(r,n,s,i,e[o+3],14,-187363961),i=md5_gg(i,r,n,s,e[o+8],20,1163531501),s=md5_gg(s,i,r,n,e[o+13],5,-1444681467),n=md5_gg(n,s,i,r,e[o+2],9,-51403784),r=md5_gg(r,n,s,i,e[o+7],14,1735328473),i=md5_gg(i,r,n,s,e[o+12],20,-1926607734),s=md5_hh(s,i,r,n,e[o+5],4,-378558),n=md5_hh(n,s,i,r,e[o+8],11,-2022574463),r=md5_hh(r,n,s,i,e[o+11],16,1839030562),i=md5_hh(i,r,n,s,e[o+14],23,-35309556),s=md5_hh(s,i,r,n,e[o+1],4,-1530992060),n=md5_hh(n,s,i,r,e[o+4],11,1272893353),r=md5_hh(r,n,s,i,e[o+7],16,-155497632),i=md5_hh(i,r,n,s,e[o+10],23,-1094730640),s=md5_hh(s,i,r,n,e[o+13],4,681279174),n=md5_hh(n,s,i,r,e[o+0],11,-358537222),r=md5_hh(r,n,s,i,e[o+3],16,-722521979),i=md5_hh(i,r,n,s,e[o+6],23,76029189),s=md5_hh(s,i,r,n,e[o+9],4,-640364487),n=md5_hh(n,s,i,r,e[o+12],11,-421815835),r=md5_hh(r,n,s,i,e[o+15],16,530742520),i=md5_hh(i,r,n,s,e[o+2],23,-995338651),s=md5_ii(s,i,r,n,e[o+0],6,-198630844),n=md5_ii(n,s,i,r,e[o+7],10,1126891415),r=md5_ii(r,n,s,i,e[o+14],15,-1416354905),i=md5_ii(i,r,n,s,e[o+5],21,-57434055),s=md5_ii(s,i,r,n,e[o+12],6,1700485571),n=md5_ii(n,s,i,r,e[o+3],10,-1894986606),r=md5_ii(r,n,s,i,e[o+10],15,-1051523),i=md5_ii(i,r,n,s,e[o+1],21,-2054922799),s=md5_ii(s,i,r,n,e[o+8],6,1873313359),n=md5_ii(n,s,i,r,e[o+15],10,-30611744),r=md5_ii(r,n,s,i,e[o+6],15,-1560198380),i=md5_ii(i,r,n,s,e[o+13],21,1309151649),s=md5_ii(s,i,r,n,e[o+4],6,-145523070),n=md5_ii(n,s,i,r,e[o+11],10,-1120210379),r=md5_ii(r,n,s,i,e[o+2],15,718787259),i=md5_ii(i,r,n,s,e[o+9],21,-343485551),s=safe_add(s,a),i=safe_add(i,S),r=safe_add(r,u),n=safe_add(n,_);return[s,i,r,n]}function md5_cmn(e,t,s,i,r,n){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,n)),r),s)}function md5_ff(e,t,s,i,r,n,o){return md5_cmn(t&s|~t&i,e,t,r,n,o)}function md5_gg(e,t,s,i,r,n,o){return md5_cmn(t&i|s&~i,e,t,r,n,o)}function md5_hh(e,t,s,i,r,n,o){return md5_cmn(t^s^i,e,t,r,n,o)}function md5_ii(e,t,s,i,r,n,o){return md5_cmn(s^(t|~i),e,t,r,n,o)}function safe_add(e,t){var s=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(s>>16)<<16|65535&s}function bit_rol(e,t){return e<<t|e>>>32-t}SFS2X={SmartFox:function(e){this._majVersion=1,this._minVersion=7,this._subVersion=1,this._socketEngine=new SFS2X.SocketEngine,this._eventDispatcher=new SFS2X.EventDispatcher,this._lagMonitor=null,this._log=SFS2X.Logger,this._inited=this._isJoining=!1,this._currentZone=null,this._clientDetails="JavaScript",this.version=this._majVersion+"."+this._minVersion+"."+this._subVersion,this.config=e,this.debug=!1,null!=this.config&&this.config.debug&&(this.debug=!0),this.logger=this._log,this.lastJoinedRoom=this.mySelf=this.buddyManager=this.userManager=this.roomManager=this.sessionToken=null,this._controllers={},this._initialize(),this._log.info("SmartFox instance ready!")}},SmartFox=SFS2X.SmartFox,SFS2X.SmartFox.prototype.addEventListener=function(e,t,s){this._eventDispatcher.addEventListener(e,t,s)},SFS2X.SmartFox.prototype.removeEventListener=function(e,t){this._eventDispatcher.removeEventListener(e,t)},SFS2X.SmartFox.prototype.setClientDetails=function(e,t){this.isConnected()?this._log.warn("SetClientDetails must be called before the connection is started"):(this._clientDetails=null!=e?e.replace(":"," "):"",this._clientDetails+=":",this._clientDetails+=null!=t?t.replace(":"," "):"")},SFS2X.SmartFox.prototype.connect=function(e,t,s){if(this.isConnected())this._log.warn("Already connected");else if(this._socketEngine.isConnecting)this._log.warn("A connection attempt is already in progress");else{var i=null!=this.config&&null!=this.config.host?this.config.host:null,r=null!=this.config&&null!=this.config.port?this.config.port:null,n=null!=this.config&&this.config.useSSL;null!=e&&(i=e),null!=t&&(r=t),null!=s&&(n=s),null==i||0==i.length?this._log.error("Invalid connection host/address"):"number"!=typeof r||0>r||r>65535?this._log.error("Invalid TCP port"):("boolean"!=typeof n&&(n=!1),this._socketEngine.connect(i,r,n))}},SFS2X.SmartFox.prototype.disconnect=function(){this.isConnected()?(0<this._socketEngine.reconnectionSeconds&&this.send(new SFS2X.Requests.System.ManualDisconnectionRequest),setTimeout(function(e){e._handleClientDisconnection(SFS2X.Utils.ClientDisconnectionReason.MANUAL)},100,this)):this._log.info("You are not connected")},SFS2X.SmartFox.prototype.enableLagMonitor=function(e,t,s){null==this.mySelf?this._log.warn("Lag Monitoring requires that you are logged in a Zone; please retry after completing the login process"):(null!=this._lagMonitor&&this._lagMonitor.destroy(),e&&(this._lagMonitor=new SFS2X.Utils.LagMonitor(this,t,s),this._lagMonitor.start()))},SFS2X.SmartFox.prototype.isConnected=function(){return null!=this._socketEngine?this._socketEngine.isConnected:!1},SFS2X.SmartFox.prototype.getMaxMessageSize=function(){return null!=this._socketEngine?this._socketEngine._maxMessageSize:0},SFS2X.SmartFox.prototype.send=function(e){if(this.isConnected()){if(null!=e.validate&&null!=e.execute){try{e.validate(this),e.execute(this)}catch(t){if(!(t instanceof SFS2X.Exceptions.SFSValidationError&&null!=t.getMessage))throw t;if(e=t.getMessage(),null!=t.getErrors())for(var e=e+":",s=0;s<t.getErrors().length;s++)1<t.getErrors().length&&(e+=" "+(s+1)+")"),e+=" "+t.getErrors()[s];return this._log.error("Request failed | "+e),!1}return this.debug&&(this._log.info("OUTGOING DATA\n"+SFS2X.DebugHelper.getDump(e.getMessage())),this._log.info("OUT > "+SFS2X.Requests.getRequestNameFromId(e._id))),this._socketEngine.send(e.getMessage()),!0}this._log.error("An invalid request was passed: "+e),this._log.debug("Object dump:\n"+SFS2X.DebugHelper.getDump(e))}else this._log.error("You are not connected. Request cannot be sent: "+SFS2X.Requests.getRequestNameFromId(e._id))},SFS2X.SmartFox.prototype.getRoomById=function(e){return this.roomManager.getRoomById(e)},SFS2X.SmartFox.prototype.getRoomByName=function(e){return this.roomManager.getRoomByName(e)},SFS2X.SmartFox.prototype.getRoomList=function(){return this.roomManager.getRoomList()},SFS2X.SmartFox.prototype.getRoomListFromGroup=function(e){return this.roomManager.getRoomListFromGroup(e)},SFS2X.SmartFox.prototype.getJoinedRooms=function(){return this.roomManager.getJoinedRooms()},SFS2X.SmartFox.prototype._initialize=function(){this._inited||(this._socketEngine=new SFS2X.SocketEngine(this),this._socketEngine.addEventListener(SFS2X.SocketEvent.CONNECT,this._onSocketConnect,this),this._socketEngine.addEventListener(SFS2X.SocketEvent.DISCONNECT,this._onSocketDisconnect,this),this._socketEngine.addEventListener(SFS2X.SocketEvent.DATA,this._onSocketData,this),this._socketEngine.addEventListener(SFS2X.SocketEvent.IOERROR,this._onSocketIOError,this),this._controllers[0]=new SFS2X.Controllers.SystemController(this),this._controllers[1]=new SFS2X.Controllers.ExtensionController(this),this._inited=!0,this._reset())},SFS2X.SmartFox.prototype._reset=function(e){null!=this.buddyManager&&this.buddyManager._clearAll(),this.userManager=new SFS2X.Managers.GlobalUserManager(this),this.roomManager=new SFS2X.Managers.RoomManager(this),this.buddyManager=new SFS2X.Managers.BuddyManager(this),null!=this._lagMonitor&&this._lagMonitor.destroy(),this._isJoining=!1,this.mySelf=this.lastJoinedRoom=this._currentZone=null,e&&(this.sessionToken=null)},SFS2X.SmartFox.prototype._dispatchEvent=function(e,t){this._eventDispatcher.dispatchEvent(e,t)},SFS2X.SmartFox.prototype._onSocketConnect=function(e){e.success?(e=new SFS2X.Requests.System.HandshakeRequest(this.version,this._clientDetails,e.isReconnection?this.sessionToken:null),this.send(e)):this._dispatchEvent(SFS2X.SFSEvent.CONNECTION,{success:!1})},SFS2X.SmartFox.prototype._onSocketDisconnect=function(e){this._dispatchEvent(SFS2X.SFSEvent.CONNECTION_LOST,{reason:e.reason}),this._reset(!0)},SFS2X.SmartFox.prototype._onSocketData=function(e){this.debug&&this._log.info("INCOMING DATA\n"+SFS2X.DebugHelper.getDump(e));var t=e[SFS2X.Controllers.CONTROLLER_ID],s=e[SFS2X.Controllers.ACTION_ID],e=e[SFS2X.Controllers.PARAM_ID];null==t?this._log.error("Message rejected: Controller ID is missing"):null==t?this._log.error("Message rejected: Action ID missing"):this._controllers[t].handleMessage(e,s)},SFS2X.SmartFox.prototype._onSocketIOError=function(e){this._dispatchEvent(SFS2X.SFSEvent.SOCKET_ERROR,{message:e})},SFS2X.SmartFox.prototype._handleHandShake=function(e){var t=e[SFS2X.Controllers.KEY_ERROR_CODE];null==t?(this.sessionToken=e[SFS2X.Requests.System.HandshakeRequest.KEY_SESSION_TOKEN],this._socketEngine._maxMessageSize=e[SFS2X.Requests.System.HandshakeRequest.KEY_MAX_MESSAGE_SIZE],this._socketEngine._isReconnecting?this._socketEngine._isReconnecting=!1:this._dispatchEvent(SFS2X.SFSEvent.CONNECTION,{success:!0})):(e={success:!1,errorMessage:SFS2X.ErrorCodes.getErrorMessage(t,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),errorCode:t},this._dispatchEvent(SFS2X.SFSEvent.CONNECTION,e))},SFS2X.SmartFox.prototype._handleLogout=function(){this._reset(!1)},SFS2X.SmartFox.prototype._handleClientDisconnection=function(e){this.isConnected()&&this._socketEngine.disconnect(e)},function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(s){function i(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var n=new this;e=!1;for(var o in s)n[o]="function"==typeof s[o]&&"function"==typeof r[o]&&t.test(s[o])?function(e,t){return function(){var s=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=s,i}}(o,s[o]):s[o];return i.prototype=n,i.prototype.constructor=i,i.extend=arguments.callee,i}}();var hexcase=0,b64pad="";SFS2X.Utils={},SFS2X.Utils.md5_crypt=function(e,t){"undefined"!=typeof VarType&&(e=VarType.toStr(e),t=VarType.toStr(t));var s=b64pad;b64pad="";var i=chrsz;chrsz=8,"$1$"==t.substr(0,3)&&(t=t.substr(3));var r=t.indexOf("$");(0>r||r>8)&&(r=8);for(var t=t.substr(0,r),n=e+"$1$"+t,o=str_md5(e+t+e),r=e.length;r>0;r-=16)n=r>=16?n+o:n+o.substr(0,r);for(r=e.length;0!=r;r>>=1)n=0!=(1&r)?n+String.fromCharCode(0):n+e.charAt(0);for(var a="$1$"+t+"$",o=str_md5(n),r=0;1e3>r;r++)n="",n=0!=(1&r)?n+e:n+o,0!=r%3&&(n+=t),0!=r%7&&(n+=e),n=0!=(1&r)?n+o:n+e,o=str_md5(n);for(o+=o.charAt(5),r=0;5>r;r++)n=o.charCodeAt(r)<<16|o.charCodeAt(r+6)<<8|o.charCodeAt(r+12),a+=md5_to64(n,4);return n=o.charCodeAt(11),a+=md5_to64(n,2),b64pad=s,chrsz=i,a},SFS2X.Utils.ClientDisconnectionReason={IDLE:"idle",KICK:"kick",BAN:"ban",MANUAL:"manual",UNKNOWN:"unknown"},SFS2X.Utils.ClientDisconnectionReason.getReason=function(e){switch(e){case 0:return this.IDLE;case 1:return this.KICK;case 2:return this.BAN;case 3:return this.MANUAL;case 4:return this.UNKNOWN}},SFS2X.Utils.ArrayUtil={},SFS2X.Utils.ArrayUtil.objToArray=function(e){var t,s=[];for(t in e)e.hasOwnProperty(t)&&s.push(e[t]);return s},SFS2X.Utils.ArrayUtil.removeItem=function(e,t){var s=e.indexOf(t);s>-1&&e.splice(s,1)},SFS2X.Utils.HashTable=function(e){this.length=0,this.items={};for(var t in e)e.hasOwnProperty(t)&&(this.items[t]=e[t],this.length++)},SFS2X.Utils.HashTable.prototype.setItem=function(e,t){var s=void 0;return this.hasItem(e)?s=this.items[e]:this.length++,this.items[e]=t,s},SFS2X.Utils.HashTable.prototype.getItem=function(e){return this.hasItem(e)?this.items[e]:void 0},SFS2X.Utils.HashTable.prototype.hasItem=function(e){return this.items.hasOwnProperty(e)},SFS2X.Utils.HashTable.prototype.removeItem=function(e){return this.hasItem(e)?(previous=this.items[e],this.length--,delete this.items[e],previous):void 0},SFS2X.Utils.HashTable.prototype.keys=function(){var e,t=[];for(e in this.items)this.hasItem(e)&&t.push(e);return t},SFS2X.Utils.HashTable.prototype.values=function(){var e,t=[];for(e in this.items)this.hasItem(e)&&t.push(this.items[e]);return t},SFS2X.Utils.HashTable.prototype.each=function(e){for(var t in this.items)this.hasItem(t)&&e(t,this.items[t])},SFS2X.Utils.HashTable.prototype.clear=function(){this.items={},this.length=0},SFS2X.Utils.LagMonitor=function(e,t,s){(null==t||1>t)&&(t=4),(null==s||1>s)&&(s=10),this._sfs=e,this._valueQueue=[],this._interval=t,this._queueSize=s,this._thread=null,this._lastReqTime=-1},SFS2X.Utils.LagMonitor.prototype.start=function(){!this.isRunning()&&null!=this._sfs&&(this._thread=setInterval(this._threadRunner,1e3*this._interval,this))},SFS2X.Utils.LagMonitor.prototype.stop=function(){this.isRunning()&&(clearInterval(this._thread),this._thread=null,this._valueQueue=[])},SFS2X.Utils.LagMonitor.prototype.destroy=function(){this.stop(),this._sfs=null},SFS2X.Utils.LagMonitor.prototype.isRunning=function(){return null!=this._thread},SFS2X.Utils.LagMonitor.prototype.getLastPingTime=function(){return 0<this._valueQueue.length?this._valueQueue[this._valueQueue.length-1]:0},SFS2X.Utils.LagMonitor.prototype._threadRunner=function(e){e._lastReqTime=(new Date).getTime(),e._sfs.send(new SFS2X.Requests.System.PingPongRequest)},SFS2X.Utils.LagMonitor.prototype._onPingPong=function(){var e=(new Date).getTime()-this._lastReqTime;return this._valueQueue.length>=this._queueSize&&this._valueQueue.shift(),this._valueQueue.push(e),this._getAveragePingTime()},SFS2X.Utils.LagMonitor.prototype._getAveragePingTime=function(){if(0==this._valueQueue.length)return 0;for(var e=0,t=0;t<this._valueQueue.length;t++)e+=this._valueQueue[t];return e/this._valueQueue.length},SFS2X.Utils.BuddyOnlineState={ONLINE:0,OFFLINE:1,LEFT_THE_SERVER:2},SFS2X.Controllers={},SFS2X.Controllers.CONTROLLER_ID="c",SFS2X.Controllers.ACTION_ID="a",SFS2X.Controllers.PARAM_ID="p",SFS2X.Controllers.KEY_ERROR_CODE="ec",SFS2X.Controllers.KEY_ERROR_PARAMS="ep",SFS2X.Controllers.ROOM_PARAM="r",SFS2X.Controllers.USER_PARAM="u",SFS2X.Controllers.USER_COUNT_PARAM="uc",SFS2X.Controllers.SPECT_COUNT_PARAM="sc",SFS2X.Controllers.SystemController=function(e){this._sfs=e,this._id=0,this._requestHandlers={},this._initRequestHandlers(),this._log=SFS2X.Logger},SFS2X.Controllers.SystemController.prototype.getId=function(){return this._id},SFS2X.Controllers.SystemController.prototype.handleMessage=function(e,t){this._sfs.debug&&this._log.info("IN < "+this._getEvtName(t));var s=this._requestHandlers[t];null!=s?this[s](e):this._log.warn("Unknown message id: "+e.id)},SFS2X.Controllers.SystemController.prototype._initRequestHandlers=function(){this._requestHandlers[SFS2X.Requests.Handshake]="_fnHandshake",this._requestHandlers[SFS2X.Requests.Login]="_fnLogin",this._requestHandlers[SFS2X.Requests.Logout]="_fnLogout",this._requestHandlers[SFS2X.Requests.JoinRoom]="_fnJoinRoom",this._requestHandlers[SFS2X.Requests.CreateRoom]="_fnCreateRoom",this._requestHandlers[SFS2X.Requests.ChangeRoomName]="_fnChangeRoomName",this._requestHandlers[SFS2X.Requests.ChangeRoomPassword]="_fnChangeRoomPassword",this._requestHandlers[SFS2X.Requests.ChangeRoomCapacity]="_fnChangeRoomCapacity",this._requestHandlers[SFS2X.Requests.GenericMessage]="_fnGenericMessage",this._requestHandlers[SFS2X.Requests.SetRoomVariables]="_fnSetRoomVariables",this._requestHandlers[SFS2X.Requests.SetUserVariables]="_fnSetUserVariables",this._requestHandlers[SFS2X.Requests.SubscribeRoomGroup]="_fnSubscribeRoomGroup",this._requestHandlers[SFS2X.Requests.UnsubscribeRoomGroup]="_fnUnsubscribeRoomGroup",this._requestHandlers[SFS2X.Requests.SpectatorToPlayer]="_fnSpectatorToPlayer",this._requestHandlers[SFS2X.Requests.PlayerToSpectator]="_fnPlayerToSpectator",this._requestHandlers[SFS2X.Requests.InitBuddyList]="_fnInitBuddyList",this._requestHandlers[SFS2X.Requests.AddBuddy]="_fnAddBuddy",this._requestHandlers[SFS2X.Requests.RemoveBuddy]="_fnRemoveBuddy",this._requestHandlers[SFS2X.Requests.BlockBuddy]="_fnBlockBuddy",this._requestHandlers[SFS2X.Requests.GoOnline]="_fnGoOnline",this._requestHandlers[SFS2X.Requests.SetBuddyVariables]="_fnSetBuddyVariables",this._requestHandlers[SFS2X.Requests.FindRooms]="_fnFindRooms",this._requestHandlers[SFS2X.Requests.FindUsers]="_fnFindUsers",this._requestHandlers[SFS2X.Requests.InviteUsers]="_fnInviteUsers",this._requestHandlers[SFS2X.Requests.InvitationReply]="_fnInvitationReply",this._requestHandlers[SFS2X.Requests.QuickJoinGame]="_fnQuickJoinGame",this._requestHandlers[SFS2X.Requests.PingPong]="_fnPingPong",this._requestHandlers[SFS2X.Requests.SetUserPosition]="_fnSetUserPosition",this._requestHandlers[1e3]="_fnUserEnterRoom",this._requestHandlers[1001]="_fnUserCountChange",this._requestHandlers[1002]="_fnUserLost",this._requestHandlers[1003]="_fnRoomLost",this._requestHandlers[1004]="_fnUserExitRoom",this._requestHandlers[1005]="_fnClientDisconnection",this._requestHandlers[1007]="_fnSetMMOItemVariables"},SFS2X.Controllers.SystemController.prototype._getEvtName=function(e){return this._requestHandlers[e].substr(3)},SFS2X.Controllers.SystemController.prototype._fnHandshake=function(e){this._sfs._handleHandShake(e)},SFS2X.Controllers.SystemController.prototype._fnLogin=function(e){if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){this._populateRoomList(e[SFS2X.Requests.System.LoginRequest.KEY_ROOMLIST]),this._sfs.mySelf=new SFS2X.Entities.SFSUser(e[SFS2X.Requests.System.LoginRequest.KEY_ID],e[SFS2X.Requests.System.LoginRequest.KEY_USER_NAME],!0),this._sfs.mySelf._setUserManager(this._sfs.userManager),this._sfs.mySelf.privilegeId=e[SFS2X.Requests.System.LoginRequest.KEY_PRIVILEGE_ID],this._sfs.userManager._addUser(this._sfs.mySelf),this._sfs._socketEngine.reconnectionSeconds=e[SFS2X.Requests.System.LoginRequest.KEY_RECONNECTION_SECONDS];var t={};t.zone=e[SFS2X.Requests.System.LoginRequest.KEY_ZONE_NAME],t.user=this._sfs.mySelf,t.data=e[SFS2X.Requests.System.LoginRequest.KEY_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.LOGIN,t)}else t=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(t,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),this._sfs._dispatchEvent(SFS2X.SFSEvent.LOGIN_ERROR,{errorMessage:e,errorCode:t})},SFS2X.Controllers.SystemController.prototype._fnLogout=function(e){this._sfs._handleLogout();var t={};t.zone=e[SFS2X.Requests.System.LogoutRequest.KEY_ZONE_NAME],this._sfs._dispatchEvent(SFS2X.SFSEvent.LOGOUT,t)},SFS2X.Controllers.SystemController.prototype._fnJoinRoom=function(e){var t=this._sfs.roomManager,s={};this._sfs._isJoining=!1;var i=e[SFS2X.Controllers.KEY_ERROR_CODE];if(null==i){for(i=e[SFS2X.Requests.System.JoinRoomRequest.KEY_USER_LIST],e=SFS2X.Entities.SFSRoom.fromArray(e[SFS2X.Requests.System.JoinRoomRequest.KEY_ROOM]),e._setRoomManager(t),e=t._replaceRoom(e,t.containsGroup(e.groupId)),t=0;t<i.length;t++){var r=i[t],n=this._getOrCreateUser(r,!0,e);n._setPlayerId(r[3],e),e._addUser(n)}e.isJoined=!0,this._sfs.lastJoinedRoom=e,s.room=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_JOIN,s)}else e=SFS2X.ErrorCodes.getErrorMessage(i,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),s.errorMessage=e,s.errorCode=i,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_JOIN_ERROR,s)},SFS2X.Controllers.SystemController.prototype._fnCreateRoom=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=this._sfs.roomManager,e=SFS2X.Entities.SFSRoom.fromArray(e[SFS2X.Requests.System.CreateRoomRequest.KEY_ROOM]);e._setRoomManager=s,s._addRoom(e),t.room=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_ADD,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_CREATION_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnChangeRoomName=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=this._sfs.roomManager.getRoomById(e[SFS2X.Requests.System.ChangeRoomNameRequest.KEY_ROOM]);null!=s?(t.oldName=s.name,this._sfs.roomManager._changeRoomName(s,e[SFS2X.Requests.System.ChangeRoomNameRequest.KEY_NAME]),t.room=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_NAME_CHANGE,t)):this._log.warn("RoomNameChange event, unknown Room id: "+rId)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_NAME_CHANGE_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnChangeRoomPassword=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=this._sfs.roomManager.getRoomById(e[SFS2X.Requests.System.ChangeRoomNameRequest.KEY_ROOM]);null!=s?(this._sfs.roomManager._changeRoomPasswordState(s,e[SFS2X.Requests.System.ChangeRoomPasswordStateRequest.KEY_PASS]),t.room=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_PASSWORD_STATE_CHANGE,t)):this._log.warn("RoomPasswordChange event, unknown Room id: "+rId)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_PASSWORD_STATE_CHANGE_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnChangeRoomCapacity=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=this._sfs.roomManager.getRoomById(e[SFS2X.Requests.System.ChangeRoomNameRequest.KEY_ROOM]);null!=s?(this._sfs.roomManager._changeRoomCapacity(s,e[SFS2X.Requests.System.ChangeRoomCapacityRequest.KEY_USER_SIZE],e[SFS2X.Requests.System.ChangeRoomCapacityRequest.KEY_SPEC_SIZE]),t.room=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_CAPACITY_CHANGE,t)):this._log.warn("RoomPasswordChange event, unknown Room id: "+rId)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_CAPACITY_CHANGE_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnGenericMessage=function(e){switch(e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE_TYPE]){case SFS2X.Requests.GenericMessageType.PUBLIC_MSG:this._handlePublicMessage(e);break;case SFS2X.Requests.GenericMessageType.PRIVATE_MSG:this._handlePrivateMessage(e);break;case SFS2X.Requests.GenericMessageType.BUDDY_MSG:this._handleBuddyMessage(e);break;case SFS2X.Requests.GenericMessageType.MODERATOR_MSG:this._handleModMessage(e);break;case SFS2X.Requests.GenericMessageType.ADMING_MSG:this._handleAdminMessage(e);break;case SFS2X.Requests.GenericMessageType.OBJECT_MSG:this._handleObjectMessage(e)}},SFS2X.Controllers.SystemController.prototype._handlePublicMessage=function(e){var t={},s=e[SFS2X.Requests.System.GenericMessageRequest.KEY_ROOM_ID],i=this._sfs.roomManager.getRoomById(s);null!=i?(t.room=i,t.sender=this._sfs.userManager.getUserById(e[SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID]),t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE],t.data=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.PUBLIC_MESSAGE,t)):this._log.warn("Unexpected, public message target Room doesn't exist; Room id: "+s)},SFS2X.Controllers.SystemController.prototype._handlePrivateMessage=function(e){var t={},s=this._sfs.userManager.getUserById(e[SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID]);if(null==s){if(null==e[SFS2X.Requests.System.GenericMessageRequest.KEY_SENDER_DATA])return this._log.warn("Unexpected, private message has no sender details"),void 0;s=SFS2X.Entities.SFSUser.fromArray(e[SFS2X.Requests.System.GenericMessageRequest.KEY_SENDER_DATA])}t.sender=s,t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE],t.data=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.PRIVATE_MESSAGE,t)},SFS2X.Controllers.SystemController.prototype._handleBuddyMessage=function(e){var t={},s=e[SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID],i=this._sfs.buddyManager.getBuddyById(s);t.isItMe=this._sfs.mySelf.id==s,t.buddy=i,t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE],t.data=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_MESSAGE,t)},SFS2X.Controllers.SystemController.prototype._handleModMessage=function(e){var t={};t.sender=SFS2X.Entities.SFSUser.fromArray(e[SFS2X.Requests.System.GenericMessageRequest.KEY_SENDER_DATA]),t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE],t.data=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.MODERATOR_MESSAGE,t)},SFS2X.Controllers.SystemController.prototype._handleAdminMessage=function(e){var t={};t.sender=SFS2X.Entities.SFSUser.fromArray(e[SFS2X.Requests.System.GenericMessageRequest.KEY_SENDER_DATA]),t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE],t.data=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.ADMIN_MESSAGE,t)},SFS2X.Controllers.SystemController.prototype._handleObjectMessage=function(e){var t={};t.sender=this._sfs.userManager.getUserById(e[SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID]),t.message=e[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS],this._sfs._dispatchEvent(SFS2X.SFSEvent.OBJECT_MESSAGE,t)},SFS2X.Controllers.SystemController.prototype._fnSetRoomVariables=function(e){var t=e[SFS2X.Requests.System.SetRoomVariablesRequest.KEY_VAR_ROOM],s=e[SFS2X.Requests.System.SetRoomVariablesRequest.KEY_VAR_LIST],e=this._sfs.roomManager.getRoomById(t),i=[];if(null!=e){for(t=0;t<s.length;t++){var r=SFS2X.Entities.Variables.SFSRoomVariable.fromArray(s[t]);e._setVariable(r),i.push(r.name)}s={},s.changedVars=i,s.room=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_VARIABLES_UPDATE,s)}else this._log.warn("RoomVariablesUpdate event, unknown Room id: "+t)},SFS2X.Controllers.SystemController.prototype._fnSetUserVariables=function(e){var t=e[SFS2X.Requests.System.SetUserVariablesRequest.KEY_USER],s=e[SFS2X.Requests.System.SetUserVariablesRequest.KEY_VAR_LIST],e=this._sfs.userManager.getUserById(t),i=[];if(null!=e){for(t=0;t<s.length;t++){var r=SFS2X.Entities.Variables.SFSUserVariable.fromArray(s[t]);e._setVariable(r),i.push(r.name)}s={},s.changedVars=i,s.user=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_VARIABLES_UPDATE,s)}else this._log.warn("UserVariablesUpdate event, unknown User id: "+t)},SFS2X.Controllers.SystemController.prototype._fnSubscribeRoomGroup=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.System.SubscribeRoomGroupRequest.KEY_GROUP_ID],e=e[SFS2X.Requests.System.SubscribeRoomGroupRequest.KEY_ROOM_LIST];this._sfs.roomManager.containsGroup(s)&&this._log.warn("Subscribe Group error: Group '"+s+"' already subscribed"),this._populateRoomList(e),t.groupId=s,t.newRooms=this._sfs.roomManager.getRoomListFromGroup(s),this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_GROUP_SUBSCRIBE,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_GROUP_SUBSCRIBE_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnUnsubscribeRoomGroup=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.System.UnsubscribeRoomGroupRequest.KEY_GROUP_ID];this._sfs.roomManager.containsGroup(s)||this._log.warn("Unsubscribe Group error: Group '"+s+"' not found (maybe never subscribed, or the Room Manager doesn't contain Rooms belonging to that Group)"),this._sfs.roomManager._removeGroup(s),t.groupId=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_GROUP_UNSUBSCRIBE,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_GROUP_UNSUBSCRIBE_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnSpectatorToPlayer=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_ROOM_ID],i=e[SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_USER_ID],e=e[SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_PLAYER_ID],r=this._sfs.userManager.getUserById(i),n=this._sfs.roomManager.getRoomById(s);null!=n?null!=r?r.isJoinedInRoom(n)?(r._setPlayerId(e,n),t.room=n,t.user=r,t.playerId=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.SPECTATOR_TO_PLAYER,t)):this._log.warn("SpectatorToPlayer event, user "+r+" not joined in Room ",n):this._log.warn("SpectatorToPlayer event, unknown User id: "+i):this._log.warn("SpectatorToPlayer event, unknown Room id: "+s)
}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],i=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=i,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.SPECTATOR_TO_PLAYER_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnPlayerToSpectator=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.System.PlayerToSpectatorRequest.KEY_ROOM_ID],e=e[SFS2X.Requests.System.PlayerToSpectatorRequest.KEY_USER_ID],i=this._sfs.userManager.getUserById(e),r=this._sfs.roomManager.getRoomById(s);null!=r?null!=i?i.isJoinedInRoom(r)?(i._setPlayerId(-1,r),t.room=r,t.user=i,this._sfs._dispatchEvent(SFS2X.SFSEvent.PLAYER_TO_SPECTATOR,t)):this._log.warn("PlayerToSpectator event, user "+i+" not joined in Room ",r):this._log.warn("PlayerToSpectator event, unknown User id: "+e):this._log.warn("PlayerToSpectator event, unknown Room id: "+s)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.PLAYER_TO_SPECTATOR_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnFindRooms=function(e){for(var t={},e=e[SFS2X.Requests.System.FindRoomsRequest.KEY_FILTERED_ROOMS],s=[],i=0;i<e.length;i++){var r=SFS2X.Entities.SFSRoom.fromArray(e[i]),n=this._sfs.roomManager.getRoomById(r.id);null!=n&&(r.isJoined=n.isJoined),s.push(r)}t.rooms=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_FIND_RESULT,t)},SFS2X.Controllers.SystemController.prototype._fnFindUsers=function(e){for(var t={},e=e[SFS2X.Requests.System.FindUsersRequest.KEY_FILTERED_USERS],s=[],i=this._sfs.mySelf,r=0;r<e.length;r++){var n=SFS2X.Entities.SFSUser.fromArray(e[r]);n.id==i.id&&(n=i),s.push(n)}t.users=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_FIND_RESULT,t)},SFS2X.Controllers.SystemController.prototype._fnInviteUsers=function(e){var t={},s=null,s=null!=e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER_ID]?this._sfs.userManager.getUserById(e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER_ID]):SFS2X.Entities.SFSUser.fromArray(e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER]),i=e[SFS2X.Requests.Game.InviteUsersRequest.KEY_INVITATION_ID],e=new SFS2X.Entities.Invitation.SFSInvitation(s,this._sfs.mySelf,e[SFS2X.Requests.Game.InviteUsersRequest.KEY_TIME],e[SFS2X.Requests.Game.InviteUsersRequest.KEY_PARAMS]);e.id=i,t.invitation=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.INVITATION,t)},SFS2X.Controllers.SystemController.prototype._fnInvitationReply=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=null,s=null!=e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER_ID]?this._sfs.userManager.getUserById(e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER_ID]):SFS2X.Entities.SFSUser.fromArray(e[SFS2X.Requests.Game.InviteUsersRequest.KEY_USER]),i=e[SFS2X.Requests.Game.InviteUsersRequest.KEY_REPLY_ID],e=e[SFS2X.Requests.Game.InviteUsersRequest.KEY_PARAMS];t.invitee=s,t.reply=i,t.data=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.INVITATION_REPLY,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.INVITATION_REPLY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnQuickJoinGame=function(e){if(null!=e[SFS2X.Controllers.KEY_ERROR_CODE]){var t=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(t,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),s={};s.errorMessage=e,s.errorCode=t,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_JOIN_ERROR,s)}},SFS2X.Controllers.SystemController.prototype._fnPingPong=function(){var e=this._sfs._lagMonitor._onPingPong(),t={};t.lagValue=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.PING_PONG,t)},SFS2X.Controllers.SystemController.prototype._fnSetUserPosition=function(e){var t={},s=this._sfs.roomManager.getRoomById(e[SFS2X.Requests.MMO.SetUserPositionRequest.KEY_ROOM]),i=e[SFS2X.Requests.MMO.SetUserPositionRequest.KEY_MINUS_USER_LIST],r=e[SFS2X.Requests.MMO.SetUserPositionRequest.KEY_PLUS_USER_LIST],n=e[SFS2X.Requests.MMO.SetUserPositionRequest.KEY_MINUS_ITEM_LIST],e=e[SFS2X.Requests.MMO.SetUserPositionRequest.KEY_PLUS_ITEM_LIST],o=[],a=[],S=[],u=[],_=0;if(null!=i)for(_=0;_<i.length;_++){var l=s.getUserById(i[_]);null!=l&&(s._removeUser(l),a.push(l))}if(null!=r)for(_=0;_<r.length;_++)l=r[_],i=this._getOrCreateUser(l,!0,s),o.push(i),s._addUser(i),l=l[5],null!=l&&(i.aoiEntryPoint=SFS2X.Entities.Data.Vec3D.fromArray(l));if(null!=n)for(_=0;_<n.length;_++)r=s.getMMOItem(n[_]),null!=r&&(s._removeItem(r),u.push(r));if(null!=e)for(_=0;_<e.length;_++)r=e[_],n=SFS2X.Entities.MMOItem.fromArray(r),S.push(n),s._addMMOItem(n),r=r[2],null!=r&&(n.aoiEntryPoint=SFS2X.Entities.Data.Vec3D.fromArray(r));t.addedItems=S,t.removedItems=u,t.removedUsers=a,t.addedUsers=o,t.room=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.PROXIMITY_LIST_UPDATE,t)},SFS2X.Controllers.SystemController.prototype._fnSetMMOItemVariables=function(e){var t={},s=this._sfs.roomManager.getRoomById(e[SFS2X.Requests.MMO.SetMMOItemVariables.KEY_ROOM_ID]),i=e[SFS2X.Requests.MMO.SetMMOItemVariables.KEY_ITEM_ID],e=e[SFS2X.Requests.MMO.SetMMOItemVariables.KEY_VAR_LIST],r=[];if(null!=s&&(i=s.getMMOItem(i),null!=i)){for(var n=0;n<e.length;n++){var o=SFS2X.Entities.Variables.MMOItemVariable.fromArray(e[n]);i._setVariable(o),r.push(o.name)}t.changedVars=r,t.mmoItem=i,t.room=s,this._sfs._dispatchEvent(SFS2X.SFSEvent.MMOITEM_VARIABLES_UPDATE,t)}},SFS2X.Controllers.SystemController.prototype._fnUserEnterRoom=function(e){var t=this._sfs.roomManager.getRoomById(e[SFS2X.Controllers.ROOM_PARAM]);if(null!=t){e=this._getOrCreateUser(e[SFS2X.Controllers.USER_PARAM],!0,t),t._addUser(e);var s={};s.user=e,s.room=t,this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_ENTER_ROOM,s)}},SFS2X.Controllers.SystemController.prototype._fnUserCountChange=function(e){var t=this._sfs.roomManager.getRoomById(e[SFS2X.Controllers.ROOM_PARAM]);if(null!=t){var s=e[SFS2X.Controllers.USER_COUNT_PARAM],i=0;null!=e.sc&&(i=e[SFS2X.Controllers.SPECT_COUNT_PARAM]),t._userCount=s,t._specCount=i,e={},e.room=t,e.uCount=s,e.sCount=i,this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_COUNT_CHANGE,e)}},SFS2X.Controllers.SystemController.prototype._fnUserLost=function(e){if(e=this._sfs.userManager.getUserById(e[SFS2X.Controllers.USER_PARAM]),null!=e){var t=this._sfs.roomManager.getUserRooms(e);this._sfs.roomManager._removeUser(e),this._sfs.userManager._removeUserReference(e,!0);for(var s=0;s<t.length;s++){var i={};i.user=e,i.room=t[s],this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_EXIT_ROOM,i)}}},SFS2X.Controllers.SystemController.prototype._fnRoomLost=function(e){var e=this._sfs.roomManager.getRoomById(e[SFS2X.Controllers.ROOM_PARAM]),t=this._sfs.userManager;if(null!=e){this._sfs.roomManager._removeRoom(e);for(var s=e.getUserList(),i=0;i<s.length;i++)t._removeUser(s[i]);t={},t.room=e,this._sfs._dispatchEvent(SFS2X.SFSEvent.ROOM_REMOVE,t)}},SFS2X.Controllers.SystemController.prototype._fnUserExitRoom=function(e){var t=this._sfs.roomManager.getRoomById(e[SFS2X.Controllers.ROOM_PARAM]),e=this._sfs.userManager.getUserById(e[SFS2X.Controllers.USER_PARAM]);if(null!=t&&null!=e){t._removeUser(e),this._sfs.userManager._removeUser(e),e.isItMe&&t.isJoined&&(t.isJoined=!1,0==this._sfs.roomManager.getJoinedRooms().length&&(this._sfs.lastJoinedRoom=null),t._isManaged||this._sfs.roomManager._removeRoom(t));var s={};s.user=e,s.room=t,this._sfs._dispatchEvent(SFS2X.SFSEvent.USER_EXIT_ROOM,s)}else this._log.debug("Failed to handle UserExit event. Room: "+t+", User: "+e)},SFS2X.Controllers.SystemController.prototype._fnClientDisconnection=function(e){this._sfs._handleClientDisconnection(SFS2X.Utils.ClientDisconnectionReason.getReason(e.dr))},SFS2X.Controllers.SystemController.prototype._fnInitBuddyList=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_BLIST],i=e[SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_MY_VARS],r=e[SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_BUDDY_STATES];for(this._sfs.buddyManager._clearAll(),e=0;e<s.length;e++){var n=SFS2X.Entities.SFSBuddy.fromArray(s[e]);this._sfs.buddyManager._addBuddy(n)}for(null!=r&&this._sfs.buddyManager._setBuddyStates(r),s=[],e=0;e<i.length;e++)r=SFS2X.Entities.Variables.SFSBuddyVariable.fromArray(i[e]),s.push(r);this._sfs.buddyManager._setMyVariables(s),this._sfs.buddyManager._setInited(),t.buddyList=this._sfs.buddyManager.getBuddyList(),t.myVariables=this._sfs.buddyManager.getMyVariables(),this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_LIST_INIT,t)}else i=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(i,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=i,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnAddBuddy=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=SFS2X.Entities.SFSBuddy.fromArray(e[SFS2X.Requests.BuddyList.AddBuddyRequest.KEY_BUDDY_NAME]);this._sfs.buddyManager._addBuddy(s),t.buddy=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ADD,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnRemoveBuddy=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.BuddyList.RemoveBuddyRequest.KEY_BUDDY_NAME],e=this._sfs.buddyManager._removeBuddyByName(s);null!=e?(t.buddy=e,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_REMOVE,t)):this._log.warn("Unexpected: buddy removal failed, can't find "+s+" in local buddy list")}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnBlockBuddy=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY_NAME],i=this._sfs.buddyManager.getBuddyByName(s);if(null!=e[SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY])i=SFS2X.Entities.SFSBuddy.fromArray(e[SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY]),this._sfs.buddyManager._addBuddy(i);else{if(null==i)return this._log.warn("Unexpected: buddy blocking/unblocking failed, can't find "+s+" in local buddy list"),void 0;i.blocked=e[SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY_BLOCK_STATE]}t.buddy=i,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_BLOCK,t)}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnGoOnline=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){var s=e[SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_BUDDY_NAME],i=this._sfs.buddyManager.getBuddyByName(s),r=s==this._sfs.mySelf.name,n=e[SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_ONLINE],o=n==SFS2X.Utils.BuddyOnlineState.ONLINE,a=!0;if(r)this._sfs.buddyManager.getMyOnlineState()!=o&&(this._log.warn("Unexpected: myOnlineState is not in synch with the server; resynching to: "+o),this._sfs.buddyManager._setMyOnlineState(o));else{if(null==i)return this._log.warn("Unexpected:  buddy '"+s+"' not found in local Buddy List when trying to set his online state"),void 0;i.id=e[SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_BUDDY_ID],i._setVariable(new SFS2X.Entities.Variables.SFSBuddyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_ONLINE,o)),n==SFS2X.Utils.BuddyOnlineState.LEFT_THE_SERVER&&i._clearVolatileVariables(),a=this._sfs.buddyManager.getMyOnlineState()}a&&(t.buddy=i,t.isItMe=r,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ONLINE_STATE_CHANGE,t))}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._fnSetBuddyVariables=function(e){var t={};if(null==e[SFS2X.Controllers.KEY_ERROR_CODE]){for(var s=e[SFS2X.Requests.BuddyList.SetBuddyVariablesRequest.KEY_BUDDY_NAME],e=e[SFS2X.Requests.BuddyList.SetBuddyVariablesRequest.KEY_BUDDY_VARS],i=this._sfs.buddyManager.getBuddyByName(s),r=s==this._sfs.mySelf.name,n=[],o=[],a=!0,S=0;S<e.length;S++){var u=SFS2X.Entities.Variables.SFSBuddyVariable.fromArray(e[S]);o.push(u),n.push(u.name)}if(r)this._sfs.buddyManager._setMyVariables(o);else{if(null==i)return this._log.warn("Unexpected:  buddy '"+s+"' not found in local Buddy List when trying to set his Buddy Variables"),void 0;i._setVariables(o),a=this._sfs.buddyManager.getMyOnlineState()}a&&(t.buddy=i,t.isItMe=r,t.changedVars=n,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_VARIABLES_UPDATE,t))}else s=e[SFS2X.Controllers.KEY_ERROR_CODE],e=SFS2X.ErrorCodes.getErrorMessage(s,e[SFS2X.Controllers.KEY_ERROR_PARAMS]),t.errorMessage=e,t.errorCode=s,this._sfs._dispatchEvent(SFS2X.SFSBuddyEvent.BUDDY_ERROR,t)},SFS2X.Controllers.SystemController.prototype._populateRoomList=function(e){for(var t=this._sfs.roomManager,s=0;s<e.length;s++){var i=SFS2X.Entities.SFSRoom.fromArray(e[s]);t._replaceRoom(i)}},SFS2X.Controllers.SystemController.prototype._getOrCreateUser=function(e,t,s){null==t&&(t=!1);var i=this._sfs.userManager.getUserById(e[0]);if(null==i)i=SFS2X.Entities.SFSUser.fromArray(e,s),i._setUserManager(this._sfs.userManager);else if(null!=s)for(i._setPlayerId(e[3],s),e=e[4],s=0;s<e.length;s++)i._setVariable(SFS2X.Entities.Variables.SFSUserVariable.fromArray(e[s]));return t&&this._sfs.userManager._addUser(i),i},SFS2X.Controllers.ExtensionController=function(e){this.KEY_CMD="c",this.KEY_PARAMS="p",this.KEY_ROOM="r",this._sfs=e,this._id=1,this._log=SFS2X.Logger},SFS2X.Controllers.ExtensionController.prototype.getId=function(){return this._id},SFS2X.Controllers.ExtensionController.prototype.handleMessage=function(e){this._sfs.debug&&this._log.info("IN < ExtensionResponse");var t={};if(t.cmd=e[this.KEY_CMD],t.params=e[this.KEY_PARAMS],null!=e[this.KEY_ROOM]){var e=e[this.KEY_ROOM],s=this._sfs.roomManager.getRoomById(e);t.sourceRoom=e,t.room=s}this._sfs._dispatchEvent(SFS2X.SFSEvent.EXTENSION_RESPONSE,t)},SFS2X.DebugHelper={},SFS2X.DebugHelper.getDump=function(e){return void 0==e?"<Null>":e instanceof Object?this._dumpObject(e):"<Not An Object>"},SFS2X.DebugHelper._dumpObject=function(e){function t(e,s,i){var r=null;SFS2X.DebugHelper._getTabs(i);for(var n in e){var o=e[n];if(null==o)r="Null";else{var a=o.constructor,S=void 0;a===Array||a===Object?(r=null,S=a===Array?"[Array]":"[Object]",t(o,s,i+1)):r=o.constructor===Number?"Num":o.constructor===Boolean?"Bool":o.constructor===String?"Str":"Unsupported"}s.push(SFS2X.DebugHelper._getTabs(i)+n+": "+(void 0==S?o:S)+(void 0==r?"":" ("+r+")"))}}var s=[];return t(e,s,0),SFS2X.DebugHelper._prettyPrint(s)},SFS2X.DebugHelper._getTabs=function(e){if(0>=e)return"";if(1==e)return"	";for(var t="",s=0;e>s;s++)t+="	";return t},SFS2X.DebugHelper._prettyPrint=function(e){for(var t="",s=e.length-1;s>-1;s--)t+=e[s]+"\n";return t},SFS2X.Entities={},SFS2X.Entities.Data={},SFS2X.Entities.Variables={},SFS2X.Entities.Match={},SFS2X.Entities.Invitation={},SFS2X.Entities.SFSRoom=Class.extend({init:function(e,t,s){this.id=e,this.name=t,this.groupId=null!=s?s:"default",this.isPasswordProtected=this.isJoined=this.isHidden=this.isGame=!1,this._specCount=this._userCount=this.maxSpectators=this.maxUsers=0,this._isManaged=!0,this.variables={},this.properties={},this._userManager=new SFS2X.Managers.UserManager,this._roomManager=null},toString:function(){return"[Room: "+this.name+", Id: "+this.id+", Group id: "+this.groupId+"]"},getUserCount:function(){return this.isJoined?this.isGame?this.getPlayerList().length:this._userManager.getUserCount():this._userCount},getSpectatorCount:function(){return this.isGame?this.isJoined?this.getSpectatorList().length:this._specCount:0},getCapacity:function(){return this.maxUsers+this.maxSpectators},getUserByName:function(e){return this._userManager.getUserByName(e)},getUserById:function(e){return this._userManager.getUserById(e)},containsUser:function(e){return this._userManager.containsUser(e)},getUserList:function(){return this._userManager.getUserList()},getPlayerList:function(){for(var e=[],t=this._userManager.getUserList(),s=0;s<t.length;s++){var i=t[s];i.isPlayerInRoom(this)&&e.push(i)}return e},getSpectatorList:function(){for(var e=[],t=this._userManager.getUserList(),s=0;s<t.length;s++){var i=t[s];i.isSpectatorInRoom(this)&&e.push(i)}return e},getVariable:function(e){return this.variables[e]},containsVariable:function(e){return null!=this.variables[e]},getVariables:function(){return SFS2X.Utils.ArrayUtil.objToArray(this.variables)},getRoomManager:function(){return this._roomManager},_addUser:function(e){this._userManager._addUser(e)},_removeUser:function(e){this._userManager._removeUser(e)},_setVariables:function(e){for(var t=0;t<e.length;t++)this._setVariable(e[t])},_setVariable:function(e){e.isNull()?delete this.variables[e.name]:this.variables[e.name]=e},_setRoomManager:function(e){if(null!=this._roomManager)throw new SFS2X.Exceptions.SFSError("Room Manager already assigned to Room "+this.toString());this._roomManager=e},_merge:function(e){this.variables=[];for(var t in e.variables)this.variables[t]=e.variables[t];for(this._userManager._clearAll(),e=e.getUserList(),t=0;t<e.length;t++)this._userManager._addUser(e[t])}}),SFS2X.Entities.SFSRoom.fromArray=function(e){var t=14==e.length,s=null,s=t?new SFS2X.Entities.MMORoom(e[0],e[1],e[2]):new SFS2X.Entities.SFSRoom(e[0],e[1],e[2]);s.isGame=e[3],s.isHidden=e[4],s.isPasswordProtected=e[5],s._userCount=e[6],s.maxUsers=e[7];var i=e[8];if(null!=i)for(var r=0;r<i.length;r++){var n=SFS2X.Entities.Variables.SFSRoomVariable.fromArray(i[r]);s._setVariable(n)}return s.isGame&&(s._specCount=e[9],s.maxSpectators=e[10]),t&&(s.defaultAOI=SFS2X.Entities.Data.Vec3D.fromArray(e[11]),null!=e[13]&&(s.lowerMapLimit=SFS2X.Entities.Data.Vec3D.fromArray(e[12]),s.higherMapLimit=SFS2X.Entities.Data.Vec3D.fromArray(e[13]))),s},SFS2X.Entities.MMORoom=SFS2X.Entities.SFSRoom.extend({init:function(e,t,s){this._super(e,t,s),this.higherMapLimit=this.lowerMapLimit=this.defaultAOI=null,this._itemsById={}},getMMOItem:function(e){return this._itemsById[e]},getMMOItems:function(){return SFS2X.Utils.ArrayUtil.objToArray(this._itemsById)},_addMMOItem:function(e){this._itemsById[e.id]=e},_removeItem:function(e){delete this._itemsById[e]}}),SFS2X.Entities.SFSUser=function(e,t,s){this.id=e,this.name=t,this.isItMe=null!=s?s:!1,this.privilegeId=0,this.properties={},this.aoiEntryPoint=null,this.variables={},this._playerIdByRoomId={},this._userManager=null},SFS2X.Entities.SFSUser.fromArray=function(e,t){var s=new SFS2X.Entities.SFSUser(e[0],e[1]);s.privilegeId=e[2],null!=t&&s._setPlayerId(e[3],t);var i=e[4];if(null!=i)for(var r=0;r<i.length;r++){var n=SFS2X.Entities.Variables.SFSUserVariable.fromArray(i[r]);s._setVariable(n)}return s},SFS2X.Entities.SFSUser.prototype.toString=function(){return"[User: "+this.name+", Id: "+this.id+", Is me: "+this.isItMe+"]"},SFS2X.Entities.SFSUser.prototype.isJoinedInRoom=function(e){return e.containsUser(this)},SFS2X.Entities.SFSUser.prototype.isGuest=function(){return this.privilegeId==SFS2X.Entities.UserPrivileges.GUEST},SFS2X.Entities.SFSUser.prototype.isStandardUser=function(){return this.privilegeId==SFS2X.Entities.UserPrivileges.STANDARD},SFS2X.Entities.SFSUser.prototype.isModerator=function(){return this.privilegeId==SFS2X.Entities.UserPrivileges.MODERATOR},SFS2X.Entities.SFSUser.prototype.isAdmin=function(){return this.privilegeId==SFS2X.Entities.UserPrivileges.ADMINISTRATOR},SFS2X.Entities.SFSUser.prototype.isPlayer=function(){return this.isPlayerInRoom(this._userManager._sfs.lastJoinedRoom)},SFS2X.Entities.SFSUser.prototype.isSpectator=function(){return this.isSpectatorInRoom(this._userManager._sfs.lastJoinedRoom)},SFS2X.Entities.SFSUser.prototype.getPlayerId=function(e){var t=0;return null!=this._playerIdByRoomId[e.id]&&(t=this._playerIdByRoomId[e.id]),t},SFS2X.Entities.SFSUser.prototype.isPlayerInRoom=function(e){return null!=e&&e.isGame?0<this._playerIdByRoomId[e.id]:!1},SFS2X.Entities.SFSUser.prototype.isSpectatorInRoom=function(e){return null!=e&&e.isGame?0>this._playerIdByRoomId[e.id]:!1},SFS2X.Entities.SFSUser.prototype.getVariable=function(e){return this.variables[e]},SFS2X.Entities.SFSUser.prototype.containsVariable=function(e){return null!=this.variables[e]},SFS2X.Entities.SFSUser.prototype.getVariables=function(){return SFS2X.Utils.ArrayUtil.objToArray(this.variables)},SFS2X.Entities.SFSUser.prototype.getUserManager=function(){return this._userManager},SFS2X.Entities.SFSUser.prototype._setPlayerId=function(e,t){this._playerIdByRoomId[t.id]=e},SFS2X.Entities.SFSUser.prototype._removePlayerId=function(e){delete this._playerIdByRoomId[e.id]},SFS2X.Entities.SFSUser.prototype._setVariables=function(e){for(var t=0;t<e.length;t++)this._setVariable(e[t])},SFS2X.Entities.SFSUser.prototype._setVariable=function(e){e.isNull()?delete this.variables[e.name]:this.variables[e.name]=e},SFS2X.Entities.SFSUser.prototype._setUserManager=function(e){if(null!=this._userManager)throw new SFS2X.Exceptions.SFSError("User Manager already assigned to user "+this.toString());this._userManager=e},SFS2X.Entities.SFSBuddy=function(e,t,s,i){this.id=e,this.name=t,this.blocked=null!=s?s:!1,this.temp=null!=i?i:!1,this.variables={}},SFS2X.Entities.SFSBuddy.fromArray=function(e){for(var t=new SFS2X.Entities.SFSBuddy(e[0],e[1],e[2],4<e.length?e[4]:!1),e=e[3],s=0;s<e.length;s++){var i=SFS2X.Entities.Variables.SFSBuddyVariable.fromArray(e[s]);t._setVariable(i)}return t},SFS2X.Entities.SFSBuddy.prototype.toString=function(){return"[Buddy: "+this.name+", Id: "+this.id+"]"},SFS2X.Entities.SFSBuddy.prototype.isBlocked=function(){return this.blocked},SFS2X.Entities.SFSBuddy.prototype.isTemp=function(){return this.temp},SFS2X.Entities.SFSBuddy.prototype.isOnline=function(){var e=!0,t=SFS2X.Entities.Variables.ReservedBuddyVariables.BV_ONLINE;return this.containsVariable(t)&&(e=this.getVariable(t).value),e&&-1<this.id},SFS2X.Entities.SFSBuddy.prototype.getState=function(){var e=SFS2X.Entities.Variables.ReservedBuddyVariables.BV_STATE;return this.containsVariable(e)?this.getVariable(e).value:null},SFS2X.Entities.SFSBuddy.prototype.getNickName=function(){var e=SFS2X.Entities.Variables.ReservedBuddyVariables.BV_NICKNAME;return this.containsVariable(e)?this.getVariable(e).value:null},SFS2X.Entities.SFSBuddy.prototype.getVariable=function(e){return this.variables[e]},SFS2X.Entities.SFSBuddy.prototype.containsVariable=function(e){return null!=this.variables[e]},SFS2X.Entities.SFSBuddy.prototype.getVariables=function(){return SFS2X.Utils.ArrayUtil.objToArray(this.variables)},SFS2X.Entities.SFSBuddy.prototype.getOfflineVariables=function(){var e,t=[];for(e in this.variables){var s=this.variables[e];s.name.charAt(0)==SFS2X.Entities.Variables.SFSBuddyVariable.OFFLINE_PREFIX&&t.push(s)}return t},SFS2X.Entities.SFSBuddy.prototype.getOnlineVariables=function(){var e,t=[];for(e in this.variables){var s=this.variables[e];s.name.charAt(0)!=SFS2X.Entities.Variables.SFSBuddyVariable.OFFLINE_PREFIX&&t.push(s)}return t},SFS2X.Entities.SFSBuddy.prototype._setVariables=function(e){for(var t=0;t<e.length;t++)this._setVariable(e[t])},SFS2X.Entities.SFSBuddy.prototype._setVariable=function(e){e.isNull()?this._removeVariable(e.name):this.variables[e.name]=e},SFS2X.Entities.SFSBuddy.prototype._removeVariable=function(e){delete this.variables[e]},SFS2X.Entities.SFSBuddy.prototype._clearVolatileVariables=function(){for(var e in this.variables){var t=this.variables[e];t.name.charAt(0)!=SFS2X.Entities.Variables.SFSBuddyVariable.OFFLINE_PREFIX&&this._removeVariable(t.name)}},SFS2X.Entities.MMOItem=function(e){this.id=e,this.aoiEntryPoint=null,this.variables={}},SFS2X.Entities.MMOItem.fromArray=function(e){var t=new SFS2X.Entities.MMOItem(e[0]),e=e[1];if(null!=e)for(var s=0;s<e.length;s++){var i=SFS2X.Entities.Variables.MMOItemVariable.fromArray(e[s]);t._setVariable(i)}return t},SFS2X.Entities.MMOItem.prototype.toString=function(){return"[Item: "+this.id+"]"},SFS2X.Entities.MMOItem.prototype.getVariable=function(e){return this.variables[e]},SFS2X.Entities.MMOItem.prototype.containsVariable=function(e){return null!=this.variables[e]},SFS2X.Entities.MMOItem.prototype.getVariables=function(){return SFS2X.Utils.ArrayUtil.objToArray(this.variables)},SFS2X.Entities.MMOItem.prototype._setVariables=function(e){for(var t=0;t<e.length;t++)this._setVariable(e[t])},SFS2X.Entities.MMOItem.prototype._setVariable=function(e){null!=e&&(e.isNull()?delete this.variables[e.name]:this.variables[e.name]=e)},SFS2X.Entities.Variables.BaseVariable=Class.extend({init:function(e,t,s){this.name=e,this.value=t,this._setType(s)},toArray:function(){return[this.name,SFS2X.Entities.Variables.VariableType.getTypeIdFromName(this.type),this.value]},isNull:function(){return SFS2X.Entities.Variables.VariableType.getTypeIdFromName(this.type)==SFS2X.Entities.Variables.VariableType.NULL},_setType:function(e){null==e&&(e=-1),e>-1?this.type=this.getTypeName(e):null==this.value?this.type=this.getTypeName(SFS2X.Entities.Variables.VariableType.NULL):(e=typeof this.value,"boolean"==e?this.type=this.getTypeName(SFS2X.Entities.Variables.VariableType.BOOL):"number"==e?(e=this.value,this.type=e===+e&&e===(0|e)?this.getTypeName(SFS2X.Entities.Variables.VariableType.INT):this.getTypeName(SFS2X.Entities.Variables.VariableType.DOUBLE)):"string"==e?this.type=this.getTypeName(SFS2X.Entities.Variables.VariableType.STRING):"object"==e&&(this.type=this.value instanceof Array?this.getTypeName(SFS2X.Entities.Variables.VariableType.ARRAY):this.getTypeName(SFS2X.Entities.Variables.VariableType.OBJECT)))},getTypeName:function(e){return SFS2X.Entities.Variables.VariableType.getTypeName(e)}}),SFS2X.Entities.Variables.SFSUserVariable=SFS2X.Entities.Variables.BaseVariable.extend({init:function(e,t,s){this._super(e,t,s),this.isPrivate=!1},toString:function(){return"[UserVar: "+this.name+", Type: "+this.type+", Value: "+this.value+", Private: "+this.isPrivate+"]"},toArray:function(){var e=this._super();return e.push(this.isPrivate),e}}),SFS2X.Entities.Variables.SFSUserVariable.fromArray=function(e){var t=new SFS2X.Entities.Variables.SFSUserVariable(e[0],e[2],e[1]);return 3<e.length&&(t.isPrivate=e[3]),t},SFS2X.Entities.Variables.SFSRoomVariable=SFS2X.Entities.Variables.BaseVariable.extend({init:function(e,t,s){this._super(e,t,s),this.isPersistent=this.isPrivate=!1},toString:function(){return"[RoomVar: "+this.name+", Type: "+this.type+", Value: "+this.value+", Private: "+this.isPrivate+"]"},toArray:function(){var e=this._super();return e.push(this.isPrivate),e.push(this.isPersistent),e}}),SFS2X.Entities.Variables.SFSRoomVariable.fromArray=function(e){var t=new SFS2X.Entities.Variables.SFSRoomVariable(e[0],e[2],e[1]);return t.isPrivate=e[3],t.isPersistent=e[4],t},SFS2X.Entities.Variables.SFSBuddyVariable=SFS2X.Entities.Variables.BaseVariable.extend({init:function(e,t,s){this._super(e,t,s)},toString:function(){return"[BuddyVar: "+this.name+", Type: "+this.type+", Value: "+this.value+"]"},isOffline:function(){return this.name.charAt(0)==SFS2X.Entities.Variables.SFSBuddyVariable.OFFLINE_PREFIX}}),SFS2X.Entities.Variables.SFSBuddyVariable.OFFLINE_PREFIX="$",SFS2X.Entities.Variables.SFSBuddyVariable.fromArray=function(e){return new SFS2X.Entities.Variables.SFSBuddyVariable(e[0],e[2],e[1])},SFS2X.Entities.Variables.MMOItemVariable=SFS2X.Entities.Variables.BaseVariable.extend({init:function(e,t,s){this._super(e,t,s)},toString:function(){return"[ItemVar: "+this.name+", Type: "+this.type+", Value: "+this.value+"]"}}),SFS2X.Entities.Variables.MMOItemVariable.fromArray=function(e){return new SFS2X.Entities.Variables.MMOItemVariable(e[0],e[2],e[1])},SFS2X.Entities.Variables.VariableType={_typeStrings:"Null Bool Int Double String Object Array".split(" "),NULL:0,BOOL:1,INT:2,DOUBLE:3,STRING:4,OBJECT:5,ARRAY:6},SFS2X.Entities.Variables.VariableType.getTypeName=function(e){return this._typeStrings[e]},SFS2X.Entities.Variables.VariableType.getTypeIdFromName=function(e){return this._typeStrings.indexOf(e)},SFS2X.Entities.Variables.ReservedBuddyVariables={},SFS2X.Entities.Variables.ReservedBuddyVariables.BV_ONLINE="$__BV_ONLINE__",SFS2X.Entities.Variables.ReservedBuddyVariables.BV_STATE="$__BV_STATE__",SFS2X.Entities.Variables.ReservedBuddyVariables.BV_NICKNAME="$__BV_NICKNAME__",SFS2X.Entities.Variables.ReservedRoomVariables={},SFS2X.Entities.Variables.ReservedRoomVariables.RV_GAME_STARTED="$GS",SFS2X.Entities.UserPrivileges={},SFS2X.Entities.UserPrivileges.GUEST=0,SFS2X.Entities.UserPrivileges.STANDARD=1,SFS2X.Entities.UserPrivileges.MODERATOR=2,SFS2X.Entities.UserPrivileges.ADMINISTRATOR=3,SFS2X.Entities.Match.MatchExpression=function(e,t,s){this.varName=e,this.condition=t,this.value=s,this._parent=this.next=this.logicOp=null},SFS2X.Entities.Match.MatchExpression.chainedMatchExpression=function(e,t,s,i,r){return e=new SFS2X.Entities.Match.MatchExpression(e,t,s),e.logicOp=i,e._parent=r,e},SFS2X.Entities.Match.MatchExpression.prototype.and=function(e,t,s){return this.next=SFS2X.Entities.Match.MatchExpression.chainedMatchExpression(e,t,s,SFS2X.Entities.Match.LogicOperator.AND,this)},SFS2X.Entities.Match.MatchExpression.prototype.or=function(e,t,s){return this.next=SFS2X.Entities.Match.MatchExpression.chainedMatchExpression(e,t,s,SFS2X.Entities.Match.LogicOperator.OR,this)},SFS2X.Entities.Match.MatchExpression.prototype.hasNext=function(){return null!=this.next},SFS2X.Entities.Match.MatchExpression.prototype.rewind=function(){for(var e=this;null!=e._parent;)e=e._parent;return e},SFS2X.Entities.Match.MatchExpression.prototype.toString=function(){for(var e=this.rewind(),t=e._asString();e.hasNext();)e=e.next,t+=e._asString();return t},SFS2X.Entities.Match.MatchExpression.prototype._asString=function(){var e="";return null!=this.logicOp&&(e+=" "+this.logicOp.id+" "),e=e+"("+(this.varName+" "+this.condition.symbol+" "+("string"==typeof this.value?"'"+this.value+"'":this.value)),e+")"},SFS2X.Entities.Match.MatchExpression.prototype._toArray=function(){var e=this.rewind(),t=[];for(t.push(e._expressionAsArray());e.hasNext();)e=e.next,t.push(e._expressionAsArray());return t},SFS2X.Entities.Match.MatchExpression.prototype._expressionAsArray=function(){var e=[];return null!=this.logicOp?e.push(this.logicOp.id):e.push(null),e.push(this.varName),e.push(this.condition.type),e.push(this.condition.symbol),e.push(this.value),e},SFS2X.Entities.Match.LogicOperator=function(e){this.id=e},SFS2X.Entities.Match.LogicOperator.AND=new SFS2X.Entities.Match.LogicOperator("AND"),SFS2X.Entities.Match.LogicOperator.OR=new SFS2X.Entities.Match.LogicOperator("OR"),SFS2X.Entities.Match.BoolMatch=function(e){this.type=0,this.symbol=e},SFS2X.Entities.Match.BoolMatch.EQUALS=new SFS2X.Entities.Match.BoolMatch("=="),SFS2X.Entities.Match.BoolMatch.NOT_EQUALS=new SFS2X.Entities.Match.BoolMatch("!="),SFS2X.Entities.Match.NumberMatch=function(e){this.type=1,this.symbol=e},SFS2X.Entities.Match.NumberMatch.EQUALS=new SFS2X.Entities.Match.NumberMatch("=="),SFS2X.Entities.Match.NumberMatch.NOT_EQUALS=new SFS2X.Entities.Match.NumberMatch("!="),SFS2X.Entities.Match.NumberMatch.GREATER_THAN=new SFS2X.Entities.Match.NumberMatch(">"),SFS2X.Entities.Match.NumberMatch.GREATER_THAN_OR_EQUAL_TO=new SFS2X.Entities.Match.NumberMatch(">="),SFS2X.Entities.Match.NumberMatch.LESS_THAN=new SFS2X.Entities.Match.NumberMatch("<"),SFS2X.Entities.Match.NumberMatch.LESS_THAN_OR_EQUAL_TO=new SFS2X.Entities.Match.NumberMatch("<="),SFS2X.Entities.Match.StringMatch=function(e){this.type=2,this.symbol=e
},SFS2X.Entities.Match.StringMatch.EQUALS=new SFS2X.Entities.Match.StringMatch("=="),SFS2X.Entities.Match.StringMatch.NOT_EQUALS=new SFS2X.Entities.Match.StringMatch("!="),SFS2X.Entities.Match.StringMatch.CONTAINS=new SFS2X.Entities.Match.StringMatch("contains"),SFS2X.Entities.Match.StringMatch.STARTS_WITH=new SFS2X.Entities.Match.StringMatch("startsWith"),SFS2X.Entities.Match.StringMatch.ENDS_WITH=new SFS2X.Entities.Match.StringMatch("endsWith"),SFS2X.Entities.Match.RoomProperties={},SFS2X.Entities.Match.RoomProperties.NAME="${N}",SFS2X.Entities.Match.RoomProperties.GROUP_ID="${G}",SFS2X.Entities.Match.RoomProperties.MAX_USERS="${MXU}",SFS2X.Entities.Match.RoomProperties.MAX_SPECTATORS="${MXS}",SFS2X.Entities.Match.RoomProperties.USER_COUNT="${UC}",SFS2X.Entities.Match.RoomProperties.SPECTATOR_COUNT="${SC}",SFS2X.Entities.Match.RoomProperties.IS_GAME="${ISG}",SFS2X.Entities.Match.RoomProperties.IS_PRIVATE="${ISP}",SFS2X.Entities.Match.RoomProperties.HAS_FREE_PLAYER_SLOTS="${HFP}",SFS2X.Entities.Match.RoomProperties.IS_TYPE_SFSGAME="${IST}",SFS2X.Entities.Match.UserProperties={},SFS2X.Entities.Match.UserProperties.NAME="${N}",SFS2X.Entities.Match.UserProperties.IS_PLAYER="${ISP}",SFS2X.Entities.Match.UserProperties.IS_SPECTATOR="${ISS}",SFS2X.Entities.Match.UserProperties.IS_NPC="${ISN}",SFS2X.Entities.Match.UserProperties.PRIVILEGE_ID="${PRID}",SFS2X.Entities.Match.UserProperties.IS_IN_ANY_ROOM="${IAR}",SFS2X.Entities.Invitation.SFSInvitation=function(e,t,s,i){this.id=-1,this.inviter=e,this.invitee=t,this.secondsForAnswer=null!=s?s:15,this.params=i},SFS2X.Entities.Invitation.InvitationReply={},SFS2X.Entities.Invitation.InvitationReply.ACCEPT=0,SFS2X.Entities.Invitation.InvitationReply.REFUSE=1,SFS2X.Entities.Invitation.InvitationReply.EXPIRED=255,SFS2X.Entities.Data.Vec3D=function(e,t,s){this.px=null!=e?e:0,this.py=null!=t?t:0,this.pz=null!=s?s:0},SFS2X.Entities.Data.Vec3D.fromArray=function(e){return new SFS2X.Entities.Data.Vec3D(e[0],e[1],e[2])},SFS2X.Entities.Data.Vec3D.prototype.isFloat=function(){return!(this.px===parseInt(this.px)&&this.py===parseInt(this.py)&&this.pz===parseInt(this.pz))},SFS2X.Entities.Data.Vec3D.prototype._toString=function(){return"("+this.px+", "+this.py+", "+this.pz+")"},SFS2X.Entities.Data.Vec3D.prototype._toArray=function(){return[this.px,this.py,this.pz]},SFS2X.ErrorCodes={},SFS2X.ErrorCodes._errorsByCode=["Client API version is obsolete: {0}; required version: {1}","Requested Zone {0} does not exist","User name {0} is not recognized","Wrong password for user {0}","User {0} is banned","Zone {0} is full","User {0} is already logged in Zone {1}","The server is full","Zone {0} is currently inactive","User name {0} contains bad words; filtered: {1}","Guest users not allowed in Zone {0}","IP address {0} is banned","A Room with the same name already exists: {0}","Requested Group is not available - Room: {0}; Group: {1}","Bad Room name length -  Min: {0}; max: {1}; passed name length: {2}","Room name contains bad words: {0}","Zone is full; can't add Rooms anymore","You have exceeded the number of Rooms that you can create per session: {0}","Room creation failed, wrong parameter: {0}","User {0} already joined in Room","Room {0} is full","Wrong password for Room {0}","Requested Room does not exist","Room {0} is locked","Group {0} is already subscribed","Group {0} does not exist","Group {0} is not subscribed","Group {0} does not exist","{0}","Room permission error; Room {0} cannot be renamed","Room permission error; Room {0} cannot change password state","Room permission error; Room {0} cannot change capacity","Switch user error; no player slots available in Room {0}","Switch user error; no spectator slots available in Room {0}","Switch user error; Room {0} is not a Game Room","Switch user error; you are not joined in Room {0}","Buddy Manager initialization error, could not load buddy list: {0}","Buddy Manager error, your buddy list is full; size is {0}","Buddy Manager error, was not able to block buddy {0} because offline","Buddy Manager error, you are attempting to set too many Buddy Variables; limit is {0}","Game {0} access denied, user does not match access criteria","QuickJoinGame action failed: no matching Rooms were found","Your previous invitation reply was invalid or arrived too late"],SFS2X.ErrorCodes.setErrorMessage=function(e,t){this._errorsByCode[e]=t},SFS2X.ErrorCodes.getErrorMessage=function(e,t){return this.stringFormat(this._errorsByCode[e],t)},SFS2X.ErrorCodes.stringFormat=function(e,t){if(null==e)return"";if(null!=t)for(var s=0;s<t.length;s++)e=e.replace("{"+s+"}",t[s]);return e},SFS2X.EventDispatcher=function(){this.listenersByEvent={}},SFS2X.EventDispatcher.prototype.addEventListener=function(e,t,s){null==this.listenersByEvent[e]&&(this.listenersByEvent[e]=[]),this.listenersByEvent[e].push({listener:t,scope:s})},SFS2X.EventDispatcher.prototype.removeEventListener=function(e,t){var s=this.listenersByEvent[e];if(null!=s)for(var i=0;i<s.length;i++)if(s[i].listener===t){s.splice(i,1);break}},SFS2X.EventDispatcher.prototype.dispatchEvent=function(e,t){var s=this.listenersByEvent[e];if(s&&0<s.length)for(var i=0;i<s.length;i++)s[i].listener.call(s[i].scope,t)},SFS2X.EventDispatcher.prototype.getListeners=function(e){return listeners[e]},SFS2X.SFSEvent={HANDSHAKE:"handshake",CONNECTION:"connection",CONNECTION_LOST:"connectionLost",CONNECTION_RETRY:"connectionRetry",CONNECTION_RESUME:"connectionResume",LOGIN:"login",LOGIN_ERROR:"loginError",LOGOUT:"logout",ROOM_ADD:"roomAdd",ROOM_CREATION_ERROR:"roomCreationError",ROOM_REMOVE:"roomRemove",ROOM_JOIN:"roomJoin",ROOM_JOIN_ERROR:"roomJoinError",USER_ENTER_ROOM:"userEnterRoom",USER_EXIT_ROOM:"userExitRoom",USER_COUNT_CHANGE:"userCountChange",PROXIMITY_LIST_UPDATE:"proximityListUpdate",PLAYER_TO_SPECTATOR:"playerToSpectator",PLAYER_TO_SPECTATOR_ERROR:"playerToSpectatorError",SPECTATOR_TO_PLAYER:"spectatorToPlayer",SPECTATOR_TO_PLAYER_ERROR:"spectatorToPlayerError",ROOM_NAME_CHANGE:"roomNameChange",ROOM_NAME_CHANGE_ERROR:"roomNameChangeError",ROOM_PASSWORD_STATE_CHANGE:"roomPasswordStateChange",ROOM_PASSWORD_STATE_CHANGE_ERROR:"roomPasswordStateChangeError",ROOM_CAPACITY_CHANGE:"roomCapacityChange",ROOM_CAPACITY_CHANGE_ERROR:"roomCapacityChangeError",PUBLIC_MESSAGE:"publicMessage",PRIVATE_MESSAGE:"privateMessage",OBJECT_MESSAGE:"objectMessage",MODERATOR_MESSAGE:"moderatorMessage",ADMIN_MESSAGE:"adminMessage",EXTENSION_RESPONSE:"extensionResponse",ROOM_VARIABLES_UPDATE:"roomVariablesUpdate",USER_VARIABLES_UPDATE:"userVariablesUpdate",MMOITEM_VARIABLES_UPDATE:"mmoItemVariablesUpdate",ROOM_GROUP_SUBSCRIBE:"roomGroupSubscribe",ROOM_GROUP_SUBSCRIBE_ERROR:"roomGroupSubscribeError",ROOM_GROUP_UNSUBSCRIBE:"roomGroupUnsubscribe",ROOM_GROUP_UNSUBSCRIBE_ERROR:"roomGroupUnsubscribeError",ROOM_FIND_RESULT:"roomFindResult",USER_FIND_RESULT:"userFindResult",INVITATION:"invitation",INVITATION_REPLY:"invitationReply",INVITATION_REPLY_ERROR:"invitationReplyError",PING_PONG:"pingPong",SOCKET_ERROR:"socketError"},SFS2X.SFSBuddyEvent={BUDDY_LIST_INIT:"buddyListInit",BUDDY_ADD:"buddyAdd",BUDDY_REMOVE:"buddyRemove",BUDDY_BLOCK:"buddyBlock",BUDDY_ERROR:"buddyError",BUDDY_ONLINE_STATE_CHANGE:"buddyOnlineStateChange",BUDDY_VARIABLES_UPDATE:"buddyVariablesUpdate",BUDDY_MESSAGE:"buddyMessage"},SFS2X.Exceptions={},SFS2X.Exceptions.SFSError=Class.extend({init:function(e){this._messsage=e},getMessage:function(){return this._messsage}}),SFS2X.Exceptions.SFSValidationError=SFS2X.Exceptions.SFSError.extend({init:function(e,t){this._super(e),this._errrors=t},getErrors:function(){return this._errrors}}),SFS2X.LogLevel={DEBUG:0,INFO:1,WARN:2,ERROR:3},SFS2X._Logger=function(){this.isAvailable=void 0!=console,this.level=SFS2X.LogLevel.INFO},SFS2X.Logger=new SFS2X._Logger,SFS2X._Logger.prototype.setLevel=function(e){e<SFS2X.LogLevel.DEBUG||e>SFS2X.LogLevel.ERROR||(this.level=e)},SFS2X._Logger.prototype.debug=function(e){this.isAvailable&&this.level<=SFS2X.LogLevel.DEBUG&&console.log("[DEBUG] "+e)},SFS2X._Logger.prototype.info=function(e){this.isAvailable&&this.level<=SFS2X.LogLevel.INFO&&console.log("[INFO] "+e)},SFS2X._Logger.prototype.warn=function(e){this.isAvailable&&this.level<=SFS2X.LogLevel.WARN&&console.log("[WARN] "+e)},SFS2X._Logger.prototype.error=function(e){this.isAvailable&&console.log("[ERROR] "+e)},SFS2X.Managers={},SFS2X.Managers.UserManager=Class.extend({init:function(e){this._sfs=e,this._usersById=new SFS2X.Utils.HashTable,this._usersByName=new SFS2X.Utils.HashTable},containsUserName:function(e){return this._usersByName.hasItem(e)},containsUserId:function(e){return this._usersById.hasItem(e)},containsUser:function(e){return this._usersById.hasItem(e.id)},getUserById:function(e){return this._usersById.getItem(e)},getUserByName:function(e){return this._usersByName.getItem(e)},getUserCount:function(){return this._usersById.length},getUserList:function(){return this._usersById.values()},_addUser:function(e){this._usersById.hasItem(e.id)&&SFS2X.Logger.warn("Unexpected, duplicate user in UserManager: "+e.toString()),this.__addUser(e)},__addUser:function(e){this._usersByName.setItem(e.name,e),this._usersById.setItem(e.id,e)},_removeUser:function(e){this.__removeUser(e)},__removeUser:function(e){this._usersById.removeItem(e.id),this._usersByName.removeItem(e.name)},_removeUserById:function(){this._usersById.removeItem(user.id),this._usersByName.removeItem(user.name)},_clearAll:function(){this._usersById.clear(),this._usersByName.clear()}}),SFS2X.Managers.GlobalUserManager=SFS2X.Managers.UserManager.extend({init:function(e){this._super(e),this._roomRefCount=[]},_addUser:function(e){null==this._roomRefCount[e]?this._roomRefCount[e]=1:this._roomRefCount[e]++,this.__addUser(e)},_removeUser:function(e){this._removeUserReference(e,!1)},_removeUserReference:function(e,t){null!=this._roomRefCount?1>this._roomRefCount[e]?SFS2X.Logger.warn("GlobalUserManager RefCount is already at zero. User: "+e):(this._roomRefCount[e]--,(0==this._roomRefCount[e]||t)&&(this.__removeUser(e),delete this._roomRefCount[e])):SFS2X.Logger.warn("Can't remove User from GlobalUserManager. RefCount missing. User: "+e)},dumpRefCount:function(){}}),SFS2X.Managers.RoomManager=function(e){this._sfs=e,this._ownerZone=null,this._groups=[],this._roomsById=new SFS2X.Utils.HashTable,this._roomsByName=new SFS2X.Utils.HashTable},SFS2X.Managers.RoomManager.prototype.getRoomGroups=function(){return this._groups},SFS2X.Managers.RoomManager.prototype.containsGroup=function(e){return-1<this._groups.indexOf(e)},SFS2X.Managers.RoomManager.prototype.containsRoom=function(e){return"number"==typeof e?this._roomsById.hasItem(e):this._roomsByName.hasItem(e)},SFS2X.Managers.RoomManager.prototype.containsRoomInGroup=function(e,t){var s,i=this.getRoomListFromGroup(t),r=!1,n="number"==typeof e;for(s in i){var o=i[s];if(o instanceof SFS2X.Entities.SFSRoom)if(n){if(o.id==e){r=!0;break}}else if(o.name==e){r=!0;break}}return r},SFS2X.Managers.RoomManager.prototype.getRoomById=function(e){return this._roomsById.getItem(e)},SFS2X.Managers.RoomManager.prototype.getRoomByName=function(e){return this._roomsByName.getItem(e)},SFS2X.Managers.RoomManager.prototype.getRoomList=function(){return this._roomsById.values()},SFS2X.Managers.RoomManager.prototype.getRoomCount=function(){return this._roomsById.length},SFS2X.Managers.RoomManager.prototype.getRoomListFromGroup=function(e){var t,s=[];for(t in this._roomsById.items){var i=this._roomsById.items[t];i instanceof SFS2X.Entities.SFSRoom&&i.groupId==e&&s.push(i)}return s},SFS2X.Managers.RoomManager.prototype.getJoinedRooms=function(){var e,t=[];for(e in this._roomsById.items){var s=this._roomsById.items[e];s instanceof SFS2X.Entities.SFSRoom&&s.isJoined&&t.push(s)}return t},SFS2X.Managers.RoomManager.prototype.getUserRooms=function(e){var t,s=[];for(t in this._roomsById.items){var i=this._roomsById.items[t];i instanceof SFS2X.Entities.SFSRoom&&i.containsUser(e)&&s.push(i)}return s},SFS2X.Managers.RoomManager.prototype._addRoom=function(e,t){null==t&&(t=!0),this._roomsById.setItem(e.id,e),this._roomsByName.setItem(e.name,e),t?this.containsGroup(e.groupId)||this._addGroup(e.groupId):e._isManaged=!1},SFS2X.Managers.RoomManager.prototype._replaceRoom=function(e,t){null==t&&(t=!0);var s=this.getRoomById(e.id);return null!=s?(s._merge(e),s):(this._addRoom(e,t),e)},SFS2X.Managers.RoomManager.prototype._removeRoom=function(e){this._roomsById.removeItem(e.id),this._roomsByName.removeItem(e.name)},SFS2X.Managers.RoomManager.prototype._removeRoomById=function(e){e=this.getRoomById(e),null!=e&&this._removeRoom(e)},SFS2X.Managers.RoomManager.prototype._removeRoomByName=function(e){e=this.getRoomByName(e),null!=e&&this._removeRoom(e)},SFS2X.Managers.RoomManager.prototype._changeRoomName=function(e,t){var s=e.name;e.name=t,this._roomsByName.setItem(t,e),this._roomsByName.removeItem(s)},SFS2X.Managers.RoomManager.prototype._changeRoomPasswordState=function(e,t){e.isPasswordProtected=t},SFS2X.Managers.RoomManager.prototype._changeRoomCapacity=function(e,t,s){e.maxUsers=t,e.maxSpectators=s},SFS2X.Managers.RoomManager.prototype._addGroup=function(e){this._groups.push(e)},SFS2X.Managers.RoomManager.prototype._removeGroup=function(e){SFS2X.Utils.ArrayUtil.removeItem(this._groups,e);var t,e=this.getRoomListFromGroup(e);for(t in e){var s=e[t];s instanceof SFS2X.Entities.SFSRoom&&(s.isJoined?s._isManaged=!1:this._removeRoom(s))}},SFS2X.Managers.RoomManager.prototype._removeUser=function(e){for(var t in this._roomsById.items){var s=this._roomsById.items[t];s instanceof SFS2X.Entities.SFSRoom&&s.containsUser(e)&&s._removeUser(e)}},SFS2X.Managers.BuddyManager=function(e){this._sfs=e,this._buddiesByName=[],this._myVariables=[],this._inited=!1,this._buddyStates=[]},SFS2X.Managers.BuddyManager.prototype.isInited=function(){return this._inited},SFS2X.Managers.BuddyManager.prototype.containsBuddy=function(e){return null!=this.getBuddyByName(e)},SFS2X.Managers.BuddyManager.prototype.getBuddyById=function(e){if(e>-1)for(var t in this._buddiesByName){var s=this._buddiesByName[t];if(s instanceof SFS2X.Entities.SFSBuddy&&s.id==e)return s}return null},SFS2X.Managers.BuddyManager.prototype.getBuddyByName=function(e){return this._buddiesByName[e]},SFS2X.Managers.BuddyManager.prototype.getBuddyByNickName=function(e){for(var t in this._buddiesByName){var s=this._buddiesByName[t];if(s instanceof SFS2X.Entities.SFSBuddy&&s.nickName==e)return s}return null},SFS2X.Managers.BuddyManager.prototype.getOfflineBuddies=function(){var e,t=[];for(e in this._buddiesByName){var s=this._buddiesByName[e];s instanceof SFS2X.Entities.SFSBuddy&&!s.isOnline()&&t.push(s)}return t},SFS2X.Managers.BuddyManager.prototype.getOnlineBuddies=function(){var e,t=[];for(e in this._buddiesByName){var s=this._buddiesByName[e];s instanceof SFS2X.Entities.SFSBuddy&&s.isOnline()&&t.push(s)}return t},SFS2X.Managers.BuddyManager.prototype.getBuddyList=function(){return SFS2X.Utils.ArrayUtil.objToArray(this._buddiesByName)},SFS2X.Managers.BuddyManager.prototype.getMyVariable=function(e){return this._myVariables[e]},SFS2X.Managers.BuddyManager.prototype.getMyVariables=function(){return SFS2X.Utils.ArrayUtil.objToArray(this._myVariables)},SFS2X.Managers.BuddyManager.prototype.getMyOnlineState=function(){if(!this._inited)return!1;var e=!0,t=this.getMyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_ONLINE);return null!=t&&(e=t.value),e},SFS2X.Managers.BuddyManager.prototype.getMyNickName=function(){var e=this.getMyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_NICKNAME);return null!=e?e.value:null},SFS2X.Managers.BuddyManager.prototype.getMyState=function(){var e=this.getMyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_STATE);return null!=e?e.value:null},SFS2X.Managers.BuddyManager.prototype.getBuddyStates=function(){return this._buddyStates},SFS2X.Managers.BuddyManager.prototype._setInited=function(){this._inited=!0},SFS2X.Managers.BuddyManager.prototype._addBuddy=function(e){this._buddiesByName[e.name]=e},SFS2X.Managers.BuddyManager.prototype._clearAll=function(){this._buddiesByName=[]},SFS2X.Managers.BuddyManager.prototype._removeBuddyById=function(e){return e=this.getBuddyById(e),null!=e&&delete this._buddiesByName[e.name],e},SFS2X.Managers.BuddyManager.prototype._removeBuddyByName=function(e){var t=this.getBuddyByName(e);return null!=t&&delete this._buddiesByName[e],t},SFS2X.Managers.BuddyManager.prototype._setMyVariables=function(e){for(var t=0;t<e.length;t++)this._setMyVariable(e[t])},SFS2X.Managers.BuddyManager.prototype._setMyVariable=function(e){e.isNull()?delete this._myVariables[e.name]:this._myVariables[e.name]=e},SFS2X.Managers.BuddyManager.prototype._setMyOnlineState=function(e){e=new SFS2X.Entities.Variables.SFSBuddyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_ONLINE,e),this._setMyVariable(e)},SFS2X.Managers.BuddyManager.prototype._setMyNickName=function(e){e=new SFS2X.Entities.Variables.SFSBuddyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_NICKNAME,e),this._setMyVariable(e)},SFS2X.Managers.BuddyManager.prototype._setMyState=function(e){e=new SFS2X.Entities.Variables.SFSBuddyVariable(SFS2X.Entities.Variables.ReservedBuddyVariables.BV_STATE,e),this._setMyVariable(e)},SFS2X.Managers.BuddyManager.prototype._setBuddyStates=function(e){this._buddyStates=e},SFS2X.Requests={},SFS2X.Requests.System={},SFS2X.Requests.MMO={},SFS2X.Requests.BuddyList={},SFS2X.Requests.Game={},SFS2X.Requests._BaseRequest=Class.extend({init:function(e){this._reqObj={},this._id=e,this._targetController=0,this._log=SFS2X.Logger},getMessage:function(){return{a:this._id,c:this._targetController,p:this._reqObj}},validate:function(){this._log.error("BaseRequest.validate = no child-class implementation found!")},execute:function(){this._log.error("BaseRequest.execute = no child-class implementation found!")}}),SFS2X.Requests.System.HandshakeRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.Handshake),this._apiVersion=e,this._clientDetails=t,this._reconnectionToken=s},validate:function(){},execute:function(){this._reqObj[this.constructor.KEY_API]=this._apiVersion,this._reqObj[this.constructor.KEY_CLIENT_TYPE]=this._clientDetails,null!=this._reconnectionToken&&(this.reqObj[this.constructor.KEY_RECONNECTION_TOKEN]=this._reconnectionToken)}}),SFS2X.Requests.System.HandshakeRequest.KEY_SESSION_TOKEN="tk",SFS2X.Requests.System.HandshakeRequest.KEY_API="api",SFS2X.Requests.System.HandshakeRequest.KEY_COMPRESSION_THRESHOLD="ct",SFS2X.Requests.System.HandshakeRequest.KEY_RECONNECTION_TOKEN="rt",SFS2X.Requests.System.HandshakeRequest.KEY_CLIENT_TYPE="cl",SFS2X.Requests.System.HandshakeRequest.KEY_MAX_MESSAGE_SIZE="ms",SFS2X.Requests.System.LoginRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s,i){this._super(SFS2X.Requests.Login),this._userName=e,this._password=t,this._params=s,this._zoneName=i},validate:function(e){if(null!=e.mySelf)throw new SFS2X.Exceptions.SFSValidationError("LoginRequest error",["You are already logged in; logout before attempting a new login"]);if(e=null!=e.config&&null!=e.config.zone?e.config.zone:null,null!=this._zoneName&&(e=this._zoneName),null==e||0==e.length)throw new SFS2X.Exceptions.SFSValidationError("LoginRequest Error",["Missing Zone name"]);this._zoneName=e,null==this._userName&&(this._userName=""),null==this._password&&(this._password="")},execute:function(e){this._reqObj[this.constructor.KEY_ZONE_NAME]=this._zoneName,this._reqObj[this.constructor.KEY_USER_NAME]=this._userName,this._reqObj[this.constructor.KEY_PASSWORD]=0<this._password.length?hex_md5(e.sessionToken+this._password):"",null!=this._params&&(this._reqObj[this.constructor.KEY_PARAMS]=this._params)}}),SFS2X.Requests.System.LoginRequest.KEY_ZONE_NAME="zn",SFS2X.Requests.System.LoginRequest.KEY_USER_NAME="un",SFS2X.Requests.System.LoginRequest.KEY_PASSWORD="pw",SFS2X.Requests.System.LoginRequest.KEY_PARAMS="p",SFS2X.Requests.System.LoginRequest.KEY_PRIVILEGE_ID="pi",SFS2X.Requests.System.LoginRequest.KEY_ID="id",SFS2X.Requests.System.LoginRequest.KEY_ROOMLIST="rl",SFS2X.Requests.System.LoginRequest.KEY_RECONNECTION_SECONDS="rs",SFS2X.Requests.System.LogoutRequest=SFS2X.Requests._BaseRequest.extend({init:function(){this._super(SFS2X.Requests.Logout)},validate:function(e){if(null==e.mySelf)throw new SFS2X.Exceptions.SFSValidationError("LogoutRequest error",["You are not logged in"])},execute:function(){}}),SFS2X.Requests.System.LogoutRequest.KEY_ZONE_NAME="zn",SFS2X.Requests.System.JoinRoomRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s,i){this._super(SFS2X.Requests.JoinRoom),"string"==typeof e?this._rName=e:"number"==typeof e?this._rId=e:e instanceof SFS2X.Entities.SFSRoom&&(this._rId=e.id,this._rName=e.name),this._password=t,this._roomIdToLeave=s,this._asSpectator="boolean"==typeof i?i:!1},validate:function(){if(null==this._rId&&null==this._rName)throw new SFS2X.Exceptions.SFSValidationError("JoinRoomRequest Error",["Missing Room id or name, please provide one of the two or an existing Room object"])},execute:function(e){e._isJoining=!0,0<=this._rId?this._reqObj[this.constructor.KEY_ROOM_ID]=this._rId:null!=this._rName&&(this._reqObj[this.constructor.KEY_ROOM_NAME]=this._rName),null!=this._password&&(this._reqObj[this.constructor.KEY_PASS]=this._password),null!=this._roomIdToLeave&&(this._reqObj[this.constructor.KEY_ROOM_TO_LEAVE]=this._roomIdToLeave),this._asSpectator&&(this._reqObj[this.constructor.KEY_AS_SPECTATOR]=this._asSpectator)}}),SFS2X.Requests.System.JoinRoomRequest.KEY_ROOM="r",SFS2X.Requests.System.JoinRoomRequest.KEY_USER_LIST="ul",SFS2X.Requests.System.JoinRoomRequest.KEY_ROOM_NAME="n",SFS2X.Requests.System.JoinRoomRequest.KEY_ROOM_ID="i",SFS2X.Requests.System.JoinRoomRequest.KEY_PASS="p",SFS2X.Requests.System.JoinRoomRequest.KEY_ROOM_TO_LEAVE="rl",SFS2X.Requests.System.JoinRoomRequest.KEY_AS_SPECTATOR="sp",SFS2X.Requests.System.CreateRoomRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.CreateRoom),this._settings=e,this._autoJoin="boolean"==typeof t?t:!1,this._roomToLeave=s},validate:function(){var e=[];if((null==this._settings.name||0==this._settings.name.length)&&e.push("Missing Room name"),0>=this._settings.maxUsers&&e.push("Max number of users must be > 0"),null!=this._settings.extension&&((null==this._settings.extension.className||0==this._settings.extension.className.length)&&e.push("Missing Extension class name"),(null==this._settings.extension.id||0==this._settings.extension.id.length)&&e.push("Missing Extension id")),this._settings instanceof SFS2X.Requests.MMO.MMORoomSettings&&(null==this._settings.defaultAOI&&e.push("Missing default AoI (Area of Interest)"),null!=this._settings.mapLimits&&(null==this._settings.mapLimits.lowerLimit||null==this._settings.mapLimits.higherLimit)&&e.push("Map limits must be both defined")),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("CreateRoomRequest Error",e)},execute:function(){if(this._reqObj[this.constructor.KEY_NAME]=this._settings.name,this._reqObj[this.constructor.KEY_GROUP_ID]=this._settings.groupId,this._reqObj[this.constructor.KEY_PASSWORD]=this._settings.password,this._reqObj[this.constructor.KEY_ISGAME]=this._settings.isGame,this._reqObj[this.constructor.KEY_MAXUSERS]=this._settings.maxUsers,this._reqObj[this.constructor.KEY_MAXSPECTATORS]=this._settings.maxSpectators,this._reqObj[this.constructor.KEY_MAXVARS]=this._settings.maxVariables,this._reqObj[this.constructor.KEY_ALLOW_JOIN_INVITATION_BY_OWNER]=this._settings.allowOwnerOnlyInvitation,null!=this._settings.variables&&0<this._settings.variables.length){var e,t=[];for(e in this._settings.variables){var s=this._settings.variables[e];s instanceof SFS2X.Entities.Variables.SFSRoomVariable&&t.push(s.toArray())}this._reqObj[this.constructor.KEY_ROOMVARS]=t}null!=this._settings.permissions&&(t=[],t.push(this._settings.permissions.allowNameChange),t.push(this._settings.permissions.allowPasswordStateChange),t.push(this._settings.permissions.allowPublicMessages),t.push(this._settings.permissions.allowResizing),this._reqObj[this.constructor.KEY_PERMISSIONS]=t),null!=this._settings.events&&(t=[],t.push(this._settings.events.allowUserEnter),t.push(this._settings.events.allowUserExit),t.push(this._settings.events.allowUserCountChange),t.push(this._settings.events.allowUserVariablesUpdate),this._reqObj[this.constructor.KEY_EVENTS]=t),null!=this._settings.extension&&(this._reqObj[this.constructor.KEY_EXTID]=this._settings.extension.id,this._reqObj[this.constructor.KEY_EXTCLASS]=this._settings.extension.className,null!=this._settings.extension.propertiesFile&&0<this._settings.extension.propertiesFile.length&&(this._reqObj[this.constructor.KEY_EXTPROP]=this._settings.extension.propertiesFile)),this._settings instanceof SFS2X.Requests.MMO.MMORoomSettings&&(this._reqObj[this.constructor.KEY_MMO_DEFAULT_AOI]=this._settings.defaultAOI._toArray(),null!=this._settings.mapLimits&&(this._reqObj[this.constructor.KEY_MMO_MAP_LOW_LIMIT]=this._settings.mapLimits.lowerLimit._toArray(),this._reqObj[this.constructor.KEY_MMO_MAP_HIGH_LIMIT]=this._settings.mapLimits.higherLimit._toArray()),this._reqObj[this.constructor.KEY_MMO_USER_MAX_LIMBO_SECONDS]=this._settings.userMaxLimboSeconds,this._reqObj[this.constructor.KEY_MMO_PROXIMITY_UPDATE_MILLIS]=this._settings.proximityListUpdateMillis,this._reqObj[this.constructor.KEY_MMO_SEND_ENTRY_POINT]=this._settings.sendAOIEntryPoint),this._reqObj[this.constructor.KEY_AUTOJOIN]=this._autoJoin,null!=this._roomToLeave&&(this._reqObj[this.constructor.KEY_ROOM_TO_LEAVE]=this._roomToLeave.id)}}),SFS2X.Requests.System.CreateRoomRequest.KEY_ROOM="r",SFS2X.Requests.System.CreateRoomRequest.KEY_NAME="n",SFS2X.Requests.System.CreateRoomRequest.KEY_PASSWORD="p",SFS2X.Requests.System.CreateRoomRequest.KEY_GROUP_ID="g",SFS2X.Requests.System.CreateRoomRequest.KEY_ISGAME="ig",SFS2X.Requests.System.CreateRoomRequest.KEY_MAXUSERS="mu",SFS2X.Requests.System.CreateRoomRequest.KEY_MAXSPECTATORS="ms",SFS2X.Requests.System.CreateRoomRequest.KEY_MAXVARS="mv",SFS2X.Requests.System.CreateRoomRequest.KEY_ROOMVARS="rv",SFS2X.Requests.System.CreateRoomRequest.KEY_PERMISSIONS="pm",SFS2X.Requests.System.CreateRoomRequest.KEY_EVENTS="ev",SFS2X.Requests.System.CreateRoomRequest.KEY_EXTID="xn",SFS2X.Requests.System.CreateRoomRequest.KEY_EXTCLASS="xc",SFS2X.Requests.System.CreateRoomRequest.KEY_EXTPROP="xp",SFS2X.Requests.System.CreateRoomRequest.KEY_AUTOJOIN="aj",SFS2X.Requests.System.CreateRoomRequest.KEY_ROOM_TO_LEAVE="rl",SFS2X.Requests.System.CreateRoomRequest.KEY_ALLOW_JOIN_INVITATION_BY_OWNER="aji",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_DEFAULT_AOI="maoi",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_MAP_LOW_LIMIT="mllm",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_MAP_HIGH_LIMIT="mlhm",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_USER_MAX_LIMBO_SECONDS="muls",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_PROXIMITY_UPDATE_MILLIS="mpum",SFS2X.Requests.System.CreateRoomRequest.KEY_MMO_SEND_ENTRY_POINT="msep",SFS2X.Requests.System.GenericMessageRequest=SFS2X.Requests._BaseRequest.extend({init:function(){this._super(SFS2X.Requests.GenericMessage),this._type=-1,this._recipient=this._params=this._message=this._user=this._room=null,this._sendMode=-1},validate:function(e){if(0>this._type)throw new SFS2X.Exceptions.SFSValidationError("GenericMessageRequest Error",["Unsupported message type: "+this._type]);var t=[];switch(this._type){case SFS2X.Requests.GenericMessageType.PUBLIC_MSG:this._validatePublicMessage(e,t);break;case SFS2X.Requests.GenericMessageType.PRIVATE_MSG:this._validatePrivateMessage(e,t);break;case SFS2X.Requests.GenericMessageType.OBJECT_MSG:this._validateObjectMessage(e,t);break;case SFS2X.Requests.GenericMessageType.BUDDY_MSG:this._validateBuddyMessage(e,t);break;default:this._validateSuperUserMessage(e,t)}if(0<t.length)throw new SFS2X.Exceptions.SFSValidationError("GenericMessageRequest Error",t)},execute:function(e){switch(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE_TYPE]=this._type,this._type){case SFS2X.Requests.GenericMessageType.PUBLIC_MSG:this._executePublicMessage(e);break;case SFS2X.Requests.GenericMessageType.PRIVATE_MSG:this._executePrivateMessage(e);break;case SFS2X.Requests.GenericMessageType.OBJECT_MSG:this._executeObjectMessage(e);break;case SFS2X.Requests.GenericMessageType.BUDDY_MSG:this._executeBuddyMessage(e);break;default:this._executeSuperUserMessage(e)}},_validatePublicMessage:function(e,t){(null==this._message||0==this._message.length)&&t.push("Public message is empty"),null!=this._room&&!e.mySelf.isJoinedInRoom(this._room)&&t.push("You are not joined in the target Room: "+this._room)},_validatePrivateMessage:function(e,t){(null==this._message||0==this._message.length)&&t.push("Private message is empty"),0>this._recipient&&t.push("Invalid recipient id: "+this._recipient)},_validateObjectMessage:function(e,t){null==this._params&&t.push("Object message is null")},_validateBuddyMessage:function(e,t){e.buddyManager.isInited||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),0==e.buddyManager.myOnlineState&&t.push("Can't send messages while you are offline in the Buddy List system"),(null==this._message||0==this._message.length)&&t.push("Buddy message is empty"),0>this._recipient&&t.push("Recipient is offline or not in your Buddy List")},_validateSuperUserMessage:function(e,t){switch((null==this._message||0==this._message.length)&&t.push("Moderator message is empty"),this._sendMode){case SFS2X.Requests.MessageRecipientMode.TO_USER:this._recipient instanceof SFS2X.Entities.SFSUser||t.push("SFSUser object expected as recipient");break;case SFS2X.Requests.MessageRecipientMode.TO_ROOM:this._recipient instanceof SFS2X.Entities.SFSRoom||t.push("SFSRoom object expected as recipient");break;case SFS2X.Requests.MessageRecipientMode.TO_GROUP:"string"!=typeof this._recipient&&t.push("String object (the groupId) expected as recipient")}},_executePublicMessage:function(e){if(null==this._room&&(this._room=e.lastJoinedRoom),null==this._room)throw new SFS2X.Exceptions.SFSError("User should be joined in a Room in order to send a public message");this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_ROOM_ID]=this._room.id,this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID]=e.mySelf.id,this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE]=this._message,null!=this._params&&(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS]=this._params)},_executePrivateMessage:function(){this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=this._recipient,this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE]=this._message,null!=this._params&&(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS]=this._params)},_executeBuddyMessage:function(){this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=this._recipient,this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE]=this._message,null!=this._params&&(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS]=this._params)},_executeSuperUserMessage:function(){switch(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE]=this._message,null!=this._params&&(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS]=this._params),this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT_MODE]=this._sendMode,this._sendMode){case SFS2X.Requests.MessageRecipientMode.TO_USER:this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=this._recipient.id;break;case SFS2X.Requests.MessageRecipientMode.TO_ROOM:this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=this._recipient.id;break;case SFS2X.Requests.MessageRecipientMode.TO_GROUP:this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=this._recipient}},_executeObjectMessage:function(e){if(null==this._room&&(this._room=e.lastJoinedRoom),null==this._room)throw new SFS2X.Exceptions.SFSError("User should be joined in a Room in order to send an object message");
if(e=[],null!=this._recipient&&this._recipient instanceof Array){var t=this._recipient;if(t.length>this._room.capacity)throw new SFS2X.Exceptions.SFSError("The number of recipients is bigger than the target Room capacity: "+t.length);for(var s in t){var i=t[s];i instanceof SFS2X.Entities.SFSUser?e.push(i.id):this._log.warn("Bad recipient in ObjectMessage recipient list: "+typeof i+"; expected type: SFSUser")}}this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_ROOM_ID]=this._room.id,this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS]=this._params,0<e.length&&(this._reqObj[SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT]=e)}}),SFS2X.Requests.System.GenericMessageRequest.KEY_ROOM_ID="r",SFS2X.Requests.System.GenericMessageRequest.KEY_USER_ID="u",SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE="m",SFS2X.Requests.System.GenericMessageRequest.KEY_MESSAGE_TYPE="t",SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT="rc",SFS2X.Requests.System.GenericMessageRequest.KEY_RECIPIENT_MODE="rm",SFS2X.Requests.System.GenericMessageRequest.KEY_XTRA_PARAMS="p",SFS2X.Requests.System.GenericMessageRequest.KEY_SENDER_DATA="sd",SFS2X.Requests.System.ChangeRoomNameRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t){this._super(SFS2X.Requests.ChangeRoomName),this._room=e,this._newName=t},validate:function(){var e=[];if(null==this._room&&e.push("Provided Room is null"),(null==this._newName||0==this._newName.length)&&e.push("Invalid new room name: it must be a non-null and non-empty string"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("ChangeRoomNameRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_ROOM]=this._room.id,this._reqObj[this.constructor.KEY_NAME]=this._newName}}),SFS2X.Requests.System.ChangeRoomNameRequest.KEY_ROOM="r",SFS2X.Requests.System.ChangeRoomNameRequest.KEY_NAME="n",SFS2X.Requests.System.ChangeRoomPasswordStateRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t){this._super(SFS2X.Requests.ChangeRoomPassword),this._room=e,this._newPass=t},validate:function(){var e=[];if(null==this._room&&e.push("Provided Room is null"),null==this._newPass&&e.push("Invalid new room name: it must be a non-null string"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("ChangeRoomPasswordStateRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_ROOM]=this._room.id,this._reqObj[this.constructor.KEY_PASS]=this._newPass}}),SFS2X.Requests.System.ChangeRoomPasswordStateRequest.KEY_ROOM="r",SFS2X.Requests.System.ChangeRoomPasswordStateRequest.KEY_PASS="p",SFS2X.Requests.System.ObjectMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){this._super(),this._type=SFS2X.Requests.GenericMessageType.OBJECT_MSG,this._params=e,this._room=t,this._recipient=s}}),SFS2X.Requests.System.SetRoomVariablesRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t){this._super(SFS2X.Requests.SetRoomVariables),this._roomVariables=e,this._room=t},validate:function(e){var t=[];if(null!=this._room?this._room.containsUser(e.mySelf)||t.push("You are not joined in the target Room"):null==e.lastJoinedRoom&&t.push("You are not joined in any Room"),(null==this._roomVariables||0==this._roomVariables.length)&&t.push("No variables were specified"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("SetRoomVariablesRequest Error",t)},execute:function(e){var t,s=[];for(t in this._roomVariables){var i=this._roomVariables[t];i instanceof SFS2X.Entities.Variables.SFSRoomVariable&&s.push(i.toArray())}null==this._room&&(this._room=e.lastJoinedRoom),this._reqObj[this.constructor.KEY_VAR_LIST]=s,this._reqObj[this.constructor.KEY_VAR_ROOM]=this._room.id}}),SFS2X.Requests.System.SetRoomVariablesRequest.KEY_VAR_ROOM="r",SFS2X.Requests.System.SetRoomVariablesRequest.KEY_VAR_LIST="vl",SFS2X.Requests.System.SetUserVariablesRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.SetUserVariables),this._userVariables=e},validate:function(){var e=[];if((null==this._userVariables||0==this._userVariables.length)&&e.push("No variables were specified"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("SetUserVariablesRequest Error",e)},execute:function(){var e,t=[];for(e in this._userVariables){var s=this._userVariables[e];s instanceof SFS2X.Entities.Variables.SFSUserVariable&&t.push(s.toArray())}this._reqObj[this.constructor.KEY_VAR_LIST]=t}}),SFS2X.Requests.System.SetUserVariablesRequest.KEY_USER="u",SFS2X.Requests.System.SetUserVariablesRequest.KEY_VAR_LIST="vl",SFS2X.Requests.System.ExtensionRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.CallExtension),this._targetController=1,this._extCmd=e,this._params=t,this._room=s,null==this._params&&(this._params={})},validate:function(){var e=[];if((null==this._extCmd||0==this._extCmd.length)&&e.push("Missing extension command"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("ExtensionRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_CMD]=this._extCmd,this._reqObj[this.constructor.KEY_ROOM]=null==this._room?-1:this._room.id,this._reqObj[this.constructor.KEY_PARAMS]=this._params}}),SFS2X.Requests.System.ExtensionRequest.KEY_CMD="c",SFS2X.Requests.System.ExtensionRequest.KEY_PARAMS="p",SFS2X.Requests.System.ExtensionRequest.KEY_ROOM="r",SFS2X.Requests.System.LeaveRoomRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.LeaveRoom),this._room=e},validate:function(e){if(1>e.getJoinedRooms().length)throw new SFS2X.Exceptions.SFSValidationError("LeaveRoomRequest Error",["You are not joined in any room"])},execute:function(){null!=this._room&&(this._reqObj[this.constructor.KEY_ROOM_ID]=this._room.id)}}),SFS2X.Requests.System.LeaveRoomRequest.KEY_ROOM_ID="r",SFS2X.Requests.System.SubscribeRoomGroupRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.SubscribeRoomGroup),this._groupId=e},validate:function(){var e=[];if((null==this._groupId||0==this._groupId.length)&&e.push("Invalid group id passed; must be a string with at least one character"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("SubscribeGroupRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_GROUP_ID]=this._groupId}}),SFS2X.Requests.System.SubscribeRoomGroupRequest.KEY_GROUP_ID="g",SFS2X.Requests.System.SubscribeRoomGroupRequest.KEY_ROOM_LIST="rl",SFS2X.Requests.System.UnsubscribeRoomGroupRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.UnsubscribeRoomGroup),this._groupId=e},validate:function(){var e=[];if((null==this._groupId||0==this._groupId.length)&&e.push("Invalid group id passed; must be a string with at least one character"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("UnsubscribeGroupRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_GROUP_ID]=this._groupId}}),SFS2X.Requests.System.UnsubscribeRoomGroupRequest.KEY_GROUP_ID="g",SFS2X.Requests.System.SpectatorToPlayerRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.SpectatorToPlayer),this._room=e},validate:function(e){if(1>e.getJoinedRooms().length)throw new SFS2X.Exceptions.SFSValidationError("SpectatorToPlayerRequest Error",["You are not joined in any room"])},execute:function(e){null==this._room&&(this._room=e.lastJoinedRoom),this._reqObj[this.constructor.KEY_ROOM_ID]=this._room.id}}),SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_ROOM_ID="r",SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_USER_ID="u",SFS2X.Requests.System.SpectatorToPlayerRequest.KEY_PLAYER_ID="p",SFS2X.Requests.System.PlayerToSpectatorRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.PlayerToSpectator),this._room=e},validate:function(e){if(1>e.getJoinedRooms().length)throw new SFS2X.Exceptions.SFSValidationError("PlayerToSpectatorRequest Error",["You are not joined in any room"])},execute:function(e){null==this._room&&(this._room=e.lastJoinedRoom),this._reqObj[this.constructor.KEY_ROOM_ID]=this._room.id}}),SFS2X.Requests.System.PlayerToSpectatorRequest.KEY_ROOM_ID="r",SFS2X.Requests.System.PlayerToSpectatorRequest.KEY_USER_ID="u",SFS2X.Requests.System.ChangeRoomCapacityRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.ChangeRoomCapacity),this._room=e,this._newMaxUsers=t,this._newMaxSpect=s},validate:function(){var e=[];if(null==this._room&&e.push("Provided Room is null"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("ChangeRoomCapacityRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_ROOM]=this._room.id,this._reqObj[this.constructor.KEY_USER_SIZE]=this._newMaxUsers,this._reqObj[this.constructor.KEY_SPEC_SIZE]=this._newMaxSpect}}),SFS2X.Requests.System.ChangeRoomCapacityRequest.KEY_ROOM="r",SFS2X.Requests.System.ChangeRoomCapacityRequest.KEY_USER_SIZE="u",SFS2X.Requests.System.ChangeRoomCapacityRequest.KEY_SPEC_SIZE="s",SFS2X.Requests.System.PublicMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){this._super(),this._type=SFS2X.Requests.GenericMessageType.PUBLIC_MSG,this._message=e,this._room=s,this._params=t}}),SFS2X.Requests.System.PrivateMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){this._super(),this._type=SFS2X.Requests.GenericMessageType.PRIVATE_MSG,this._message=e,this._recipient=t,this._params=s}}),SFS2X.Requests.System.ModeratorMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){if(this._super(),null==t)throw new SFS2X.Exceptions.SFSError("Recipient mode cannot be null");this._type=SFS2X.Requests.GenericMessageType.MODERATOR_MSG,this._message=e,this._params=s,this._recipient=t.target,this._sendMode=t.mode}}),SFS2X.Requests.System.AdminMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){if(this._super(),null==t)throw new SFS2X.Exceptions.SFSError("Recipient mode cannot be null");this._type=SFS2X.Requests.GenericMessageType.ADMING_MSG,this._message=e,this._params=s,this._recipient=t.target,this._sendMode=t.mode}}),SFS2X.Requests.System.KickUserRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.KickUser),null==s&&(s=5),0>s&&(s=0),this._userId=e,this._message=t,this._delay=s},validate:function(){var e=[];if(0<e.length)throw new SFS2X.Exceptions.SFSValidationError("KickUserRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_USER_ID]=this._userId,this._reqObj[this.constructor.KEY_DELAY]=this._delay,null!=this._message&&0<this._message.length&&(this._reqObj[this.constructor.KEY_MESSAGE]=this._message)}}),SFS2X.Requests.System.KickUserRequest.KEY_USER_ID="u",SFS2X.Requests.System.KickUserRequest.KEY_MESSAGE="m",SFS2X.Requests.System.KickUserRequest.KEY_DELAY="d",SFS2X.Requests.System.BanUserRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s,i,r){this._super(SFS2X.Requests.BanUser),null==s&&(s=1),null==i&&(i=5),null==r&&(r=24),this._userId=e,this._message=t,this._banMode=s,this._delay=i,this._durationHours=r},validate:function(){var e=[];if(0<e.length)throw new SFS2X.Exceptions.SFSValidationError("BanUserRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_USER_ID]=this._userId,this._reqObj[this.constructor.KEY_DELAY]=this._delay,this._reqObj[this.constructor.KEY_BAN_MODE]=this._banMode,this._reqObj[this.constructor.KEY_BAN_DURATION_HOURS]=this._durationHours,null!=this._message&&0<this._message.length&&(this._reqObj[this.constructor.KEY_MESSAGE]=this._message)}}),SFS2X.Requests.System.BanUserRequest.KEY_USER_ID="u",SFS2X.Requests.System.BanUserRequest.KEY_MESSAGE="m",SFS2X.Requests.System.BanUserRequest.KEY_DELAY="d",SFS2X.Requests.System.BanUserRequest.KEY_BAN_MODE="b",SFS2X.Requests.System.BanUserRequest.KEY_BAN_DURATION_HOURS="dh",SFS2X.Requests.System.ManualDisconnectionRequest=SFS2X.Requests._BaseRequest.extend({init:function(){this._super(SFS2X.Requests.ManualDisconnection)},validate:function(){},execute:function(){}}),SFS2X.Requests.System.FindRoomsRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.FindRooms),null==s&&(s=0),this._matchExpr=e,this._groupId=t,this._limit=s},validate:function(){var e=[];if(null==this._matchExpr&&e.push("Missing match expression"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("FindRoomsRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_EXPRESSION]=this._matchExpr._toArray(),null!=this._groupId&&(this._reqObj[this.constructor.KEY_GROUP]=this._groupId),0<this._limit&&(this._reqObj[this.constructor.KEY_LIMIT]=this._limit)}}),SFS2X.Requests.System.FindRoomsRequest.KEY_EXPRESSION="e",SFS2X.Requests.System.FindRoomsRequest.KEY_GROUP="g",SFS2X.Requests.System.FindRoomsRequest.KEY_LIMIT="l",SFS2X.Requests.System.FindRoomsRequest.KEY_FILTERED_ROOMS="fr",SFS2X.Requests.System.FindUsersRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.FindUsers),null==s&&(s=0),this._matchExpr=e,this._target=t,this._limit=s},validate:function(){var e=[];if(null==this._matchExpr&&e.push("Missing match expression"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("FindUsersRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_EXPRESSION]=this._matchExpr._toArray(),null!=this._target&&(this._target instanceof SFS2X.Entities.SFSRoom?this._reqObj[this.constructor.KEY_ROOM]=this._target.id:"string"==typeof this._target?this._reqObj[this.constructor.KEY_GROUP]=this._target:this._log.warn("Unsupport target type for FindUsersRequest: "+this._target)),0<this._limit&&(this._reqObj[this.constructor.KEY_LIMIT]=this._limit)}}),SFS2X.Requests.System.FindUsersRequest.KEY_EXPRESSION="e",SFS2X.Requests.System.FindUsersRequest.KEY_GROUP="g",SFS2X.Requests.System.FindUsersRequest.KEY_ROOM="r",SFS2X.Requests.System.FindUsersRequest.KEY_LIMIT="l",SFS2X.Requests.System.FindUsersRequest.KEY_FILTERED_USERS="fu",SFS2X.Requests.System.PingPongRequest=SFS2X.Requests._BaseRequest.extend({init:function(){this._super(SFS2X.Requests.PingPong)},validate:function(){},execute:function(){}}),SFS2X.Requests.MMO.SetUserPositionRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t){this._super(SFS2X.Requests.SetUserPosition),this._pos=e,this._room=t},validate:function(e){var t=[];if(null==this._pos&&t.push("Position must be a Vec3D instance"),null==this._room&&(this._room=e.lastJoinedRoom),this._room instanceof SFS2X.Entities.MMORoom||t.push("Passed Room is not an MMORoom"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("SetUserPosition Error",t)},execute:function(){this._reqObj[this.constructor.KEY_ROOM]=this._room.id,this._reqObj[this.constructor.KEY_VEC3D]=this._pos._toArray()}}),SFS2X.Requests.MMO.SetUserPositionRequest.KEY_ROOM="r",SFS2X.Requests.MMO.SetUserPositionRequest.KEY_VEC3D="v",SFS2X.Requests.MMO.SetUserPositionRequest.KEY_PLUS_USER_LIST="p",SFS2X.Requests.MMO.SetUserPositionRequest.KEY_MINUS_USER_LIST="m",SFS2X.Requests.MMO.SetUserPositionRequest.KEY_PLUS_ITEM_LIST="q",SFS2X.Requests.MMO.SetUserPositionRequest.KEY_MINUS_ITEM_LIST="n",SFS2X.Requests.MMO.SetMMOItemVariables={},SFS2X.Requests.MMO.SetMMOItemVariables.KEY_ROOM_ID="r",SFS2X.Requests.MMO.SetMMOItemVariables.KEY_ITEM_ID="i",SFS2X.Requests.MMO.SetMMOItemVariables.KEY_VAR_LIST="v",SFS2X.Requests.BuddyList.InitBuddyListRequest=SFS2X.Requests._BaseRequest.extend({init:function(){this._super(SFS2X.Requests.InitBuddyList)},validate:function(e){var t=[];if(e.buddyManager.isInited()&&t.push("Buddy List is already initialized"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("InitBuddyListRequest Error",t)},execute:function(){}}),SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_BLIST="bl",SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_BUDDY_STATES="bs",SFS2X.Requests.BuddyList.InitBuddyListRequest.KEY_MY_VARS="mv",SFS2X.Requests.BuddyList.AddBuddyRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.AddBuddy),this._name=e},validate:function(e){var t=[];if(e.buddyManager.isInited()||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),(null==this._name||1>this._name.length)&&t.push("Invalid buddy name (null or empty string)"),0==e.buddyManager.getMyOnlineState()&&t.push("Can't add a buddy while you are offline in the Buddy List system"),e=e.buddyManager.getBuddyByName(this._name),null!=e&&!e.isTemp()&&t.push("Can't add buddy '"+this._name+"' because it is already in your list"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("AddBuddyRequest Error",t)},execute:function(){this._reqObj[this.constructor.KEY_BUDDY_NAME]=this._name}}),SFS2X.Requests.BuddyList.AddBuddyRequest.KEY_BUDDY_NAME="bn",SFS2X.Requests.BuddyList.BlockBuddyRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t){this._super(SFS2X.Requests.BlockBuddy),this._name=e,this._blocked=t},validate:function(e){var t=[];if(e.buddyManager.isInited()||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),(null==this._name||1>this._name.length)&&t.push("Invalid buddy name (null or empty string)"),0==e.buddyManager.getMyOnlineState()&&t.push("Can't block a buddy while you are offline in the Buddy List system"),e=e.buddyManager.getBuddyByName(this._name),null==e?t.push("Can't block buddy '"+this._name+"' because it isn't in your list"):e.isBlocked()==this._blocked&&t.push("Block flag is already in the requested '"+this._blocked+"' state for buddy "+this._name),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("BlockBuddyRequest Error",t)},execute:function(){this._reqObj[this.constructor.KEY_BUDDY_NAME]=this._name,this._reqObj[this.constructor.KEY_BUDDY_BLOCK_STATE]=this._blocked}}),SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY_NAME="bn",SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY_BLOCK_STATE="bs",SFS2X.Requests.BuddyList.BlockBuddyRequest.KEY_BUDDY="bd",SFS2X.Requests.BuddyList.RemoveBuddyRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.RemoveBuddy),this._name=e},validate:function(e){var t=[];if(e.buddyManager.isInited()||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),0==e.buddyManager.getMyOnlineState()&&t.push("Can't remove a buddy while you are offline in the Buddy List system"),e.buddyManager.containsBuddy(this._name)||t.push("Can't remove buddy '"+this._name+"' because it isn't in your list"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("RemoveBuddyRequest Error",t)},execute:function(){this._reqObj[this.constructor.KEY_BUDDY_NAME]=this._name}}),SFS2X.Requests.BuddyList.RemoveBuddyRequest.KEY_BUDDY_NAME="bn",SFS2X.Requests.BuddyList.SetBuddyVariablesRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.SetBuddyVariables),this._buddyVariables=e},validate:function(e){var t=[];if(e.buddyManager.isInited()||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),0==e.buddyManager.getMyOnlineState()&&t.push("Can't set Buddy Variables while you are offline in the Buddy List system"),(null==this._buddyVariables||0==this._buddyVariables.length)&&t.push("No Buddy Variables to set have been specified"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("SetBuddyVariablesRequest Error",t)},execute:function(){var e,t=[];for(e in this._buddyVariables){var s=this._buddyVariables[e];s instanceof SFS2X.Entities.Variables.SFSBuddyVariable&&t.push(s.toArray())}this._reqObj[this.constructor.KEY_BUDDY_VARS]=t}}),SFS2X.Requests.BuddyList.SetBuddyVariablesRequest.KEY_BUDDY_NAME="bn",SFS2X.Requests.BuddyList.SetBuddyVariablesRequest.KEY_BUDDY_VARS="bv",SFS2X.Requests.BuddyList.GoOnlineRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.GoOnline),this._online=e},validate:function(e){var t=[];if(e.buddyManager.isInited()||t.push("Buddy List not yet initialized; please send an InitBuddyRequest first"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("GoOnlineRequest Error",t)},execute:function(e){e.buddyManager._setMyOnlineState(this._online),this._reqObj[this.constructor.KEY_ONLINE]=this._online}}),SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_ONLINE="o",SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_BUDDY_NAME="bn",SFS2X.Requests.BuddyList.GoOnlineRequest.KEY_BUDDY_ID="bi",SFS2X.Requests.BuddyList.BuddyMessageRequest=SFS2X.Requests.System.GenericMessageRequest.extend({init:function(e,t,s){this._super(),this._type=SFS2X.Requests.GenericMessageType.BUDDY_MSG,this._message=e,this._recipient=null!=t?t.id:-1,this._params=s}}),SFS2X.Requests.Game.InviteUsersRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.InviteUsers),this._invitedUsers=e,this._secondsForAnswer=t,this._params=s},validate:function(){var e=[];if((null==this._invitedUsers||1>this._invitedUsers.length)&&e.push("No invitation(s) to send"),this._invitedUsers.length>this.constructor.MAX_INVITATIONS_FROM_CLIENT_SIDE&&e.push("Too many invitations; "+this.constructor.MAX_INVITATIONS_FROM_CLIENT_SIDE+" max are allowed from client side"),(this._secondsForAnswer<this.constructor.MIN_EXPIRY_TIME||this._secondsForAnswer>this.constructor.MAX_EXPIRY_TIME)&&e.push("secondsForAnswer value is out of range (min: "+this.constructor.MIN_EXPIRY_TIME+"; max: "+this.constructor.MAX_EXPIRY_TIME+")"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("InviteUsersRequest Error",e)},execute:function(e){var t,s=[];for(t in this._invitedUsers){var i=this._invitedUsers[t];(i instanceof SFS2X.Entities.SFSUser||i instanceof SFS2X.Entities.SFSBuddy)&&i!=e.mySelf&&s.push(i.id)}this._reqObj[this.constructor.KEY_INVITED_USERS]=s,this._reqObj[this.constructor.KEY_TIME]=this._secondsForAnswer,null!=this._params&&(this._reqObj[this.constructor.KEY_PARAMS]=this._params)}}),SFS2X.Requests.Game.InviteUsersRequest.KEY_USER="u",SFS2X.Requests.Game.InviteUsersRequest.KEY_USER_ID="ui",SFS2X.Requests.Game.InviteUsersRequest.KEY_INVITATION_ID="ii",SFS2X.Requests.Game.InviteUsersRequest.KEY_TIME="t",SFS2X.Requests.Game.InviteUsersRequest.KEY_PARAMS="p",SFS2X.Requests.Game.InviteUsersRequest.KEY_INVITEE_ID="ee",SFS2X.Requests.Game.InviteUsersRequest.KEY_INVITED_USERS="iu",SFS2X.Requests.Game.InviteUsersRequest.KEY_REPLY_ID="ri",SFS2X.Requests.Game.InviteUsersRequest.MAX_INVITATIONS_FROM_CLIENT_SIDE=8,SFS2X.Requests.Game.InviteUsersRequest.MIN_EXPIRY_TIME=5,SFS2X.Requests.Game.InviteUsersRequest.MAX_EXPIRY_TIME=300,SFS2X.Requests.Game.InvitationReplyRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.InvitationReply),this._invitation=e,this._reply=t,this._params=s},validate:function(){var e=[];if(null==this._invitation&&e.push("Missing invitation object"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("InvitationReplyRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_INVITATION_ID]=this._invitation.id,this._reqObj[this.constructor.KEY_INVITATION_REPLY]=this._reply,null!=this._params&&(this._reqObj[this.constructor.KEY_INVITATION_PARAMS]=this._params)}}),SFS2X.Requests.Game.InvitationReplyRequest.KEY_INVITATION_ID="i",SFS2X.Requests.Game.InvitationReplyRequest.KEY_INVITATION_REPLY="r",SFS2X.Requests.Game.InvitationReplyRequest.KEY_INVITATION_PARAMS="p",SFS2X.Requests.Game.CreateSFSGameRequest=SFS2X.Requests._BaseRequest.extend({init:function(e){this._super(SFS2X.Requests.CreateSFSGame),this._settings=e,this._createRoomRequest=new SFS2X.Requests.System.CreateRoomRequest(e,!1,null)},validate:function(e){var t=[];try{this._createRoomRequest.validate(e)}catch(s){t=s.getErrors()}if(this._settings.minPlayersToStartGame>this._settings.maxUsers&&t.push("Minimum number of players to start the game can't be greater than the Room's maximum number of users"),(this._settings.invitationExpiryTime<SFS2X.Requests.Game.InviteUsersRequest.MIN_EXPIRY_TIME||this._settings.invitationExpiryTime>SFS2X.Requests.Game.InviteUsersRequest.MAX_EXPIRY_TIME)&&t.push("Invitation expiration time value is out of range (min: "+SFS2X.Requests.Game.InviteUsersRequest.MIN_EXPIRY_TIME+"; max: "+SFS2X.Requests.Game.InviteUsersRequest.MAX_EXPIRY_TIME+")"),null!=this._settings.invitedPlayers&&this._settings.invitedPlayers.length>SFS2X.Requests.Game.InviteUsersRequest.MAX_INVITATIONS_FROM_CLIENT_SIDE&&t.push("Can't invite more than "+SFS2X.Requests.Game.InviteUsersRequest.MAX_INVITATIONS_FROM_CLIENT_SIDE+" players from client side"),0<t.length)throw new SFS2X.Exceptions.SFSValidationError("CreateSFSGameRequest Error",t)},execute:function(e){if(this._createRoomRequest.execute(e),this._reqObj=this._createRoomRequest._reqObj,this._reqObj[this.constructor.KEY_IS_PUBLIC]=this._settings.isPublic,this._reqObj[this.constructor.KEY_MIN_PLAYERS]=this._settings.minPlayersToStartGame,this._reqObj[this.constructor.KEY_INVITATION_EXPIRY]=this._settings.invitationExpiryTime,this._reqObj[this.constructor.KEY_LEAVE_ROOM]=this._settings.leaveLastJoinedRoom,this._reqObj[this.constructor.KEY_NOTIFY_GAME_STARTED]=this._settings.notifyGameStarted,null!=this._settings.playerMatchExpression&&(this._reqObj[this.constructor.KEY_PLAYER_MATCH_EXP]=this._settings.playerMatchExpression._toArray()),null!=this._settings.spectatorMatchExpression&&(this._reqObj[this.constructor.KEY_SPECTATOR_MATCH_EXP]=this._settings.spectatorMatchExpression._toArray()),null!=this._settings.invitedPlayers){var t,e=[];for(t in this._settings.invitedPlayers){var s=this._settings.invitedPlayers[t];(s instanceof SFS2X.Entities.SFSUser||s instanceof SFS2X.Entities.SFSBuddy)&&e.push(s.id)}this._reqObj[this.constructor.KEY_INVITED_PLAYERS]=e}null!=this._settings.searchableRooms&&(this._reqObj[this.constructor.KEY_SEARCHABLE_ROOMS]=this._settings.searchableRooms),null!=this._settings.invitationParams&&(this._reqObj[this.constructor.KEY_INVITATION_PARAMS]=this._settings.invitationParams)}}),SFS2X.Requests.Game.CreateSFSGameRequest.KEY_IS_PUBLIC="gip",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_MIN_PLAYERS="gmp",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_INVITED_PLAYERS="ginp",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_SEARCHABLE_ROOMS="gsr",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_PLAYER_MATCH_EXP="gpme",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_SPECTATOR_MATCH_EXP="gsme",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_INVITATION_EXPIRY="gie",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_LEAVE_ROOM="glr",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_NOTIFY_GAME_STARTED="gns",SFS2X.Requests.Game.CreateSFSGameRequest.KEY_INVITATION_PARAMS="ip",SFS2X.Requests.Game.QuickJoinGameRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s){this._super(SFS2X.Requests.QuickJoinGame),this._matchExpression=e,this._whereToSearch=t,this._roomToLeave=s},validate:function(){var e=[];if(null==this._whereToSearch||1>this._whereToSearch.length?e.push("Missing lis of Rooms or Group name where to search the game to join"):this._whereToSearch.length>this.constructor.MAX_ROOMS&&e.push("Too many Rooms specified in list where to search the game to join; client limit is: "+this.constructor.MAX_ROOMS),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("CreateSFSGameRequest Error",e)},execute:function(){if("string"==typeof this._whereToSearch[0])this._reqObj[this.constructor.KEY_GROUP_LIST]=this._whereToSearch;else{if(!(this._whereToSearch[0]instanceof SFS2X.Entities.SFSRoom))throw new SFS2X.Exceptions.SFSError("Invalid type in whereToSearch parameter");for(var e=[],t=0;t<this._whereToSearch.length;t++){var s=this._whereToSearch[t];s instanceof SFS2X.Entities.SFSRoom&&e.push(s.id)}this._reqObj[this.constructor.KEY_ROOM_LIST]=e}null!=this._roomToLeave&&(this._reqObj[this.constructor.KEY_ROOM_TO_LEAVE]=this._roomToLeave.id),null!=this._matchExpression&&(this._reqObj[this.constructor.KEY_MATCH_EXPRESSION]=this._matchExpression._toArray())}}),SFS2X.Requests.Game.QuickJoinGameRequest.KEY_ROOM_LIST="rl",SFS2X.Requests.Game.QuickJoinGameRequest.KEY_GROUP_LIST="gl",SFS2X.Requests.Game.QuickJoinGameRequest.KEY_ROOM_TO_LEAVE="tl",SFS2X.Requests.Game.QuickJoinGameRequest.KEY_MATCH_EXPRESSION="me",SFS2X.Requests.Game.QuickJoinGameRequest.MAX_ROOMS=32,SFS2X.Requests.Game.JoinRoomInvitationRequest=SFS2X.Requests._BaseRequest.extend({init:function(e,t,s,i,r){this._super(SFS2X.Requests.JoinRoomInvite),this._targetRoom=e,this._invitedUserNames=t,this._params=s,this._expirySeconds=i,this._asSpectator=r},validate:function(){var e=[];if(null==this._targetRoom&&e.push("Missing target room"),(null==this._invitedUserNames||1>this._invitedUserNames.length)&&e.push("No invitees provided"),0<e.length)throw new SFS2X.Exceptions.SFSValidationError("JoinRoomInvitationRequest Error",e)},execute:function(){this._reqObj[this.constructor.KEY_ROOM_ID]=this._targetRoom.id,this._reqObj[this.constructor.KEY_INVITED_NAMES]=this._invitedUserNames,this._reqObj[this.constructor.KEY_EXPIRY_SECONDS]=this._expirySeconds,this._reqObj[this.constructor.KEY_AS_SPECT]=this._asSpectator,null!=this._params&&(this._reqObj[this.constructor.KEY_OPTIONAL_PARAMS]=this._params)}}),SFS2X.Requests.Game.JoinRoomInvitationRequest.KEY_ROOM_ID="r",SFS2X.Requests.Game.JoinRoomInvitationRequest.KEY_EXPIRY_SECONDS="es",SFS2X.Requests.Game.JoinRoomInvitationRequest.KEY_INVITED_NAMES="in",SFS2X.Requests.Game.JoinRoomInvitationRequest.KEY_AS_SPECT="as",SFS2X.Requests.Game.JoinRoomInvitationRequest.KEY_OPTIONAL_PARAMS="op",SFS2X.Requests.Handshake=0,SFS2X.Requests.Login=1,SFS2X.Requests.Logout=2,SFS2X.Requests.JoinRoom=4,SFS2X.Requests.CreateRoom=6,SFS2X.Requests.GenericMessage=7,SFS2X.Requests.ChangeRoomName=8,SFS2X.Requests.ChangeRoomPassword=9,SFS2X.Requests.SetRoomVariables=11,SFS2X.Requests.SetUserVariables=12,SFS2X.Requests.CallExtension=13,SFS2X.Requests.LeaveRoom=14,SFS2X.Requests.SubscribeRoomGroup=15,SFS2X.Requests.UnsubscribeRoomGroup=16,SFS2X.Requests.SpectatorToPlayer=17,SFS2X.Requests.PlayerToSpectator=18,SFS2X.Requests.ChangeRoomCapacity=19,SFS2X.Requests.KickUser=24,SFS2X.Requests.BanUser=25,SFS2X.Requests.ManualDisconnection=26,SFS2X.Requests.FindRooms=27,SFS2X.Requests.FindUsers=28,SFS2X.Requests.PingPong=29,SFS2X.Requests.SetUserPosition=30,SFS2X.Requests.InitBuddyList=200,SFS2X.Requests.AddBuddy=201,SFS2X.Requests.BlockBuddy=202,SFS2X.Requests.RemoveBuddy=203,SFS2X.Requests.SetBuddyVariables=204,SFS2X.Requests.GoOnline=205,SFS2X.Requests.InviteUsers=300,SFS2X.Requests.InvitationReply=301,SFS2X.Requests.CreateSFSGame=302,SFS2X.Requests.QuickJoinGame=303,SFS2X.Requests.JoinRoomInvite=304,SFS2X.Requests.getRequestNameFromId=function(e){for(var t in SFS2X.Requests)if(SFS2X.Requests[t]==e)return t;return null},SFS2X.Requests.RoomSettings=Class.extend({init:function(e){this.name=e,this.password="",this.groupId="default",this.isGame=!1,this.maxUsers=10,this.maxSpectators=0,this.maxVariables=5,this.variables=[],this.extension=this.events=this.permissions=null,this.allowOwnerOnlyInvitation=!0}}),SFS2X.Requests.Game.SFSGameSettings=SFS2X.Requests.RoomSettings.extend({init:function(e){this._super(e),this.isPublic=!0,this.minPlayersToStartGame=2,this.searchableRooms=this.invitedPlayers=null,this.invitationExpiryTime=15,this.leaveLastJoinedRoom=!0,this.notifyGameStarted=!1,this.invitationParams=this.spectatorMatchExpression=this.playerMatchExpression=null}}),SFS2X.Requests.MMO.MMORoomSettings=SFS2X.Requests.RoomSettings.extend({init:function(e){this._super(e),this.mapLimits=this.defaultAOI=null,this.userMaxLimboSeconds=50,this.proximityListUpdateMillis=250,this.sendAOIEntryPoint=!0}}),SFS2X.Requests.RoomPermissions=function(){this.allowPasswordStateChange=this.allowNameChange=!1,this.allowPublicMessages=!0,this.allowResizing=!1},SFS2X.Requests.RoomEvents=function(){this.allowUserVariablesUpdate=this.allowUserExit=this.allowUserEnter=this.allowUserCountChange=!1},SFS2X.Requests.RoomExtension=function(e,t){this.id=e,this.className=t,this.propertiesFile=""
},SFS2X.Requests.MMO.MapLimits=function(e,t){if(null==e||null==t)throw new SFS2X.Exceptions.SFSError("Map limits arguments must be both non null!");this.lowerLimit=e,this.higherLimit=t},SFS2X.Requests.GenericMessageType={},SFS2X.Requests.GenericMessageType.PUBLIC_MSG=0,SFS2X.Requests.GenericMessageType.PRIVATE_MSG=1,SFS2X.Requests.GenericMessageType.MODERATOR_MSG=2,SFS2X.Requests.GenericMessageType.ADMING_MSG=3,SFS2X.Requests.GenericMessageType.OBJECT_MSG=4,SFS2X.Requests.GenericMessageType.BUDDY_MSG=5,SFS2X.Requests.MessageRecipientMode=function(e,t){if(e<this.TO_USER||e>this.TO_ZONE)throw new SFS2X.Exceptions.SFSError("Illegal recipient mode: "+e);this.mode=e,this.target=t},SFS2X.Requests.MessageRecipientMode.TO_USER=0,SFS2X.Requests.MessageRecipientMode.TO_ROOM=1,SFS2X.Requests.MessageRecipientMode.TO_GROUP=2,SFS2X.Requests.MessageRecipientMode.TO_ZONE=3,SFS2X.Requests.BanMode={},SFS2X.Requests.BanMode.BY_ADDRESS=0,SFS2X.Requests.BanMode.BY_NAME=1,SFS2X.SocketEngine=function(e){this.isConnecting=this.isConnected=!1,this.reconnectionSeconds=0,this._controllers={},this._log=SFS2X.Logger,this._socket=null,this._maxMessageSize=1e4,this._sfs=e,this._lastTcpPort=0,this._reconnectionDelayMillis=1e3,this._attemptingReconnection=this._isReconnecting=!1,this._eventDispatcher=new SFS2X.EventDispatcher,this._disconnectionReason=SFS2X.Utils.ClientDisconnectionReason.UNKNOWN},SFS2X.SocketEngine.prototype.connect=function(e,t,s){this.isConnected?this._log.error("Connection is already active"):this.isConnecting?this._log.error("A connection attempt is already in progress"):(this.isConnecting=!0,this._socket=new WebSocket("ws"+(s?"s":"")+"://"+e+":"+t+"/websocket"),this._socket._scope=this,this._socket.onopen=this._onSocketConnect,this._socket.onclose=this._onSocketDisconnect,this._socket.onmessage=this._onSocketData,this._socket.onerror=this._onSocketError),SFS2X.SocketEngine._socket=this._socket},SFS2X.SocketEngine.prototype.disconnect=function(e){this._disconnectionReason=e,this._socket.close()},SFS2X.SocketEngine.prototype.addEventListener=function(e,t,s){this._eventDispatcher.addEventListener(e,t,s)},SFS2X.SocketEngine.prototype.removeEventListener=function(e,t){this._eventDispatcher.removeEventListener(e,t)},SFS2X.SocketEngine.prototype.addController=function(e,t){null==this._controllers[e]&&(this._controllers[e]=t)},SFS2X.SocketEngine.prototype.removeController=function(e){delete this._controllers[e]},SFS2X.SocketEngine.prototype.send=function(e){e=this._encodeMessage(e),this._socket.send(e)},SFS2X.SocketEngine.prototype._decodeMessage=function(e){return JSON.parse(e)},SFS2X.SocketEngine.prototype._encodeMessage=function(e){return JSON.stringify(e)},SFS2X.SocketEngine.prototype._onSocketConnect=function(){var e=this instanceof WebSocket?this:SFS2X.SocketEngine._socket;e._scope.isConnected=!0,e._scope.isConnecting=!1,e._scope._log.debug("SOCKET CONNECTION OK"),e._scope._eventDispatcher.dispatchEvent(SFS2X.SocketEvent.CONNECT,{success:!0,isReconnection:e._scope._attemptingReconnection})},SFS2X.SocketEngine.prototype._onSocketDisconnect=function(){var e=this instanceof WebSocket?this:SFS2X.SocketEngine._socket;if(e._scope.isConnected=!1,e._scope.isConnecting){e._scope.isConnecting=!1;var t={success:!1,isReconnection:e._scope._attemptingReconnection};e._scope._eventDispatcher.dispatchEvent(SFS2X.SocketEvent.CONNECT,t)}else t={reason:e._scope._disconnectionReason},e._scope._eventDispatcher.dispatchEvent(SFS2X.SocketEvent.DISCONNECT,t),e._scope._disconnectionReason=SFS2X.Utils.ClientDisconnectionReason.UNKNOWN},SFS2X.SocketEngine.prototype._onSocketData=function(e){var t=this instanceof WebSocket?this:SFS2X.SocketEngine._socket;t._scope._eventDispatcher.dispatchEvent(SFS2X.SocketEvent.DATA,t._scope._decodeMessage(e.data))},SFS2X.SocketEngine.prototype._onSocketError=function(e){var t=this instanceof WebSocket?this:SFS2X.SocketEngine._socket;t._scope._eventDispatcher.dispatchEvent(SFS2X.SocketEvent.IOERROR,e.data)},SFS2X.SocketEvent={CONNECT:"socketConnect",DISCONNECT:"socketDisconnect",DATA:"data",IOERROR:"socketIOError"};