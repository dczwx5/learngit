function create(e){return VL.ObjectCache.CacheableClass.create(e)}function getClassName(e){return app.reflector.getClassName(e)}function getClass(e){return app.reflector.getClass(e)}function getClassByEntity(e){return app.reflector.getClassByEntity(e)}function isExtends(e,t){return app.reflector.isExtends(e,t)}var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(t){o(t)}}function a(e){try{u(r["throw"](e))}catch(t){o(t)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(r){n=[6,r],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},App;!function(e){var t=function(e){function t(t,n){var r=e.call(this)||this;return r._isOpened=!1,r._isInited=!1,r.dg_inited=new VL.Delegate,r.skinName=t,r.myParent=n,r}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.init()},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.resources.length>0?[4,this.loadRes()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.onInit(),this._isInited=!0,this.updateLayout(),this.dg_inited.boardcast(),[2]}})})},t.prototype.loadRes=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t){app.resManager.loadResTask({keys:e.resources,taskName:getClassName(e),onComplete:function(e){t()}})})]})})},t.prototype.open=function(e){void 0===e&&(e=null),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this),this.addEventListener(egret.Event.RESIZE,this.onResize,this),this.isInited&&this.updateLayout(),this.addToParent(),this._isOpened=!0},t.prototype.close=function(e){void 0===e&&(e=null),this.removeFromParent(),this._isOpened=!1,StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.onResize,this),this.removeEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.onResize=function(e){this.updateLayout()},t.prototype.updateLayout=function(){this.width=StageUtils.getStageWidth(),this.height=StageUtils.getStageHeight()},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},t.prototype.destroy=function(){this.onDestroy(),this.removeFromParent(),this._isInited=!1},Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},set:function(e){this._myParent=e,this.isOpened&&this.addToParent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInited",{get:function(){return this._isInited},enumerable:!0,configurable:!0}),t}(eui.Component);e.BaseEuiView=t,__reflect(t.prototype,"App.BaseEuiView",["App.IBaseView","IBaseComponent"])}(App||(App={}));var VoyaMVC;!function(e){var t=function(){function e(){this._map={}}return e.prototype.getEvent=function(e){var t=getClassName(e);return this._map[t]||(this._map[t]=new e),this._map[t]},e}();__reflect(t.prototype,"EventMap",["VoyaMVC.IEventMap"]);var n=function(){function e(){this._map={}}return e.prototype.getModel=function(e){var t=getClassName(e);return this._map[t]||(this._map[t]=new e),this._map[t]},e}();__reflect(n.prototype,"ModelMap",["VoyaMVC.IModelMap"]);var r=function(){function e(){this._map={}}return e.prototype.registerMediator=function(e){var t=this._map[getClassName(e)];t&&t.deactivate(),this._map[getClassName(e)]=e,e.activate()},e.prototype.removeMediator=function(e){e.deactivate(),delete this._map[getClassName(e)]},e.prototype.getMediator=function(e){return this._map[getClassName(e)]},e}();__reflect(r.prototype,"MediatorMap",["VoyaMVC.IMediatorMap"]);var i=function(){function e(){this._map={}}return e.prototype.registerController=function(e){var t=this._map[getClassName(e)];t&&t.deactivate(),this._map[getClassName(e)]=e,e.activate()},e.prototype.removeController=function(e){e.deactivate(),delete this._map[getClassName(e)]},e}();__reflect(i.prototype,"ControllerMap",["VoyaMVC.IControllerMap"]);var o=function(){function o(){if(o._instance)throw new Error("单利模式，别乱new");this._controllerMap=new i,this._mediatorMap=new r,this._modelMap=new n,this._eventMap=new t,this._msgSender=new e.MsgSender}return Object.defineProperty(o,"instance",{get:function(){return this._instance||(this._instance=new o),this._instance},enumerable:!0,configurable:!0}),o.prototype.sendMsg=function(e){this._msgSender.sendMsg(e)},o.prototype.regMsg=function(e,t,n,r){void 0===r&&(r=!1),this._msgSender.regMsg(e,t,n,r)},o.prototype.unregMsg=function(e,t,n){this._msgSender.unregMsg(e,t,n)},o.prototype.existMsgHandler=function(e,t,n){return this._msgSender.existMsgHandler(e,t,n)},o.prototype.getModel=function(e){return this._modelMap.getModel(e)},o.prototype.getEvent=function(e){return this._eventMap.getEvent(e)},o.prototype.registerMediator=function(e){this._mediatorMap.registerMediator(e)},o.prototype.removeMediator=function(e){this._mediatorMap.removeMediator(e)},o.prototype.getMediator=function(e){return this._mediatorMap.getMediator(e)},o.prototype.registerController=function(e){this._controllerMap.registerController(e)},o.prototype.removeController=function(e){this._controllerMap.removeController(e)},o}();__reflect(o.prototype,"MvcCore",["VoyaMVC.IModelMap","VoyaMVC.IEventMap","VoyaMVC.IMediatorMap","VoyaMVC.IControllerMap","VoyaMVC.IMsgSender"]);var s=function(){function e(){}return e.prototype.sendMsg=function(e){o.instance.sendMsg(e)},e}();e.Model=s,__reflect(s.prototype,"VoyaMVC.Model",["VoyaMVC.IModel"]);var a=function(){function e(){}return e.prototype.getModel=function(e){return o.instance.getModel(e)},e.prototype.getEvent=function(e){return o.instance.getEvent(e)},e.prototype.sendMsg=function(e){o.instance.sendMsg(e)},e.prototype.regMsg=function(e,t,n,r){void 0===r&&(r=!1),o.instance.regMsg(e,t,n,r)},e.prototype.unregMsg=function(e,t,n){o.instance.unregMsg(e,t,n)},e.prototype.existMsgHandler=function(e,t,n){return o.instance.existMsgHandler(e,t,n)},e}();e.Mediator=a,__reflect(a.prototype,"VoyaMVC.Mediator",["VoyaMVC.IMediator"]);var u=function(){function e(){}return e.prototype.registerMediator=function(e){o.instance.registerMediator(e)},e.prototype.removeMediator=function(e){o.instance.removeMediator(e)},e.prototype.getMediator=function(e){return o.instance.getMediator(e)},e.prototype.getModel=function(e){return o.instance.getModel(e)},e.prototype.getEvent=function(e){return o.instance.getEvent(e)},e.prototype.sendMsg=function(e){o.instance.sendMsg(e)},e.prototype.regMsg=function(e,t,n,r){void 0===r&&(r=!1),o.instance.regMsg(e,t,n,r)},e.prototype.unregMsg=function(e,t,n){o.instance.unregMsg(e,t,n)},e.prototype.existMsgHandler=function(e,t,n){return o.instance.existMsgHandler(e,t,n)},e.prototype.registerController=function(e){o.instance.registerController(e)},e.prototype.removeController=function(e){o.instance.removeController(e)},e}();e.Controller=u,__reflect(u.prototype,"VoyaMVC.Controller",["VoyaMVC.IController"]);var h=function(){function e(){}return Object.defineProperty(e.prototype,"core",{get:function(){return o.instance},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){for(var t,n=0,r=e.length;r>n;n++)t=e[n],t.mediatorList&&t.mediatorList.length>0&&this.regMediators(t.mediatorList),t.handlerList&&t.handlerList.length>0&&this.regControllers(t.handlerList)},e.prototype.regMediators=function(e){for(var t,n=0,r=e.length;r>n;n++)t=e[n],o.instance.registerMediator(t)},e.prototype.regControllers=function(e){for(var t,n=0,r=e.length;r>n;n++)t=e[n],o.instance.registerController(t)},e.prototype.regMediator=function(e){o.instance.registerMediator(e)},e.prototype.regController=function(e){o.instance.registerController(e)},e}();e.MVC=h,__reflect(h.prototype,"VoyaMVC.MVC")}(VoyaMVC||(VoyaMVC={}));var ViewMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.regMsg(SystemMsg.CloseAllViews,this.onCloseAllViews,this),this.regMsg(this.openViewMsg,this.onOpenViewHandler,this),this.regMsg(this.closeViewMsg,this.onCloseViewHandler,this)},t.prototype.deactivate=function(){this.unregMsg(SystemMsg.CloseAllViews,this.onCloseAllViews,this),this.unregMsg(this.openViewMsg,this.onOpenViewHandler,this),this.unregMsg(this.closeViewMsg,this.onCloseViewHandler,this)},t.prototype.onCloseAllViews=function(e){this.closeView()},t.prototype.onOpenViewHandler=function(e){this.openView(e.body)},t.prototype.onCloseViewHandler=function(e){this.closeView(e.body)},t.prototype.openView=function(e){var t=this;void 0===e&&(e=null),this.view||(this.view=new this.viewClass);var n=this.view,r=function(){t.view.dg_inited.unregister(r),t.onViewOpen(e),app.easyLoadingManager.remove(t.easyLoadingCaseId)};n.isInited?(n.open(e),this.onViewOpen(e)):(this.easyLoadingCaseId=app.easyLoadingManager.add(getClassName(this.viewClass)),n.dg_inited.register(r,this),n.open(e))},t.prototype.closeView=function(e){void 0===e&&(e=null),this.view&&this.view.isOpened&&(this.onViewClose(),this.view.close(e))},Object.defineProperty(t.prototype,"isViewInited",{get:function(){return this.view.isInited},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewClassName",{get:function(){return getClassName(this.viewClass)},enumerable:!0,configurable:!0}),t}(VoyaMVC.Mediator);__reflect(ViewMediator.prototype,"ViewMediator");var App;!function(e){var t=function(t){function n(n,r){return void 0===r&&(r=e.GameLayers.UI_Main),t.call(this,n,r)||this}return __extends(n,t),n.prototype.onInit=function(){this.initScaleMode()},n.prototype.initScaleMode=function(){this.contentScaleMode=VL.ScaleMode.SHOW_ALL_FILL,this.bgScaleMode=VL.ScaleMode.NO_BORDER},n.prototype.updateLayout=function(){t.prototype.updateLayout.call(this),this.grp_content&&this.contentScaleMode&&this.contentScaleMode.adapt(this.grp_content,this),this.bgScaleMode&&this.img_bg&&this.bgScaleMode.adapt(this.img_bg,this)},n}(e.BaseEuiView);e.BaseAutoSizeView=t,__reflect(t.prototype,"App.BaseAutoSizeView")}(App||(App={}));var VL;!function(e){var t;!function(t){var n=function(){function t(t){this._enableDrop=!0,this._isMoveOver=!1,this.dg_onDragIn=new e.Delegate,this.dg_onDragOut=new e.Delegate,this.container=t}return t.prototype.onDragBegin=function(e){this._targetDragItem=e,this.enableDrop&&this.checkEnableDrop(e)&&this.waitForDrop(e)},t.prototype.onDragEnd=function(e){e&&(this.isWaitingForDrop&&this.isMoveOver&&this.container.dg_onDropIn.boardcast({container:this.container,dragItem:e}),this._isMoveOver=!1,this.cancelWait(),this._targetDragItem=null)},t.prototype.waitForDrop=function(e){e&&!this.isWaitingForDrop&&this.isContainerOf(e)&&(this._isWaitingForDrop=!0,StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this))},t.prototype.cancelWait=function(){this.isWaitingForDrop&&(this._isWaitingForDrop=!1,StageUtils.getStage().removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this))},t.prototype.onTouchMove=function(e){!this.isMoveOver&&this.container.checkHover(e.target)?this.onDragIn():this.isMoveOver&&!this.container.checkHover(e.target)&&this.onDragOut()},t.prototype.isContainerOf=function(e){return egret.is(e,getClassName(this.tarDragItemClass))},t.prototype.onDragIn=function(){this._isMoveOver=!0,this.dg_onDragIn.boardcast(this.container)},t.prototype.onDragOut=function(){this._isMoveOver=!1,this.dg_onDragOut.boardcast(this.container)},Object.defineProperty(t.prototype,"container",{get:function(){return this._container},set:function(e){this._container!=e&&(this._container=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMoveOver",{get:function(){return this._isMoveOver},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWaitingForDrop",{get:function(){return this._isWaitingForDrop&&this.enableDrop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableDrop",{get:function(){return this._enableDrop},set:function(e){this._enableDrop!=e&&(this._enableDrop=e,e?this.waitForDrop(this._targetDragItem):this.cancelWait())},enumerable:!0,configurable:!0}),t}();t.DropContainerCtrlBase=n,__reflect(n.prototype,"VL.DragDrop.DropContainerCtrlBase",["VL.DragDrop.IDropContainerCtrl"])}(t=e.DragDrop||(e.DragDrop={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function t(){}return t.create=function(e){var t=getClassName(e),n=this._objPoolDic[t];return n&&n.length>0?n.take():new e},t.prototype.restore=function(e){void 0===e&&(e=Number.MAX_VALUE),restore(this,e)},t.restore=function(n,r){void 0===r&&(r=Number.MAX_VALUE),n.clear();var i=getClassName(n),o=t._objPoolDic[i];o||(o=t._objPoolDic[i]=new e.ObjectPool(getClassByEntity(n))),o.maxLength=r,o.restore(n)},t._objPoolDic={},t}();e.CacheableClass=t,__reflect(t.prototype,"VL.ObjectCache.CacheableClass",["VL.ObjectCache.ICacheable"])}(t=e.ObjectCache||(e.ObjectCache={}))}(VL||(VL={}));var restore=VL.ObjectCache.CacheableClass.restore,VoyaMVC;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(e){return void 0===e&&(e=void 0),null!=e&&void 0!=e&&(this._body=e),this},Object.defineProperty(t.prototype,"body",{get:function(){return this._body},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._body=null},t}(VL.ObjectCache.CacheableClass);e.Msg=t,__reflect(t.prototype,"VoyaMVC.Msg",["VoyaMVC.IMsg"])}(VoyaMVC||(VoyaMVC={}));var App;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!1,t.scrollRect=egret.Rectangle.create(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdd,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemove,t),t}return __extends(t,e),t.prototype.onAdd=function(){StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)},t.prototype.onRemove=function(){StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this)},t.prototype.updateLayout=function(e){var t=e.target;this.width=t.width,this.height=t.height,this.scrollRect.setTo(0,0,this.width,this.height)},t}(egret.DisplayObjectContainer);e.BaseSpriteLayer=t,__reflect(t.prototype,"App.BaseSpriteLayer",["App.IGameLayer"])}(App||(App={}));var App;!function(e){var t=function(t){function n(n,r,i,o,s,a){void 0===r&&(r=e.GameLayers.UI_Popup),void 0===i&&(i=!0),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===a&&(a=!0);var u=t.call(this,n,r)||this;return u._isMask=!1,u._uiMask=null,u._maskAlpha=.5,u.dg_onMaskTap=new VL.Delegate,u._centerH=s,u._centerV=a,u._isMask=i,i&&u.initMask(o),u}return __extends(n,t),n.prototype.updateLayout=function(){this._centerH&&(this.x=StageUtils.getStageWidth()-this.width>>1),this._centerV&&(this.y=StageUtils.getStageHeight()-this.height>>1),this.updateMask()},n.prototype.initMask=function(e){this.cleanUiMask(),this._uiMask=new egret.Sprite,this._uiMask.touchEnabled=e,this._uiMask.touchChildren=!1},n.prototype.updateMask=function(){if(this._isMask){var e=this._uiMask.graphics;e.clear(),e.beginFill(0,1),e.drawRect(0,0,StageUtils.getStageWidth(),StageUtils.getStageHeight()),e.endFill(),this.setMaskAlpha(this._maskAlpha),this._uiMask.parent!=this.myParent&&this.myParent.addChildAt(this._uiMask,this.myParent.getChildIndex(this))}},n.prototype.setMaskAlpha=function(e){var t=this;null!=t._uiMask&&(t._maskAlpha=e,t._uiMask.alpha=t._maskAlpha)},n.prototype.cleanUiMask=function(){var e=this;e._uiMask&&(e._uiMask.parent&&e._uiMask.parent.removeChild(e._uiMask),e._uiMask.graphics.clear(),e._uiMask=null)},n.prototype.open=function(e){void 0===e&&(e=null),t.prototype.open.call(this),this._isMask&&this._uiMask&&(this._uiMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskTap,this),this.updateMask())},n.prototype.close=function(e){void 0===e&&(e=null),t.prototype.close.call(this),this._isMask&&this._uiMask.parent&&(this._uiMask.parent.removeChild(this._uiMask),this._uiMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskTap,this))},n.prototype.onMaskTap=function(e){this.dg_onMaskTap.boardcast()},n.prototype.destroy=function(){t.prototype.destroy.call(this),this.cleanUiMask()},n}(e.BaseEuiView);e.BaseWindow=t,__reflect(t.prototype,"App.BaseWindow")}(App||(App={}));var DropCardContainerCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"tarDragItemClass",{get:function(){return Card},enumerable:!0,configurable:!0}),t}(VL.DragDrop.DropContainerCtrlBase);__reflect(DropCardContainerCtrl.prototype,"DropCardContainerCtrl");var SceneMediator=function(e){function t(){var t=e.call(this)||this;return t._scene=t.createScene(),t}return __extends(t,e),t.prototype.activate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.regMsg(SystemMsg.EnterScene,this.onEnterScene,this)},t.prototype.deactivate=function(){this.unregMsg(SystemMsg.EnterScene,this.onEnterScene,this)},t.prototype.onEnterScene=function(e){this.exit(),e.body.scene==getClassByEntity(this.scene)&&this.enter()},t.prototype.enter=function(){this.scene.enter()},t.prototype.exit=function(){this.sendMsg(create(SystemMsg.CloseAllViews).init({closeSystemView:!1})),this.scene.exit()},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t}(VoyaMVC.Mediator);__reflect(SceneMediator.prototype,"SceneMediator");var App;!function(e){var t=function(e){function t(t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var r=e.call(this)||this;return r.touchEnabled=n,r.touchChildren=t,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAdd,r),r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemove,r),r}return __extends(t,e),t.prototype.onAdd=function(){StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)},t.prototype.onRemove=function(){StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this)},t.prototype.updateLayout=function(e){var t=e.target;this.width=t.width,this.height=t.height},t}(eui.UILayer);e.BaseEuiLayer=t,__reflect(t.prototype,"App.BaseEuiLayer",["App.IGameLayer"])}(App||(App={}));var ShareCanvasMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){this.initContent();var e=this.view;EventHelper.addTapEvent(e.btn_back,this.onBack,this)},t.prototype.onViewClose=function(){this.clearCanvas(),this.clearContent();var e=this.view;EventHelper.removeTapEvent(e.btn_back,this.onBack,this)},t.prototype.initContent=function(){var e=this.view,t=this.bitmapdata=new egret.BitmapData(window.sharedCanvas);t.$deleteSource=!1;var n=new egret.Texture;n._setBitmapData(t),this.bitmap=new egret.Bitmap(n),this.bitmap.width=e.width,this.bitmap.height=e.height,app.log(" ========= Bmp: X:"+this.bitmap.x+", Y:"+this.bitmap.y+", W:"+this.bitmap.width+", H:"+this.bitmap.height),e.grp_canvasLayer.addChild(this.bitmap),egret.startTick(this.onTick,this)},t.prototype.clearContent=function(){egret.stopTick(this.onTick,this);var e=this.view;e.grp_canvasLayer.removeChildren(),this.bitmapdata.$dispose(),this.bitmapdata=null,this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),this.bitmap=null},t.prototype.onTick=function(e){var t=this.bitmapdata;egret.WebGLUtils.deleteWebGLTexture(t.webGLTexture),t.webGLTexture=null;var n=this.view;return this.bitmap.width=n.width,this.bitmap.height=n.height,!1},t.prototype.clearCanvas=function(){this.sendMsg(create(WxSdkMsg.SendOpenDataContextCmd).init({head:WxOpenDataContextMsg.CLOSE_CONTEXT}))},t}(ViewMediator);__reflect(ShareCanvasMediator.prototype,"ShareCanvasMediator");var ShareCanvasView=function(e){function t(){return e.call(this,"ShareCanvasViewSkin")||this}return __extends(t,e),t.prototype.onInit=function(){e.prototype.onInit.call(this),this.rect_bg.touchEnabled=!0},t}(App.BaseAutoSizeView);__reflect(ShareCanvasView.prototype,"ShareCanvasView");var VL;!function(e){var t;!function(t){var n=function(t){function n(){var n=t.call(this)||this;return n._autoRestore=!0,n._isOpened=!1,n.dg_commandCompleted=new e.Delegate,n}return __extends(n,t),n.prototype.openAsync=function(){this._isOpened||(this._isOpened=!0,this.execute())},n.prototype.closeAsync=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this._isOpened&&(this.clear(),this._isOpened=!1,this.dg_commandCompleted.boardcast({isAbort:e,isRecursion:t}),this.autoRestore&&this.restore())},n.prototype.run=function(){this.openAsync(),this.closeAsync()},Object.defineProperty(n.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoRestore",{get:function(){return this._autoRestore},set:function(e){this._autoRestore=e},enumerable:!0,configurable:!0}),n}(e.ObjectCache.CacheableClass);t.Command=n,__reflect(n.prototype,"VL.Command.Command",["VL.Command.ICommand"])}(t=e.Command||(e.Command={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(){function t(t){this._enableDrag=!1,this.dg_DragBegin=new e.Delegate,this.dg_DragEnd=new e.Delegate,this.dragItem=t}return t.prototype.addEvent=function(){this._dragItem.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},t.prototype.removeEvent=function(){this._dragItem.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},t.prototype.onTouchBegin=function(e){this.startDrag(e.localX,e.localY,e.stageX,e.stageY)},t.prototype.startDrag=function(e,t,n,r){var i=this._dragItem;this.backupBeforeDrag(),this._offsetX=e,this._offsetY=t;var o=StageUtils.getStage();o.addChild(i),i.x=n-e,i.y=r-t,i.touchEnabled=!1,o.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),o.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancel,this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this._isDragging=!0,this.dg_DragBegin.boardcast(this.dragItem)},t.prototype.stopDrag=function(){var e=this._dragItem;this._offsetX=null,this._offsetY=null;var t=StageUtils.getStage();t.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancel,this),t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this._isDragging=!1,e.touchEnabled=!0,this.dg_DragEnd.boardcast(this.dragItem)},t.prototype.onTouchMove=function(e){var t=this._dragItem;t.x=e.stageX-this._offsetX,t.y=e.stageY-this._offsetY},t.prototype.onTouchCancel=function(e){this.stopDrag()},t.prototype.onDropTo=function(e){e?this.onDropSecceed(e):this.onDropFaild()},t.prototype.onDropFaild=function(){this.rollBackBeforDrag()},Object.defineProperty(t.prototype,"dragItem",{get:function(){return this._dragItem},set:function(e){this._dragItem!=e&&(this.isDragging&&this.stopDrag(),this._dragItem=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDragging",{get:function(){return this._isDragging},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableDrag",{get:function(){return this._enableDrag},set:function(e){this.enableDrag!=e&&(this.removeEvent(),this._enableDrag=e,e?this.addEvent():this.stopDrag())},enumerable:!0,configurable:!0}),t}();t.DragItemCtrlBase=n,__reflect(n.prototype,"VL.DragDrop.DragItemCtrlBase",["VL.DragDrop.IDragItemCtrl"])}(t=e.DragDrop||(e.DragDrop={}))}(VL||(VL={}));var App;!function(e){var t=function(){function t(){this._loginTs_ms=0,this._serverTs_ms=0,this.respChecker=new e.AppHttpRespChecker}return t.prototype.init=function(e,t,n,r,i){return void 0===i&&(i=1),this.http=e,this.httpServer=n,this.httpServerPort=r,this.clientVersion=t,this.gameId=i,this},Object.defineProperty(t.prototype,"serverTimestamp",{set:function(e){this._loginTs_ms=egret.getTimer(),this._serverTs_ms=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverTs_s",{get:function(){return this._serverTs_ms+Math.floor(.001*(egret.getTimer()-this._loginTs_ms))},enumerable:!0,configurable:!0}),t.prototype.createReqPack=function(e,t){e=this.ensurePackData(e);var n={"Content-Type":"application/x-www-form-urlencoded"};return create(VL.Net.HttpReqPack).init(this.httpServer,this.httpServerPort,egret.HttpMethod.POST,e,t,n)},t.prototype.ensurePackData=function(e){return e?(this.token&&(e.token=this.token),e.version=this.clientVersion,e.game_id=this.gameId,e.timestamp=this.serverTs_s,e.sig=(new Utils.md5).hex_md5(this.token+this.serverTs_s),e):void 0},t.prototype.sendHttp=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o=this;return __generator(this,function(s){switch(s.label){case 0:return i=function(e,n){var r=JSON.parse(e);t&&o.respChecker.check(r).pass&&t(r.data,n)},[4,this.http.send(this.createReqPack(e,r),i,n)];case 1:return[2,s.sent()]}})})},t}();e.AppHttpBase=t,__reflect(t.prototype,"App.AppHttpBase")}(App||(App={}));var App;!function(e){var t=function(){function e(){this.dg_checkHttpResp=new VL.Delegate}return e.prototype.check=function(e){var t=this.onCheck(e);return this.dg_checkHttpResp.boardcast(t),t},e}();e.HttpRespChecker=t,__reflect(t.prototype,"App.HttpRespChecker")}(App||(App={}));var VL;!function(e){var t;!function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.ObjectCache.CacheableClass);t.SoundBase=n,__reflect(n.prototype,"VL.Sound.SoundBase")}(t=e.Sound||(e.Sound={}))}(VL||(VL={}));var App;!function(e){var t=function(){function t(){this._layers=[]}return t.prototype.addLayers=function(){this.addLayer(e.GameLayers.Game_Bg),this.addLayer(e.GameLayers.Game_Main),this.addLayer(e.GameLayers.UI_Main),this.addLayer(e.GameLayers.UI_Popup),this.addLayer(e.GameLayers.UI_Guide),this.addLayer(e.GameLayers.UI_Message),this.addLayer(e.GameLayers.UI_Tips),this.addLayer(e.GameLayers.UI_Top)},t.prototype.enter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.addLayers()},t.prototype.exit=function(){this.removeAllLayer()},t.prototype.addLayer=function(e){var t=StageUtils.getStage();t.addChild(e),this._layers.push(e),e.width=e.parent.width,e.height=e.parent.height},t.prototype.addLayerAt=function(e,t){StageUtils.getStage().addChildAt(e,t),this._layers.push(e),e.width=e.parent.width,e.height=e.parent.height},t.prototype.removeLayer=function(e){StageUtils.getStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)},t.prototype.layerRemoveAllChildren=function(e){e.removeChildren()},t.prototype.removeAllLayer=function(){for(;this._layers.length;){var e=this._layers[0];this.layerRemoveAllChildren(e),this.removeLayer(e)}},t}();e.BaseScene=t,__reflect(t.prototype,"App.BaseScene")}(App||(App={}));var VoyaMVC;!function(e){var t=function(){function e(){}return Object.defineProperty(e.prototype,"mediatorList",{get:function(){return this._mediatorList||(this._mediatorList=this.getMediatorList()),this._mediatorList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handlerList",{get:function(){return this._handlerList||(this._handlerList=this.getControllerList()),this._handlerList},enumerable:!0,configurable:!0}),e}();e.MvcConfigBase=t,__reflect(t.prototype,"VoyaMVC.MvcConfigBase",["VoyaMVC.IMvcConfig"])}(VoyaMVC||(VoyaMVC={}));var SDKMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ON_APP_ACTIVE=t,__reflect(t.prototype,"SDKMsg.ON_APP_ACTIVE");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ON_LOGIN_SUCCESS=n,__reflect(n.prototype,"SDKMsg.ON_LOGIN_SUCCESS");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ON_SHARE_SUCCESS=r,__reflect(r.prototype,"SDKMsg.ON_SHARE_SUCCESS")}(SDKMsg||(SDKMsg={}));var SDK;!function(e){var t;!function(e){e[e.FAILD=0]="FAILD",e[e.SUCCESE=1]="SUCCESE"}(t=e.Enum_SDKShareResult||(e.Enum_SDKShareResult={}))}(SDK||(SDK={}));var Enum_System;!function(e){e[e.ANDROID=1]="ANDROID",e[e.IOS=2]="IOS"}(Enum_System||(Enum_System={})),window.hasOwnProperty("wx")&&(wx.WxAdErrorMap={0:{code:0,desc:"观看视频次数用尽",reason:"观看视频次数用尽",solution:"次日恢复"},1e3:{code:1e3,desc:"后端错误调用失败",reason:"该项错误不是开发者的异常情况",solution:"一般情况下忽略一段时间即可恢复。"},1001:{code:1001,desc:"参数错误",reason:"使用方法错误",solution:"可以前往developers.weixin.qq.com确认具体教程（小程序和小游戏分别有各自的教程，可以在顶部选项中，“设计”一栏的右侧进行切换。"},1002:{code:1002,desc:"广告单元无效",reason:"可能是拼写错误、或者误用了其他APP的广告ID",solution:"请重新前往mp.weixin.qq.com确认广告位ID。"},1003:{code:1003,desc:"内部错误",reason:"该项错误不是开发者的异常情况",solution:"一般情况下忽略一段时间即可恢复。"},1004:{code:1004,desc:"无适合的广告",reason:"广告不是每一次都会出现，这次没有出现可能是由于该用户不适合浏览广告",solution:"属于正常情况，且开发者需要针对这种情况做形态上的兼容。"},1005:{code:1005,desc:"广告组件审核中",reason:"你的广告正在被审核，无法展现广告",solution:"请前往mp.weixin.qq.com确认审核状态，且开发者需要针对这种情况做形态上的兼容。"},1006:{code:1006,desc:"广告组件被驳回",reason:"你的广告审核失败，无法展现广告",solution:"请前往mp.weixin.qq.com确认审核状态，且开发者需要针对这种情况做形态上的兼容。"},1007:{code:1007,desc:"广告组件被驳回",reason:"你的广告能力已经被封禁，封禁期间无法展现广告",solution:"请前往mp.weixin.qq.com确认小程序广告封禁状态。"},1008:{code:1008,desc:"广告单元已关闭",reason:"该广告位的广告能力已经被关闭",solution:"请前往mp.weixin.qq.com重新打开对应广告位的展现。"}});var App;!function(e){var t=function(){function e(){}return e.prototype.addTapEvent=function(e,t,n){e.addEventListener(egret.TouchEvent.TOUCH_TAP,t,n)},e.prototype.removeTapEvent=function(e,t,n){e.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,n)},e}();e.EventHelper=t,__reflect(t.prototype,"App.EventHelper")}(App||(App={}));var EventHelper=new App.EventHelper,AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GradientType=egret.GradientType,Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},t=new AssetAdapter,egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),[4,app.init()];
case 1:return n.sent(),(new App.MVC).startup(),[2]}})})},t.prototype.onTap=function(e){var t=egret.Point.create(e.localX,e.localY),n=e.currentTarget;console.log(n.matrix.transformPoint(e.localX,e.localY)),console.log(e.localX,e.localY),console.log(e.stageX,e.stageY);for(var r,i=egret.getTimer(),o=0;100>o;o++)for(var s=0;6>s;s++)r=VL.Geom.isPolygonContainsPoint(this.ps,t);i=egret.getTimer()-i,console.log("isContain: "+r),console.log("ts:"+i)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var App;!function(e){var t=function(){function t(){}return t.Game_Bg=new e.BaseSpriteLayer,t.Game_Main=new e.BaseSpriteLayer,t.UI_Main=new e.BaseEuiLayer,t.UI_Popup=new e.BaseEuiLayer,t.UI_Guide=new e.BaseEuiLayer,t.UI_Message=new e.BaseEuiLayer,t.UI_Tips=new e.BaseEuiLayer(!1,!1),t.UI_Top=new e.BaseEuiLayer,t}();e.GameLayers=t,__reflect(t.prototype,"App.GameLayers")}(App||(App={}));var App;!function(e){var t=function(){function e(){this.$log=this.$warn=this.$error=function(){}}return e.prototype.init=function(){this.$log=egret.log,this.$warn=egret.warn,this.$error=egret.error},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.$log.apply(this,[e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.$warn.apply(this,[e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.$error.apply(this,[e].concat(t))},e}();e.Logger=t,__reflect(t.prototype,"App.Logger")}(App||(App={}));var App;!function(e){var t=function(){function e(){this._mcCacheLength=10,this.MC_DATA_COMMON_GROUP_NAME="common",this._mcCache=[],this._mcFactoryCache={},this._mcDataGroups={},this._mcDataGroups[this.MC_DATA_COMMON_GROUP_NAME]={}}return e.prototype.createMc=function(){return this._mcCache.length>0?this._mcCache.pop():new egret.MovieClip},e.prototype.restoreMc=function(e){e.movieClipData=null,this._mcCache.length<this._mcCacheLength&&this._mcCache.push(e)},Object.defineProperty(e.prototype,"mcCacheLength",{get:function(){return this._mcCacheLength},set:function(e){this._mcCacheLength=e,this._mcCacheLength>e&&(this._mcCacheLength=e)},enumerable:!0,configurable:!0}),e.prototype.clearMcCache=function(){this._mcCache.length=0},e.prototype.getMcData=function(e,t,n){void 0===n&&(n=this.MC_DATA_COMMON_GROUP_NAME),n||(n=this.MC_DATA_COMMON_GROUP_NAME);var r=e+"_"+t,i=this._mcDataGroups[n],o=i?i[r]:null;if(!o){var s=this._mcFactoryCache[e];if(!s){var a=RES.getRes(e+"_json"),u=RES.getRes(e+"_png");s=new egret.MovieClipDataFactory(a,u),this._mcFactoryCache[e]=s}o=s.generateMovieClipData(t),i||(this._mcDataGroups[n]={}),this._mcDataGroups[n][r]=o}return o},e.prototype.clearMcFactoryCache=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),e)for(var n=void 0,r=0,i=e.length;i>r;r++)n=e[r],this._mcFactoryCache[n]&&delete this._mcFactoryCache[n];else this._mcFactoryCache={}},e.prototype.clearMcDataCache=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),e){var n=this._mcDataGroups;if(t)for(var r in n)e.indexOf(r)<0&&delete n[r];else for(var r=void 0,i=0,o=e.length;o>i;i++)r=e[i],n[r]&&delete n[r]}else this._mcDataGroups={}},e.prototype.clearAllCache=function(){this.clearMcCache(),this.clearMcFactoryCache(),this.clearMcDataCache()},e}();e.MCHelper=t,__reflect(t.prototype,"App.MCHelper")}(App||(App={}));var App;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.startup=function(){this.configureModuls(),this.core.sendMsg(create(StartupMsg.Startup))},t.prototype.configureModuls=function(){this.configure([new TestModuleCfg,new SystemModuleMvcCfg,new MainModuleCfg,new BattleModuleCfg,new HelpModuleMvcCfg,new CardSkinModuleCfg])},t}(VoyaMVC.MVC);e.MVC=t,__reflect(t.prototype,"App.MVC")}(App||(App={}));var App;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(t,n,r,i){return e.prototype.init.call(this,t,n,r,i),this},t.prototype.login=function(e,t,n,r,i,o,s,a,u,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.sendHttp({api_name:"weixin_reg_login",jscode:s,nikename:"",sex:"",avatar:"",content_id:o,sys:n,source:r,source_lv:i,invite_openid:e,invite_user_id:t},function(e,t){this.serverTimestamp=parseInt(e.timestamp),this.token=e.token,a.call(u,e,t)}.bind(this),this,h)];case 1:return[2,c.sent()]}})})},t.prototype.submitBattleRecord=function(e,t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return app.log("========= submit battle record ======="),[4,this.sendHttp({api_name:"combat",lv:e,score:t},n,this,i)];case 1:return[2,r.sent()]}})})},t.prototype.getAboutShare=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.sendHttp({api_name:"get_share_content_image_list"},e,this,n)];case 1:return[2,t.sent()]}})})},t.prototype.shareStatistics=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.sendHttp({api_name:"share_log",content_id:e},t,n,r)];case 1:return[2,i.sent()]}})})},t.prototype.getGameExamineStatus=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.sendHttp({api_name:"get_version_status"},e,this,n)];case 1:return[2,t.sent()]}})})},t.prototype.enterFromShare=function(e,t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"invite_into_game",invite_openid:t,invite_user_id:e},n,r,i)];case 1:return[2,o.sent()]}})})},t.prototype.getOtherGamesInfo=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.sendHttp({api_name:"get_guide_image_list_new"},e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.getUseinfo=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.sendHttp({api_name:"get_base_info"},e,t,n)];case 1:return[2,r.sent()]}})})},t.prototype.sendWatchTVStep=function(e,t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"video_log",type:e,action_type:t},n,r,i)];case 1:return[2,o.sent()]}})})},t.prototype.checkGroupShare=function(e,t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"check_share_group",encrypted:e,iv:t},n,r,i)];case 1:return[2,o.sent()]}})})},t}(e.AppHttpBase);e.AppHttp=t,__reflect(t.prototype,"App.AppHttp")}(App||(App={}));var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.getSysInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Enum_HttpRespCode;!function(e){e[e.undefined=-1]="undefined",e[e.SUCCESS=1]="SUCCESS"}(Enum_HttpRespCode||(Enum_HttpRespCode={}));var App;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCheck=function(e){return 1!=e.code&&app.warn("====== http resp exception =======  code:"+e.code+"  msg:"+e.msg),{pass:!0}},t}(e.HttpRespChecker);e.AppHttpRespChecker=t,__reflect(t.prototype,"App.AppHttpRespChecker")}(App||(App={}));var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var u=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(u,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var App;!function(e){var t=function(){function t(){}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return this.reflector=new VL.Reflector.EgretReflector,n=this,r=e.GlobalCfg.bind,[4,this.loadGlobalJson()];case 1:return t=n.globalConfig=new(r.apply(e.GlobalCfg,[void 0,i.sent()])),this.logger=new e.Logger,t.isDebug&&this.logger.init(),console.log("====================== check info ======================="),console.log("client_version:"+t.client_version),console.log("pf:"+t.pf),console.log("httpServer:"+t.httpServer),console.log("serverPort:"+t.serverPort),console.log("isDebug:"+t.isDebug),console.log("========================================================="),this.resManager=new VL.Resource.EgretResManager,this.config=new e.Config,this.mcHelper=new e.MCHelper,this.easyLoadingManager=new e.EasyLoadingManager,this.soundManager=new VL.Sound.SoundMgr(VL.Sound.EgretSound),this.dragDropManager=new VL.DragDrop.DragDropManager,this._http=new VL.Net.Http,this.appHttp=(new e.AppHttp).init(this._http,t.client_version,t.httpServer,t.serverPort),[2]}})})},t.prototype.loadGlobalJson=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){var r=new egret.URLRequest("resource/config/global.json"),i=new egret.URLLoader(r);i.dataFormat=egret.URLLoaderDataFormat.TEXT,i.once(egret.Event.COMPLETE,function(e){var n=JSON.parse(i.data);t(n)},e),i.once(egret.IOErrorEvent.IO_ERROR,function(e){n(e.data)},e)})]})})},t.prototype.getConfig=function(e){return this.config.getConfig(e)},t.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(r=this.logger).log.apply(r,[e].concat(t));var r},t.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(r=this.logger).warn.apply(r,[e].concat(t));var r},t.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(r=this.logger).error.apply(r,[e].concat(t));var r},t}();e.App=t,__reflect(t.prototype,"App.App")}(App||(App={}));var app=new App.App,App;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.dg_onRestore=new VL.Delegate,t.touchEnabled=t.touchChildren=!1,t}return __extends(t,e),t.prototype.init=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this},t.prototype.clear=function(){this.parent&&this.parent.removeChild(this),this.dg_onRestore.boardcast(this),this.container.y=0,this.container.alpha=1},t.prototype.restore=function(){restore(this)},t.prototype.onShow=function(){egret.Tween.get(this.container).set({y:0,alpha:1}).to({y:-100},300,egret.Ease.circOut).wait(700).to({y:-200,alpha:0},400,egret.Ease.circIn).call(this.restore,this)},t}(eui.Component);e.BaseTipItem=t,__reflect(t.prototype,"App.BaseTipItem",["VL.ObjectCache.ICacheable"])}(App||(App={}));var App;!function(e){var t=function(){function e(){this.tipItemList=[]}return e.prototype.showTip=function(e){e&&(e.dg_onRestore.register(this.onTipItemRestore,this),this.tipItemList.push(e),this.onShowTip(e),e.onShow())},e.prototype.activate=function(e){this.area=e},e.prototype.deactivate=function(){this.area=null},e.prototype.onTipItemRestore=function(e){this.tipItemList.splice(this.tipItemList.indexOf(e),1),e.dg_onRestore.unregister(this.onTipItemRestore)},Object.defineProperty(e.prototype,"gap",{get:function(){return 3},enumerable:!0,configurable:!0}),e}();e.BaseTipManager=t,__reflect(t.prototype,"App.BaseTipManager",["App.ITipManager"])}(App||(App={}));var GameData=function(){function e(){}return Object.defineProperty(e,"score",{get:function(){return Math.floor(this._score)},set:function(e){this._score=e},enumerable:!0,configurable:!0}),e.resetAttr=function(){e.score=0,e.killCount=0,e.speed=10},e._score=0,e.killCount=20,e.addScore=10,e.speed=10,e.continuePlayCount=0,e.continuePlayMaxCount=3,e.syncTime=0,e.syncDogTime=0,e.isOnlyShareGroup=!1,e.shareId=[],e.shareText=["抖音火爆游戏！","你有39个好友正在玩，一起来吧！","史上最难游戏，全球仅有四人通关。","世界上最好玩的游戏，保证你没玩过！","苹果排行榜第一的游戏，快来玩吧！","单身多年，让他们见识你的手速有多快！","说以你的智商，绝对活不过30秒。","别以为你长得帅我就不打你。","左脑发达还是右脑发达，进来就知道了！","智商超过130才能通过，来测试测试！","牛顿的棺材板压不住了，快来帮忙！","史上最难游戏，爱因斯坦很无语！","老婆在家，不要偷偷点哦！"],e.shareImg=["http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/1.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/2.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/3.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/4.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/5.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/6.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/7.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/8.jpg"],e}();__reflect(GameData.prototype,"GameData");var CardConfig=function(){function e(){}return e.prototype.attrs=function(){return["id","type","value","unlock","weight"]},e}();__reflect(CardConfig.prototype,"CardConfig"),window.CardConfig=CardConfig;var App;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n._isOpened=!1,n._isInited=!1,n.dg_inited=new VL.Delegate,n.myParent=t,n.init(),n}return __extends(t,e),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.resources.length>0?[4,this.loadRes()]:[3,2];case 1:e.sent(),this.onInit(),this._isInited=!0,this.dg_inited.boardcast(),e.label=2;case 2:return[2]}})})},t.prototype.loadRes=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t){app.resManager.loadResTask({keys:e.resources,taskName:getClassName(e),onComplete:function(e){t()}})})]})})},t.prototype.open=function(e){void 0===e&&(e=null),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this),this.addEventListener(egret.Event.RESIZE,this.onResize,this),this.updateLayout(),this.addToParent(),this._isOpened=!0},t.prototype.close=function(e){void 0===e&&(e=null),this.removeFromParent(),this._isOpened=!1,StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.onResize,this),this.removeEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.onResize=function(e){this.updateLayout()},t.prototype.updateLayout=function(){var e=StageUtils.getStage();this.width=e.stageWidth,this.height=e.stageHeight},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},t.prototype.destroy=function(){this.onDestroy(),this.removeFromParent(),this._isInited=!1},Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},set:function(e){this._myParent=e,this.isOpened&&this.addToParent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInited",{get:function(){return this._isInited},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(t.prototype,"BaseSpriteView",["App.IBaseView","IBaseComponent"])}(App||(App={}));var LvConfig=function(){function e(){}return e.prototype.attrs=function(){return["id","lv","needExp"]},e}();__reflect(LvConfig.prototype,"LvConfig"),window.LvConfig=LvConfig;var BattleModuleCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new BattleViewMediator,new BattleMenuWindowMediator,new BattleSettleMediator,new RebirthConfirmMediator]},t.prototype.getControllerList=function(){return[new BattleModuleCtrl]},t}(VoyaMVC.MvcConfigBase);__reflect(BattleModuleCfg.prototype,"BattleModuleCfg");var BattleModuleCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(BattleMsg.cmd.EnterBattle,this.onEnterBattleHandler,this),this.regMsg(BattleMsg.cmd.AppendHandCardToGroup,this.onAppendHandCardToGroup,this),this.regMsg(BattleMsg.cmd.DropCurrCardToRubbishBin,this.onDropCurrCardToRubbishBin,this),this.regMsg(BattleMsg.cmd.ClearOneRubbishCell,this.onClearOneRubbishCell,this),this.regMsg(BattleMsg.cmd.RefreshHandCard,this.onRefreshHandCard,this),this.regMsg(BattleMsg.cmd.PlayAgain,this.onPlayAgain,this),this.regMsg(BattleMsg.cmd.BackToMainView,this.onBackToMainView,this),this.regMsg(BattleMsg.cmd.Rebirth,this.onRebirth,this),this.regMsg(BattleMsg.feedBack.LvUp,this.onLvUp,this),this.regMsg(WxSdkMsg.WatchVideo_FeedBack,this.onWxWatchVideoResult,this)},t.prototype.deactivate=function(){this.unregMsg(BattleMsg.cmd.EnterBattle,this.onEnterBattleHandler,this),this.unregMsg(BattleMsg.cmd.AppendHandCardToGroup,this.onAppendHandCardToGroup,this),this.unregMsg(BattleMsg.cmd.DropCurrCardToRubbishBin,this.onDropCurrCardToRubbishBin,this),this.unregMsg(BattleMsg.cmd.ClearOneRubbishCell,this.onClearOneRubbishCell,this),this.unregMsg(BattleMsg.cmd.RefreshHandCard,this.onRefreshHandCard,this),this.unregMsg(BattleMsg.cmd.PlayAgain,this.onPlayAgain,this),this.unregMsg(BattleMsg.cmd.BackToMainView,this.onBackToMainView,this),this.unregMsg(BattleMsg.cmd.Rebirth,this.onRebirth,this),this.unregMsg(BattleMsg.feedBack.LvUp,this.onLvUp,this),this.unregMsg(WxSdkMsg.WatchVideo_FeedBack,this.onWxWatchVideoResult,this)},t.prototype.onEnterBattleHandler=function(e){this.battleModel.newGame(this.playerModel.lv),this.sendMsg(create(BattleMsg.cmd.OpenBattleView))},t.prototype.onAppendHandCardToGroup=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){return t=this.battleModel,n=t.getCardGroupByIdx(e.body.groupId),n.appendCard(t.handCardList.pop()),n.mergCard(),r=t.checkGameOver(),t.unshiftNewHandCard(),r&&(this.saveBattleRecord(),t.rebirthEnable?this.sendMsg(create(BattleMsg.cmd.OpenRebirthWindow).init({onClose:function(){i.sendMsg(create(BattleMsg.cmd.CloseBattleView)),i.sendMsg(create(BattleMsg.cmd.OpenBattleSettleView))}})):(this.sendMsg(create(BattleMsg.cmd.CloseBattleView)),this.sendMsg(create(BattleMsg.cmd.OpenBattleSettleView)))),[2]})})},t.prototype.onDropCurrCardToRubbishBin=function(e){this.battleModel.abandonCurrHandCard()},t.prototype.onClearOneRubbishCell=function(e){var t=this.battleModel;t.rubbishCount>0&&t.clearRubbishCellChance>0&&!this.getModel(WxSDKModel).isExamine&&(this.sendMsg(create(WxSdkMsg.Share)),egret.setTimeout(function(){t.removeOneRubbish()},this,3e3))},t.prototype.onRefreshHandCard=function(e){var t=this.battleModel;t.enableRefreshAllHandCards?t.refreshAllHandCards():t.resetRefreshHandCardChanceChance>0&&this.sendMsg(create(WxSdkMsg.WatchVideo_CMD).init({flag:Enum_WxWatchVideoFlag.REFRESH_HAND_CARD,showAlertWhenGiveUp:!1}))},t.prototype.onPlayAgain=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.saveBattleRecord(),this.battleModel.newGame(this.playerModel.lv),[2]})})},t.prototype.onBackToMainView=function(e){this.saveBattleRecord(),this.sendMsg(create(BattleMsg.cmd.CloseBattleView)),this.sendMsg(create(MainModuleMsg.OpenMainView))},t.prototype.onRebirth=function(e){this.sendMsg(create(WxSdkMsg.WatchVideo_CMD).init({flag:Enum_WxWatchVideoFlag.REBIRTH,showAlertWhenGiveUp:!1}))},t.prototype.onLvUp=function(e){var t=this.battleModel;t.resetClearRubbishBinChance(),t.enableRefreshAllHandCards||t.resetRefreshHandCardChance(),t.resetResetRefreshHandCardChanceChance();var n=this.playerModel;n.lv=t.currLv,n.saveBattleRecord(t.currLv,t.currScore)},t.prototype.onWxWatchVideoResult=function(e){var t=e.body.flag,n=e.body.result,r=(e.body.error,this.battleModel);switch(n){case Enum_WxWatchVideoResult.COMPLETE:switch(app.appHttp.sendWatchTVStep(t,2,null,null),t){case Enum_WxWatchVideoFlag.REFRESH_HAND_CARD:r.resetRefreshHandCardChance();break;case Enum_WxWatchVideoFlag.REBIRTH:r.rebirth(),this.sendMsg(create(BattleMsg.cmd.CloseRebirthWindow))}break;case Enum_WxWatchVideoResult.NO_AD_COUNT:this.sendMsg(create(PopupMsg.ShowPopup).init({content:"今日广告奖励机会已耗尽，无法享受相应福利",showClose:!0}));break;case Enum_WxWatchVideoResult.GIVE_UP:}},t.prototype.saveBattleRecord=function(){var e=this.playerModel,t=this.battleModel;e.saveBattleRecord(t.currLv,t.currScore)},Object.defineProperty(t.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),t}(VoyaMVC.Controller);__reflect(BattleModuleCtrl.prototype,"BattleModuleCtrl");var Enum_CardType;!function(e){e[e.NORMAL=1]="NORMAL",e[e.RESTOR=2]="RESTOR",e[e.BOMB=3]="BOMB",e[e.UNIVERSAL=4]="UNIVERSAL"}(Enum_CardType||(Enum_CardType={}));var Enum_ResetCardGroupReason;!function(e){e[e.NEW_GAME=1]="NEW_GAME",e[e.MAX_CARD_VALUE=2]="MAX_CARD_VALUE",e[e.BOMB_CARD=3]="BOMB_CARD"}(Enum_ResetCardGroupReason||(Enum_ResetCardGroupReason={}));var Enum_WxWatchVideoFlag;!function(e){e[e.REFRESH_HAND_CARD=1]="REFRESH_HAND_CARD",e[e.REBIRTH=2]="REBIRTH"}(Enum_WxWatchVideoFlag||(Enum_WxWatchVideoFlag={}));var BattleModel=function(e){function t(){var t=e.call(this)||this;t._handCardList=[],t._cardGroupList=[];for(var n,r=0;r<PublicConfigHelper.CARD_GROUP_COUNT;r++)n=new CardGroupModel(r),n.dg_cardsMerged.register(t.onCardMerged,t),t._cardGroupList.push(n);return t}return __extends(t,e),t.prototype.newGame=function(e){this._score=0,this._baseExp=LvConfigHelper.getExpByLv(e),this._scoreMultiple=1,this._rebirthChance=1,this.removeAllRubbish(),this.resetClearRubbishBinChance();for(var t=0,n=this._cardGroupList.length;n>t;t++)this._cardGroupList[t].reset(Enum_ResetCardGroupReason.NEW_GAME);this.refreshAllHandCards(),this._refreshHandCardChance=PublicConfigHelper.INITIAL_REFRESH_HAND_CARD_CHANCE,this.resetResetRefreshHandCardChanceChance(),this.sendMsg(create(BattleMsg.feedBack.NewGame))},t.prototype.unshiftNewHandCard=function(){if(this._handCardList.length<2){var e=this.getRandomCard();return this._handCardList.unshift(e),this.sendMsg(create(BattleMsg.feedBack.UnshiftNewHandCard).init({card:e})),e}return null},t.prototype.getRandomCard=function(){var e,t=app.config.getConfig(CardConfig),n=this.currLv,r=[],i=0;for(var o in t)e=t[o],n>=e.unlock&&(i+=e.weight,r.push({lessThan:i,cfg:e}));Utils.ArrayUtils.quickSort(r,function(e,t){return e.lessThan-t.lessThan});for(var s=Math.random()*i,a=0,u=r.length;u>a;a++)if(s<=r[a].lessThan)return r[a].cfg;return null},Object.defineProperty(t.prototype,"enableAbandonCurrHandCard",{get:function(){return this._rubbishCount<PublicConfigHelper.MAX_RUBBISH_COUNT},enumerable:!0,configurable:!0}),t.prototype.abandonCurrHandCard=function(){return this.enableAbandonCurrHandCard?(this._handCardList.pop(),this._rubbishCount++,this.sendMsg(create(BattleMsg.feedBack.AbandonedCurrHandCard)),this.unshiftNewHandCard(),!0):!1},t.prototype.removeOneRubbish=function(){return this._rubbishCount>0&&(--this._rubbishCount,--this._clearRubbishCellChance,this.sendMsg(create(BattleMsg.feedBack.RubbishCountChanged).init({remainRubbishCount:this._rubbishCount}))),this._rubbishCount},t.prototype.removeAllRubbish=function(){this._rubbishCount=0,this.sendMsg(create(BattleMsg.feedBack.RubbishCountChanged).init({remainRubbishCount:this._rubbishCount}))},t.prototype.resetClearRubbishBinChance=function(){this._clearRubbishCellChance=PublicConfigHelper.MAX_RUBBISH_COUNT,this.sendMsg(create(BattleMsg.feedBack.ClearRubbishCellChanceChanged).init({chanceCount:this._clearRubbishCellChance}))},Object.defineProperty(t.prototype,"clearRubbishCellChance",{get:function(){return this._clearRubbishCellChance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rubbishCount",{get:function(){return this._rubbishCount},enumerable:!0,configurable:!0}),t.prototype.resetRefreshHandCardChance=function(){this._refreshHandCardChance=PublicConfigHelper.INITIAL_REFRESH_HAND_CARD_CHANCE,this.sendMsg(create(BattleMsg.feedBack.RefreshedHandCardsChanceChanged).init({chanceCount:this._refreshHandCardChance}))},t.prototype.costResetRefreshHandCardChanceChance=function(){this._resetRefreshHandCardChanceChance--,this.sendMsg(create(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged).init({chanceCount:this._resetRefreshHandCardChanceChance}))},t.prototype.resetResetRefreshHandCardChanceChance=function(){this._resetRefreshHandCardChanceChance=1,this.sendMsg(create(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged).init({chanceCount:this._resetRefreshHandCardChanceChance}))},t.prototype.refreshAllHandCards=function(){this._refreshHandCardChance--;for(var e=0;e<PublicConfigHelper.MAX_HAND_CARD_COUNT;e++)this._handCardList[e]=this.getRandomCard();return this.sendMsg(create(BattleMsg.feedBack.RefreshedHandCards).init({cards:this._handCardList})),!0},Object.defineProperty(t.prototype,"refreshHandCardChance",{get:function(){return this._refreshHandCardChance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableRefreshAllHandCards",{get:function(){return this._refreshHandCardChance>0},enumerable:!0,configurable:!0}),t.prototype.onCardMerged=function(e){var t=e.distCards,n=this.calculateAddScore(t);this.addScore(n),t[t.length-1].value==CardConfigHelper.maxValueCard.value&&(this.scoreMultiple++,this.getCardGroupByIdx(e.groupIdx).reset(Enum_ResetCardGroupReason.MAX_CARD_VALUE),this.resetClearRubbishBinChance(),this.resetRefreshHandCardChance(),this.resetResetRefreshHandCardChanceChance()),this.sendMsg(create(BattleMsg.feedBack.CardMerged).init({groupIdx:e.groupIdx,distCards:t,scoreList:n}))},t.prototype.calculateAddScore=function(e){for(var t,n=[],r=0,i=e.length;i>r;r++){if(t=e[r],2048==t.value||t.type==Enum_CardType.BOMB){for(var o=r;i>o;o++)t=e[o],n.push(t.value);break}n.push(t.value*(r+1)*this.scoreMultiple)}return n},t.prototype.addScore=function(e){for(var t=this.currLv,n=0;n<e.length;n++)this._score+=e[n];var r=this.currLv;r>t&&this.sendMsg(create(BattleMsg.feedBack.LvUp).init({currLv:r})),app.log("currScore:",this._score)},t.prototype.checkGameOver=function(){for(var e,t=!0,n=0,r=this._cardGroupList.length;r>n;n++)e=this._cardGroupList[n],e.cardsCount<PublicConfigHelper.MAX_GROUP_CARDS_COUNT&&(t=!1);return t},t.prototype.rebirth=function(){this._rebirthChance--;for(var e,t=PublicConfigHelper.MAX_GROUP_CARDS_COUNT>>1,n=0,r=PublicConfigHelper.CARD_GROUP_COUNT;r>n;n++)e=this.getCardGroupByIdx(n),e.cardList.length>t&&(e.cardList.length=t);this.sendMsg(create(BattleMsg.feedBack.Rebirth))},Object.defineProperty(t.prototype,"rebirthEnable",{get:function(){return this._rebirthChance>0},enumerable:!0,configurable:!0}),t.prototype.getCardGroupByIdx=function(e){return this._cardGroupList[e]},Object.defineProperty(t.prototype,"currScore",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currLv",{get:function(){var e=LvConfigHelper.getLvByExp(this.exp);return e==LvConfigHelper.maxLv&&(e-=1),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseExp",{get:function(){return this._baseExp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exp",{get:function(){return Math.min(Math.max(this._baseExp+this._score,0),LvConfigHelper.getExpByLv(LvConfigHelper.maxLv)-1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreMultiple",{get:function(){return this._scoreMultiple},set:function(e){this._scoreMultiple=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currHandCard",{get:function(){return this._handCardList[this._handCardList.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"handCardList",{get:function(){return this._handCardList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resetRefreshHandCardChanceChance",{get:function(){return this._resetRefreshHandCardChanceChance},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(BattleModel.prototype,"BattleModel");var CardGroupModel=function(e){function t(t){var n=e.call(this)||this;return n._cardList=[],n.dg_cardsMerged=new VL.Delegate,n.groupIdx=t,n}return __extends(t,e),t.prototype.appendCard=function(e){if(this.cardList.length>=PublicConfigHelper.MAX_GROUP_CARDS_COUNT)switch(e.type){case Enum_CardType.NORMAL:case Enum_CardType.BOMB:if(e.value!=this.lastCard.value)return!1}return this._cardList.push(e),this.sendMsg(create(BattleMsg.feedBack.CurrCardAppendedToGroup).init({groupIdx:this.groupIdx,card:e})),!0},t.prototype.mergCard=function(){for(var e,t=[];;){if(e=this.checkMergeCard(),!e){t.length>0&&this.dg_cardsMerged.boardcast({groupIdx:this.groupIdx,distCards:t});break}switch(e.type){case Enum_CardType.NORMAL:t.push(e);break;case Enum_CardType.BOMB:for(;this.cardList.length>0;){var n=this.cardList.pop();n.type==Enum_CardType.UNIVERSAL&&(n=CardConfigHelper.getNormalCardByValue(e.value)),t.push(n)}}}return t},t.prototype.checkMergeCard=function(){var e=this._cardList;if(e.length>=2){var t=this.lastCard,n=this.lastButOneCard,r=void 0;if(n.type!=Enum_CardType.NORMAL||n.value!=t.value&&t.type!=Enum_CardType.UNIVERSAL){if(n.type==Enum_CardType.BOMB&&(n.value==t.value||t.type==Enum_CardType.UNIVERSAL))return n;if(n.type==Enum_CardType.UNIVERSAL){if(t.type==Enum_CardType.NORMAL)return r=CardConfigHelper.getNormalCardByValue(t.value<<1),e[e.length-2]=r,e.pop(),r;if(t.type==Enum_CardType.UNIVERSAL)return null;if(t.type==Enum_CardType.BOMB)return t}}else{if(t.type==Enum_CardType.NORMAL||t.type==Enum_CardType.UNIVERSAL)return r=CardConfigHelper.getNormalCardByValue(n.value<<1),r&&(e[e.length-2]=r,e.pop()),r;if(t.type==Enum_CardType.BOMB)return t}return null}return null},t.prototype.reset=function(e){for(var t=[];this._cardList.length>0;)t.push(this._cardList.pop());this.sendMsg(create(BattleMsg.feedBack.CardGroupReset).init({groupIdx:this.groupIdx,reason:e}))},Object.defineProperty(t.prototype,"cardList",{get:function(){return this._cardList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardsCount",{get:function(){return this._cardList.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastButOneCard",{get:function(){return this._cardList[this._cardList.length-2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastCard",{get:function(){return this._cardList[this._cardList.length-1]},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(CardGroupModel.prototype,"CardGroupModel");var BattleMsg;!function(e){var t;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.EnterBattle=t,__reflect(t.prototype,"BattleMsg.cmd.EnterBattle");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this
}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenBattleView=n,__reflect(n.prototype,"BattleMsg.cmd.OpenBattleView");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseBattleView=r,__reflect(r.prototype,"BattleMsg.cmd.CloseBattleView");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenBattleMenu=i,__reflect(i.prototype,"BattleMsg.cmd.OpenBattleMenu");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseBattleMenu=o,__reflect(o.prototype,"BattleMsg.cmd.CloseBattleMenu");var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenBattleSettleView=s,__reflect(s.prototype,"BattleMsg.cmd.OpenBattleSettleView");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseBattleSettleView=a,__reflect(a.prototype,"BattleMsg.cmd.CloseBattleSettleView");var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenRebirthWindow=u,__reflect(u.prototype,"BattleMsg.cmd.OpenRebirthWindow");var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseRebirthWindow=h,__reflect(h.prototype,"BattleMsg.cmd.CloseRebirthWindow");var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.BackToMainView=c,__reflect(c.prototype,"BattleMsg.cmd.BackToMainView");var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.PlayAgain=p,__reflect(p.prototype,"BattleMsg.cmd.PlayAgain");var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.AppendHandCardToGroup=l,__reflect(l.prototype,"BattleMsg.cmd.AppendHandCardToGroup");var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.DropCurrCardToRubbishBin=d,__reflect(d.prototype,"BattleMsg.cmd.DropCurrCardToRubbishBin");var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ClearOneRubbishCell=g,__reflect(g.prototype,"BattleMsg.cmd.ClearOneRubbishCell");var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.RefreshHandCard=f,__reflect(f.prototype,"BattleMsg.cmd.RefreshHandCard");var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.Rebirth=_,__reflect(_.prototype,"BattleMsg.cmd.Rebirth")}(t=e.cmd||(e.cmd={}))}(BattleMsg||(BattleMsg={}));var BattleMsg;!function(e){var t;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.NewGame=t,__reflect(t.prototype,"BattleMsg.feedBack.NewGame");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CardMerged=n,__reflect(n.prototype,"BattleMsg.feedBack.CardMerged");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CurrCardAppendedToGroup=r,__reflect(r.prototype,"BattleMsg.feedBack.CurrCardAppendedToGroup");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CardGroupReset=i,__reflect(i.prototype,"BattleMsg.feedBack.CardGroupReset");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.UnshiftNewHandCard=o,__reflect(o.prototype,"BattleMsg.feedBack.UnshiftNewHandCard");var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.RefreshedHandCards=s,__reflect(s.prototype,"BattleMsg.feedBack.RefreshedHandCards");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.RefreshedHandCardsChanceChanged=a,__reflect(a.prototype,"BattleMsg.feedBack.RefreshedHandCardsChanceChanged");var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ResetRefreshedHandCardsChanceChanceChanged=u,__reflect(u.prototype,"BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged");var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ClearRubbishCellChanceChanged=h,__reflect(h.prototype,"BattleMsg.feedBack.ClearRubbishCellChanceChanged");var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.AbandonedCurrHandCard=c,__reflect(c.prototype,"BattleMsg.feedBack.AbandonedCurrHandCard");var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.RubbishCountChanged=p,__reflect(p.prototype,"BattleMsg.feedBack.RubbishCountChanged");var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.LvUp=l,__reflect(l.prototype,"BattleMsg.feedBack.LvUp");var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.Rebirth=d,__reflect(d.prototype,"BattleMsg.feedBack.Rebirth")}(t=e.feedBack||(e.feedBack={}))}(BattleMsg||(BattleMsg={}));var BattleView=function(e){function t(){return e.call(this,"BattleViewSkin")||this}return __extends(t,e),t.prototype.getCardGroup=function(e){return this["cardGroup"+e]},Object.defineProperty(t.prototype,"resources",{get:function(){return[]},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){},t}(App.BaseAutoSizeView);__reflect(BattleView.prototype,"BattleView");var BattleViewMediator=function(e){function t(){var t=e.call(this)||this;return t._groupReset=-1,t._handCardMediator=new HandCardMediator,t._recordMediator=new BattleRecordMediator,t}return __extends(t,e),t.prototype.onViewOpen=function(){var e=this.view;e.rect_bg.fillColor=SkinConfigHelper.getGameBgColor(this.getModel(PlayerModel).skinId);for(var t,n=PublicConfigHelper.CARD_GROUP_COUNT,r=this.getModel(PlayerModel).skinMng,i=0;n>i;i++)t=e.getCardGroup(i),t.activate(i,r),t.dg_onDropIn.register(this.onCardDropToGroup,this);e.rubbishBin.activate(this.getModel(PlayerModel).skinId),this._handCardMediator.activate(e.grp_handCards),this._recordMediator.activate(e.battlePanel),e.rubbishBin.dg_onDropIn.register(this.onCardDropToRubbishBin,this),EventHelper.addTapEvent(e.rubbishBin,this.onTap,this),EventHelper.addTapEvent(e.btn_refreshHandCard,this.onTap,this),EventHelper.addTapEvent(e.btn_menu,this.onTap,this),EventHelper.addTapEvent(e.btn_help,this.onTap,this),this.regMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.regMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.regMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCurrCardAppendedToGroup,this),this.regMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.regMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.regMsg(BattleMsg.feedBack.RubbishCountChanged,this.onRubbishCountChanged,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCardsChanceChanged,this.onRefreshedHandCardsChanceChanged,this),this.regMsg(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged,this.onResetRefreshedHandCardsChanceChanceChanged,this),this.regMsg(BattleMsg.feedBack.ClearRubbishCellChanceChanged,this.onClearRubbishCellChanceChanged,this),this.regMsg(BattleMsg.feedBack.Rebirth,this.onRebirth,this),this.updateByData()},t.prototype.onViewClose=function(){for(var e,t=this.view,n=PublicConfigHelper.CARD_GROUP_COUNT,r=0;n>r;r++)e=t.getCardGroup(r),e.dg_onDropIn.unregister(this.onCardDropToGroup),e.deactivate();t.rubbishBin.deactivate(),this._handCardMediator.deactivate(),this._recordMediator.deactivate(),t.rubbishBin.dg_onDropIn.unregister(this.onCardDropToRubbishBin),EventHelper.removeTapEvent(t.rubbishBin,this.onTap,this),EventHelper.removeTapEvent(t.btn_refreshHandCard,this.onTap,this),EventHelper.removeTapEvent(t.btn_menu,this.onTap,this),EventHelper.removeTapEvent(t.btn_help,this.onTap,this),this.unregMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.unregMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.unregMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCurrCardAppendedToGroup,this),this.unregMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.unregMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.unregMsg(BattleMsg.feedBack.RubbishCountChanged,this.onRubbishCountChanged,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCardsChanceChanged,this.onRefreshedHandCardsChanceChanged,this),this.unregMsg(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged,this.onResetRefreshedHandCardsChanceChanceChanged,this),this.unregMsg(BattleMsg.feedBack.ClearRubbishCellChanceChanged,this.onClearRubbishCellChanceChanged,this),this.unregMsg(BattleMsg.feedBack.Rebirth,this.onRebirth,this)},t.prototype.updateByData=function(){for(var e,t,n,r,i=this.battleModel,o=this.view,s=this.getModel(PlayerModel).skinMng,a=PublicConfigHelper.CARD_GROUP_COUNT,u=0;a>u;u++){t=o.getCardGroup(u),t.removeAllCards(),e=i.getCardGroupByIdx(u),n=e.cardList;for(var h=0,c=n.length;c>h;h++)r=create(Card).init(n[u],s),t.appendCard(r)}o.btn_refreshHandCard.enableRefresh=this.battleModel.refreshHandCardChance>0,this.updateRubbishBin()},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.rubbishBin:this.sendMsg(create(BattleMsg.cmd.ClearOneRubbishCell));break;case t.btn_refreshHandCard:this.sendMsg(create(BattleMsg.cmd.RefreshHandCard));break;case t.btn_menu:this.sendMsg(create(BattleMsg.cmd.OpenBattleMenu));break;case t.btn_help:this.sendMsg(create(HelpModuleMsg.OPEN_HELP_VIEW))}},t.prototype.onCardDropToRubbishBin=function(e){this.sendMsg(create(BattleMsg.cmd.DropCurrCardToRubbishBin).init({card:e.dragItem}))},t.prototype.onCardDropToGroup=function(e){var t=e.container;this.sendMsg(create(BattleMsg.cmd.AppendHandCardToGroup).init({groupId:t.groupId,card:e.dragItem}))},t.prototype.onCardMerged=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:t=this.view.getCardGroup(e.body.groupIdx),n=e.body.distCards,r=e.body.scoreList,i=0,o.label=1;case 1:return i<n.length?[4,t.mergeCard(n[i],r[i])]:[3,4];case 2:if(o.sent())return[3,4];o.label=3;case 3:return i++,[3,1];case 4:return this._groupReset!=t.groupId?[3,6]:[4,t.removeAllCardsAsync()];case 5:o.sent(),this._groupReset=-1,o.label=6;case 6:return[2]}})})},t.prototype.onCurrCardAppendedToGroup=function(e){var t=this.view.getCardGroup(e.body.groupIdx),n=create(Card).init(e.body.card,this.getModel(PlayerModel).skinMng);t.appendCard(n)},t.prototype.onNewGame=function(e){},t.prototype.onCardGroupReset=function(e){var t=e.body.groupIdx,n=e.body.reason;switch(n){case Enum_ResetCardGroupReason.NEW_GAME:this.view.getCardGroup(t).removeAllCards();break;case Enum_ResetCardGroupReason.MAX_CARD_VALUE:this._groupReset=t}},t.prototype.onAbandonedCurrHandCard=function(e){this.updateRubbishBin()},t.prototype.onRubbishCountChanged=function(e){this.updateRubbishBin()},t.prototype.onClearRubbishCellChanceChanged=function(e){this.updateRubbishBin()},t.prototype.updateRubbishBin=function(){var e=this.view.rubbishBin,t=this.battleModel,n=this.getModel(WxSDKModel);e.rubbishCount=t.rubbishCount,e.clearCellChance=n.isExamine?0:t.clearRubbishCellChance},t.prototype.onRefreshedHandCards=function(e){this.updateRefreshHandCardsChance()},t.prototype.onRefreshedHandCardsChanceChanged=function(e){this.updateRefreshHandCardsChance()},t.prototype.onResetRefreshedHandCardsChanceChanceChanged=function(e){this.updateRefreshHandCardsChance()},t.prototype.updateRefreshHandCardsChance=function(){this.view.btn_refreshHandCard.enableRefresh=this.battleModel.enableRefreshAllHandCards,this.view.btn_refreshHandCard.enableReset=this.battleModel.resetRefreshHandCardChanceChance>0},t.prototype.onRebirth=function(e){for(var t=PublicConfigHelper.MAX_GROUP_CARDS_COUNT>>1,n=0,r=PublicConfigHelper.CARD_GROUP_COUNT;r>n;n++)this.view.getCardGroup(n).removeCards(t)},Object.defineProperty(t.prototype,"viewClass",{get:function(){return BattleView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(BattleViewMediator.prototype,"BattleViewMediator");var PublicConfig=function(){function e(){}return e.prototype.attrs=function(){return["cardGroupCount","maxRubbishCount","maxHandCardCount","maxGroupCardCount"]},e}();__reflect(PublicConfig.prototype,"PublicConfig"),window.PublicConfig=PublicConfig;var RefreshBtn=function(e){function t(){var t=e.call(this)||this;return t.needRefresh=!1,t.touchEnabled=!0,t.touchChildren=!1,t}return __extends(t,e),t.prototype.updateShow=function(){var e=this;this.needRefresh||(this.needRefresh=!0,egret.callLater(function(){e.enableRefresh?(e.icon_playVideo.visible=!1,e.icon_refresh.visible=!0,e.rect_bg.fillColor=65280):(e.icon_playVideo.visible=!0,e.icon_refresh.visible=!1,e.rect_bg.fillColor=16711680,e.enableReset?e.icon_playVideo.source="icon_playVideo_png":e.icon_playVideo.source="icon_disable_png"),e.needRefresh=!1},this))},Object.defineProperty(t.prototype,"enableRefresh",{get:function(){return this._enableRefresh},set:function(e){this._enableRefresh=e,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableReset",{get:function(){return this._enableReset},set:function(e){this._enableReset=e,this.updateShow()},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(RefreshBtn.prototype,"RefreshBtn",["eui.UIComponent","egret.DisplayObject"]),window.RefreshBtn=RefreshBtn;var Card=function(e){function t(){var t=e.call(this)||this;return t._isChildCreated=!1,t.skinName="CardSkin",t.touchChildren=!1,t.dragItemCtrl=new DragCardCtrl(t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._isChildCreated=!0,this.updateByData()},t.prototype.updateByData=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.cfg)?(this.lb_value.text=this.cfg.value>0?this.cfg.value.toString():"",t=this._skinMng.getCardColor(this.cfg),n=this._skinMng.getCardImg(this.cfg),n.length>0?[4,app.resManager.getResAsync_promise(n)]:[3,2]):[3,4];case 1:return i=o.sent(),[3,3];case 2:i=null,o.label=3;case 3:return r=i,r?(this.img_bg.source=r,this.img_bg.visible=!0,this.rect_bg.visible=!1):(this.rect_bg.fillColor=t,this.img_bg.visible=!1,this.rect_bg.visible=!0),[3,5];case 4:this.lb_value.text="",this.rect_bg.fillColor=0,this.img_bg.source=null,this.img_bg.visible=!1,this.rect_bg.visible=!0,o.label=5;case 5:return[2]}})})},t.prototype.init=function(e,t){return this._skinMng=t,this._skinMng.dg_SkinChanged.register(this.onSkinChanged,this),this.cfg=e,this},t.prototype.onSkinChanged=function(e){this.updateByData()},t.prototype.clear=function(){this._skinMng.dg_SkinChanged.unregister(this.onSkinChanged),this._skinMng=null,this.cfg=null,app.dragDropManager.unregDragItem(this),this.x=this.y=0,this.parent&&this.parent.removeChild(this)},t.prototype.restore=function(e){void 0===e&&(e=t.MAX_CACHE_COUNT),restore(this,e)},Object.defineProperty(t.prototype,"cfg",{get:function(){return this._cfg},set:function(e){this._cfg!=e&&(this._cfg=e,this._isChildCreated&&this.updateByData())},enumerable:!0,configurable:!0}),t.MAX_CACHE_COUNT=35,t}(eui.Component);__reflect(Card.prototype,"Card",["VL.ObjectCache.ICacheable","VL.DragDrop.IDragItem"]),window.Card=Card;var DragCardCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onDropSecceed=function(e){},t.prototype.startDrag=function(t,n,r,i){e.prototype.startDrag.call(this,t,n,r,i),this.card.alpha=.5},t.prototype.stopDrag=function(){e.prototype.stopDrag.call(this),this.card.alpha=1},t.prototype.backupBeforeDrag=function(){this.origParent=this.dragItem.parent,this.origX=this.dragItem.x,this.origY=this.dragItem.y},t.prototype.rollBackBeforDrag=function(){this.dragItem.x=this.origX,this.dragItem.y=this.origY,this.origParent.addChild(this.dragItem)},Object.defineProperty(t.prototype,"card",{get:function(){return this.dragItem},enumerable:!0,configurable:!0}),t}(VL.DragDrop.DragItemCtrlBase);__reflect(DragCardCtrl.prototype,"DragCardCtrl");var CardGroup=function(e){function t(){var t=e.call(this)||this;return t.marginTop=10,t.gap=105,t._isActive=!1,t.skinName="CardGroupSkin",t._cardList=[],t.touchChildren=!1,t.touchEnabled=!0,t.dg_onDropIn=new VL.Delegate,t.dropContainerCtrl=new CardGroupDropCtrl(t),t.dg_mergeCardComplete=new VL.Delegate,t}return __extends(t,e),t.prototype.activate=function(e,t){this.stage&&!this._isActive&&(this._groupId=e,this._skinMng=t,app.dragDropManager.regDropContainer(this),this.dg_onDropIn.register(this.onDropIn,this),this._isActive=!0,this.updateDropArea())},t.prototype.deactivate=function(){app.dragDropManager.unregDropContainer(this),this.dg_onDropIn.unregister(this.onDropIn),this._skinMng=null,this._isActive=!1},t.prototype.onDropIn=function(e){this.img_border.visible=!1},t.prototype.appendCard=function(e){e.y=this.marginTop+this._cardList.length*this.gap,e.x=this.width-e.width>>1,this.addChild(e),this._cardList.push(e),this.updateDropArea()},t.prototype.mergeCard=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.lastCard,r=this.lastButOneCard,this.touchEnabled=!1,i=!1,n.cfg.type!=Enum_CardType.BOMB&&e.type!=Enum_CardType.BOMB?[3,2]:(this.flyScoreTip(n,e,t),[4,this.removeAllCardsAsync()]);case 1:return o.sent(),i=!0,[3,5];case 2:return this.flyScoreTip(n,e,t),[4,this.moveLastCardToLastButOneCard()];case 3:return o.sent(),this._cardList.pop(),n.restore(),[4,this.playMergeEff(r,e)];case 4:o.sent(),o.label=5;case 5:return[2,i]}})})},t.prototype.playMergeEff=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return[2,new Promise(function(r,i){egret.Tween.get(e).to({scaleX:.7,scaleY:.7,x:e.x+.15*e.width,y:e.y+.15*e.height},150).call(function(){e.cfg=t}).to({scaleX:1,scaleY:1,x:n.width-e.width>>1,y:e.y},150).call(function(){n.touchEnabled=!0,n.updateDropArea(),r(!0)})})]})})},t.prototype.flyScoreTip=function(e,t,n){var r=create(FlyScoreTip).init(this._skinMng.getCardColor(t),n),i=this.width>>1,o=e.y+(e.height>>1),s=o-(e.height>>1);egret.Tween.get(r).set({alpha:1,x:i,y:o}).to({alpha:0,y:s},600).call(function(){r.restore()}),this.addChild(r)},t.prototype.removeCards=function(e){e=Math.min(this._cardList.length,e);for(var t=0;e>t;t++)this._cardList.pop().restore();this.updateDropArea()},t.prototype.removeAllCards=function(){for(;this._cardList.length>0;)this._cardList.pop().restore();this.updateDropArea()},t.prototype.removeAllCardsAsync=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:this.touchEnabled=!1,t=this.lastCard.cfg.value,n=this.lastCard.cfg.type,i.label=1;case 1:return this._cardList.length>1?[4,this.moveLastCardToLastButOneCard()]:[3,3];case 2:return i.sent(),e=this.lastButOneCard,e.cfg.type!=Enum_CardType.UNIVERSAL||n!=Enum_CardType.BOMB&&n!=Enum_CardType.UNIVERSAL?(this.flyScoreTip(e,e.cfg,e.cfg.value),t=e.cfg.value):this.flyScoreTip(e,e.cfg,t),n=e.cfg.type,this._cardList.splice(this._cardList.length-2,1),e.restore(),[3,1];case 3:return[2,new Promise(function(e){var t=r.lastCard;t?egret.Tween.get(t).to({x:r.width>>1,y:t.y+t.height>>1,scaleX:0,scaleY:0},300).call(function(){r._cardList.pop(),t.parent.removeChild(t),t.scaleY=t.scaleX=1,t.restore(),r.updateDropArea(),r.touchEnabled=!0,e()}):(r.updateDropArea(),r.touchEnabled=!0,e())})]}})})},t.prototype.moveLastCardToLastButOneCard=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t){var n=e.lastCard,r=e.lastButOneCard;egret.Tween.get(n).to({y:r.y},150).call(function(){t()})})]})})},t.prototype.checkHover=function(e){var t=e==this._currDropArea;return this.img_border.visible=t,t},t.prototype.updateDropArea=function(){this._currDropArea=this},Object.defineProperty(t.prototype,"lastCard",{get:function(){return this._cardList[this._cardList.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastButOneCard",{get:function(){return this._cardList[this._cardList.length-2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupId",{get:function(){return this._groupId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardCount",{get:function(){return this._cardList.length},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(CardGroup.prototype,"CardGroup",["VL.DragDrop.IDropContainer"]),window.CardGroup=CardGroup;var CardGroupDropCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.checkEnableDrop=function(e){return this.cardGroup.cardCount<PublicConfigHelper.MAX_GROUP_CARDS_COUNT?!0:this.cardGroup.lastCard.cfg.value==e.cfg.value||e.cfg.type==Enum_CardType.UNIVERSAL},Object.defineProperty(t.prototype,"cardGroup",{get:function(){return this._container},enumerable:!0,configurable:!0}),t}(DropCardContainerCtrl);__reflect(CardGroupDropCtrl.prototype,"CardGroupDropCtrl");var DropEnableFilter=function(e){function t(){return e.call(this,0,1,20,20,2)||this}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}(egret.GlowFilter);__reflect(DropEnableFilter.prototype,"DropEnableFilter");var FlyScoreTip=function(e){function t(){var t=e.call(this)||this;return t.isReady=!1,t.skinName="FlyScoreTipSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.isReady=!0,this.updateShow()},t.prototype.init=function(e,t){return this.bgColor=e,this.score=t,this.updateShow(),this},t.prototype.updateShow=function(){this.isReady&&(this.rect_bg.fillColor=this.bgColor,this.lb_score.text="+ "+this.score,this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1)},t.prototype.clear=function(){this.score=0,this.bgColor=0,this.parent&&this.parent.removeChild(this)},t.prototype.restore=function(e){VL.ObjectCache.CacheableClass.restore(this)},t}(eui.Component);__reflect(FlyScoreTip.prototype,"FlyScoreTip",["VL.ObjectCache.ICacheable"]);var HandCardMediator=function(e){function t(){var t=e.call(this)||this;return t.gap=110,t._handCards=[],t}return __extends(t,e),t.prototype.activate=function(e){this.grp_HandCard=e,this.regMsg(BattleMsg.feedBack.UnshiftNewHandCard,this.onUnshiftNewHandCardHandler,this),this.regMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCardAppended,this),this.regMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.updateByData()},t.prototype.deactivate=function(){this.unregMsg(BattleMsg.feedBack.UnshiftNewHandCard,this.onUnshiftNewHandCardHandler,this),this.unregMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCardAppended,this),this.unregMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.grp_HandCard=null},t.prototype.updateByData=function(){for(var e=this._handCards;e.length>0;)e.pop().restore();for(var t,n=this.battleModel.handCardList,r=0,i=n.length;i>r;r++)t=create(Card).init(n[r],this.getModel(PlayerModel).skinMng),t.x=r*this.gap,this._handCards.push(t),this.grp_HandCard.addChild(t);this.setLastCardDragable()},t.prototype.onRefreshedHandCards=function(e){for(;this._handCards.length>0;)this._handCards.pop().restore();for(var t,n=e.body.cards,r=n.length-1;r>=0;r--)t=create(Card).init(n[r],this.getModel(PlayerModel).skinMng),this.unshiftNewCard(t)},t.prototype.onAbandonedCurrHandCard=function(e){var t=this._handCards.pop();t.restore()},t.prototype.onCardAppended=function(e){var t=this._handCards.pop();t.restore()},t.prototype.onUnshiftNewHandCardHandler=function(e){var t=create(Card).init(e.body.card,this.getModel(PlayerModel).skinMng);this.unshiftNewCard(t)},t.prototype.unshiftNewCard=function(e){var t=this;this._handCards.unshift(e),this.grp_HandCard.addChildAt(e,0),1==this._handCards.length?(e.x=0,this.setLastCardDragable()):egret.Tween.get(this.lastCard).to({x:this.gap*(this._handCards.length-1)},300).call(function(){t.setLastCardDragable()})},Object.defineProperty(t.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),t.prototype.setLastCardDragable=function(){app.dragDropManager.regDragItem(this.lastCard)},Object.defineProperty(t.prototype,"lastCard",{get:function(){return this._handCards[this._handCards.length-1]},enumerable:!0,configurable:!0}),t}(VoyaMVC.Mediator);__reflect(HandCardMediator.prototype,"HandCardMediator");var BattleMenuWindow=function(e){function t(){var t=e.call(this,"BattleMenuWindowSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.onInit=function(){},t.prototype.onDestroy=function(){},t}(App.BaseWindow);__reflect(BattleMenuWindow.prototype,"BattleMenuWindow");var BattleMenuWindowMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){var e=this.view;EventHelper.addTapEvent(e.icon_backHome,this.onTap,this),EventHelper.addTapEvent(e.icon_continue,this.onTap,this),EventHelper.addTapEvent(e.icon_reset,this.onTap,this)},t.prototype.onViewClose=function(){var e=this.view;EventHelper.removeTapEvent(e.icon_backHome,this.onTap,this),EventHelper.removeTapEvent(e.icon_continue,this.onTap,this),EventHelper.removeTapEvent(e.icon_reset,this.onTap,this)},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.icon_backHome:this.sendMsg(create(BattleMsg.cmd.BackToMainView));break;case t.icon_reset:this.sendMsg(create(BattleMsg.cmd.PlayAgain));break;case t.icon_continue:}this.sendMsg(create(BattleMsg.cmd.CloseBattleMenu))},Object.defineProperty(t.prototype,"viewClass",{get:function(){return BattleMenuWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleMenu},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleMenu},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(BattleMenuWindowMediator.prototype,"BattleMenuWindowMediator");var RebirthConfirmMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(e){var t=this.view;this.onClose=e.onClose,EventHelper.addTapEvent(t.btn_close,this.onTap,this),EventHelper.addTapEvent(t.btn_rebirth,this.onTap,this),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},t.prototype.onViewClose=function(){var e=this.view;EventHelper.removeTapEvent(e.btn_close,this.onTap,this),EventHelper.removeTapEvent(e.btn_rebirth,this.onTap,this),this.sendMsg(create(WxSdkMsg.HideBannerAd))},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.btn_close:this.sendMsg(create(BattleMsg.cmd.CloseRebirthWindow)),this.onClose&&this.onClose();break;case t.btn_rebirth:this.sendMsg(create(BattleMsg.cmd.Rebirth))}},Object.defineProperty(t.prototype,"viewClass",{get:function(){return RebirthConfirmWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenRebirthWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseRebirthWindow},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(RebirthConfirmMediator.prototype,"RebirthConfirmMediator");var RebirthConfirmWindow=function(e){function t(){var t=e.call(this,"RebirthConfirmWindowSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.onInit=function(){},t.prototype.onDestroy=function(){},t}(App.BaseWindow);__reflect(RebirthConfirmWindow.prototype,"RebirthConfirmWindow");var BattleRecordMediator=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isActive=!1,t}return __extends(t,e),t.prototype.activate=function(e){this._isActive=!0,this.panel=e,this.regMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.regMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.regMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.updateByData()},t.prototype.deactivate=function(){this.unregMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.unregMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.unregMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.panel=null,this._isActive=!1},t.prototype.updateByData=function(){var e=this.panel,t=this.getModel(BattleModel),n=this.getModel(PlayerModel);e.updateSkin(n.skinId),this._currScore=e.currScore=t.currScore,e.currExp=t.exp,e.highScore=n.highScore,this.panel.scoreMultiple=t.scoreMultiple},t.prototype.onNewGame=function(e){this.updateByData()},t.prototype.onCardMerged=function(e){var t=e.body.scoreList;app.log("scoreList:",t);for(var n=[],r=e.body.distCards,i=450,o=0,s=r.length;s>o;o++)r[o].type==Enum_CardType.BOMB&&(i=150),n.push(i);this.addSubScore(t,0,n)},t.prototype.onCardGroupReset=function(e){this.panel.scoreMultiple=this.getModel(BattleModel).scoreMultiple},t.prototype.addSubScore=function(e,t,n){if(this._isActive){var r=this.getModel(BattleModel),i=this.getModel(PlayerModel),o=e[t],s=this._currScore+=o;this.panel.currScore=s,s>=i.highScore&&(this.panel.highScore=s),this.panel.currExp=Math.min(Math.max(r.baseExp+s),LvConfigHelper.getExpByLv(LvConfigHelper.maxLv)-1),++t>=e.length||egret.setTimeout(this.addSubScore,this,n[t],e,t,n)}},t}(VoyaMVC.Mediator);__reflect(BattleRecordMediator.prototype,"BattleRecordMediator");var BattleRecordPanel=function(e){function t(){var t=e.call(this)||this;return t._skinId=1,t.skinName="BattleRecordPanelSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"currExp",{set:function(e){this._exp=e;var t=LvConfigHelper.getLvByExp(e),n=LvConfigHelper.getExpByLv(t),r=LvConfigHelper.getExpByLv(t+1);this.lvBlock_curr.lv=t,this.lvBlock_next.lv=t+1,this.expPgBar.setProgress(e-n,r-n),this.expPgBar.displayColor=SkinConfigHelper.getLvColor(this._skinId,t)},enumerable:!0,configurable:!0}),t.prototype.updateSkin=function(e){var t=LvConfigHelper.getLvByExp(this._exp);this.expPgBar.displayColor=SkinConfigHelper.getLvColor(e,t),this.lvBlock_curr.skinId=e,this.lvBlock_next.skinId=e,this.rect_bg_scoreMultiple.fillColor=SkinConfigHelper.getScoreMultipleBgColor(e)},Object.defineProperty(t.prototype,"highScore",{set:function(e){this.lb_highScore.text=Utils.NumberToUnitStringUtil.convert(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currScore",{set:function(e){this.lb_currScore.text=Utils.NumberToUnitStringUtil.convert(e)
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreMultiple",{set:function(e){this.lb_scoreMultiple.text="X"+e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(BattleRecordPanel.prototype,"BattleRecordPanel",["eui.UIComponent","egret.DisplayObject"]),window.BattleRecordPanel=BattleRecordPanel;var ExpPgBar=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setProgress=function(e,t){var n=e/t;this.rect_value.width=this.width*n},Object.defineProperty(t.prototype,"displayColor",{set:function(e){this.rect_value.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgColor",{set:function(e){this.rect_bg.fillColor=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ExpPgBar.prototype,"ExpPgBar",["eui.UIComponent","egret.DisplayObject"]),window.ExpPgBar=ExpPgBar;var LvBlock=function(e){function t(){var t=e.call(this)||this;return t._lv=1,t._skinId=1,t._isReady=!1,t.touchChildren=t.touchEnabled=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._isReady=!0,this.updateShow()},t.prototype.updateShow=function(){this._isReady&&(this.rect_bg.fillColor=SkinConfigHelper.getLvColor(this._skinId,this.lv),this.lb_lv.text=this.lv.toString())},Object.defineProperty(t.prototype,"lv",{get:function(){return this._lv},set:function(e){this._lv=e,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinId",{set:function(e){this._skinId=e,this.updateShow()},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(LvBlock.prototype,"LvBlock",["eui.UIComponent","egret.DisplayObject"]),window.LvBlock=LvBlock;var DropRubbishCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.checkEnableDrop=function(e){return this.rubbishBin.rubbishCount<PublicConfigHelper.MAX_RUBBISH_COUNT},Object.defineProperty(t.prototype,"rubbishBin",{get:function(){return this.container},enumerable:!0,configurable:!0}),t}(DropCardContainerCtrl);__reflect(DropRubbishCtrl.prototype,"DropRubbishCtrl");var RubbishBin=function(e){function t(){var t=e.call(this)||this;return t._isReady=!1,t._rubbishCount=0,t._skinId=1,t._needUpdate=!1,t.skinName="RubbishBinSkin",t.touchChildren=!1,t.touchEnabled=!0,t.dg_onDropIn=new VL.Delegate,t.dropContainerCtrl=new DropRubbishCtrl(t),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._isReady=!0,this.updateShow(),this.updateSkin(),this.grp_cell.mask=this.rect_mask},t.prototype.activate=function(e){app.dragDropManager.regDropContainer(this),this.dg_onDropIn.register(this.onDropIn,this),this._skinId=e,this.updateSkin()},t.prototype.deactivate=function(){app.dragDropManager.regDropContainer(this),this.dg_onDropIn.unregister(this.onDropIn)},t.prototype.checkHover=function(e){var t=e==this;return this.img_border.visible=t,t},t.prototype.onDropIn=function(){this.img_border.visible=!1},t.prototype.getRubbishCell=function(e){return this["cell"+e]},t.prototype.updateShow=function(){var e=this;this._isReady&&(this._needUpdate||(this._needUpdate=!0,egret.callLater(function(){for(var t,n=PublicConfigHelper.MAX_RUBBISH_COUNT,r=0;n>r;r++)t=e.getRubbishCell(r),t.isEmpty=r>=e.rubbishCount,t.enableClear=r<e.clearCellChance;e._needUpdate=!1},this)))},t.prototype.updateSkin=function(){if(this._isReady)for(var e=PublicConfigHelper.MAX_RUBBISH_COUNT,t=0;e>t;t++)this.getRubbishCell(t).skinId=this._skinId},Object.defineProperty(t.prototype,"rubbishCount",{get:function(){return this._rubbishCount},set:function(e){var t=PublicConfigHelper.MAX_RUBBISH_COUNT;e=Math.min(t,Math.max(e,0)),this._rubbishCount=e,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearCellChance",{get:function(){return this._clearCellChance},set:function(e){var t=PublicConfigHelper.MAX_RUBBISH_COUNT;e=Math.min(t,Math.max(e,0)),this._clearCellChance=e,this.updateShow()},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(RubbishBin.prototype,"RubbishBin",["eui.UIComponent","egret.DisplayObject","VL.DragDrop.IDropContainer"]),window.RubbishBin=RubbishBin;var RubbishBinCell=function(e){function t(){var t=e.call(this)||this;return t._isEmpty=!0,t._isReady=!1,t._skinId=1,t._enableClear=!1,t.needUpdate=!1,t.skinName="RubbishBinCellSkin",t.touchChildren=!1,t.touchEnabled=!0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._isReady=!0,this.updateIcon()},t.prototype.updateIcon=function(){var e=this;this._isReady&&(this.needUpdate||(this.needUpdate=!0,egret.callLater(function(){e._isEmpty?(e.img_icon.source="icon_rubbishBinDropable_png",e.rect_bg.fillColor=SkinConfigHelper.getRubbishCellBgColor(e._skinId)):(e._enableClear?e.img_icon.source="icon_clearRubbishBin_png":e.img_icon.source="icon_rubbishBin_disable_png",e.rect_bg.fillColor=SkinConfigHelper.getRubbishCellForeColor(e._skinId)),e.needUpdate=!1},this)))},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._isEmpty},set:function(e){this._isEmpty!=e&&(this._isEmpty=e,this.updateIcon())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinId",{get:function(){return this._skinId},set:function(e){this._skinId=e,this.updateIcon()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableClear",{get:function(){return this._enableClear},set:function(e){this._enableClear=e,this.updateIcon()},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(RubbishBinCell.prototype,"RubbishBinCell",["eui.UIComponent","egret.DisplayObject"]),window.RubbishBinCell=RubbishBinCell;var BattleSettleMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){var e=this.view,t=this.getModel(BattleModel),n=this.getModel(PlayerModel);e.lb_lv.text="等级 "+n.lv,e.lb_highScore.text=Utils.NumberToUnitStringUtil.convert(n.highScore),e.lb_battleScore.text=Utils.NumberToUnitStringUtil.convert(t.currScore),EventHelper.addTapEvent(e.btn_playAgain,this.onTap,this),EventHelper.addTapEvent(e.btn_backHome,this.onTap,this),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},t.prototype.onViewClose=function(){var e=this.view;EventHelper.removeTapEvent(e.btn_playAgain,this.onTap,this),EventHelper.removeTapEvent(e.btn_backHome,this.onTap,this),this.sendMsg(create(WxSdkMsg.HideBannerAd))},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.btn_playAgain:this.sendMsg(create(BattleMsg.cmd.PlayAgain)),this.sendMsg(create(BattleMsg.cmd.OpenBattleView)),this.sendMsg(create(BattleMsg.cmd.CloseBattleSettleView));break;case t.btn_backHome:this.sendMsg(create(BattleMsg.cmd.CloseBattleSettleView)),this.sendMsg(create(BattleMsg.cmd.BackToMainView))}},Object.defineProperty(t.prototype,"viewClass",{get:function(){return BattleSettleView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleSettleView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleSettleView},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(BattleSettleMediator.prototype,"BattleSettleMediator");var BattleSettleView=function(e){function t(){var t=e.call(this,"BattleSettleViewSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.onDestroy=function(){},t}(App.BaseAutoSizeView);__reflect(BattleSettleView.prototype,"BattleSettleView");var HelpModuleMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OPEN_HELP_VIEW=t,__reflect(t.prototype,"HelpModuleMsg.OPEN_HELP_VIEW");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CLOSE_HELP_VIEW=n,__reflect(n.prototype,"HelpModuleMsg.CLOSE_HELP_VIEW")}(HelpModuleMsg||(HelpModuleMsg={}));var HelpModuleMvcCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new HelpWindowMediator]},t.prototype.getControllerList=function(){return null},t}(VoyaMVC.MvcConfigBase);__reflect(HelpModuleMvcCfg.prototype,"HelpModuleMvcCfg");var HelpWindow=function(e){function t(){var t=e.call(this,"HelpWindowSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onInit=function(){},t.prototype.onDestroy=function(){},t}(App.BaseWindow);__reflect(HelpWindow.prototype,"HelpWindow");var HelpWindowMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){EventHelper.addTapEvent(this.view.btn_close,this.onTap,this)},t.prototype.onViewClose=function(){EventHelper.removeTapEvent(this.view.btn_close,this.onTap,this)},t.prototype.onTap=function(e){switch(e.currentTarget){case this.view.btn_close:this.sendMsg(create(HelpModuleMsg.CLOSE_HELP_VIEW))}},Object.defineProperty(t.prototype,"viewClass",{get:function(){return HelpWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return HelpModuleMsg.OPEN_HELP_VIEW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return HelpModuleMsg.CLOSE_HELP_VIEW},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(HelpWindowMediator.prototype,"HelpWindowMediator");var MainModuleCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new MainViewMediator]},t.prototype.getControllerList=function(){return null},t}(VoyaMVC.MvcConfigBase);__reflect(MainModuleCfg.prototype,"MainModuleCfg");var MainModuleMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenMainView=t,__reflect(t.prototype,"MainModuleMsg.OpenMainView");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseMainView=n,__reflect(n.prototype,"MainModuleMsg.CloseMainView")}(MainModuleMsg||(MainModuleMsg={}));var MainView=function(e){function t(){return e.call(this,"MainViewSkin")||this}return __extends(t,e),t.prototype.onInit=function(){e.prototype.onInit.call(this),this.sp_bg=new egret.Shape;var t=this.sp_bg;t.width=this.width,t.height=this.height;var n=this.bgMatrix=new egret.Matrix;n.rotate(90),this.addChildAt(t,0)},t.prototype.updateLayout=function(){e.prototype.updateLayout.call(this),this.drawBg()},t.prototype.drawBg=function(){var e=this.sp_bg;e.width=this.width,e.height=this.height;var t=this.sp_bg.graphics;t.clear(),t.beginGradientFill(GradientType.LINEAR,[9003971,14193663],[1,1],[0,255],this.bgMatrix),t.drawRect(0,0,e.width,e.height),t.endFill()},t.prototype.open=function(){e.prototype.open.call(this)},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.getWxOtherGameIcon=function(e){return this["wxOtherGameIcon"+e]},t.prototype.onDestroy=function(){},Object.defineProperty(t.prototype,"resources",{get:function(){return[]},enumerable:!0,configurable:!0}),t}(App.BaseAutoSizeView);__reflect(MainView.prototype,"MainView");var MainViewMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){var e=this.view;EventHelper.addTapEvent(e.btn_start,this.onBtnStart,this),EventHelper.addTapEvent(e.btn_shop,this.onTouch,this),EventHelper.addTapEvent(e.btn_rank,this.onTouch,this),EventHelper.addTapEvent(e.btn_share,this.onTouch,this),EventHelper.addTapEvent(e.getWxOtherGameIcon(0),this.onTouch,this),EventHelper.addTapEvent(e.getWxOtherGameIcon(1),this.onTouch,this),this.regMsg(WxSdkMsg.OtherGameDataChanged,this.onOtherGameDataChanged,this),this.updateOtherGameIcon(),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},t.prototype.onViewClose=function(){var e=this.view;EventHelper.removeTapEvent(e.btn_start,this.onBtnStart,this),EventHelper.removeTapEvent(e.btn_shop,this.onTouch,this),EventHelper.removeTapEvent(e.btn_rank,this.onTouch,this),EventHelper.removeTapEvent(e.btn_share,this.onTouch,this),EventHelper.removeTapEvent(e.getWxOtherGameIcon(0),this.onTouch,this),EventHelper.removeTapEvent(e.getWxOtherGameIcon(1),this.onTouch,this),this.unregMsg(WxSdkMsg.OtherGameDataChanged,this.onOtherGameDataChanged,this),this.updateOtherGameIcon(!0),this.sendMsg(create(WxSdkMsg.HideBannerAd))},t.prototype.onShop=function(){this.sendMsg(create(CardSkinModuleMsg.OpenCardSkinWindow))},t.prototype.onRank=function(){this.sendMsg(create(WxSdkMsg.SendOpenDataContextCmd).init({head:WxOpenDataContextMsg.FRIEND_RANK_LIST}))},t.prototype.onShare=function(){this.sendMsg(create(WxSdkMsg.Share))},t.prototype.onTouch=function(e){var t=this.view;switch(e.currentTarget){case t.btn_share:this.onShare();break;case t.btn_rank:this.onRank();break;case t.btn_shop:this.onShop();break;case t.getWxOtherGameIcon(0):this.onOtherGame(0);break;case t.getWxOtherGameIcon(1):this.onOtherGame(1)}},t.prototype.onOtherGameDataChanged=function(){this.updateOtherGameIcon()},t.prototype.updateOtherGameIcon=function(e){if(void 0===e&&(e=!1),"weixin"==app.globalConfig.pf)for(var t=this.getModel(WxSDKModel).otherGameMng,n=this.view,r=0,i=t.groupCount;i>r;r++)n.getWxOtherGameIcon(r).setData(e?null:t.getCurrGameData(r))},t.prototype.onOtherGame=function(e){this.sendMsg(create(WxSdkMsg.ToOtherGame).init({groupIdx:e}))},t.prototype.onBtnStart=function(e){this.sendMsg(create(MainModuleMsg.CloseMainView)),this.sendMsg(create(BattleMsg.cmd.EnterBattle))},Object.defineProperty(t.prototype,"viewClass",{get:function(){return MainView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return MainModuleMsg.OpenMainView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return MainModuleMsg.CloseMainView},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(MainViewMediator.prototype,"MainViewMediator");var WxOtherGameIcon=function(e){function t(){var t=e.call(this)||this;return t.isPlayingAnim=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.touchChildren=!1},t.prototype.setData=function(e){e?(this.img_gameIcon.source=e.image_small,this.visible=!0,this.playAnim()):(this.visible=!1,this.stopAnim())},t.prototype.playAnim=function(){if(!this.isPlayingAnim){var e=this.img_gameIcon;egret.Tween.removeTweens(e),e.rotation=0,egret.Tween.get(e,{loop:!0}).to({rotation:-15},50).to({rotation:0},50).to({rotation:15},50).to({rotation:0},50).wait(5e3),this.isPlayingAnim=!0}},t.prototype.stopAnim=function(){if(this.isPlayingAnim){var e=this.img_gameIcon;egret.Tween.removeTweens(e),e.rotation=0,this.isPlayingAnim=!1}},t}(eui.Component);__reflect(WxOtherGameIcon.prototype,"WxOtherGameIcon",["eui.UIComponent","egret.DisplayObject"]),window.WxOtherGameIcon=WxOtherGameIcon;var PlayerModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lv=1,t._highScore=0,t._skinMng=new SkinManager,t}return __extends(t,e),t.prototype.saveBattleRecord=function(e,t){var n=this.storageData;t&&t>this.highScore&&(this.highScore=t,n.highScore=t),e>this.lv&&(this.lv=e,n.lv=e),this.storageData=n,app.appHttp.submitBattleRecord(this.lv,this.highScore),this.sendMsg(create(WxSdkMsg.SetUserCloudStorage).init({KVDataList:[{key:"score_max",value:this.highScore.toString()}],success:function(){app.log("==== SetUserCloudStorage ====  success ")},fail:function(){app.log("==== SetUserCloudStorage ====  fail ")}}))},Object.defineProperty(t.prototype,"storageData",{get:function(){var e=egret.localStorage.getItem("playerData_"+this._uid);return"string"==typeof e&&(e=0==e.length?{lv:1,highScore:0}:JSON.parse(e)),e||(e=this.storageData={lv:1,highScore:0}),e},set:function(e){egret.localStorage.setItem("playerData_"+this._uid,JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lv",{get:function(){return this._lv},set:function(e){this._lv=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highScore",{get:function(){return this._highScore},set:function(e){this._highScore=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exp",{get:function(){return LvConfigHelper.getExpByLv(this.lv)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinId",{get:function(){return this._skinMng.skinId},set:function(e){this._skinMng.skinId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinMng",{get:function(){return this._skinMng},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},set:function(e){this._uid=e,this._skinMng.uid=e},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(PlayerModel.prototype,"PlayerModel");var PlayerModuleMsg;!function(e){var t;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.PlayerDataChanged=t,__reflect(t.prototype,"PlayerModuleMsg.feedBack.PlayerDataChanged")}(t=e.feedBack||(e.feedBack={}))}(PlayerModuleMsg||(PlayerModuleMsg={}));var CardSkinItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.cardValueList=[64,32,16,8,4,2],t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.touchChildren=!1,this.touchEnabled=!0;for(var t,n=this.cardValueList,r=0,i=6;i>r;r++)t=n[r],this.getCardValueLbByIdx(r).text=t.toString();this.grp_cards.mask=this.rect_mask},t.prototype.dataChanged=function(){var n=this;e.prototype.dataChanged.call(this);var r=this.data;if(r.playerLv>=r.skinCfg.unlockLv){r.isSelected?this.currentState=t.STATUS_USING:this.currentState=t.STATUS_ENABLED;for(var i=this.cardValueList,o=0,s=6;s>o;o++)this.getCardBgByIdx(o).fillColor=SkinConfigHelper.getCardColor(r.skinCfg.Id,CardConfigHelper.getNormalCardByValue(i[o]))}else this.currentState=t.STATUS_DISABLED,egret.setTimeout(function(){n.lb_status.text=r.skinCfg.unlockLv+"级解锁"},this,20)},t.prototype.getCardBgByIdx=function(e){return this["rect_cardBg"+e]},t.prototype.getCardValueLbByIdx=function(e){return this["lb_cardValue"+e]},t.STATUS_USING="using",t.STATUS_ENABLED="enabled",t.STATUS_DISABLED="disabled",t}(eui.ItemRenderer);__reflect(CardSkinItemRenderer.prototype,"CardSkinItemRenderer",["eui.UIComponent","egret.DisplayObject"]),window.CardSkinItemRenderer=CardSkinItemRenderer;var CardSkinModuleCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new CardSkinWindowMediator]},t.prototype.getControllerList=function(){return[]},t}(VoyaMVC.MvcConfigBase);__reflect(CardSkinModuleCfg.prototype,"CardSkinModuleCfg");var CardSkinModuleMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenCardSkinWindow=t,__reflect(t.prototype,"CardSkinModuleMsg.OpenCardSkinWindow");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseCardSkinWindow=n,__reflect(n.prototype,"CardSkinModuleMsg.CloseCardSkinWindow");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ChangeSkin=r,__reflect(r.prototype,"CardSkinModuleMsg.ChangeSkin")}(CardSkinModuleMsg||(CardSkinModuleMsg={}));var CardSkinWindowMediator=function(e){function t(){var t=e.call(this)||this;return t.source=[],t.skinCollection=new eui.ArrayCollection([]),t}return __extends(t,e),t.prototype.onViewOpen=function(){var e=this.view,t=this.getModel(PlayerModel).skinMng;e.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),e.dGroup_cardSkins.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTapItem,this),t.dg_SkinChanged.register(this.onSkinChanged,this);var n=this.source;n.length=0;var r,i=app.config.getConfig(SkinConfig),o=this.getModel(PlayerModel).lv,s=0,a=0;for(var u in i)r={skinCfg:i[u],playerLv:o,isSelected:t.skinId.toString()==u},r.isSelected&&(this.selectedItem=r),n.push(r),s++,o>=r.skinCfg.unlockLv&&a++,e.lb_unlockedCount.text=a+"/"+s;this.skinCollection.source=n,e.dGroup_cardSkins.dataProvider=this.skinCollection},t.prototype.onViewClose=function(){var e=this.view,t=this.getModel(PlayerModel).skinMng;e.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),e.dGroup_cardSkins.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTapItem,this),t.dg_SkinChanged.unregister(this.onSkinChanged),e.dGroup_cardSkins.dataProvider=null,this.skinCollection.source=null,this.selectedItem=null},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.btn_close:this.sendMsg(create(CardSkinModuleMsg.CloseCardSkinWindow))}},t.prototype.onTapItem=function(e){var t=e.itemRenderer.data,n=t.skinCfg.Id;if(t.playerLv>=t.skinCfg.unlockLv){var r=this.getModel(PlayerModel).skinMng;r.skinId=n,this.sendMsg(create(CardSkinModuleMsg.ChangeSkin).init({skinCfg:t.skinCfg}))}},t.prototype.onSkinChanged=function(e){this.selectedItem.isSelected=!1,this.skinCollection.replaceItemAt(this.selectedItem,this.skinCollection.getItemIndex(this.selectedItem)),this.selectedItem={isSelected:!0,skinCfg:app.config.getConfig(SkinConfig)[e.skinId],playerLv:this.getModel(PlayerModel).lv};for(var t,n=0,r=this.source.length;r>n;n++)if(this.source[n].skinCfg.Id==e.skinId){t=n;break}this.skinCollection.replaceItemAt(this.selectedItem,t)},Object.defineProperty(t.prototype,"viewClass",{get:function(){return SkinWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return CardSkinModuleMsg.OpenCardSkinWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return CardSkinModuleMsg.CloseCardSkinWindow},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(CardSkinWindowMediator.prototype,"CardSkinWindowMediator");var SkinManager=function(){function e(){this._skinId=0,this.dg_SkinChanged=new VL.Delegate}return e.prototype.getCardColor=function(e){return SkinConfigHelper.getCardColor(this.skinId,e)},e.prototype.getCardImg=function(e){return SkinConfigHelper.getCardImg(this.skinId,e)},e.prototype.getLvColor=function(e){return SkinConfigHelper.getLvColor(this.skinId,e)},Object.defineProperty(e.prototype,"skinId",{get:function(){if(!this._skinId){var e=egret.localStorage.getItem("skinId_"+this._uid);e&&0!=e.length||(e="1"),this._skinId=parseInt(e)}return this._skinId},set:function(e){e!=this._skinId&&(this._skinId=e,egret.localStorage.setItem("skinId_"+this._uid,this._skinId.toString()),this.dg_SkinChanged.boardcast({skinId:this._skinId}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{set:function(e){this._uid=e},enumerable:!0,configurable:!0}),e}();__reflect(SkinManager.prototype,"SkinManager");var SkinModel=function(e){function t(){var t=e.call(this)||this;return t._skinMng=new SkinManager,t._skinMng.skinId=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"skinId",{get:function(){return this._skinMng.skinId},set:function(e){this._skinMng.skinId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinMng",{get:function(){return this._skinMng},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(SkinModel.prototype,"SkinModel");var SkinWindow=function(e){function t(){var t=e.call(this,"SkinWindowSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.updateLayout=function(){this._centerH&&(this.x=StageUtils.getStageWidth()-this.width>>1),this._centerV&&(this.y=(StageUtils.getStageHeight()-this.height>>1)-70),this.updateMask()},t.prototype.onInit=function(){this.dGroup_cardSkins.itemRenderer=CardSkinItemRenderer},t.prototype.onDestroy=function(){},t}(App.BaseWindow);__reflect(SkinWindow.prototype,"SkinWindow");var SystemModuleMvcCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new LoadMediator,new MainSceneMediator,new TestSceneMediator,new PopupMediator]},t.prototype.getControllerList=function(){return[new LoadResController,new StartupController,new SdkModuleController]},t}(VoyaMVC.MvcConfigBase);__reflect(SystemModuleMvcCfg.prototype,"SystemModuleMvcCfg");var SkinConfig=function(){function e(){}return e.prototype.attrs=function(){return["Id","unlockLv","lvColor","cardImg","cardColor","gameBgColor","rubbishBinBgColor","rubbishBinForeColor","scoreMultipleBgColor","cardForeColor"]},e}();__reflect(SkinConfig.prototype,"SkinConfig"),window.SkinConfig=SkinConfig;var App;!function(e){var t=function(){function e(){}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadConfig()];case 1:return e=n.sent(),this.s_configs={},e.map(function(e){var n=egret.getDefinitionByName(e.name);if(n){var r=e.data,i=r.length,o={};t.s_configs[e.name]=o;for(var s=0;i>s;s++){for(var a=new n,u=a.attrs(),h=r[s],c=0,p=u.length;p>c;c++)a[u[c]]=h[c];o[a[u[0]]]=a}}else egret.log(name+"在ConfigBase文件中未定义")}),[2]}})})},e.prototype.loadConfig=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,RES.getResAsync("config_json")];case 1:return[2,e.sent()]}})})},e.prototype.getConfig=function(e){var t=egret.getQualifiedClassName(e);return this.s_configs[t]},e}();e.Config=t,__reflect(t.prototype,"App.Config")}(App||(App={}));var LoadingView=function(e){function t(){var t=e.call(this,null)||this;return t.resources=["preload"],t}return __extends(t,e),t.prototype.onInit=function(){e.prototype.onInit.call(this);var t=this.tf_progress=new egret.TextField;t.textColor=16711680,t.size=40,this.addChild(t)},t.prototype.setProgress=function(e,t){this.tf_progress.text=e+" / "+t},t.prototype.onDestroy=function(){this.removeChild(this.tf_progress),this.tf_progress=null},t}(App.BaseAutoSizeView);__reflect(LoadingView.prototype,"LoadingView");var LoadMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"viewClass",{get:function(){return LoadingView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return LoadMsg.OpenLoadingView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return LoadMsg.CloseLoadingView},enumerable:!0,configurable:!0}),t.prototype.onViewOpen=function(){this.regTaskMsg()},t.prototype.onViewClose=function(){this.unregTaskMsg()},t.prototype.onOpenViewHandler=function(t){this.taskName=t.body.taskName,this.closeAfterComplete=t.body.closeAfterComplete,e.prototype.onOpenViewHandler.call(this,t)},t.prototype.onCloseViewHandler=function(t){e.prototype.onCloseViewHandler.call(this,t),this.taskName=null},t.prototype.onTaskProgress=function(e){if(this.view&&this.view.isInited){var t=e.body;t.taskName==this.taskName&&this.view.setProgress(t.curr,t.total)}},t.prototype.onTaskCancel=function(e){var t=e.body;t.taskName==this.taskName&&this.closeAfterComplete&&this.sendMsg(create(LoadMsg.CloseLoadingView))},t.prototype.onTaskComplete=function(e){var t=e.body;t.taskName==this.taskName&&this.closeAfterComplete&&this.sendMsg(create(LoadMsg.CloseLoadingView))},t.prototype.regTaskMsg=function(){this.regMsg(LoadMsg.OnTaskProgress,this.onTaskProgress,this),this.regMsg(LoadMsg.OnTaskComplete,this.onTaskComplete,this),this.regMsg(LoadMsg.OnTaskCancel,this.onTaskCancel,this)},t.prototype.unregTaskMsg=function(){this.unregMsg(LoadMsg.OnTaskProgress,this.onTaskProgress,this),this.unregMsg(LoadMsg.OnTaskComplete,this.onTaskComplete,this),this.unregMsg(LoadMsg.OnTaskCancel,this.onTaskCancel,this)},t}(ViewMediator);__reflect(LoadMediator.prototype,"LoadMediator");var LoadMsg;!function(e){var t;!function(e){e[e.VIEW=0]="VIEW",e[e.MASK=1]="MASK",e[e.NONE=2]="NONE"}(t=e.Enum_LoadStyle||(e.Enum_LoadStyle={}));var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.LoadRes=n,__reflect(n.prototype,"LoadMsg.LoadRes");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.AddEasyLoadingTask=r,__reflect(r.prototype,"LoadMsg.AddEasyLoadingTask");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenLoadingView=i,__reflect(i.prototype,"LoadMsg.OpenLoadingView");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseLoadingView=o,__reflect(o.prototype,"LoadMsg.CloseLoadingView");var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OnTaskProgress=s,__reflect(s.prototype,"LoadMsg.OnTaskProgress");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OnTaskCancel=a,__reflect(a.prototype,"LoadMsg.OnTaskCancel");var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OnTaskComplete=u,__reflect(u.prototype,"LoadMsg.OnTaskComplete")}(LoadMsg||(LoadMsg={}));var LoadResController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(LoadMsg.LoadRes,this.loadResHandler,this)},t.prototype.deactivate=function(){this.unregMsg(LoadMsg.LoadRes,this.loadResHandler,this)},t.prototype.loadResHandler=function(e){var t=this,n=app.resManager;n.loadResTask({keys:e.body.sources,taskName:e.body.taskName,onComplete:function(e){t.sendMsg(create(LoadMsg.OnTaskComplete).init({taskName:e.taskName}))},onProgress:function(e,n,r){t.sendMsg(create(LoadMsg.OnTaskProgress).init({curr:n,total:r,taskName:e.taskName}))},onCancel:function(e){t.sendMsg(create(LoadMsg.OnTaskCancel).init({taskName:e.taskName}))}})},t}(VoyaMVC.Controller);__reflect(LoadResController.prototype,"LoadResController");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SystemMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.EnterScene=t,__reflect(t.prototype,"SystemMsg.EnterScene");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseAllViews=n,__reflect(n.prototype,"SystemMsg.CloseAllViews");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.APP_ACTIVE_CHANGED=r,__reflect(r.prototype,"SystemMsg.APP_ACTIVE_CHANGED")}(SystemMsg||(SystemMsg={}));var PopupMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(e){app.log("PopupWindowData:",e);var t=this.view;e.title&&e.title.length>0?(t.lb_title.parent||t.addChild(t.lb_title),t.lb_title.text=e.title):t.lb_title.parent&&t.removeChild(t.lb_title),t.btn_close.visible=e.showClose,EventHelper.addTapEvent(t.btn_close,this.onTap,this),this._customOnClose=e.onClose,t.lb_content.text=e.content
},t.prototype.onViewClose=function(){var e=this.view;EventHelper.removeTapEvent(e.btn_close,this.onTap,this),this._customOnClose=null},t.prototype.onTap=function(e){var t=this.view;switch(e.currentTarget){case t.btn_close:this.sendMsg(create(PopupMsg.HidePopup)),this._customOnClose&&this._customOnClose()}},Object.defineProperty(t.prototype,"viewClass",{get:function(){return PopupWindow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return PopupMsg.ShowPopup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return PopupMsg.HidePopup},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(PopupMediator.prototype,"PopupMediator");var PopupMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ShowPopup=t,__reflect(t.prototype,"PopupMsg.ShowPopup");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.HidePopup=n,__reflect(n.prototype,"PopupMsg.HidePopup")}(PopupMsg||(PopupMsg={}));var PopupWindow=function(e){function t(){var t=e.call(this,"PopupWindowSkin")||this;return t.resources=[],t}return __extends(t,e),t.prototype.onInit=function(){},t.prototype.onDestroy=function(){},t}(App.BaseWindow);__reflect(PopupWindow.prototype,"PopupWindow");var MainScene=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(App.BaseScene);__reflect(MainScene.prototype,"MainScene");var MainSceneMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createScene=function(){return new MainScene},t}(SceneMediator);__reflect(MainSceneMediator.prototype,"MainSceneMediator");var TestScene=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(App.BaseScene);__reflect(TestScene.prototype,"TestScene");var TestSceneMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createScene=function(){return new TestScene},t}(SceneMediator);__reflect(TestSceneMediator.prototype,"TestSceneMediator");var SdkModuleController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(SDKMsg.InitSdk,this.onInitSdk,this)},t.prototype.deactivate=function(){this.unregMsg(SDKMsg.InitSdk,this.onInitSdk,this)},t.prototype.onInitSdk=function(e){switch(e.body.pf){case"weixin":this.registerController(new WxSdkController),this.registerMediator(new SC_FriendsRankMediator);break;default:this.registerController(new LocalSdkController)}},t}(VoyaMVC.Controller);__reflect(SdkModuleController.prototype,"SdkModuleController");var SDKMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.InitSdk=t,__reflect(t.prototype,"SDKMsg.InitSdk");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.Login=n,__reflect(n.prototype,"SDKMsg.Login")}(SDKMsg||(SDKMsg={}));var LocalSdkController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(SDKMsg.Login,this.onLogin,this)},t.prototype.deactivate=function(){this.unregMsg(SDKMsg.Login,this.onLogin,this)},t.prototype.onLogin=function(e){},Object.defineProperty(t.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),t}(VoyaMVC.Controller);__reflect(LocalSdkController.prototype,"LocalSdkController");var WxBannerAdMng=function(){function e(e){this._isShow=!1,this._systemInfo=e,this.dg_onError=new VL.Delegate}return e.prototype.showBanner=function(e){var t=this;void 0===e&&(e=null);var n=this._systemInfo;if(!this._isShow){var r=this._bannerAd=wx.createBannerAd({adUnitId:app.globalConfig.bannerAdUnitId,style:{left:0,top:0,width:Math.min(this.maxAdWidth,e?e.width:n.windowWidth),height:0}});return r.onError(function(e){var n=wx.WxAdErrorMap[e.errCode];t.dg_onError.boardcast({err:n}),egret.log("Banner广告错误："+n.code+"\n 描述："+n.desc+" \n 原因："+n.reason+"\n 解决方案："+n.solution)}),r.onResize(function(t){r.style.left=e?e.left:n.windowWidth-t.width>>1,r.style.top=e?e.top:n.windowHeight-t.height}),r.show(),this._isShow=!0,r}},e.prototype.hideBanner=function(){if(this._isShow){this._isShow=!1;var e=this._bannerAd;e&&(e.destroy(),e=null)}},Object.defineProperty(e.prototype,"maxAdWidth",{get:function(){return 1080/this._systemInfo.pixelRatio},enumerable:!0,configurable:!0}),e}();__reflect(WxBannerAdMng.prototype,"WxBannerAdMng");var WxSdkController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.sdk.dg_onActiveChanged.register(this.onActiveChanged,this),this.regMsg(SDKMsg.Login,this.onLogin,this),this.regMsg(WxSdkMsg.SendOpenDataContextCmd,this.onSendOpenDataContextCmd,this),this.regMsg(WxSdkMsg.SetUserCloudStorage,this.onSetUserCloudStorage,this),this.regMsg(WxSdkMsg.Share,this.onShare,this),this.regMsg(WxSdkMsg.ToOtherGame,this.onToOtherGame,this),this.regMsg(WxSdkMsg.WatchVideo_CMD,this.onWatchVideo,this),this.regMsg(WxSdkMsg.ShowBannerAd,this.onShowBannerAd,this),this.regMsg(WxSdkMsg.HideBannerAd,this.onHideBannerAd,this),this.sdk.init()},t.prototype.deactivate=function(){this.sdk.dg_onActiveChanged.unregister(this.onActiveChanged),this.unregMsg(SDKMsg.Login,this.onLogin,this),this.unregMsg(WxSdkMsg.SendOpenDataContextCmd,this.onSendOpenDataContextCmd,this),this.unregMsg(WxSdkMsg.SetUserCloudStorage,this.onSetUserCloudStorage,this),this.unregMsg(WxSdkMsg.Share,this.onShare,this),this.unregMsg(WxSdkMsg.ToOtherGame,this.onToOtherGame,this),this.unregMsg(WxSdkMsg.WatchVideo_CMD,this.onWatchVideo,this),this.unregMsg(WxSdkMsg.ShowBannerAd,this.onShowBannerAd,this),this.unregMsg(WxSdkMsg.HideBannerAd,this.onHideBannerAd,this)},t.prototype.onActiveChanged=function(e){e.isActive&&this.handleShareQuery(e.showArgs.query)},t.prototype.handleShareQuery=function(e){var t=this.sdk,n=t.shareQueryData,r=t.openId,i=!1;e&&e.inviteOpenId&&e.inviteOpenId!=r&&(i=n&&n.inviteOpenId?e.inviteOpenId!=n.inviteOpenId:!0,t.shareQueryData=e),i&&app.appHttp.enterFromShare(n.inviteUserId,n.inviteOpenId,function(e,t){app.log("=== 受邀成功 ===",n)},this)},t.prototype.onLogin=function(e){var t=this;app.log("sdkLogin"),wx.login({success:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.reqLogin(e.code)];case 1:return t.sent(),[4,this.reqExamineStatus()];case 2:return t.sent(),[4,this.reqAboutShare()];case 3:return t.sent(),[4,this.reqGetOtherGamesInfo()];case 4:return t.sent(),[2]}})})}})},t.prototype.reqLogin=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return t=this.sdk,n=t.shareQueryData,[4,app.appHttp.login(n.inviteOpenId||"",n.inviteUserId||0,t.systemPf||0,n.source||"",n.source_lv||0,n.contentId||0,e,function(e,t){app.log("login resp data:",e);var n=r.sdk.pfUserInfo;n.nickname=e.nickname,n.gender=e.sex,r.sdk.openId=e.openid;var i=r.playerModel;i.uid=e.id;var o=i.storageData,s=parseFloat(e.score_max),a=parseInt(e.lv);o.highScore=Math.max(o.highScore,s),o.lv=Math.max(o.lv,a),(o.lv>a||o.highScore>s)&&app.appHttp.submitBattleRecord(o.lv,o.highScore),i.storageData=o,i.highScore=o.highScore,i.lv=o.lv,r.handleShareQuery(wx.getLaunchOptionsSync().query)})];case 1:return i.sent(),[2]}})})},t.prototype.reqAboutShare=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,app.appHttp.getAboutShare(function(t,n){var r=e.sdk;r.shareInfoList=[];for(var i=t.content_list,o=t.id_list,s=t.image_list,a=0,u=o.length;u>a;a++)r.shareInfoList.push({content:i[a],contentId:o[a],imgUrl:s[a]})})];case 1:return t.sent(),[2]}})})},t.prototype.reqGetOtherGamesInfo=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,app.appHttp.getOtherGamesInfo(function(t,n){e.sdk.otherGameMng.setInfo([t.image_list,t.image_list_2])})];case 1:return t.sent(),[2]}})})},t.prototype.reqExamineStatus=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,app.appHttp.getGameExamineStatus(function(t,n){e.sdk.isExamine=2==t.status})];case 1:return t.sent(),[2]}})})},t.prototype.onSendOpenDataContextCmd=function(e){var t=e.body.head,n=e.body.body;switch(t){case WxOpenDataContextMsg.FRIEND_RANK_LIST:this.sendMsg(create(WxSdkMsg.OpenFriendRankListView))}var r=new WxOpenDataContextMsg(t,n);wx.getOpenDataContext().postMessage(r)},t.prototype.onSetUserCloudStorage=function(e){wx.setUserCloudStorage(e.body)},t.prototype.onShare=function(e){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getUserInfo()];case 1:return e=r.sent(),t=this.sdk.getRandomShareInfo(),app.log("shareInfo:",t),n={source:e.source,source_lv:e.source_lv,inviteOpenId:e.openid,inviteUserId:e.user_id,contentId:t.contentId},wx.shareAppMessage({title:t.content,imageUrl:t.imgUrl,query:Utils.StringUtils.ObjectToQueryFormatString(n)}),app.appHttp.shareStatistics(t.contentId,null,null),[2]}})})},t.prototype.onToOtherGame=function(e){var t=e.body.groupIdx,n=this.sdk.otherGameMng;n.toOtherGame(t)},t.prototype.onWatchVideo=function(e){var t=this,n=this.sdk.videoMng,r=e.body.flag,i=e.body.showAlertWhenGiveUp,o=function(e){t.sendMsg(create(WxSdkMsg.WatchVideo_FeedBack).init({result:0==e.err.code?Enum_WxWatchVideoResult.NO_AD_COUNT:Enum_WxWatchVideoResult.ERROR,flag:r,error:e.err})),n.dg_onError.unregister(o)};n.dg_onError.register(o,this),n.show(function(e,s){n.dg_onError.unregister(o),t.sendMsg(create(WxSdkMsg.WatchVideo_FeedBack).init({result:e?Enum_WxWatchVideoResult.COMPLETE:Enum_WxWatchVideoResult.GIVE_UP,flag:r})),!e&&i&&t.sendMsg(create(PopupMsg.ShowPopup).init({content:"要将视频看完才能获得相应奖励哦~！",showClose:!0}))},this),app.appHttp.sendWatchTVStep(r,1,null,null)},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,app.appHttp.getUseinfo(function(n,r){t.sdk.openId=n.openid,e={user_id:n.user_id,openid:n.openid,source:n.source,source_lv:n.source_lv}})];case 1:return n.sent(),[2,e]}})})},t.prototype.onShowBannerAd=function(e){this.sdk.wxBannerAdMng.showBanner(e.body?e.body.style:null)},t.prototype.onHideBannerAd=function(e){this.sdk.wxBannerAdMng.hideBanner()},Object.defineProperty(t.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdk",{get:function(){return this.getModel(WxSDKModel)},enumerable:!0,configurable:!0}),t}(VoyaMVC.Controller);__reflect(WxSdkController.prototype,"WxSdkController");var WxSDKModel=function(e){function t(){var t=e.call(this)||this;return t.dg_onActiveChanged=new VL.Delegate,t.isExamine=!1,t.pfUserInfo=new WxUserInfo,t._otherGameMng=new WxOtherGameManager,t._otherGameMng.dg_dataChanged.register(t.onOtherGameDataChanged,t),t._videoMng=new WxVideoMng,t._wxBannerAdMng=new WxBannerAdMng(t.systemInfo),t}return __extends(t,e),t.prototype.init=function(){this.initLaunchOptions(),this.initActiveChange(),this.initAppUpdateMng(),this.initShare(),this._videoMng.init()},t.prototype.initLaunchOptions=function(){var e=wx.getLaunchOptionsSync();this.shareQueryData=e.query},t.prototype.initShare=function(){var e=this;wx.showShareMenu({withShareTicket:!0}),wx.onShareAppMessage(function(t){console.log("onShareAppMessage:",t);var n=e.getRandomShareInfo();return{title:n.content,imageUrl:n.imgUrl,query:"shareContentId="+n.contentId}})},t.prototype.initActiveChange=function(){var e=this;wx.onShow(function(t){e.dg_onActiveChanged.boardcast({isActive:!0,showArgs:t})}),wx.onHide(function(){app.log("app进入后台~~~~~~~~~~~~~~~~~~~~~~~~"),e.dg_onActiveChanged.boardcast({isActive:!1})})},t.prototype.initAppUpdateMng=function(){var e=wx.getUpdateManager();e.onCheckForUpdate(function(e){console.log("请求完新版本信息的回调",e.hasUpdate)}),e.onUpdateReady(function(){wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(t){t.confirm&&e.applyUpdate()}})}),e.onUpdateFailed(function(){console.log("新的版本下载失败")})},t.prototype.onShareAppMessage=function(e){app.log("onShareAppMessage:",e);var t=this.getRandomShareInfo();return{title:t.content,imageUrl:t.imgUrl,query:"shareContentId="+t.contentId}},t.prototype.getRandomShareInfo=function(){return Utils.ArrayUtils.randomElement(this.shareInfoList)},t.prototype.onOtherGameDataChanged=function(){this.sendMsg(create(WxSdkMsg.OtherGameDataChanged))},Object.defineProperty(t.prototype,"systemPf",{get:function(){if(!this._systemPf){var e=this.systemInfo.system.toLowerCase();e.indexOf("android")>0?this._systemPf=Enum_System.ANDROID:e.indexOf("ios")>0&&(this._systemPf=Enum_System.IOS)}return this._systemPf},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"systemInfo",{get:function(){return this._systemInfo||(this._systemInfo=wx.getSystemInfoSync()),this._systemInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherGameMng",{get:function(){return this._otherGameMng},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoMng",{get:function(){return this._videoMng},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wxBannerAdMng",{get:function(){return this._wxBannerAdMng},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(WxSDKModel.prototype,"WxSDKModel");var WxSdkMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.SendOpenDataContextCmd=t,__reflect(t.prototype,"WxSdkMsg.SendOpenDataContextCmd");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.Share=n,__reflect(n.prototype,"WxSdkMsg.Share");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OtherGameDataChanged=r,__reflect(r.prototype,"WxSdkMsg.OtherGameDataChanged");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ToOtherGame=i,__reflect(i.prototype,"WxSdkMsg.ToOtherGame");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.SetUserCloudStorage=o,__reflect(o.prototype,"WxSdkMsg.SetUserCloudStorage");var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.WatchVideo_CMD=s,__reflect(s.prototype,"WxSdkMsg.WatchVideo_CMD");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.WatchVideo_FeedBack=a,__reflect(a.prototype,"WxSdkMsg.WatchVideo_FeedBack");var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.ShowBannerAd=u,__reflect(u.prototype,"WxSdkMsg.ShowBannerAd");var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.HideBannerAd=h,__reflect(h.prototype,"WxSdkMsg.HideBannerAd");var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenFriendRankListView=c,__reflect(c.prototype,"WxSdkMsg.OpenFriendRankListView");var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseFriendRankListView=p,__reflect(p.prototype,"WxSdkMsg.CloseFriendRankListView")}(WxSdkMsg||(WxSdkMsg={}));var WxVideoMng=function(){function e(){this._isPlaying=!1,this._isError=!1,this.loadVideoFailCount=0,this._video=wx.createRewardedVideoAd({adUnitId:app.globalConfig.videoAdUnitId}),this.dg_onError=new VL.Delegate}return e.prototype.init=function(){var e=this,t=this._video;t.onError(function(t){e._isPlaying=!1,e._isError=!0;var n=wx.WxAdErrorMap[t.errCode];e.dg_onError.boardcast({err:n}),egret.log("激励视频错误："+n.code+"\n 描述："+n.desc+" \n 原因："+n.reason+"\n 解决方案："+n.solution)}),t.onLoad(function(){app.log("videoAD loaded...")})},e.prototype.show=function(e,t,n){return void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,i,o,s,a=this;return __generator(this,function(u){switch(u.label){case 0:return app.log("show isPlaying:"+this._isPlaying),this._isPlaying?[2]:(r=this._video,this.loadVideoFailCount=0,this._isError=!1,app.log("before showVideo isPlaying:"+this._isPlaying),o=this,[4,this.showVideo()]);case 1:return i=o._isPlaying=u.sent(),app.log("after showVideo isPlaying:"+this._isPlaying),i?(s=function(i){var o=!1;(i&&i.isEnded||void 0===i)&&(o=!0),r.offClose(s),a._isPlaying=!1,a._isError=!1,e.call(t,o,n)},r.onClose(s),[2]):[2]}})})},e.prototype.showVideo=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n=this;return __generator(this,function(r){switch(r.label){case 0:return e=this._video,t=!0,[4,e.show()["catch"](function(r){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return t=!1,!this._isError||this.loadVideoFailCount++<3?[4,e.load()]:[3,3];case 1:return n.sent(),[4,this.showVideo()];case 2:t=n.sent(),n.label=3;case 3:return[2]}})})})];case 1:return r.sent(),[2,t]}})})},e}();__reflect(WxVideoMng.prototype,"WxVideoMng");var Enum_WxWatchVideoResult;!function(e){e[e.COMPLETE=1]="COMPLETE",e[e.GIVE_UP=2]="GIVE_UP",e[e.NO_AD_COUNT=3]="NO_AD_COUNT",e[e.ERROR=4]="ERROR"}(Enum_WxWatchVideoResult||(Enum_WxWatchVideoResult={}));var WxOpenDataContextMsg=function(){function e(e,t){this.head=e,this.body=t}return e.INIT_DATA="WxOpenDataContextMsg_INIT_DATA",e.CLOSE_CONTEXT="WxOpenDataContextMsg_CLOSE",e.FRIEND_RANK_LIST="WxOpenDataContextMsg_FriendRankList",e.FRIEND_NEAREST_RANK_LIST="WxOpenDataContextMsg_FRIEND_NEAREST_RANK_LIST",e.GROUP_RANK_LIST="WxOpenDataContextMsg_GROUP_RANK_LIST",e.UPDATE_PLAYER_DATA="WxOpenDataContextMsg_UPDATE_PLAYER_DATA",e}();__reflect(WxOpenDataContextMsg.prototype,"WxOpenDataContextMsg");var Enum_WxShareCanvasOpenType;!function(e){e[e.FRIEND_RANK_LIST=1]="FRIEND_RANK_LIST",e[e.GROUP_RANK_LIST=2]="GROUP_RANK_LIST"}(Enum_WxShareCanvasOpenType||(Enum_WxShareCanvasOpenType={}));var App;!function(e){var t=function(){function e(e){this.sourceJson=e}return Object.defineProperty(e.prototype,"sourceJson",{set:function(e){this._json=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"client_version",{get:function(){return this._json.client_version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDebug",{get:function(){return this._json.isDebug},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCDN",{get:function(){return this._json.isCDN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resRoot",{get:function(){return this.isCDN?this._json.CDN_RESOURCE:this._json.LOCAL_RESOURCE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pf",{get:function(){return this._json.pf},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpServer",{get:function(){return this._json.HttpServer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverPort",{get:function(){return this._json.serverPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoAdUnitId",{get:function(){return this._json.videoAdUnitId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bannerAdUnitId",{get:function(){return this._json.bannerAdUnitId},enumerable:!0,configurable:!0}),e}();e.GlobalCfg=t,__reflect(t.prototype,"App.GlobalCfg")}(App||(App={}));var SC_FriendsRankView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resources=[],t}return __extends(t,e),t.prototype.onDestroy=function(){},t}(ShareCanvasView);__reflect(SC_FriendsRankView.prototype,"SC_FriendsRankView");var SC_FriendsRankMediator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onViewOpen=function(){e.prototype.onViewOpen.call(this)},t.prototype.onViewClose=function(){e.prototype.onViewClose.call(this)},Object.defineProperty(t.prototype,"viewClass",{get:function(){return SC_FriendsRankView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return WxSdkMsg.OpenFriendRankListView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return WxSdkMsg.CloseFriendRankListView},enumerable:!0,configurable:!0}),t.prototype.onBack=function(){this.sendMsg(create(WxSdkMsg.CloseFriendRankListView))},t}(ShareCanvasMediator);__reflect(SC_FriendsRankMediator.prototype,"SC_FriendsRankMediator");var WxOtherGameManager=function(){function e(){this.dg_dataChanged=new VL.Delegate,this._currGroupDataIdx=[]}return e.prototype.setInfo=function(e){this._otherGameDataGroups=e;for(var t=0,n=e.length;n>t;t++)this._currGroupDataIdx.push(0);this.dg_dataChanged.boardcast()},e.prototype.getCurrGameData=function(e){var t=this._otherGameDataGroups[e],n=this._currGroupDataIdx[e];return t[n]},Object.defineProperty(e.prototype,"groupCount",{get:function(){return this._otherGameDataGroups?this._otherGameDataGroups.length:0},enumerable:!0,configurable:!0}),e.prototype.toOtherGame=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n,r){var i=t.getCurrGameData(e);wx.navigateToMiniProgram({appId:i.game_appid,success:function(){app.log("跳转至其他游戏成功 appid："+i.game_appid)},complete:function(){++t._currGroupDataIdx[e]>=t._otherGameDataGroups[e].length&&(t._currGroupDataIdx[e]=0),t.dg_dataChanged.boardcast(),n()},fail:function(){app.log("跳转至其他游戏失败…… appid："+i.game_appid)}})})]})})},e}();__reflect(WxOtherGameManager.prototype,"WxOtherGameManager");var WxUserInfo=function(){function e(){}return e}();__reflect(WxUserInfo.prototype,"WxUserInfo");var StartupController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(StartupMsg.Startup,this.onStartup,this)},t.prototype.deactivate=function(){this.unregMsg(StartupMsg.Startup,this.onStartup,this)},t.prototype.onStartup=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.sendMsg(create(SystemMsg.EnterScene).init({scene:MainScene})),[4,this.loadCfg()];case 1:return e.sent(),this.regMsg(LoadMsg.OnTaskComplete,this.onLoadResComplete,this),this.sendMsg(create(LoadMsg.OpenLoadingView).init({taskName:"preload",closeAfterComplete:!1})),this.sendMsg(create(LoadMsg.LoadRes).init({sources:["preload"],taskName:"preload"})),[2]}})})},t.prototype.loadCfg=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=app.globalConfig.resRoot,[4,RES.loadConfig(e+"default.res.json",e)];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,app.config.init()];case 3:return n.sent(),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",StageUtils.getStage());r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})]})})},t.prototype.onLoadResComplete=function(e){"preload"==e.body.taskName&&(this.unregMsg(LoadMsg.OnTaskComplete,this.onLoadResComplete,this),this.sendMsg(create(LoadMsg.CloseLoadingView)),this.sendMsg(create(SDKMsg.InitSdk).init({pf:app.globalConfig.pf})),this.sendMsg(create(SDKMsg.Login)),this.sendMsg(create(MainModuleMsg.OpenMainView)))},t}(VoyaMVC.Controller);__reflect(StartupController.prototype,"StartupController");var StartupMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.Startup=t,__reflect(t.prototype,"StartupMsg.Startup")}(StartupMsg||(StartupMsg={}));var TestEvent=function(){function e(){this.testDg=new VL.Delegate,this.testDg1=new VL.Delegate,this.testDg2=new VL.Delegate,this.testDg3=new VL.Delegate}return e}();__reflect(TestEvent.prototype,"TestEvent",["VoyaMVC.IEvent"]);var TestController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activate=function(){this.regMsg(TestModuleMsg.RunTest,this.runTestHandler,this)},t.prototype.deactivate=function(){this.unregMsg(TestModuleMsg.RunTest,this.runTestHandler,this)},t.prototype.runTestHandler=function(){var e=this.getModel(TestModel).dataContent;this.sendMsg(create(TestModuleMsg.SetTfContent).init(e)),this.sendMsg(create(TestModuleMsg.SetTfVisible).init({visible:!0}))},t}(VoyaMVC.Controller);__reflect(TestController.prototype,"TestController");var TestMediator=function(e){function t(){var t=e.call(this)||this;return t.viewClass=TestView,t.tf=new egret.TextField,t}return __extends(t,e),t.prototype.onViewOpen=function(){this.regMsg(TestModuleMsg.SetTfVisible,this.tfVisibleHandler,this),this.regMsg(TestModuleMsg.SetTfContent,this.setTfContentHandler,this)},t.prototype.onViewClose=function(){this.unregMsg(TestModuleMsg.SetTfVisible,this.tfVisibleHandler,this),this.unregMsg(TestModuleMsg.SetTfContent,this.setTfContentHandler,this)},t.prototype.tfVisibleHandler=function(e){var t=e.body.visible,n=this.tf;t?StageUtils.getStage().addChild(n):n.parent&&n.parent.removeChild(n)},t.prototype.setTfContentHandler=function(e){var t=e.body;this.tf.text=t.num+"  "+t.str},Object.defineProperty(t.prototype,"openViewMsg",{get:function(){return TestModuleMsg.OpenTestView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closeViewMsg",{get:function(){return TestModuleMsg.CloseTestView},enumerable:!0,configurable:!0}),t}(ViewMediator);__reflect(TestMediator.prototype,"TestMediator");var TestModel=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"dataContent",{get:function(){return{num:1,str:"hello world~"}},enumerable:!0,configurable:!0}),t}(VoyaMVC.Model);__reflect(TestModel.prototype,"TestModel");var TestModuleCfg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMediatorList=function(){return[new TestMediator]},t.prototype.getControllerList=function(){return[new TestController]},t}(VoyaMVC.MvcConfigBase);__reflect(TestModuleCfg.prototype,"TestModuleCfg");var TestModuleMsg;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.RunTest=t,__reflect(t.prototype,"TestModuleMsg.RunTest");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.SetTfVisible=n,__reflect(n.prototype,"TestModuleMsg.SetTfVisible");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.SetTfContent=r,__reflect(r.prototype,"TestModuleMsg.SetTfContent");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.OpenTestView=i,__reflect(i.prototype,"TestModuleMsg.OpenTestView");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(VoyaMVC.Msg);e.CloseTestView=o,__reflect(o.prototype,"TestModuleMsg.CloseTestView")}(TestModuleMsg||(TestModuleMsg={}));var TestView=function(e){function t(){var t=e.call(this,null)||this;t.resources=[];var n=new egret.Shape,r=n.graphics;return r.beginFill(0),r.drawRect(0,0,1334,750),r.endFill(),t.addChild(n),t}return __extends(t,e),t.prototype.onInit=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.bg=new egret.Bitmap,e=this.bg,[4,app.resManager.getResAsync_promise("bg_jpg")];case 1:return e.texture=t.sent(),this.addChild(this.bg),[2]}})})},t.prototype.onDestroy=function(){this.bg=null},t}(App.BaseAutoSizeView);__reflect(TestView.prototype,"TestView");var VL;!function(e){var t=function(){function e(){this.reset()}return e.prototype.reset=function(){this._matrix||(this._matrix=[]);for(var e=this._matrix,t=0,n=e.length;n>t;t++)e[t]=0;e[0]=e[6]=e[12]=e[18]=1},e.prototype.getMatrix=function(){return this._isChanged&&(this.reset(),this.setRGB(),this.setSaturation(),this.setContrastRatio(),this.setBrightness(),this.setAlpha(),this._isChanged=!1),this._matrix.concat()},e.prototype.setRGB=function(){var e=this.r,t=this.g,n=this.b,r=Math.max(e,t,n),i=Math.min(e,t,n),o=r+i>>1,s=this._matrix;s[0]+=(e-o)/o,s[6]+=(t-o)/o,s[12]+=(n-o)/o},e.prototype.setSaturation=function(){var e=this._matrix,t=this.saturation;e[0]=.3086*(e[0]-t)+t,e[1]=.6094*(e[1]-t),e[2]=.082*(e[2]-t),e[5]=.3086*(e[5]-t),e[6]=.6094*(e[6]-t)+t,e[7]=.082*(e[7]-t),e[10]=.3086*(e[10]-t),e[11]=.6094*(e[11]-t),e[12]=.082*(e[12]-t)+t},e.prototype.setBrightness=function(){var e=this.brightness,t=this._matrix;t[4]+=e,t[9]+=e,t[14]+=e},e.prototype.setAlpha=function(){this._matrix[18]=this.a},e.prototype.setContrastRatio=function(){var e=this.contrastRatio,t=this._matrix;t[0]*=e,t[4]+=128*(t[4]-e),t[6]*=e,t[9]+=128*(t[9]-e),t[12]*=e,t[14]+=128*(t[14]-e)},Object.defineProperty(e.prototype,"r",{get:function(){return this._r},set:function(e){this._r!=e&&(this._r=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._g},set:function(e){this._g!=e&&(this._g=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._b},set:function(e){this._b!=e&&(this._b=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._a},set:function(e){this._a!=e&&(this._a=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"saturation",{get:function(){return this._saturation},set:function(e){this._saturation!=e&&(this._saturation=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"brightness",{get:function(){return this._brightness},set:function(e){this._brightness!=e&&(this._brightness=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contrastRatio",{get:function(){return this._contrastRatio},set:function(e){this._contrastRatio!=e&&(this._contrastRatio=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrix},set:function(e){this._matrix!=e&&(this._matrix=e,this._isChanged=!0)},enumerable:!0,configurable:!0}),e}();e.ColorMatrix=t,__reflect(t.prototype,"VL.ColorMatrix")}(VL||(VL={}));var CardConfigHelper=function(){function e(){}return e.getNormalCardByValue=function(e){var t,n=app.config.getConfig(CardConfig);for(var r in n)if(t=n[r],t.type==Enum_CardType.NORMAL&&t.value==e)return t;return null},Object.defineProperty(e,"maxValueCard",{get:function(){if(!this._maxValueCard)for(var e=this.getCardsByType(Enum_CardType.NORMAL),t=0,n=void 0,r=0,i=e.length;i>r;r++)n=e[r],n.value>t&&(t=n.value,this._maxValueCard=n);return this._maxValueCard},enumerable:!0,configurable:!0}),e.getCardsByType=function(e){var t=this._cardsByType[e];if(t)return t;var n,r=app.config.getConfig(CardConfig);t=[];for(var i in r)if(n=r[i],n.type==e&&(t.push(n),e!=Enum_CardType.NORMAL))break;
return Object.freeze(t),this._cardsByType[e]=t,t},e._cardsByType={},e}();__reflect(CardConfigHelper.prototype,"CardConfigHelper");var VL;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cmdList=[],t._currIdx=-1,t}return __extends(t,e),t.prototype.init=function(e){void 0===e&&(e=[]);var t,n;for(n=e.length,t=0;n>t;t++)this.add(e[t]);return this},t.prototype.add=function(e){return this._cmdList.indexOf(e)<0&&this._cmdList.push(e),this},t.prototype.remove=function(e){var t=this._cmdList.indexOf(e);return t>0&&this._cmdList.splice(t,1),this},t.prototype.execute=function(){this.executeNext()},t.prototype.executeNext=function(){if(null==this._cmdList[this._currIdx+1])return void this.closeAsync();this._currIdx++;var e=this._cmdList[this._currIdx];this._currCmd=e,e.dg_commandCompleted.register(this.onSingleCmdCompleted,this),e.autoRestore&&(e.autoRestore=!1),e.openAsync()},t.prototype.onSingleCmdCompleted=function(e){this._currCmd.dg_commandCompleted.unregister(this.onSingleCmdCompleted),e.isAbort?this.closeAsync(e.isRecursion):this._currIdx==this._cmdList.length-1?this.closeAsync():this.executeNext()},t.prototype.closeAsync=function(e){void 0===e&&(e=!1),this.isOpened&&(this._currCmd&&this._currCmd.dg_commandCompleted.unregister(this.onSingleCmdCompleted),this._currCmd=null,this._currIdx=-1,this.clear(),this._isOpened=!1,this.dg_commandCompleted.boardcast({isAbort:e,isRecursion:e}),this.autoRestore&&this.restore())},t.prototype.clear=function(){var e,t;for(t=this._cmdList.length,e=0;t>e;e++)this._cmdList[e].restore();this._cmdList.length=0},t}(e.Command);e.CommandGroup=t,__reflect(t.prototype,"VL.Command.CommandGroup")}(t=e.Command||(e.Command={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),this._fun=e,this._argsArr=n,this._thisArg=t,this},t.prototype.execute=function(){null!=this._fun&&this._fun.apply(this._thisArg,this._argsArr),this.closeAsync()},t.prototype.clear=function(){this._fun=null,this._thisArg=null,this._argsArr=null},t}(e.Command);__reflect(t.prototype,"DelegateCommand")}(t=e.Command||(e.Command={}))}(VL||(VL={}));var VL;!function(e){var t=function(){function e(){this._funList=[],this._thisArgList=[]}return Object.defineProperty(e.prototype,"count",{get:function(){return this._funList.length},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return-1!=this._funList.indexOf(e)},e.prototype.register=function(e,t){!this.has(e)&&e&&(this._funList.push(e),this._thisArgList.push(t))},e.prototype.unregister=function(e){if(this.has(e)){var t=this._funList.indexOf(e);this._funList.splice(t,1),this._thisArgList.splice(t,1)}},e.prototype.clear=function(){this._funList.length=0,this._thisArgList.length=0},e.prototype.boardcast=function(e){for(var t=0;t<this._funList.length;t++){var n=this._funList[t],r=this._thisArgList[t];r?n.call(r,e):n(e)}},e}();e.Delegate=t,__reflect(t.prototype,"VL.Delegate")}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){this._containerList=[]}return e.prototype.regDragItem=function(e){e.dragItemCtrl.dg_DragBegin.register(this.onDragBegin,this),e.dragItemCtrl.dg_DragEnd.register(this.onDragEnd,this),e.dragItemCtrl.enableDrag=!0},e.prototype.unregDragItem=function(e){e.dragItemCtrl.dg_DragBegin.unregister(this.onDragBegin),e.dragItemCtrl.dg_DragEnd.unregister(this.onDragEnd),e.dragItemCtrl.enableDrag=!1},e.prototype.regDropContainer=function(e){this._containerList.indexOf(e)<0&&(this._containerList.push(e),e.dropContainerCtrl.dg_onDragIn.register(this.onDragIn,this),e.dropContainerCtrl.dg_onDragOut.register(this.onDragOut,this),e.dropContainerCtrl.enableDrop=!0,this._currDragItem&&e.dropContainerCtrl.onDragBegin(this._currDragItem))},e.prototype.unregDropContainer=function(e){var t=this._containerList.indexOf(e);t>=0&&(this._containerList.splice(t,1),e.dropContainerCtrl.dg_onDragIn.unregister(this.onDragIn),e.dropContainerCtrl.dg_onDragOut.unregister(this.onDragOut),e.dropContainerCtrl.enableDrop=!1,e.dropContainerCtrl.onDragEnd(this._currDragItem))},e.prototype.onDragBegin=function(e){this._currDragItem=e;for(var t=0,n=this._containerList.length;n>t;t++)this._containerList[t].dropContainerCtrl.onDragBegin(e)},e.prototype.onDragEnd=function(e){for(var t=0;t<this._containerList.length;t++)this._containerList[t].dropContainerCtrl.onDragEnd(e);e.dragItemCtrl.onDropTo(this._currContainer),this._currDragItem=null,this._currContainer=null},e.prototype.onDragIn=function(e){this._currContainer=e},e.prototype.onDragOut=function(e){this._currContainer==e&&(this._currContainer=null)},e}();e.DragDropManager=t,__reflect(t.prototype,"VL.DragDrop.DragDropManager")}(t=e.DragDrop||(e.DragDrop={}))}(VL||(VL={}));var LvConfigHelper=function(){function e(){}return Object.defineProperty(e,"arrLvExp",{get:function(){if(!this._arrLvExp){var e=[],t=app.config.getConfig(LvConfig);for(var n in t)e.push(t[n].needExp);Utils.ArrayUtils.quickSort(e,function(e,t){return e-t}),this._arrLvExp=e}return this._arrLvExp},enumerable:!0,configurable:!0}),e.getLvByExp=function(e){for(var t,n,r,i=0,o=this.arrLvExp.length;o>i;i++){if(n=this.arrLvExp[i],r=this.arrLvExp[i+1],!r&&0!=r){t=i+1;break}if(e>=n&&r>e){t=i+1;break}}return t},e.getExpByLv=function(e){return this.arrLvExp[e-1]},Object.defineProperty(e,"maxLv",{get:function(){return this.arrLvExp.length},enumerable:!0,configurable:!0}),e}();__reflect(LvConfigHelper.prototype,"LvConfigHelper");var PublicConfigHelper=function(){function e(){}return e.CARD_GROUP_COUNT=4,e.MAX_RUBBISH_COUNT=2,e.MAX_HAND_CARD_COUNT=2,e.MAX_GROUP_CARDS_COUNT=8,e.INITIAL_REFRESH_HAND_CARD_CHANCE=1,e}();__reflect(PublicConfigHelper.prototype,"PublicConfigHelper");var VL;!function(e){var t;!function(t){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.init=function(e,t){return this._degree=e,this._r=t,this},n.prototype.clear=function(){this._degree=0,this._r=0},n.prototype.fromPoint=function(e){return this._r=Math.sqrt(e.x*e.x+e.y*e.y),this._degree=t.radian2Degree(Math.atan2(e.y,e.x)),this},n.prototype.toPoint=function(e){void 0===e&&(e=null);var n=this.r*Math.cos(t.degree2Radian(this._degree)),r=this.r*Math.sin(t.degree2Radian(this._degree));return e?e.setTo(n,r):egret.Point.create(n,r)},n.prototype.fromVector2D=function(e){return this._r=Math.sqrt(e.x*e.x+e.y*e.y),this._degree=t.radian2Degree(Math.atan2(e.y,e.x)),this},n.prototype.toVector=function(e){void 0===e&&(e=null);var n=this.r*Math.cos(t.degree2Radian(this._degree)),r=this.r*Math.sin(t.degree2Radian(this._degree));return e?e.init(n,r):create(t.Vector2D).init(n,r)},n.prototype.setDegreeByArcLength=function(e){return 0!=this.r&&(this._degree=180*e/(Math.PI*this.r)),this},n.prototype.addDegreeByArcLength=function(e){return 0!=this.r&&(this._degree+=180*e/(Math.PI*this.r)),this},Object.defineProperty(n.prototype,"degree",{get:function(){return this._degree},set:function(e){this._degree=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"r",{get:function(){return this._r},set:function(e){this._r=e},enumerable:!0,configurable:!0}),n}(e.ObjectCache.CacheableClass);t.PolarCoordinates=n,__reflect(n.prototype,"VL.Geom.PolarCoordinates")}(t=e.Geom||(e.Geom={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(e,t,n,r){return this._x1=e,this._y1=t,this._x2=n,this._y2=r,this},t.prototype.initByPoint=function(e,t){return this._x1=e.x,this._y1=e.y,this._x2=t.x,this._y2=t.y,this},t.prototype.setPoint1=function(e,t){return this._x1=e,this._y1=t,this},t.prototype.setPoint1ByPoint=function(e){return this._x1=e.x,this._y1=e.y,this},t.prototype.setPoint2=function(e,t){return this._x2=e,this._y2=t,this},t.prototype.setPoint2ByPoint=function(e){return this._x2=e.x,this._y2=e.y,this},t.prototype.clear=function(){this._x1=0,this._y1=0,this._x2=0,this._y2=0},t.prototype.dist2Point=function(e){var t=e.x,n=e.y,r=this.x1,i=this.y1,o=this.x2,s=this.y2,a=(o-r)*(t-r)+(s-i)*(n-i);if(0>=a)return Math.sqrt((t-r)*(t-r)+(n-i)*(n-i));var u=(o-r)*(o-r)+(s-i)*(s-i);if(a>=u)return Math.sqrt((t-o)*(t-o)+(n-s)*(n-s));var h=a/u,c=r+(o-r)*h,p=i+(s-i)*h;return Math.sqrt((t-c)*(t-c)+(p-i)*(p-i))},t.prototype.checkCross=function(e){var t=this.determinant(this.x2-this.x1,e.x1-e.x2,this.y2-this.y1,e.y1-e.y2);if(0==t)return!1;var n=this.determinant(e.x1-this.x1,e.x1-e.x2,e.y1-this.y1,e.y1-e.y2)/t;if(n>1||0>n)return!1;var r=this.determinant(this.x2-this.x1,e.x1-this.x1,this.y2-this.y1,e.y1-this.y1)/t;return r>1||0>r?!1:!0},t.prototype.determinant=function(e,t,n,r){return e*r-t*n},t.prototype.move=function(e,t){this._x1+=e,this._x2+=e,this._y1+=t,this._y2+=t},Object.defineProperty(t.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),t}(e.ObjectCache.CacheableClass);t.Segment=n,__reflect(n.prototype,"VL.Geom.Segment")}(t=e.Geom||(e.Geom={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){function t(e){return Math.PI/180*e}function n(e){return 180/Math.PI*e}function r(e,t,n,r,i,o){return e>=n&&i>=e&&t>=r&&o>=t}function i(e,t){for(var n=!1,r=0,i=e.length,o=i-1;i>r;o=r++)e[r].y>t.y!=e[o].y>t.y&&t.x<(e[o].x-e[r].x)*(t.y-e[r].y)/(e[o].y-e[r].y)+e[r].x&&(n=!n);return n}e.degree2Radian=t,e.radian2Degree=n,e.isPointInRect=r,e.isPolygonContainsPoint=i}(t=e.Geom||(e.Geom={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.init=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this._x=e,this._y=t,this},n.prototype.clear=function(){this._x=0,this._y=0},n.prototype.draw=function(e,t){void 0===t&&(t=0),e.lineStyle(0,t),e.moveTo(0,0),e.lineTo(this._x,this._y)},n.prototype.clone=function(){return create(n).init(this.x,this.y)},n.prototype.zero=function(){return this._x=0,this._y=0,this},n.prototype.isZero=function(){return 0==this._x&&0==this._y},Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)},set:function(e){var t=this.angle;this._x=Math.cos(t)*e,this._y=Math.sin(t)*e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lengthSQ",{get:function(){return this._x*this._x+this._y*this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angle",{get:function(){return Math.atan2(this._y,this._x)},set:function(e){var t=this.length;this._x=Math.cos(e)*t,this._y=Math.sin(e)*t},enumerable:!0,configurable:!0}),n.prototype.normalize=function(){if(0==this.length)return this._x=1,this;var e=this.length;return this._x/=e,this._y/=e,this},n.prototype.truncate=function(e){return this.length=Math.min(e,this.length),this},n.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this},n.prototype.isNormalized=function(){return 1==this.length},n.prototype.dotProd=function(e){return this._x*e.x+this._y*e.y},n.prototype.crossProd=function(e){return this._x*e.y-this._y*e.x},n.angleBetween=function(e,t){var n=!1,r=!1;e.isNormalized()||(e=e.clone().normalize(),n=!0),t.isNormalized()||(t=t.clone().normalize(),r=!0);var i=Math.acos(e.dotProd(t));return n&&e.restore(),r&&t.restore(),i},n.prototype.dist=function(e){return Math.sqrt(this.distSQ(e))},n.prototype.distSQ=function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},n.prototype.add=function(e,t){void 0===t&&(t=!0);var r=t?this:create(n);return r.init(this._x+e.x,this._y+e.y)},n.prototype.subtract=function(e,t){void 0===t&&(t=!0);var r=t?this:create(n);return r.init(this._x-e.x,this.y-e.y)},n.prototype.multiply=function(e,t){void 0===t&&(t=!0);var r=t?this:create(n);return r.init(this._x*e,this._y*e)},n.prototype.divide=function(e,t){void 0===t&&(t=!0);var r=t?this:create(n);return r.init(this._x/e,this._y/e)},n.prototype.equals=function(e){return this._x==e.x&&this._y==e.y},n.prototype.fromPoint=function(e){return this.x=e.x,this.y=e.y,this},n.prototype.toPoint=function(e){return void 0===e&&(e=null),e?e.setTo(this.x,this.y):egret.Point.create(this.x,this.y)},n.prototype.fromPolarCoordinates=function(e){var n=e.r*t.radian2Degree(Math.cos(t.degree2Radian(e.degree))),r=e.r*t.radian2Degree(Math.sin(t.degree2Radian(e.degree)));return this.init(n,r)},n.prototype.toPolarCoordinates=function(e){void 0===e&&(e=null);var n=Math.sqrt(this.x*this.x+this.y*this.y),r=t.radian2Degree(Math.atan2(this.y,this.x));return e?e.init(r,n):create(t.PolarCoordinates).init(r,n)},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return"[Vector2D(X:"+this._x+",y:"+this._y+")]"},n}(e.ObjectCache.CacheableClass);t.Vector2D=n,__reflect(n.prototype,"VL.Geom.Vector2D")}(t=e.Geom||(e.Geom={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.clear=function(){this.data=this.preNode=this.nextNode=null},e.prototype.init=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),this.data=e,this.preNode=t,this.nextNode=n,this},e.prototype.restore=function(e){restore(this)},e}();__reflect(t.prototype,"DLNode",["VL.LinkedList.INode","VL.ObjectCache.ICacheable"]);var n=function(){function e(){this._length=0,this._head=new t,this._tail=new t,this._head.nextNode=this._tail,this._tail.preNode=this._head}return Object.defineProperty(e.prototype,"first",{get:function(){return this.isEmpty?null:this._head.nextNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){return this.isEmpty?null:this._tail.preNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0==this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.checkNode=function(e){switch(e){case this._head:throw new Error("node 不能是 tail 哑元节点");case this._tail:throw new Error("node 不能是 tail 哑元节点");case null:throw new Error("node 不能为 null");default:if(egret.is(e,egret.getQualifiedClassName(t)))return e;throw new Error("node 不是 VL.LinkedList.DLNode")}},e.prototype.addAfter=function(e,n){var r=this.checkNode(e);if(!r)return null;var i=r.nextNode,o=create(t).init(n,r,i);return r.nextNode=o,i.preNode=o,this._length++,o},e.prototype.addBefore=function(e,n){var r=this.checkNode(e);if(!r)return null;var i=r.preNode,o=create(t).init(n,i,r);return r.preNode=o,i.nextNode=o,this._length++,o},e.prototype.push=function(e){var n=this._tail.preNode,r=create(t).init(e,n,this._tail);return this._tail.preNode=r,n.nextNode=r,this._length++,r},e.prototype.unshift=function(e){var n=this._head.nextNode,r=create(t).init(e,this._head,n);return this._head.nextNode=r,n.preNode=r,this._length++,r},e.prototype.getNext=function(e){var t=this.checkNode(e);return t?t.nextNode==this._tail?null:t.nextNode:null},e.prototype.getPre=function(e){var t=this.checkNode(e);return t?t.preNode==this._head?null:t.nextNode:null},e.prototype.pop=function(){if(this.isEmpty)throw new Error("链表成员数量为0，不能使用pop");var e=this._tail.preNode,t=e.preNode;this._tail.preNode=t,t.nextNode=this._tail;var n=e.data;return e.restore(),this._length--,n},e.prototype.remove=function(e){var t=this.checkNode(e);if(!t)return null;var n=t.preNode,r=t.nextNode;n.nextNode=r,r.preNode=n;var i=t.data;return t.restore(),this._length--,i},e.prototype.shift=function(){if(this.isEmpty)throw new Error("链表成员数量为0，不能使用shift");var e=this._head.nextNode,t=e.nextNode;this._head.nextNode=t,t.preNode=this._head;var n=e.data;return e.restore(),this._length--,n},e.prototype.replace=function(e,t){var n=this.checkNode(e);if(!n)return null;var r=e.data;return e.data=t,r},e}();e.DLinkedList=n,__reflect(n.prototype,"VL.LinkedList.DLinkedList",["VL.LinkedList.ILinkedList"]);var r=function(){function e(){this._length=0,this._entry=new t}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0==this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.checkNode=function(e){switch(e){case this._entry:throw new Error("node 不能是 entry 哑元节点");case null:throw new Error("node 不能为 null");default:if(egret.is(e,egret.getQualifiedClassName(t)))return e;throw new Error("node 不是 VL.LinkedList.DLNode")}},Object.defineProperty(e.prototype,"first",{get:function(){return this.isEmpty?null:this._entry.nextNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){return this.isEmpty?null:this._entry.preNode},enumerable:!0,configurable:!0}),e.prototype.getNext=function(e){var t=this.checkNode(e);return t?t.nextNode==t?null:t.nextNode:null},e.prototype.getPre=function(e){var t=this.checkNode(e);return t?t.preNode==t?null:t.nextNode:null},e.prototype.addAfter=function(e,n){var r=this.checkNode(e);if(!r)return null;var i=r.nextNode,o=create(t).init(n,r,i);return r.nextNode=o,i.preNode=o,this._entry.preNode==r&&(this._entry.preNode=o),this._length++,o},e.prototype.addBefore=function(e,n){var r=this.checkNode(e);if(!r)return null;var i=r.preNode,o=create(t).init(n,i,r);return r.preNode=o,i.nextNode=o,this._entry.nextNode==r&&(this._entry.nextNode=o),this._length++,o},e.prototype.push=function(e){var n=create(t).init(e);if(this.isEmpty)this._entry.preNode=this._entry.nextNode=n.preNode=n.nextNode=n;else{var r=this._entry.preNode;this._entry.preNode=n,r.nextNode=n,n.preNode=r,n.nextNode=this.first}return this._length++,n},e.prototype.unshift=function(e){var n=create(t).init(e);if(this.isEmpty)this._entry.preNode=this._entry.nextNode=n.preNode=n.nextNode=n;else{var r=this._entry.nextNode;this._entry.nextNode=n,r.preNode=n,n.preNode=this.last,n.nextNode=r}return this._length++,n},e.prototype.pop=function(){if(this.isEmpty)throw new Error("链表成员数量为0，不能使用pop");var e=this._entry.preNode,t=e.data;if(1==this.length)this._entry.preNode=this._entry.nextNode=null;else{var n=e.preNode;this._entry.preNode=n,n.nextNode=e.nextNode}return e.restore(),this._length--,t},e.prototype.remove=function(e){var t=this.checkNode(e);if(!t)return null;if(1==this.length)this._entry.preNode=this._entry.nextNode=null;else{var n=t.preNode,r=t.nextNode;n.nextNode=r,r.preNode=n}var i=t.data;return t.restore(),this._length--,i},e.prototype.shift=function(){if(this.isEmpty)throw new Error("链表成员数量为0，不能使用shift");var e=this._entry.preNode,t=e.data;if(1==this.length)this._entry.preNode=this._entry.nextNode=null;else{var n=e.nextNode;this._entry.nextNode=n,n.preNode=e.preNode}return e.restore(),this._length--,t},e.prototype.replace=function(e,t){var n=this.checkNode(e);if(!n)return null;var r=e.data;return e.data=t,r},e}();e.CircleList=r,__reflect(r.prototype,"VL.LinkedList.CircleList",["VL.LinkedList.ILinkedList"])}(t=e.LinkedList||(e.LinkedList={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(){function n(){this.reqHeader=null,this.dg_HttpError=new e.Delegate}return n.prototype.send=function(e,n,r){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,create(t.HttpTransaction).init(e,function(t,o){i.onResult(t,n.bind(r),e)}).send()];case 1:return[2,o.sent()]}})})},n.prototype.onResult=function(e,t,n){e.isSuccess?this.onSuccess(e,t,n):this.onFail(e,t,n),e.restore()},n.prototype.onSuccess=function(e,t,n){t(e.data,n.otherData),n.restore()},n.prototype.onFail=function(e,t,n){this.dg_HttpError.boardcast({key:n.key,data:e.data,otherData:n.otherData})},n}();t.Http=n,__reflect(n.prototype,"VL.Net.Http")}(t=e.Net||(e.Net={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(e,t,n,r,i,o,s,a){return void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=egret.HttpResponseType.TEXT),void 0===a&&(a=egret.URLLoaderDataFormat.TEXT),this._baseUrl=e,this._key=t,this._method=n,this._reqHead=o,this._respFormat=s,this._reqFormat=a,a==egret.URLLoaderDataFormat.TEXT?this._data=Utils.StringUtils.ObjectToQueryFormatString(r):this._data=r,this._otherData=i,this},t.prototype.clear=function(){this._baseUrl=this._key=this._reqHead=this._method=this._respFormat=this._data=this._otherData=this._reqFormat=null},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reqHead",{get:function(){return this._reqHead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"respFormat",{get:function(){return this._respFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherData",{get:function(){return this._otherData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reqFormat",{get:function(){return this._reqFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseUrl",{get:function(){return this._baseUrl},enumerable:!0,configurable:!0}),t}(e.ObjectCache.CacheableClass);t.HttpReqPack=n,__reflect(n.prototype,"VL.Net.HttpReqPack");var r=function(){function e(){}return e.process=function(t,n,r){e.completeCall["call_"+e._regID]=n.bind(r),e.startLoader(t,e._regID++)},e.startLoader=function(e,t){var n=document.createElement("script");n.src=e+"JsonpReq.completeCall.call_"+t,document.body.appendChild(n)},e._regID=0,e.completeCall={},e}();__reflect(r.prototype,"JsonpReq")}(t=e.Net||(e.Net={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(e,t,n){return this._isSuccess=e,this._header=t,this._data=n,this},t.prototype.clear=function(){this._isSuccess=null,this._header=null,this._data=null},Object.defineProperty(t.prototype,"isSuccess",{get:function(){return this._isSuccess},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),t}(e.ObjectCache.CacheableClass);t.HttpRespPack=n,__reflect(n.prototype,"VL.Net.HttpRespPack")}(t=e.Net||(e.Net={}))}(VL||(VL={}));var VL;!function(e){var t;!function(t){var n=function(e){function n(){var t=e.call(this)||this;return t._isRequesting=!1,t._httpReq=new egret.HttpRequest,t}return __extends(n,e),n.prototype.init=function(e,t){return this._reqPack=e,this._onResult=t,this},n.prototype.send=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(n){return[2,new Promise(function(n,r){e._isRequesting&&(app.log("============= 请求未返回，勿重复发送请求 ======================"),n(null));var i,o=e._httpReq,s=e._reqPack,a=s.baseUrl;s.method==egret.HttpMethod.POST&&s.data?(o.open(a+s.key,s.method),i=s.data):o.open(a+s.key+"?"+s.data,s.method);var u=s.reqHead;for(var h in u)o.setRequestHeader(h,u[h]),u[h]=u[h];o.responseType=s.respFormat,e._isRequesting=!0;var c=function(e){o.removeEventListener(egret.Event.COMPLETE,c,this),o.removeEventListener(egret.IOErrorEvent.IO_ERROR,p,this),this._isRequesting=!1;var r=create(t.HttpRespPack).init(!0,o.getAllResponseHeaders(),o.response);this._onResult(r,s.otherData),n(r),this.restore()},p=function(e){o.removeEventListener(egret.Event.COMPLETE,c,this),o.removeEventListener(egret.IOErrorEvent.IO_ERROR,p,this),this._isRequesting=!1;var r=create(t.HttpRespPack).init(!1,o.getAllResponseHeaders(),o.response);this._onResult(r,s.otherData),n(r),this.restore()};o.addEventListener(egret.Event.COMPLETE,c,e),o.addEventListener(egret.IOErrorEvent.IO_ERROR,p,e),o.send(i)})]})})},n.prototype.clear=function(){this._reqPack=this._onResult=null},n}(e.ObjectCache.CacheableClass);t.HttpTransaction=n,__reflect(n.prototype,"VL.Net.HttpTransaction")}(t=e.Net||(e.Net={}))}(VL||(VL={}));var SkinConfigHelper=function(){function e(){}return e.getCfg=function(e){return app.config.getConfig(SkinConfig)[e]},e.getArrCardSkin=function(e){if(!this.cardSkinMap[e])for(var t=this.cardSkinMap[e]=[],n=this.getCfg(e),r=n.cardColor.split(","),i=n.cardImg.split(","),o=0,s=r.length;s>o;o++)t.push({color:parseInt("0x"+r[o],16),img:i[o]});return this.cardSkinMap[e]},e.getCardColor=function(e,t){return this.getArrCardSkin(e)[t.id-1].color},e.getCardImg=function(e,t){return this.getArrCardSkin(e)[t.id-1].img},e.getLvColor=function(e,t){if(!this.arrLvColor){this.arrLvColor=[];for(var n=this.getCfg(e).lvColor.split(","),r=0,i=n.length;i>r;r++)this.arrLvColor.push(parseInt("0x"+n[r],16))}return this.arrLvColor[t-1]},e.getScoreMultipleBgColor=function(e){return parseInt("0x"+this.getCfg(e).scoreMultipleBgColor,16)},e.getGameBgColor=function(e){return parseInt("0x"+this.getCfg(e).gameBgColor,16)},e.getRubbishCellForeColor=function(e){return parseInt("0x"+this.getCfg(e).rubbishBinForeColor,16)},e.getRubbishCellBgColor=function(e){return parseInt("0x"+this.getCfg(e).rubbishBinBgColor,16)},e.cardSkinMap={},e}();__reflect(SkinConfigHelper.prototype,"SkinConfigHelper");var VL;!function(e){var t;!function(e){var t=function(){function e(e,t){void 0===t&&(t=Number.MAX_VALUE),this._objClass=e,this._objs=[],this.maxLength=t}return e.prototype.take=function(){var e,t=this._objs;return e=t&&t.length>0?t.pop():new this._objClass},e.prototype.restore=function(e){return null==e?!1:this._objs.length<this._maxLength?(this._objs.push(e),!0):!1},e.prototype.clear=function(){this._objs.length=0},Object.defineProperty(e.prototype,"length",{get:function(){return this._objs.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLength",{get:function(){return this._maxLength},set:function(e){e!=this._maxLength&&(this._maxLength=e,this._objs.length>e&&(this._objs.length=e))},enumerable:!0,configurable:!0}),e}();e.ObjectPool=t,__reflect(t.prototype,"VL.ObjectCache.ObjectPool")}(t=e.ObjectCache||(e.ObjectCache={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.getClassName=function(e){return egret.getQualifiedClassName(e)},e.prototype.getClass=function(e){return egret.getDefinitionByName(e)},e.prototype.getClassByEntity=function(e){return e?e.__proto__.constructor:null},e.prototype.isExtends=function(e,t){var n=this.getClassName(e);return t!=n&&e.prototype.__types__.indexOf(t)>=0},e}();e.EgretReflector=t,__reflect(t.prototype,"VL.Reflector.EgretReflector",["VL.Reflector.IReflector"])}(t=e.Reflector||(e.Reflector={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(e){void 0===e&&(e="tempLoadTask"),this.tempGroupIdx=0,this.taskCanceled=!1,this.tempGroupBaseName=e,this.loadTaskQueue=[],this.taskReporter={onProgress:this.onProgress.bind(this),onCancel:this.onCancel.bind(this)}}return e.prototype.loadConfig=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,RES.loadConfig(e,t)]})})},e.prototype.loadResTask=function(e){var t=this.tempGroupBaseName+this.tempGroupIdx;e.taskName=e.taskName||t,this.loadTaskQueue.push(e),this.loadNextTask()},e.prototype.loadNextTask=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return this.isRunningTask?[2]:(e=this.loadTaskQueue.shift())?(this.currTask=e,t=e.keys,n=e.taskName,r=this.tempGroupBaseName+this.tempGroupIdx++,n=n||r,t&&t.length>0?RES.createGroup(r,t,!0)?(app.log("加载任务 taskName:"+n+"  keys:"+t),[4,RES.loadGroup(r,0,this.taskReporter)]):[3,2]:[3,4]):[2];case 1:return i.sent(),this.onTaskOver(),[3,3];case 2:app.warn("资源组创建失败 taskName:"+n+",  keys:"+t),this.onCancel(),this.onTaskOver(),i.label=3;case 3:return[3,5];case 4:this.onTaskOver(),i.label=5;case 5:return[2]}})})},e.prototype.onTaskOver=function(){var e=this.currTask;this.currTask=null,this.taskCanceled?(this.taskCanceled=!1,e.onCancel&&(app.warn("加载任务被取消 taskName:"+e.taskName),e.onCancel(e))):e.onComplete&&(app.log("加载任务结束 taskName:"+e.taskName),e.onComplete(e)),this.loadNextTask()},e.prototype.onProgress=function(e,t){var n=this.currTask;app.log(e+" / "+t),n.onProgress&&n.onProgress(n,e,t)},e.prototype.onCancel=function(){this.taskCanceled=!0},e.prototype.getRes=function(e){return RES.getRes(e)},e.prototype.getResAsync_promise=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,RES.getResAsync(e)]})})},e.prototype.getResAsync_callback=function(e,t,n){return RES.getResAsync(e,t,n)},e.prototype.destroyRes=function(e,t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,!RES.getRes(e)||RES.destroyRes(e,t)]})})},e.prototype.destroyReses=function(e,t){void 0===t&&(t=!0);for(var n=0,r=e.length;r>n;n++)this.destroyRes(e[n],t)},e.prototype.loadResByURL=function(e,t){return void 0===t&&(t=egret.URLLoaderDataFormat.TEXTURE),__awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return[2,new Promise(function(r,i){var o=new egret.URLRequest(e),s=new egret.URLLoader(o);s.dataFormat=t,s.once(egret.Event.COMPLETE,function(e){r(e.data)},n),s.once(egret.IOErrorEvent.IO_ERROR,function(e){i(e.data)},n)})]})})},Object.defineProperty(e.prototype,"isRunningTask",{get:function(){return!!this.currTask},enumerable:!0,configurable:!0}),e}();e.EgretResManager=t,__reflect(t.prototype,"VL.Resource.EgretResManager")}(t=e.Resource||(e.Resource={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.adapt=function(e,t){e.scaleX=t.width/e.width,e.scaleY=t.height/e.height},e}();__reflect(t.prototype,"ScaleMode_Draw",["VL.ScaleMode.IScaleMode"]),e.DRAW=new t}(t=e.ScaleMode||(e.ScaleMode={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.adapt=function(e,t){e.scaleX=e.scaleY=1;var n=e.width,r=e.height,i=t.width,o=t.height,s=Math.max(i/n,o/r);e.scaleY=e.scaleX=s},e}();__reflect(t.prototype,"ScaleMode_NoBorder",["VL.ScaleMode.IScaleMode"]),e.NO_BORDER=new t}(t=e.ScaleMode||(e.ScaleMode={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.adapt=function(e,t){e.scaleX=e.scaleY=1;var n=e.width,r=e.height,i=t.width,o=t.height,s=Math.min(i/n,o/r);e.scaleY=e.scaleX=s},e}();__reflect(t.prototype,"ScaleMode_ShowAll_Fill",["VL.ScaleMode.IScaleMode"]),e.SHOW_ALL_FILL=new t}(t=e.ScaleMode||(e.ScaleMode={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.adapt=function(e,t){e.scaleX=e.scaleY=1;var n=e.width,r=e.height,i=t.width,o=t.height,s=Math.min(1,Math.min(i/n,o/r));e.scaleY=e.scaleX=s},e}();__reflect(t.prototype,"ScaleMode_ShowAll",["VL.ScaleMode.IScaleMode"]),e.SHOW_ALL=new t}(t=e.ScaleMode||(e.ScaleMode={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t=function(t){function n(n,r){void 0===n&&(n=null),void 0===r&&(r=e.SoundType.EFFECT);var i=t.call(this)||this;return i._soundType=egret.Sound.EFFECT,i._volume=1,i._pausedPos=0,i.init(n,r),i
}return __extends(n,t),n.prototype.init=function(t,n){return void 0===t&&(t=null),void 0===n&&(n=e.SoundType.EFFECT),this.isPlaying&&this.stop(),this.source=t,this.soundType=n,this._sound=null,this._isLoading=!1,this.volume=1,this._pausedPos=0,this},n.prototype.play=function(e,t){void 0===e&&(e=1),void 0===t&&(t=!0),this.isPlaying&&this.stop();var n=this._sound;n&&(this._channel=n.play(t?this._pausedPos:0,e),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel.volume=this._volume),this._pausedPos=0},n.prototype.onPlayComplete=function(e){this.stop()},n.prototype.pause=function(){this.isPlaying&&(this._pausedPos=this._channel.position,this.stop())},n.prototype.stop=function(){this.isPlaying&&this._channel.stop(),this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel=null},n.prototype.load=function(e,t,n){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){r.source==e&&r._sound?(t.call(n,r),i(r)):(r._isLoading=!0,RES.getResAsync(e,function(s,a){getClassByEntity(s)!=egret.Sound&&o(a+" 的资源类型不是 egret.Sound"),r._sound=s,r.source=e,r._isLoading=!1,t.call(n,r),i(r)},r))})]})})},n.prototype.clear=function(){RES.destroyRes(this.source),this.init()},n.prototype.dispose=function(){this.restore()},Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this._channel&&(this._channel.volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e;var t=RES.getRes(this.source);this._sound!=t&&(this._sound=t,this._sound&&(this._sound.type=this._soundType))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"soundType",{get:function(){var t=e.SoundType.EFFECT;switch(this._soundType){case egret.Sound.MUSIC:t=e.SoundType.MUSIC;break;case egret.Sound.EFFECT:t=e.SoundType.EFFECT}return t},set:function(t){switch(t){case e.SoundType.MUSIC:this._soundType=egret.Sound.MUSIC;break;case e.SoundType.EFFECT:this._soundType=egret.Sound.EFFECT}this._sound&&(this._sound.type=this._soundType)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return null!=this._channel},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pausedPos",{get:function(){return this._pausedPos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPaused",{get:function(){return this._pausedPos>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._sound?this._sound.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!this.isLoading&&this.source&&this.source.length>0?null!=this._sound:!1},enumerable:!0,configurable:!0}),n}(e.SoundBase);e.EgretSound=t,__reflect(t.prototype,"VL.Sound.EgretSound",["VL.Sound.ISound","VL.ObjectCache.ICacheable"])}(t=e.Sound||(e.Sound={}))}(VL||(VL={}));var App;!function(e){var t=function(){function t(){this._caseIDSeed=0,this.loadingCaseList=[],this.loadingPanel=new EasyLoadingPanel}return t.prototype.getNewCaseID=function(){return this._caseIDSeed>=1e6&&(this._caseIDSeed=0),""+this._caseIDSeed++},t.prototype.add=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=e||this.getNewCaseID();return this.loadingCaseList.push(n),this.isShow||this.show(t),n},t.prototype.remove=function(e){var t=this.loadingCaseList.indexOf(e);-1!=t&&(this.loadingCaseList.splice(t,1),this.loadingCaseList.length<=0&&this.hide())},t.prototype.clear=function(){this.loadingCaseList.length=0,this.hide()},t.prototype.show=function(t){void 0===t&&(t=null),this.loadingPanel.show(e.GameLayers.UI_Top,t)},t.prototype.hide=function(){this.loadingPanel.hide()},Object.defineProperty(t.prototype,"isShow",{get:function(){return this.loadingPanel.isShow},enumerable:!0,configurable:!0}),t}();e.EasyLoadingManager=t,__reflect(t.prototype,"App.EasyLoadingManager")}(App||(App={}));var VL;!function(e){var t;!function(e){var t=function(){function t(e){this._soundClass=e,this._musicList={},this._effList={}}return t.prototype.createSound=function(){return create(this._soundClass)},t.prototype.playEffect=function(e,t){var n=this.getSoundEffect(e);if(!n)throw new Error("sound effect entity is not exist !  source:"+e);n.play(t,!1)},t.prototype.playMusic=function(e,t,n){var r=this.getMusic(e);if(!r)throw new Error("music entity is not exist !  source:"+e);r.play(t,n)},t.prototype.loadSounds=function(t){for(var n,r=function(r,o){n=t[r];var s;switch(n.soundType){case e.SoundType.EFFECT:s=i._effList;break;case e.SoundType.MUSIC:s=i._musicList}var a=s[n.source];if(a)n.onLoaded.call(n.thisObj,a);else{a=i.createSound();var u=function(e){s[e.source]=e,n.onLoaded.call(n.thisObj,e)};a.load(n.source,u,i)}},i=this,o=0,s=t.length;s>o;o++)r(o,s)},t.prototype.releaseSound=function(e){var t=this.getSoundEffect(e);return t?(delete this._effList[e],void t.restore()):(t=this.getMusic(e),void(t&&(delete this._musicList[e],t.restore())))},t.prototype.getSoundEffect=function(e){return this._effList[e]},t.prototype.getMusic=function(e){return this._musicList[e]},t}();e.SoundMgr=t,__reflect(t.prototype,"VL.Sound.SoundMgr")}(t=e.Sound||(e.Sound={}))}(VL||(VL={}));var VL;!function(e){var t;!function(e){var t;!function(e){e[e.MUSIC=0]="MUSIC",e[e.EFFECT=1]="EFFECT"}(t=e.SoundType||(e.SoundType={}))}(t=e.Sound||(e.Sound={}))}(VL||(VL={}));var Utils;!function(e){var t=function(){function e(){}return e.init=function(){e._propertyChange=Object.create(null),e._anchorChange=Object.create(null),e.injectAnchor()},e.setAnchorX=function(e,t){e.anchorX=t},e.setAnchorY=function(e,t){e.anchorY=t},e.setAnchor=function(e,t){e.anchorX=e.anchorY=t},e.getAnchor=function(e){return e.anchorX!=e.anchorY&&console.log("target's anchorX != anchorY"),e.anchorX||0},e.getAnchorY=function(e){return e.anchorY||0},e.getAnchorX=function(e){return e.anchorX||0},e.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){var n=this;this.$setWidth(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){var n=this;this.$setHeight(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(t){var n=this;this._anchorX=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(t){var n=this;this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0})},e.changeAnchor=function(t){e._propertyChange[t.hashCode]&&e._anchorChange[t.hashCode]&&(t.anchorOffsetX=t._anchorX*t.width,t.anchorOffsetY=t._anchorY*t.height,delete e._propertyChange[t.hashCode])},e}();e.AnchorUtil=t,__reflect(t.prototype,"Utils.AnchorUtil")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function t(){}return t.quickSort=function(e,t){if(e.length<=1)return e;for(var n,r,i=Math.floor(e.length>>1),o=e[i],s=[],a=[],u=[],h=0;h<e.length;h++)r=e[h],n=t(e[h],o),0>n?s.push(r):0==n?a.push(r):n>0&&u.push(r);return this.quickSort(s,t).concat(a,this.quickSort(u,t))},t.randomElement=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},t.upsetArr=function(t,n){var r,i=t.concat();if(n){r=[];for(var o=void 0,s=0,a=n.length;a>s;s++)o=i.splice(n[s],1),r.push(o[0])}for(var u=i.length,h=[];u>0;){var c=e.RandomUtils.limitInteger(0,--u);h.push(i.splice(c,1)[0])}if(r)for(var s=0,p=n.length;p>s;s++){var l=n[s];h.splice(l,0,r[s])}return h},t}();e.ArrayUtils=t,__reflect(t.prototype,"Utils.ArrayUtils")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.play=function(e){function t(e){C++,C==s&&n.removeChild(o)}var n=StageUtils.getStage(),r=n.width,i=n.height,o=new eui.Group;o.width=r,o.height=i,n.addChild(o);for(var s=40,a=5,u=s/a,h=0;s>h;h++){var c=r/a,p=i/u,l=h%a*c,d=Math.floor(h/a)*p,g=new egret.RenderTexture,f=(g.drawToTexture(n,new egret.Rectangle(l,d,c,p)),new egret.Bitmap);switch(f.texture=g,f.anchorOffsetX=c>>1,f.anchorOffsetY=p>>1,f.x=l+c>>1,f.y=d+p>>1,o.addChild(f),5==e&&(e=Math.ceil(4*Math.random())),e){case 1:var _=egret.Tween.get(f);_.to({scaleX:0,scaleY:0,alpha:0,rotation:359},800,egret.Ease.circIn).call(t,this);break;case 2:var y=-r;h%2||(y=2*r);var _=egret.Tween.get(f);_.to({x:y,alpha:0},800,egret.Ease.circIn).call(t,this);break;case 3:var _=egret.Tween.get(f);_.to({scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,egret.Ease.backInOut).call(t,this);break;case 4:var _=egret.Tween.get(f);_.to({alpha:0},900,egret.Ease.circIn).call(t,this);break;default:var _=egret.Tween.get(f);_.to({scaleX:1,scaleY:0,alpha:0},800,egret.Ease.circIn).call(t,this)}}var C=0},e}();e.ChangeSceneEffect=t,__reflect(t.prototype,"Utils.ChangeSceneEffect")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.drawSector=function(e,t,n,r,i,o,s,a){void 0===t&&(t=100),void 0===n&&(n=0),void 0===r&&(r=360),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=16711680),void 0===a&&(a=1),e.clear(),e.beginFill(s,a),e.moveTo(i,o),r=Math.abs(r)>360?360:r;var u=Math.ceil(Math.abs(r)/45),h=r/u;h=h*Math.PI/180,n=n*Math.PI/180,e.lineTo(i+t*Math.cos(n),o+t*Math.sin(n));for(var c=1;u>=c;c++){n+=h;var p=n-h>>1,l=i+t/Math.cos(h>>1)*Math.cos(p),d=o+t/Math.cos(h>>1)*Math.sin(p),g=i+t*Math.cos(n),f=o+t*Math.sin(n);e.curveTo(l,d,g,f)}360!=r&&e.lineTo(i,o),e.endFill()},e}();e.GraphicsUtil=t,__reflect(t.prototype,"Utils.GraphicsUtil")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){this.hexcase=0,this.b64pad=""}return e.prototype.hex_md5=function(e){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.b64_md5=function(e){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(e)))},e.prototype.any_md5=function(e,t){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(e)),t)},e.prototype.hex_hmac_md5=function(e,t){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.b64_hmac_md5=function(e,t){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)))},e.prototype.any_hmac_md5=function(e,t,n){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(e),this.str2rstr_utf8(t)),n)},e.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},e.prototype.rstr_md5=function(e){return this.binl2rstr(this.binl_md5(this.rstr2binl(e),8*e.length))},e.prototype.rstr_hmac_md5=function(e,t){var n=this.rstr2binl(e);n.length>16&&(n=this.binl_md5(n,8*e.length));for(var r=Array(16),i=Array(16),o=0;16>o;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=this.binl_md5(r.concat(this.rstr2binl(t)),512+8*t.length);return this.binl2rstr(this.binl_md5(i.concat(s),640))},e.prototype.rstr2hex=function(e){try{this.hexcase}catch(t){this.hexcase=0}for(var n,r=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",o=0;o<e.length;o++)n=e.charCodeAt(o),i+=r.charAt(n>>>4&15)+r.charAt(15&n);return i},e.prototype.rstr2b64=function(e){try{this.b64pad}catch(t){this.b64pad=""}for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length,o=0;i>o;o+=3)for(var s=e.charCodeAt(o)<<16|(i>o+1?e.charCodeAt(o+1)<<8:0)|(i>o+2?e.charCodeAt(o+2):0),a=0;4>a;a++)r+=8*o+6*a>8*e.length?this.b64pad:n.charAt(s>>>6*(3-a)&63);return r},e.prototype.rstr2any=function(e,t){var n,r,i,o,s,a=t.length,u=Array(Math.ceil(e.length/2));for(n=0;n<u.length;n++)u[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);var h=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),c=Array(h);for(r=0;h>r;r++){for(s=Array(),o=0,n=0;n<u.length;n++)o=(o<<16)+u[n],i=Math.floor(o/a),o-=i*a,(s.length>0||i>0)&&(s[s.length]=i);c[r]=o,u=s}var p="";for(n=c.length-1;n>=0;n--)p+=t.charAt(c[n]);return p},e.prototype.str2rstr_utf8=function(e){for(var t,n,r="",i=-1;++i<e.length;)t=e.charCodeAt(i),n=i+1<e.length?e.charCodeAt(i+1):0,t>=55296&&56319>=t&&n>=56320&&57343>=n&&(t=65536+((1023&t)<<10)+(1023&n),i++),127>=t?r+=String.fromCharCode(t):2047>=t?r+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r},e.prototype.str2rstr_utf16le=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n),e.charCodeAt(n)>>>8&255);return t},e.prototype.str2rstr_utf16be=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,255&e.charCodeAt(n));return t},e.prototype.rstr2binl=function(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(var n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},e.prototype.binl2rstr=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},e.prototype.binl_md5=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,u=r,h=i,c=o;n=this.md5_ff(n,r,i,o,e[s+0],7,-680876936),o=this.md5_ff(o,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,o,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,o,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,o,e[s+4],7,-176418897),o=this.md5_ff(o,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,o,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,o,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,o,e[s+8],7,1770035416),o=this.md5_ff(o,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,o,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,o,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,o,e[s+12],7,1804603682),o=this.md5_ff(o,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,o,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,o,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,o,e[s+1],5,-165796510),o=this.md5_gg(o,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,o,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,o,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,o,e[s+5],5,-701558691),o=this.md5_gg(o,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,o,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,o,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,o,e[s+9],5,568446438),o=this.md5_gg(o,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,o,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,o,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,o,e[s+13],5,-1444681467),o=this.md5_gg(o,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,o,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,o,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,o,e[s+5],4,-378558),o=this.md5_hh(o,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,o,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,o,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,o,e[s+1],4,-1530992060),o=this.md5_hh(o,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,o,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,o,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,o,e[s+13],4,681279174),o=this.md5_hh(o,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,o,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,o,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,o,e[s+9],4,-640364487),o=this.md5_hh(o,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,o,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,o,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,o,e[s+0],6,-198630844),o=this.md5_ii(o,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,o,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,o,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,o,e[s+12],6,1700485571),o=this.md5_ii(o,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,o,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,o,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,o,e[s+8],6,1873313359),o=this.md5_ii(o,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,o,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,o,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,o,e[s+4],6,-145523070),o=this.md5_ii(o,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,o,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,o,n,e[s+9],21,-343485551),n=this.safe_add(n,a),r=this.safe_add(r,u),i=this.safe_add(i,h),o=this.safe_add(o,c)}return[n,r,i,o]},e.prototype.md5_cmn=function(e,t,n,r,i,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,o)),i),n)},e.prototype.md5_ff=function(e,t,n,r,i,o,s){return this.md5_cmn(t&n|~t&r,e,t,i,o,s)},e.prototype.md5_gg=function(e,t,n,r,i,o,s){return this.md5_cmn(t&r|n&~r,e,t,i,o,s)},e.prototype.md5_hh=function(e,t,n,r,i,o,s){return this.md5_cmn(t^n^r,e,t,i,o,s)},e.prototype.md5_ii=function(e,t,n,r,i,o,s){return this.md5_cmn(n^(t|~r),e,t,i,o,s)},e.prototype.safe_add=function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n},e.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t},e}();e.md5=t,__reflect(t.prototype,"Utils.md5")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.convert=function(e,t,n,r){void 0===t&&(t=44),void 0===n&&(n=4),void 0===r&&(r=2);for(var i,o,s=t;s>=4;s-=n)if(e/Math.pow(10,s)>=1)return i=Math.pow(10,s-r),o=this.unit[s]||"",Math.floor(e/(i>0?i:1))/Math.pow(10,r)+o;return e.toString()},e.unit={2:"百",3:"千",4:"万",5:"十万",6:"百万",7:"千万",8:"亿",9:"十亿",10:"百亿",11:"千亿",12:"兆",16:"京",20:"垓",24:"秭",28:"穰",32:"沟",36:"涧",40:"正",44:"载"},e}();e.NumberToUnitStringUtil=t,__reflect(t.prototype,"Utils.NumberToUnitStringUtil")}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.limit=function(e,t){e=Math.min(e,t),t=Math.max(e,t);var n=t-e;return e+Math.random()*n},e.limitInteger=function(e,t){return Math.round(this.limit(e,t))},e}();e.RandomUtils=t,__reflect(t.prototype,"Utils.RandomUtils")}(Utils||(Utils={}));var StageUtils;!function(e){function t(){return c||(c=egret.MainContext.instance.stage),c}function n(){return t().stageHeight}function r(){return t().stageWidth}function i(){return t().height}function o(){return t().width}function s(e){t().touchChildren=e}function a(e){t().maxTouches=e}function u(e){t().frameRate=e}function h(e){t().scaleMode=e}var c;e.getStage=t,e.getStageHeight=n,e.getStageWidth=r,e.getGameHeight=i,e.getGameWidth=o,e.setTouchChildren=s,e.setMaxTouches=a,e.setFrameRate=u,e.setScaleMode=h}(StageUtils||(StageUtils={}));var Utils;!function(e){var t=function(){function e(){}return e.queryFormatToObject=function(e){for(var t,n=e.split("&"),r={},i=0,o=n.length;o>i;i++)t=n[i].split("="),t.length>=2&&(r[t[0]]=t[1]);return r},e.ObjectToQueryFormatString=function(e){var t=[];for(var n in e){var r=n+"="+e[n];t.push(r)}return t.join("&")},e}();e.StringUtils=t,__reflect(t.prototype,"Utils.StringUtils")}(Utils||(Utils={}));var EasyLoadingPanel=function(e){function t(t,n,r){void 0===t&&(t="x-jiazai_png"),void 0===n&&(n=0),void 0===r&&(r=.5);var i=e.call(this)||this;return i.rollSpeed=6,i._isShow=!1,i.roller=new egret.Bitmap,i._rollerRes=t,i.opacity=r,i.bgColor=n,i.touchChildren=!1,i.touchEnabled=!0,i}return __extends(t,e),t.prototype.show=function(e,t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=this.roller,t.texture?[3,2]:(n=t,[4,RES.getResAsync(this._rollerRes)]);case 1:n.texture=r.sent(),t.anchorOffsetX=t.width>>1,t.anchorOffsetY=t.height>>1,this.updateLayout(),this.addChild(this.roller),r.label=2;case 2:return egret.setTimeout(function(){this.isShow&&e.addChild(this)},this,500),this._isShow||(this._isShow=!0,this.interval=egret.setInterval(this.roll,this,20),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)),this.updateLayout(),[2]}})})},t.prototype.hide=function(){this.parent&&this.parent.removeChild(this),egret.clearInterval(this.interval),StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this),this._isShow=!1},t.prototype.updateLayout=function(){var e=StageUtils.getStageWidth(),t=StageUtils.getStageHeight(),n=this.graphics;n.clear(),n.beginFill(this.bgColor,this.opacity),n.drawRect(0,0,e,t),n.endFill(),this.roller.x=this.width>>1,this.roller.y=this.height>>1},t.prototype.roll=function(){var e=this.roller;e.rotation>360?e.rotation=e.rotation-360+this.rollSpeed:e.rotation+=this.rollSpeed},Object.defineProperty(t.prototype,"isShow",{get:function(){return this._isShow},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(EasyLoadingPanel.prototype,"EasyLoadingPanel"),window.EasyLoadingPanel=EasyLoadingPanel;var SDK;!function(e){var t;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.MALE=1]="MALE",e[e.FEMALE=2]="FEMALE"}(t=e.Enum_Gender||(e.Enum_Gender={}))}(SDK||(SDK={}));var SDK;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"LOCAL",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WANBA",{get:function(){return"wanba_ts"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"YYB",{get:function(){return"yingyongbao"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WX",{get:function(){return"weixin"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"H5SDK",{get:function(){return"h5sdk"},enumerable:!0,configurable:!0}),e}();e.Enum_PF=t,__reflect(t.prototype,"SDK.Enum_PF")}(SDK||(SDK={}));var VoyaMVC;!function(e){var t=function(){function e(){this.msgHandlerMap={}}return e.prototype.sendMsg=function(e){var t=getClassName(e),n=this.msgHandlerMap[t];if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i.handler.call(i.thisObj,e)}e.restore()},e.prototype.regMsg=function(e,t,n,r){void 0===r&&(r=!1);var i=getClassName(e),o=this.msgHandlerMap[i];o||(this.msgHandlerMap[i]=[]),r?this.existMsgHandler(e,t,n)||this.msgHandlerMap[i].push({handler:t,thisObj:n}):this.msgHandlerMap[i].push({handler:t,thisObj:n})},e.prototype.unregMsg=function(e,t,n){void 0===n&&(n=null);var r=getClassName(e),i=this.msgHandlerMap[r];if(i&&i.length>0&&t)for(var o=void 0,s=0;s<i.length;s++)o=i[s],o.handler==t&&(n?o.thisObj==n&&i.splice(s--,1):i.splice(s--,1))},e.prototype.existMsgHandler=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=getClassName(e),i=this.msgHandlerMap[r],o=!1;if(i&&i.length>0)if(t){for(var s=void 0,a=0,u=i.length;u>a;a++)if(s=i[a],s.handler==t){if(!n){o=!0;break}if(s.thisObj==n){o=!0;break}}}else o=!0;return o},e}();e.MsgSender=t,__reflect(t.prototype,"VoyaMVC.MsgSender",["VoyaMVC.IMsgSender"])}(VoyaMVC||(VoyaMVC={})),window.Main=Main;