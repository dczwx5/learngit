function kvList2KvSet(t){if(!t||0==t.length)return[];for(var e=function(e,n){var i={},r=t[e];r.KVDataList.forEach(function(t,e,n){i[t.key]=parseInt(t.value)}),r.KVDataSet=i},n=0,i=t.length;i>n;n++)e(n,i);return t}function userGamedataListFilterByWeek(t){var e=[],n=new DateUtil;n.newToday(Date.now());for(var i,r,a=n.getMonday().getTime()/1e3,o=0,s=t.length;s>o;o++)i=t[o],i.KVDataSet&&i.KVDataSet.score_time&&(r=i.KVDataSet.score_time,r>a&&e.push(i));return e}function getClassName(t){return egret.getQualifiedClassName(t)}function getClass(t){return egret.getDefinitionByName(t)}function getClassByInstance(t){return t?t.prototype?t:t.__proto__.constructor:null}function isExtends(t,e){var n=getClassName(t);return e!=n&&t.prototype.__types__.indexOf(e)>=0}function toObject(t){var e={};for(var n in t)e[n]=t[n];return e}function fromObject(t,e){for(var n in e)t[n]=e[n]}var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},ObjectPool=function(){function t(){this._content={},this._objs=[]}return t.prototype.pop=function(t){var e=getClassName(t);if(e||egret.warn(t.__proto__.__class__+"需要加到window里面~~~~~~~~~~"),t.prototype.__types__.indexOf("ICacheable")<0)throw new Error(e+"未实现ICacheable接口，只有实现ICacheable接口的类才能使用对象池");var n,i=this._content[e];return n=i&&i.length?i.pop():new t},t.prototype.push=function(t){if(null==t)return!1;var e=getClassName(t);return this._content[e]=this._content[e]||[],this._content[e].push(t),!0},t.prototype.clear=function(){this._content={},this._objs.length=0},t.prototype.clearClass=function(t,e){void 0===e&&(e=null);for(var n=this._content[t];n&&n.length;){var i=n.pop();e&&i[e](),i=null}this._content[t]=null,delete this._content[t]},t.prototype.dealFunc=function(t,e){var n=this._content[t];if(null!=n){var i=0,r=n.length;for(i;r>i;i++)n[i][e]()}},t}();__reflect(ObjectPool.prototype,"ObjectPool");var CacheableClass=function(){function t(){}return t.create=function(t){return this._cachePool.pop(t)},t.prototype.restore=function(){this.clear();var t=getClassByInstance(this);t||(egret.warn("這個類要放到window~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"),egret.warn(this.__proto__.__class__)),t._cachePool.push(this)},t._cachePool=new ObjectPool,t}();__reflect(CacheableClass.prototype,"CacheableClass",["ICacheable"]),window.CacheableClass=CacheableClass;var Command=function(t){function e(){var e=t.call(this)||this;return e._autoRestore=!0,e._isOpened=!1,e.eventDispatcher=new egret.EventDispatcher,e}return __extends(e,t),Object.defineProperty(e,"COMMAND_COMPLETE",{get:function(){return"commandComplete"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"COMMAND_ABORT",{get:function(){return"commandAbort"},enumerable:!0,configurable:!0}),e.prototype.openAsync=function(){this._isOpened||(this._isOpened=!0,this.execute())},e.prototype.closeAsync=function(t){void 0===t&&(t=!1),this._isOpened&&(this.clear(),this.context=null,this._isOpened=!1,this.dispatchEvent(egret.Event.create(egret.Event,t?e.COMMAND_ABORT:e.COMMAND_COMPLETE)),this.autoRestore&&this.restore())},e.prototype.run=function(){this.openAsync(),this.closeAsync()},Object.defineProperty(e.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoRestore",{get:function(){return this._autoRestore},set:function(t){this._autoRestore=t},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(t,e,n,i,r){this.eventDispatcher.addEventListener(t,e,n,i,r)},e.prototype.once=function(t,e,n,i,r){this.eventDispatcher.once(t,e,n,i,r)},e.prototype.removeEventListener=function(t,e,n,i){this.eventDispatcher.removeEventListener(t,e,n,i)},e.prototype.hasEventListener=function(t){return this.eventDispatcher.hasEventListener(t)},e.prototype.dispatchEvent=function(t){return this.eventDispatcher.dispatchEvent(t)},e.prototype.willTrigger=function(t){return this.eventDispatcher.willTrigger(t)},e}(CacheableClass);__reflect(Command.prototype,"Command",["ICommand","egret.IEventDispatcher"]);var HandlerBase=function(t){function e(){var e=t.call(this)||this;return e.autoRestore=!1,e.contextEventDispatcher=new ContextEventDispatcher,e}return __extends(e,t),Object.defineProperty(e.prototype,"viewManager",{get:function(){return e._viewManager||(e._viewManager=new ViewManager),e._viewManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalData",{get:function(){return GlobalData.instance},enumerable:!0,configurable:!0}),e.prototype.onOpenView=function(t){return this.viewManager.onOpenView(t)},e.prototype.closeView=function(t){this.viewManager.onCloseView(t)},e.prototype.closeAllView=function(){this.viewManager.onCloseAllView()},e.prototype.addContextEvent=function(t,e,n,i,r){this.contextEventDispatcher.addEventListener(t,e,n,i,r)},e.prototype.removeContextEvent=function(t,e,n,i){this.contextEventDispatcher.removeEventListener(t,e,n,i)},e.prototype.hasContextEvent=function(t){return this.contextEventDispatcher.hasEventListener(t)},e.prototype.dispatchContextEvent=function(t){return this.contextEventDispatcher.dispatchEvent(t)},e}(Command);__reflect(HandlerBase.prototype,"HandlerBase");var ListItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.onDataChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(ListItem.prototype,"ListItem");var ListPanel=function(t){function e(e,n,i){void 0===e&&(e=RankListItem.WIDTH),void 0===n&&(n=590),void 0===i&&(i=5);var r=t.call(this)||this;return r._isInited=!1,r.init(e,n,i),r.createItems(),r}return __extends(e,t),e.prototype.init=function(t,e,n){void 0===t&&(t=RankListItem.WIDTH),void 0===e&&(e=590),void 0===n&&(n=5),this._pageSize=n,this._pageIdx=0,this.itemList=[],this._dataList=[],this.vGap=5,this.width=t,this.height=e;var i=this.bg=new egret.Shape;i.graphics.beginFill(14939626),i.graphics.drawRect(0,0,this.width,this.height),i.graphics.endFill(),this.addChild(i),this.initHeadArea(),this.initListArea(),this.initFootArea(),this._isInited=!0,this.setPosistion()},e.prototype.setPosistion=function(){this.x=Main.stage.stageWidth-this.width>>1,this.y=Main.stage.stageHeight-this.height>>1},e.prototype.initHeadArea=function(){var t=this.headArea=new egret.DisplayObjectContainer;t.width=this.width,t.height=70;var e=this.headBg=new egret.Shape;e.graphics.beginFill(8180694),e.graphics.drawRect(0,0,t.width,t.height),e.graphics.endFill(),t.addChild(e);var n=this.tf_title=new egret.TextField;n.size=34,n.textColor=16777215,n.text=this.titleText,n.x=t.width-n.textWidth>>1,n.y=t.height-n.textHeight>>1,t.addChild(n),this.addChild(t)},e.prototype.initListArea=function(){var t=this.listArea=new egret.DisplayObjectContainer;t.width=this.width,t.height=this.listHeight,t.y=this.headArea.y+this.headArea.height,this.addChild(t)},e.prototype.initFootArea=function(){var t=this.footArea=new egret.DisplayObjectContainer;t.width=this.width,t.height=70,t.y=this.listArea.y+this.listArea.height;var e=this.footBg=new egret.Shape;e.graphics.beginFill(8180694),e.graphics.drawRect(0,0,t.width,t.height),e.graphics.endFill(),t.addChild(e);var n=this.tf_prePage=new egret.TextField;n.touchEnabled=!0,n.size=30,n.textColor=16777215,n.text="上一页",n.x=620,n.y=t.height-n.textHeight>>1,t.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPrePage,this);var i=this.tf_nextPage=new egret.TextField;i.touchEnabled=!0,i.size=30,i.textColor=16777215,i.text="下一页",i.x=t.width-i.textWidth-60,i.y=t.height-i.textHeight>>1,t.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextPage,this),this.addChild(t)},e.prototype.createItems=function(){if(!this.isInited)return void egret.warn(" ListPanel 尚未初始化 ！");this.removeAllItems();for(var t,e=this.listArea,n=0,i=this.pageSize;i>n;n++)t=this.createItem(),e.addChild(t),t.x=e.width-t.width>>1,t.y=0==n?0:(t.height+this.vGap)*n,this.itemList.push(t)},e.prototype.updateByData=function(){this.pageIdx=0,this.updateCurrPage()},e.prototype.updateCurrPage=function(){for(var t,e=this.pageSize*this.pageIdx,n=e+this.pageSize-1,i=e;n>=i;i++)t=this.itemList[i-e],t.index=i,t.data=this.dataList[i]},e.prototype.removeAllItems=function(){for(var t;this.itemList.length>0;)t=this.itemList.pop(),t.onRemoved(),t.parent&&t.parent.removeChild(t)},e.prototype.onPrePage=function(t){egret.log(" onPrePage currPgIdx:"+this.pageIdx+"   pgCount:"+this.pageCount),this.pageIdx<=0||this.pageIdx--},e.prototype.onNextPage=function(t){egret.log(" onNextPage currPgIdx:"+this.pageIdx+"  pgCount:"+this.pageCount),this.pageIdx>=this.pageCount-1||this.pageIdx++},Object.defineProperty(e.prototype,"dataList",{get:function(){return this._dataList},set:function(t){this._dataList=t,this.updateByData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageIdx",{get:function(){return this._pageIdx},set:function(t){this._pageIdx=Math.max(0,Math.min(this.pageCount-1,t)),this.updateCurrPage()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageSize",{get:function(){return this._pageSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageCount",{get:function(){return Math.max(Math.ceil(this.dataList.length/this.pageSize),1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listHeight",{get:function(){return this.pageSize*(this.vGap+this.itemHeight)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInited",{get:function(){return this._isInited},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(ListPanel.prototype,"ListPanel");var MsgRouter=function(){function t(){this.handlerClassRefMap={}}return t.prototype.regMsgHandler=function(t,e){this.handlerClassRefMap[t]?LogUtil.warn("注意：开放域程序重复注册了一个消息："+t):this.handlerClassRefMap[t]=e},t.prototype.unregMsgHandler=function(t){this.handlerClassRefMap[t]&&delete this.handlerClassRefMap[t]},t.prototype.handleMsg=function(t){if(LogUtil.log("---- handleMsg: "+t.head),!t.head)return void LogUtil.warn("注意：开放域程序接收了一个没有 head 的消息："+t);var e=this.handlerClassRefMap[t.head];e?(new e).init(t.body).openAsync():LogUtil.warn("注意：开放域程序并未添加对 "+t.head+" 的消息处理~！")},t}();__reflect(MsgRouter.prototype,"MsgRouter");var DataKey=function(){function t(){}return t.SCORE="score",t.SCORE_MAX="score_max",t.SCORE_WEEK="score_week",t.SCORE_TIME="score_time",t}();__reflect(DataKey.prototype,"DataKey");var CommandGroup=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cmdList=[],e._currIdx=-1,e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=[]);var e,n;for(n=t.length,e=0;n>e;e++)this.add(t[e]);return this},e.prototype.add=function(t){return this._cmdList.indexOf(t)<0&&this._cmdList.push(t),this},e.prototype.remove=function(t){var e=this._cmdList.indexOf(t);return e>0&&this._cmdList.splice(e,1),this},e.prototype.execute=function(){this.executeNext()},e.prototype.executeNext=function(){if(null==this._cmdList[this._currIdx+1])return void this.closeAsync();this._currIdx++;var t=this._cmdList[this._currIdx];this._currCmd=t,t.addEventListener(Command.COMMAND_ABORT,this.onSingleCmdAbort,this),t.addEventListener(Command.COMMAND_COMPLETE,this.onSingleCmdComplete,this),t.autoRestore&&(t.autoRestore=!1),t.context=this.context,t.openAsync()},e.prototype.onSingleCmdAbort=function(t){this._currCmd.removeEventListener(Command.COMMAND_ABORT,this.onSingleCmdAbort,this),this._currCmd.removeEventListener(Command.COMMAND_COMPLETE,this.onSingleCmdComplete,this),this.closeAsync(!0)},e.prototype.onSingleCmdComplete=function(t){this._currCmd.removeEventListener(Command.COMMAND_ABORT,this.onSingleCmdAbort,this),this._currCmd.removeEventListener(Command.COMMAND_COMPLETE,this.onSingleCmdComplete,this),this._currIdx==this._cmdList.length-1?this.closeAsync():this.executeNext()},e.prototype.closeAsync=function(e){void 0===e&&(e=!1),t.prototype.closeAsync.call(this,e),this._currCmd&&(this._currCmd.removeEventListener(Command.COMMAND_ABORT,this.onSingleCmdAbort,this),this._currCmd.removeEventListener(Command.COMMAND_COMPLETE,this.onSingleCmdComplete,this)),this._currCmd=null,this._currIdx=-1},e.prototype.clear=function(t){void 0===t&&(t=!1);var e,n;for(n=this._cmdList.length,e=0;n>e;e++)this._cmdList[e].restore();this._cmdList.length=0},e}(Command);__reflect(CommandGroup.prototype,"CommandGroup"),window.CommandGroup=CommandGroup;var DelegateCommand=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=null),this._fun=t,this._argsArr=n,this._thisArg=e,this},e.prototype.execute=function(){null!=this._fun&&this._fun.apply(this._thisArg,this._argsArr),egret.log("finish DelegateCommand"),this.closeAsync()},e.prototype.clear=function(){this._fun=null,this._thisArg=null,this._argsArr=null},e}(Command);__reflect(DelegateCommand.prototype,"DelegateCommand"),window.DelegateCommand=DelegateCommand;var GlobalData=function(){function t(){if(t._instance)throw new Error("单利模式，别乱new~~")}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=(new t).init()),this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){return this.playerData={openId:"",nickName:""},this},t}();__reflect(GlobalData.prototype,"GlobalData");var ContextEventDispatcher=function(){function t(){}return t.prototype.addEventListener=function(e,n,i,r,a){t.eventDispatcher.addEventListener(e,n,i,r,a)},t.prototype.once=function(e,n,i,r,a){t.eventDispatcher.once(e,n,i,r,a)},t.prototype.removeEventListener=function(e,n,i,r){t.eventDispatcher.removeEventListener(e,n,i,r)},t.prototype.hasEventListener=function(e){return t.eventDispatcher.hasEventListener(e)},t.prototype.dispatchEvent=function(e){return t.eventDispatcher.dispatchEvent(e)},t.prototype.willTrigger=function(e){return t.eventDispatcher.willTrigger(e)},t.eventDispatcher=new egret.EventDispatcher,t}();__reflect(ContextEventDispatcher.prototype,"ContextEventDispatcher",["IEventDispatcher"]);var ContextEvent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.CLOSE_CONTEXT="ContextEvent_CLOSE_CONTEXT",e}(egret.Event);__reflect(ContextEvent.prototype,"ContextEvent");var WxOpenDataContextMsg=function(){function t(t,e){this.head=t,this.body=e}return t.INIT_DATA="WxOpenDataContextMsg_INIT_DATA",t.CLOSE_CONTEXT="WxOpenDataContextMsg_CLOSE",t.FRIEND_RANK_LIST="WxOpenDataContextMsg_FriendRankList",t.FRIEND_NEAREST_RANK_LIST="WxOpenDataContextMsg_FRIEND_NEAREST_RANK_LIST",t.GROUP_RANK_LIST="WxOpenDataContextMsg_GROUP_RANK_LIST",t.UPDATE_PLAYER_DATA="WxOpenDataContextMsg_UPDATE_PLAYER_DATA",t}();__reflect(WxOpenDataContextMsg.prototype,"WxOpenDataContextMsg");var LevelConfig=function(){function t(){}return t.prototype.attrs=function(){return["id","icon","lev","name","stars","baseStars","upStars","winRank1","winStar1","lostRank1","lostStar1","winRank2","winStar2","lostRank2","lostStar2","awards","nameColour"]},t.getLevelDataByStars=function(t){for(var e,n=GlobalData.instance.lvCfg,i=n.keys,r=i.length,a=0,o=0,s=r-1,h=!1;s>=o;){a=Math.floor((o+s)/2),e=n.get(a+1);var l=e.upStars,u=e.baseStars;if(l>=t&&t>=u){h=!0;break}t>l&&(o=a+1),u>t&&(s=a-1)}return h||(egret.error("没有找到对应的段位等级数据!"),1>t?e=n.get(1):t>999999&&(e=n.get(i[r-1]))),e},t}();__reflect(LevelConfig.prototype,"LevelConfig"),window.LevelConfig=LevelConfig;var Main=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),Object.defineProperty(e,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this;this.msgRouter=new MsgRouter,this.initRouter(),wx.onMessage(function(e){LogUtil.log(e),e.head&&t.msgRouter.handleMsg(e)})},e.prototype.test=function(){this.msgRouter.handleMsg(new WxOpenDataContextMsg(WxOpenDataContextMsg.FRIEND_RANK_LIST))},e.prototype.initRouter=function(){var t=this.msgRouter;t.regMsgHandler(WxOpenDataContextMsg.INIT_DATA,InitDataHandler),t.regMsgHandler(WxOpenDataContextMsg.CLOSE_CONTEXT,CloseContextHandler),t.regMsgHandler(WxOpenDataContextMsg.FRIEND_RANK_LIST,ShowFriendRankListHandler),t.regMsgHandler(WxOpenDataContextMsg.FRIEND_NEAREST_RANK_LIST,ShowFriendNearestRankListHandler),t.regMsgHandler(WxOpenDataContextMsg.GROUP_RANK_LIST,ShowGroupRankListHandler),t.regMsgHandler(WxOpenDataContextMsg.UPDATE_PLAYER_DATA,UpdatePlayerDataHandler)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var CloseContextHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){return this},e.prototype.execute=function(){var t=ContextEvent.create(ContextEvent,ContextEvent.CLOSE_CONTEXT);this.dispatchContextEvent(t),ContextEvent.release(t),this.closeAsync()},e.prototype.clear=function(){},e}(HandlerBase);__reflect(CloseContextHandler.prototype,"CloseContextHandler"),window.CloseContextHandler=CloseContextHandler;var InitDataHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){return this.data=t,this},e.prototype.execute=function(){this.globalData.resBaseUrl=this.data.resBaseUrl;var t=new Dictionary;t.setDatas(this.data.lvCfg),this.globalData.lvCfg=t,this.closeAsync()},e.prototype.clear=function(){this.data=null},e}(HandlerBase);__reflect(InitDataHandler.prototype,"InitDataHandler"),window.InitDataHandler=InitDataHandler;var UpdatePlayerDataHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){return this.data=t,this},e.prototype.execute=function(){this.globalData.playerData=this.data,this.closeAsync()},e.prototype.clear=function(){this.data=null},e}(HandlerBase);__reflect(UpdatePlayerDataHandler.prototype,"UpdatePlayerDataHandler"),window.UpdatePlayerDataHandler=UpdatePlayerDataHandler;var ViewManager=function(){function t(){this.openedViewList={}}return t.prototype.onOpenView=function(t){var e,n=getClassName(t);return this.openedViewList[n]?e=this.openedViewList[n]:(e=new t,this.openedViewList[n]=e),Main.stage.addChild(e),e},t.prototype.onCloseView=function(t){var e=getClassName(t),n=this.openedViewList[e];n&&n.parent&&(n.parent.removeChild(n),delete this.openedViewList[e]),LogUtil.log("开放域移除界面:"+e)},t.prototype.onCloseAllView=function(){var t;for(var e in this.openedViewList)t=this.openedViewList[e],t.parent.removeChild(t),delete this.openedViewList[e]},t}();__reflect(ViewManager.prototype,"ViewManager");var Img=function(t){function e(){var e=t.call(this)||this;return e.imgLoader=new egret.ImageLoader,e}return __extends(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(t){return this._url=t&&t.length>0?t:null,this._url?(this.imgLoader.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.imgLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this._isLoading=!0,void this.imgLoader.load(t)):void this.$setTexture(null)},enumerable:!0,configurable:!0}),e.prototype.onLoadComplete=function(t){this.imgLoader.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.imgLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this);var e=t.currentTarget,n=new egret.Texture;n._setBitmapData(e.data),this.$setTexture(n),this._isLoading=!1},e.prototype.onError=function(t){this.imgLoader.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.imgLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.$setTexture(null),this._isLoading=!1},Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),e}(egret.Bitmap);__reflect(Img.prototype,"Img");var Dictionary=function(){function t(){this.m_keys=[],this.m_values=[]}return t.prototype.setDatas=function(t){this.m_keys=t.m_keys,this.m_values=t.m_values},Object.defineProperty(t.prototype,"length",{get:function(){return this.m_keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this.m_values.concat()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){return this.m_keys.concat()},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){var n=this.indexOfKey(t);n>=0?this.m_values[n]=e:(this.m_keys.push(t),this.m_values.push(e))},t.prototype.keyOfValue=function(t){return this.m_keys[this.indexOfValue(t)]},t.prototype.indexOfKey=function(t){return this.m_keys.indexOf(t)},t.prototype.indexOfValue=function(t){return this.m_values.indexOf(t)},t.prototype.exist=function(t){return this.m_keys.indexOf(t)>=0},t.prototype.every=function(t,e){void 0===e&&(e=null);for(var n=this.keys.length,i=0;n>i;i++)if(e){if(!t.call(e,i,this.values[i]))break}else if(!t(i,this.values[i]))break},t.prototype.get=function(t){var e=this.indexOfKey(t);return e>=0?this.m_values[e]:null},t.prototype.remove=function(t){var e=this.indexOfKey(t);return e>=0?(this.m_keys.splice(e,1),this.m_values.splice(e,1)[0]):null},t.prototype.clear=function(){this.m_keys.length=0,this.m_values.length=0},t.create=function(){var e;return e=t.pool&&t.pool.length>0?t.pool.pop():new t},t.release=function(e){t.pool||(t.pool=[]),e.clear(),t.pool.push(e)},t}();__reflect(Dictionary.prototype,"Dictionary");var StarLevelComponent=function(t){function e(){var e=t.call(this)||this;e.starUrl="resource/openContext/rank/g-xing2.png",e.emptyUrl="resource/openContext/rank/g-xing1.png";var n=e.tf_levelName=new egret.TextField;n.size=32,n.bold=!0,e.addChild(n),e.imgStars=[];for(var i=0;5>i;i++){var r=new Img;e.imgStars.push(r),e.addChild(r)}var a=e.tf_moreStars=new egret.TextField;return a.size=32,a.bold=!0,e.addChild(a),e.height=50,e}return __extends(e,t),e.prototype.updateShow=function(){this.tf_levelName.text=this._levelCfg.name,this.tf_moreStars.textColor=this.tf_levelName.textColor=parseInt("0x"+this._levelCfg.nameColour,16),LogUtil.log("===== lvNameColor:"+this._levelCfg.nameColour+"   "+parseInt(this._levelCfg.nameColour,16));var t=this.level-this._levelCfg.baseStars;if(this.isLastLevel){this.tf_moreStars.visible=!0,this.tf_moreStars.text=(t+1).toString();for(var e=1;e<=this.imgStars.length;e++){var n=this.imgStars[e-1];1==e?n.url=this.starUrl:n.visible=!1}}else{var i=this._levelCfg.stars;this.tf_moreStars.visible=!1;for(var e=0;e<this.imgStars.length;e++){var n=this.imgStars[e];n.url=t>=e?this.starUrl:this.emptyUrl,n.visible=i>e}}this.updateLayout()},e.prototype.updateLayout=function(){var t=this.tf_levelName;t.x=0,t.y=this.height-t.textHeight>>1;for(var e=this.tf_levelName.x+this.tf_levelName.width+10,n=this.height-48>>1,i=0;i<this.imgStars.length;i++){var r=this.imgStars[i];r.x=e,r.y=n,e+=55}this.tf_moreStars.x=this.imgStars[1].x,this.tf_moreStars.y=t.y},Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t,this._levelCfg=LevelConfig.getLevelDataByStars(t),this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLastLevel",{get:function(){return this.level>=157},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(StarLevelComponent.prototype,"StarLevelComponent");var DateUtil=function(){function t(){var t=new Date;this.today=t,this.year=t.getFullYear(),this.Month_a=t.getMonth(),this.Month=this.Month_a+1,this.date=t.getDate(),this.day=0==t.getDay()?7:t.getDay()}return t.prototype.newToday=function(t){this.today=new Date(t),this.year=this.today.getFullYear(),this.Month_a=this.today.getMonth(),this.Month=this.Month_a+1,this.date=this.today.getDate(),this.day=0==this.today.getDay()?7:this.today.getDay(),this.Monday,this.Sunday,this.day_one},t.prototype.getMonday=function(){if(this.Monday)return this.Monday;var t=new Date(this.year,this.Month_a,this.date-this.day+1);return this.Monday=t,t},t.prototype.getSunday=function(){if(this.Sunday)return this.Sunday;var t=new Date(this.year,this.Month_a,this.date-this.day+7);return this.Sunday=t,t},t.prototype.getPreviousMonday=function(t){var e=new Date(t.getYear(),t.getMonth(),t.getDate()-7);return e},t.prototype.getPreviousSunday=function(t){var e=new Date(t.getYear(),t.getMonth(),t.getDate()-1);return this.Sunday=e,e},t.prototype.getNextMonday=function(t){var e=new Date(t.getYear(),t.getMonth(),t.getDate()+7);return e},t.prototype.getNextSunday=function(t){var e=new Date(t.getYear(),t.getMonth(),t.getDate()+13);return this.Sunday=e,e},t}();__reflect(DateUtil.prototype,"DateUtil");var LogUtil=function(){function t(){}return t.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.enableLog&&console.log.apply(console,["== OpenDataContext log == :",t].concat(e))},t.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.enableLog&&console.warn.apply(console,["== OpenDataContext log == :",t].concat(e))},t.enableLog=!0,t}();__reflect(LogUtil.prototype,"LogUtil");var NickNameFilter=function(){function t(){}return t.filter=function(t,e){return void 0===e&&(e=6),t.length>e?t.substr(0,e-1)+"...":t},t}();__reflect(NickNameFilter.prototype,"NickNameFilter");var ShowFriendNearestRankListHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){return this.addContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this),this},e.prototype.execute=function(){var t=this;LogUtil.log("ShowFriendNearestRankListHandler execute"),wx.getFriendCloudStorage({keyList:[DataKey.SCORE,DataKey.SCORE_MAX,DataKey.SCORE_WEEK,DataKey.SCORE_TIME],success:function(e){var n=e.data;if(n=kvList2KvSet(n),n.sort(function(t,e){return e.KVDataSet.score_week-t.KVDataSet.score_week}),LogUtil.log("success: "+JSON.stringify(n)),t.isOpened){var i=t.onOpenView(FriendNearestRankListPanel);i.dataList=n}else LogUtil.warn(" ShowFriendNearestRankListHandler is Closed")},fail:function(e){LogUtil.log("fail: "+e),t.isOpened||LogUtil.warn(" ShowFriendNearestRankListHandler is Closed")},complete:function(){t.isOpened||LogUtil.warn(" ShowFriendNearestRankListHandler is Closed")}})},e.prototype.onCloseContext=function(){this.closeView(FriendNearestRankListPanel),this.closeAsync()},e.prototype.clear=function(){this.removeContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this)},e}(HandlerBase);__reflect(ShowFriendNearestRankListHandler.prototype,"ShowFriendNearestRankListHandler"),window.ShowFriendNearestRankListHandler=ShowFriendNearestRankListHandler;var FriendNearestRankListItem=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this.imgSelfBg=new egret.Shape;t.graphics.beginFill(16369154),t.graphics.drawRect(0,0,e.WIDTH,e.HEIGHT),t.graphics.endFill(),this.addChild(this.imgSelfBg);var n=this.tfRank=new egret.TextField;n.size=28,n.textColor=4430750,this.addChild(n);var i=this.imgheadIcon=new Img;i.height=i.width=67,this.addChild(i);var r=this.tfName=new egret.TextField;r.textColor=4430750,r.size=18,this.addChild(r);var a=this.tfScore=new egret.TextField;a.textColor=4430750,a.size=28,a.bold=!0,this.addChild(a),this.visible=!1},e.prototype.onRemoved=function(){this.removeChildren(),this.imgheadIcon=this.tfName=this.tfRank=this.tfScore=this.imgSelfBg=null},e.prototype.onDataChanged=function(){if(!this.data)return void(this.visible=!1);var t=this.data.userData,e=this.data.rank,n=this.data.isSelf;this.imgheadIcon.url=t.avatarUrl,this.imgSelfBg.visible=n,this.tfScore.text=t.KVDataSet.score_week.toString(),this.tfRank.text=e.toString(),this.tfName.text=NickNameFilter.filter(t.nickname),this.updateLayout(),this.visible=!0},e.prototype.updateLayout=function(){this.tfRank.y=13,this.imgheadIcon.y=60,this.tfName.y=141,this.tfScore.y=165,this.setHCenter(this.imgheadIcon),this.tfScore.width=this.tfScore.textWidth,this.tfRank.width=this.tfRank.textWidth,this.tfName.width=this.tfName.textWidth,this.setHCenter(this.tfScore),this.setHCenter(this.tfRank),this.setHCenter(this.tfName)},e.prototype.setHCenter=function(t){t.x=e.WIDTH-t.width>>1},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.onDataChanged()},enumerable:!0,configurable:!0}),e.WIDTH=215,e.HEIGHT=208,e}(ListItem);__reflect(FriendNearestRankListItem.prototype,"FriendNearestRankListItem");var FriendNearestRankListPanel=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.width=655,this.height=212;var t=this.bg=new egret.Shape;t.graphics.beginFill(14939626),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill(),this.addChild(t),this.itemList=[];for(var e,n=5,i=this.height-FriendNearestRankListItem.HEIGHT>>1,r=0,a=3;a>r;r++)e=new FriendNearestRankListItem,this.itemList.push(e),e.x=r*(n+FriendNearestRankListItem.WIDTH),e.y=i,this.addChild(e);this.setPosistion()},e.prototype.setPosistion=function(){this.x=Main.stage.stageWidth-this.width>>1,this.y=Main.stage.stageHeight-this.height>>1},e.prototype.updateByData=function(){for(var t=this.getItemDatas(),e=0,n=this.itemList.length;n>e;e++)this.itemList[e].data=t[e]},e.prototype.getItemDatas=function(){for(var t,e=[],n=GlobalData.instance.playerData,i=0,r=this.dataList.length;r>i;i++)if(t=this.dataList[i],t.openid==n.openId){var a=!1,o=!1;i>0?e.push({isSelf:!1,rank:i,userData:this.dataList[i-1]}):a=!0,e.push({isSelf:!0,rank:i+1,userData:t}),r-1>i?e.push({isSelf:!1,rank:i+2,userData:this.dataList[i+1]}):o=!0,a&&r-2>i?e.push({isSelf:!1,rank:i+3,userData:this.dataList[i+2]}):e.push(null),o&&i>1?e.unshift({isSelf:!1,rank:i-1,userData:this.dataList[i-2]}):e.push(null);break}return e},Object.defineProperty(e.prototype,"dataList",{get:function(){return this._dataList},set:function(t){this._dataList=t,this.updateByData()},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(FriendNearestRankListPanel.prototype,"FriendNearestRankListPanel");var ShowFriendRankListHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){return this.addContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this),this},e.prototype.execute=function(){var t=this;LogUtil.log("ShowFriendRankListHandler execute"),wx.getFriendCloudStorage({keyList:[DataKey.SCORE,DataKey.SCORE_MAX,DataKey.SCORE_WEEK,DataKey.SCORE_TIME],success:function(e){var n=e.data;if(n=kvList2KvSet(n),n.sort(function(t,e){return e.KVDataSet.score_max-t.KVDataSet.score_max}),LogUtil.log("success: "+JSON.stringify(n)),t.isOpened){var i=t.onOpenView(FriendRankListPanel);i.dataList=n}else LogUtil.warn(" ShowFriendRankListHandler is Closed")},fail:function(e){LogUtil.log("fail: "+e),t.isOpened||LogUtil.warn(" ShowFriendRankListHandler is Closed")},complete:function(){t.isOpened||LogUtil.warn(" ShowFriendRankListHandler is Closed")}})},e.prototype.onCloseContext=function(){this.closeView(FriendRankListPanel),this.closeAsync()},e.prototype.clear=function(){this.removeContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this)},e}(HandlerBase);__reflect(ShowFriendRankListHandler.prototype,"ShowFriendRankListHandler"),window.ShowFriendRankListHandler=ShowFriendRankListHandler;var FriendRankListPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createItem=function(){return new RankListItem},Object.defineProperty(e.prototype,"itemHeight",{get:function(){return RankListItem.HEIGHT
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleText",{get:function(){return"好友排行"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataList",{get:function(){return this._dataList},set:function(t){this._dataList=t,this.updateByData()},enumerable:!0,configurable:!0}),e}(ListPanel);__reflect(FriendRankListPanel.prototype,"FriendRankListPanel"),window.FriendRankListPanel=FriendRankListPanel;var RankListItem=function(t){function e(){var e=t.call(this)||this;return e._isInit=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){this.width=e.WIDTH,this.height=e.HEIGHT;var t=this.bg=new egret.Shape;t.graphics.beginFill(16369154),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill(),this.addChild(t);var n=this.img_rank=new Img;n.height=100,n.width=73,n.x=35,n.y=this.height-n.height>>1,this.addChild(n);var i=this.tf_rank=new egret.TextField;i.size=32,i.textColor=4430750,i.x=35,i.y=this.height-i.size>>1,this.addChild(i);var r=this.img_head=new Img;r.height=r.width=72,r.x=140,r.y=this.height-r.height>>1,this.addChild(r);var a=this.tf_name=new egret.TextField;a.size=32,a.bold=!0,a.textColor=4430750,a.x=240,a.y=this.height-a.size>>1,this.addChild(a);var o=this.tf_score=new egret.TextField;o.size=42,o.textColor=4430750,o.x=700,o.y=this.height-o.size>>1,this.addChild(o);var s=this.starLevel=new StarLevelComponent;s.x=500,s.y=this.height-48>>1,this.addChild(s),this._isInit=!0},e.prototype.onDataChanged=function(){var t=this.data;if(t){this.bg.visible=t.openid==GlobalData.instance.playerData.openId,this.tf_name.text=NickNameFilter.filter(t.nickname);var e=this.index+1;3>=e?(this.tf_rank.visible=!1,this.img_rank.url="resource/openContext/rank/rank"+e+".png",this.img_rank.visible=!0):(this.tf_rank.visible=!0,this.img_rank.visible=!1,this.tf_rank.text=e.toString(),this.tf_rank.x=78-(this.tf_rank.width>>1));var n=t.KVDataSet.score_max||0;this.tf_score.text=n.toString(),this.tf_score.x=this.width-this.tf_score.width-50,this.img_head.url=t.avatarUrl,this.visible=!0}else this.visible=!1},e.prototype.onRemoved=function(){this.removeChildren(),this.bg=this.tf_rank=this.tf_name=this.tf_score=this.img_head=null,this._isInit=!1},Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.onDataChanged()},enumerable:!0,configurable:!0}),e.WIDTH=914,e.HEIGHT=90,e}(ListItem);__reflect(RankListItem.prototype,"RankListItem"),window.RankListItem=RankListItem;var ShowGroupRankListHandler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){return this.shareTicket=t,this.addContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this),this},e.prototype.execute=function(){var t=this;LogUtil.log("ShowGroupRankListHandler execute"),wx.getGroupCloudStorage({shareTicket:this.shareTicket,keyList:[DataKey.SCORE,DataKey.SCORE_MAX,DataKey.SCORE_WEEK,DataKey.SCORE_TIME],success:function(e){var n=e.data;if(n=kvList2KvSet(n),n.sort(function(t,e){return e.KVDataSet.score_week-t.KVDataSet.score_week}),LogUtil.log("success: "+JSON.stringify(n)),t.isOpened){var i=t.onOpenView(GroupRankListPanel);i.dataList=n}else LogUtil.warn(" ShowGroupRankListHandler is Closed")},fail:function(e){LogUtil.log("fail: "+e),t.isOpened||LogUtil.warn(" ShowGroupRankListHandler is Closed")},complete:function(){t.isOpened||LogUtil.warn(" ShowGroupRankListHandler is Closed")}})},e.prototype.onCloseContext=function(){this.closeView(FriendRankListPanel),this.closeAsync()},e.prototype.clear=function(){this.removeContextEvent(ContextEvent.CLOSE_CONTEXT,this.onCloseContext,this)},e}(HandlerBase);__reflect(ShowGroupRankListHandler.prototype,"ShowGroupRankListHandler"),window.ShowGroupRankListHandler=ShowGroupRankListHandler;var GroupRankListPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createItem=function(){return new RankListItem},Object.defineProperty(e.prototype,"itemHeight",{get:function(){return RankListItem.HEIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleText",{get:function(){return"群排行"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataList",{get:function(){return this._dataList},set:function(t){this._dataList=t,this.updateByData()},enumerable:!0,configurable:!0}),e}(ListPanel);__reflect(GroupRankListPanel.prototype,"GroupRankListPanel"),window.GroupRankListPanel=GroupRankListPanel,window.Main=Main;