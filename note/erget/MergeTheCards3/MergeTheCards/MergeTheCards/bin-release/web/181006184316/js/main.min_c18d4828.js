function create(t){return VL.ObjectCache.CacheableClass.create(t)}function getClassName(t){return app.reflector.getClassName(t)}function getClass(t){return app.reflector.getClass(t)}function getClassByEntity(t){return app.reflector.getClassByEntity(t)}function isExtends(t,e){return app.reflector.isExtends(t,e)}var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},App;!function(t){var e=function(t){function e(e,n){var r=t.call(this)||this;return r._isOpened=!1,r._isInited=!1,r.dg_inited=new VL.Delegate,r.skinName=e,r.myParent=n,r}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.init()},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.resources.length>0?[4,this.loadRes()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.onInit(),this._isInited=!0,this.dg_inited.boardcast(),[2]}})})},e.prototype.loadRes=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){app.resManager.loadResTask({keys:t.resources,taskName:getClassName(t),onComplete:function(t){e()}})})]})})},e.prototype.open=function(t){void 0===t&&(t=null),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this),this.addEventListener(egret.Event.RESIZE,this.onResize,this),this.updateLayout(),this.addToParent(),this._isOpened=!0},e.prototype.close=function(t){void 0===t&&(t=null),this.removeFromParent(),this._isOpened=!1,StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.onResize,this),this.removeEventListener(egret.Event.RESIZE,this.onResize,this)},e.prototype.onResize=function(t){this.updateLayout()},e.prototype.updateLayout=function(){this.width=StageUtils.getStageWidth(),this.height=StageUtils.getStageHeight()},e.prototype.addToParent=function(){this._myParent.addChild(this)},e.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.destroy=function(){this.onDestroy(),this.removeFromParent(),this._isInited=!1},Object.defineProperty(e.prototype,"myParent",{get:function(){return this._myParent},set:function(t){this._myParent=t,this.isOpened&&this.addToParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInited",{get:function(){return this._isInited},enumerable:!0,configurable:!0}),e}(eui.Component);t.BaseEuiView=e,__reflect(e.prototype,"App.BaseEuiView",["App.IBaseView","IBaseComponent"])}(App||(App={}));var VoyaMVC;!function(t){var e=function(){function t(){this._map={}}return t.prototype.getEvent=function(t){var e=getClassName(t);return this._map[e]||(this._map[e]=new t),this._map[e]},t}();__reflect(e.prototype,"EventMap",["VoyaMVC.IEventMap"]);var n=function(){function t(){this._map={}}return t.prototype.getModel=function(t){var e=getClassName(t);return this._map[e]||(this._map[e]=new t),this._map[e]},t}();__reflect(n.prototype,"ModelMap",["VoyaMVC.IModelMap"]);var r=function(){function t(){this._map={}}return t.prototype.registerMediator=function(t){var e=this._map[getClassName(t)];e&&e.deactivate(),this._map[getClassName(t)]=t,t.activate()},t.prototype.removeMediator=function(t){t.deactivate(),delete this._map[getClassName(t)]},t.prototype.getMediator=function(t){return this._map[getClassName(t)]},t}();__reflect(r.prototype,"MediatorMap",["VoyaMVC.IMediatorMap"]);var i=function(){function t(){this._map={}}return t.prototype.registerController=function(t){var e=this._map[getClassName(t)];e&&e.deactivate(),this._map[getClassName(t)]=t,t.activate()},t.prototype.removeController=function(t){t.deactivate(),delete this._map[getClassName(t)]},t}();__reflect(i.prototype,"ControllerMap",["VoyaMVC.IControllerMap"]);var o=function(){function o(){if(o._instance)throw new Error("单利模式，别乱new");this._controllerMap=new i,this._mediatorMap=new r,this._modelMap=new n,this._eventMap=new e,this._msgSender=new t.MsgSender}return Object.defineProperty(o,"instance",{get:function(){return this._instance||(this._instance=new o),this._instance},enumerable:!0,configurable:!0}),o.prototype.sendMsg=function(t){this._msgSender.sendMsg(t)},o.prototype.regMsg=function(t,e,n,r){void 0===r&&(r=!1),this._msgSender.regMsg(t,e,n,r)},o.prototype.unregMsg=function(t,e,n){this._msgSender.unregMsg(t,e,n)},o.prototype.existMsgHandler=function(t,e,n){return this._msgSender.existMsgHandler(t,e,n)},o.prototype.getModel=function(t){return this._modelMap.getModel(t)},o.prototype.getEvent=function(t){return this._eventMap.getEvent(t)},o.prototype.registerMediator=function(t){this._mediatorMap.registerMediator(t)},o.prototype.removeMediator=function(t){this._mediatorMap.removeMediator(t)},o.prototype.getMediator=function(t){return this._mediatorMap.getMediator(t)},o.prototype.registerController=function(t){this._controllerMap.registerController(t)},o.prototype.removeController=function(t){this._controllerMap.removeController(t)},o}();__reflect(o.prototype,"MvcCore",["VoyaMVC.IModelMap","VoyaMVC.IEventMap","VoyaMVC.IMediatorMap","VoyaMVC.IControllerMap","VoyaMVC.IMsgSender"]);var a=function(){function t(){}return t.prototype.sendMsg=function(t){o.instance.sendMsg(t)},t}();t.Model=a,__reflect(a.prototype,"VoyaMVC.Model",["VoyaMVC.IModel"]);var s=function(){function t(){}return t.prototype.getModel=function(t){return o.instance.getModel(t)},t.prototype.getEvent=function(t){return o.instance.getEvent(t)},t.prototype.sendMsg=function(t){o.instance.sendMsg(t)},t.prototype.regMsg=function(t,e,n,r){void 0===r&&(r=!1),o.instance.regMsg(t,e,n,r)},t.prototype.unregMsg=function(t,e,n){o.instance.unregMsg(t,e,n)},t.prototype.existMsgHandler=function(t,e,n){return o.instance.existMsgHandler(t,e,n)},t}();t.Mediator=s,__reflect(s.prototype,"VoyaMVC.Mediator",["VoyaMVC.IMediator"]);var u=function(){function t(){}return t.prototype.registerMediator=function(t){o.instance.registerMediator(t)},t.prototype.removeMediator=function(t){o.instance.removeMediator(t)},t.prototype.getMediator=function(t){return o.instance.getMediator(t)},t.prototype.getModel=function(t){return o.instance.getModel(t)},t.prototype.getEvent=function(t){return o.instance.getEvent(t)},t.prototype.sendMsg=function(t){o.instance.sendMsg(t)},t.prototype.regMsg=function(t,e,n,r){void 0===r&&(r=!1),o.instance.regMsg(t,e,n,r)},t.prototype.unregMsg=function(t,e,n){o.instance.unregMsg(t,e,n)},t.prototype.existMsgHandler=function(t,e,n){return o.instance.existMsgHandler(t,e,n)},t.prototype.registerController=function(t){o.instance.registerController(t)},t.prototype.removeController=function(t){o.instance.removeController(t)},t}();t.Controller=u,__reflect(u.prototype,"VoyaMVC.Controller",["VoyaMVC.IController"]);var c=function(){function t(){}return Object.defineProperty(t.prototype,"core",{get:function(){return o.instance},enumerable:!0,configurable:!0}),t.prototype.configure=function(t){for(var e,n=0,r=t.length;r>n;n++)e=t[n],e.mediatorList&&e.mediatorList.length>0&&this.regMediators(e.mediatorList),e.handlerList&&e.handlerList.length>0&&this.regControllers(e.handlerList)},t.prototype.regMediators=function(t){for(var e,n=0,r=t.length;r>n;n++)e=t[n],o.instance.registerMediator(e)},t.prototype.regControllers=function(t){for(var e,n=0,r=t.length;r>n;n++)e=t[n],o.instance.registerController(e)},t.prototype.regMediator=function(t){o.instance.registerMediator(t)},t.prototype.regController=function(t){o.instance.registerController(t)},t}();t.MVC=c,__reflect(c.prototype,"VoyaMVC.MVC")}(VoyaMVC||(VoyaMVC={}));var App;!function(t){var e=function(e){function n(n,r){return void 0===r&&(r=t.GameLayers.UI_Main),e.call(this,n,r)||this}return __extends(n,e),n.prototype.onInit=function(){this.initScaleMode()},n.prototype.initScaleMode=function(){this.contentScaleMode=VL.ScaleMode.SHOW_ALL_FILL,this.bgScaleMode=VL.ScaleMode.NO_BORDER},n.prototype.updateLayout=function(){e.prototype.updateLayout.call(this),this.grp_content&&this.contentScaleMode&&this.contentScaleMode.adapt(this.grp_content,this),this.bgScaleMode&&this.img_bg&&this.bgScaleMode.adapt(this.img_bg,this)},n}(t.BaseEuiView);t.BaseAutoSizeView=e,__reflect(e.prototype,"App.BaseAutoSizeView")}(App||(App={}));var ViewMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.regMsg(SystemMsg.CloseAllViews,this.onCloseAllViews,this),this.regMsg(this.openViewMsg,this.onOpenViewHandler,this),this.regMsg(this.closeViewMsg,this.onCloseViewHandler,this)},e.prototype.deactivate=function(){this.unregMsg(SystemMsg.CloseAllViews,this.onCloseAllViews,this),this.unregMsg(this.openViewMsg,this.onOpenViewHandler,this),this.unregMsg(this.closeViewMsg,this.onCloseViewHandler,this)},e.prototype.onCloseAllViews=function(t){this.closeView()},e.prototype.onOpenViewHandler=function(t){this.openView(t.body)},e.prototype.onCloseViewHandler=function(t){this.closeView(t.body)},e.prototype.openView=function(t){var e=this;void 0===t&&(t=null),this.view||(this.view=new this.viewClass);var n=this.view,r=function(){e.view.dg_inited.unregister(r),e.onViewOpen(t),app.easyLoadingManager.remove(e.easyLoadingCaseId)};n.isInited?(n.open(t),this.onViewOpen(t)):(this.easyLoadingCaseId=app.easyLoadingManager.add(getClassName(this.viewClass)),n.dg_inited.register(r,this),n.open(t))},e.prototype.closeView=function(t){void 0===t&&(t=null),this.view&&this.view.isOpened&&(this.onViewClose(),this.view.close(t))},Object.defineProperty(e.prototype,"isViewInited",{get:function(){return this.view.isInited},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewClassName",{get:function(){return getClassName(this.viewClass)},enumerable:!0,configurable:!0}),e}(VoyaMVC.Mediator);__reflect(ViewMediator.prototype,"ViewMediator");var VL;!function(t){var e;!function(e){var n=function(){function e(e){this._enableDrop=!0,this._isMoveOver=!1,this.dg_onDragIn=new t.Delegate,this.dg_onDragOut=new t.Delegate,this.container=e}return e.prototype.onDragBegin=function(t){this._targetDragItem=t,this.enableDrop&&this.checkEnableDrop(t)&&this.waitForDrop(t)},e.prototype.onDragEnd=function(t){t&&(this.isWaitingForDrop&&this.isMoveOver&&this.container.dg_onDropIn.boardcast({container:this.container,dragItem:t}),this._isMoveOver=!1,this.cancelWait(),this._targetDragItem=null)},e.prototype.waitForDrop=function(t){t&&!this.isWaitingForDrop&&this.isContainerOf(t)&&(this._isWaitingForDrop=!0,StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this))},e.prototype.cancelWait=function(){this.isWaitingForDrop&&(this._isWaitingForDrop=!1,StageUtils.getStage().removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this))},e.prototype.onTouchMove=function(t){!this.isMoveOver&&this.container.checkHover(t.target)?this.onDragIn():this.isMoveOver&&!this.container.checkHover(t.target)&&this.onDragOut()},e.prototype.isContainerOf=function(t){return egret.is(t,getClassName(this.tarDragItemClass))},e.prototype.onDragIn=function(){this._isMoveOver=!0,this.dg_onDragIn.boardcast(this.container)},e.prototype.onDragOut=function(){this._isMoveOver=!1,this.dg_onDragOut.boardcast(this.container)},Object.defineProperty(e.prototype,"container",{get:function(){return this._container},set:function(t){this._container!=t&&(this._container=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMoveOver",{get:function(){return this._isMoveOver},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWaitingForDrop",{get:function(){return this._isWaitingForDrop&&this.enableDrop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableDrop",{get:function(){return this._enableDrop},set:function(t){this._enableDrop!=t&&(this._enableDrop=t,t?this.waitForDrop(this._targetDragItem):this.cancelWait())},enumerable:!0,configurable:!0}),e}();e.DropContainerCtrlBase=n,__reflect(n.prototype,"VL.DragDrop.DropContainerCtrlBase",["VL.DragDrop.IDropContainerCtrl"])}(e=t.DragDrop||(t.DragDrop={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function e(){}return e.create=function(t){var e=getClassName(t),n=this._objPoolDic[e];return n&&n.length>0?n.take():new t},e.prototype.restore=function(t){void 0===t&&(t=Number.MAX_VALUE),restore(this,t)},e.restore=function(n,r){void 0===r&&(r=Number.MAX_VALUE),n.clear();var i=getClassName(n),o=e._objPoolDic[i];o||(o=e._objPoolDic[i]=new t.ObjectPool(getClassByEntity(n))),o.maxLength=r,o.restore(n)},e._objPoolDic={},e}();t.CacheableClass=e,__reflect(e.prototype,"VL.ObjectCache.CacheableClass",["VL.ObjectCache.ICacheable"])}(e=t.ObjectCache||(t.ObjectCache={}))}(VL||(VL={}));var restore=VL.ObjectCache.CacheableClass.restore,ShareCanvasMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){this.initContent();var t=this.view;EventHelper.addTapEvent(t.btn_back,this.onBack,this)},e.prototype.onViewClose=function(){this.clearCanvas(),this.clearContent();var t=this.view;EventHelper.removeTapEvent(t.btn_back,this.onBack,this)},e.prototype.initContent=function(){var t=this.view,e=this.bitmapdata=new egret.BitmapData(window.sharedCanvas);e.$deleteSource=!1;var n=new egret.Texture;n._setBitmapData(e),this.bitmap=new egret.Bitmap(n),this.bitmap.width=t.width,this.bitmap.height=t.height,app.log(" ========= Bmp: X:"+this.bitmap.x+", Y:"+this.bitmap.y+", W:"+this.bitmap.width+", H:"+this.bitmap.height),t.grp_canvasLayer.addChild(this.bitmap),egret.startTick(this.onTick,this)},e.prototype.clearContent=function(){egret.stopTick(this.onTick,this);var t=this.view;t.grp_canvasLayer.removeChildren(),this.bitmapdata.$dispose(),this.bitmapdata=null,this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),this.bitmap=null},e.prototype.onTick=function(t){var e=this.bitmapdata;egret.WebGLUtils.deleteWebGLTexture(e.webGLTexture),e.webGLTexture=null;var n=this.view;return this.bitmap.width=n.width,this.bitmap.height=n.height,!1},e.prototype.clearCanvas=function(){this.sendMsg(create(WxSdkMsg.SendOpenDataContextCmd).init({head:WxOpenDataContextMsg.CLOSE_CONTEXT}))},e}(ViewMediator);__reflect(ShareCanvasMediator.prototype,"ShareCanvasMediator");var App;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.scrollRect=egret.Rectangle.create(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdd,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.onAdd=function(){StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)},e.prototype.onRemove=function(){StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this)},e.prototype.updateLayout=function(t){var e=t.target;this.width=e.width,this.height=e.height,this.scrollRect.setTo(0,0,this.width,this.height)},e}(egret.DisplayObjectContainer);t.BaseSpriteLayer=e,__reflect(e.prototype,"App.BaseSpriteLayer",["App.IGameLayer"])}(App||(App={}));var App;!function(t){var e=function(e){function n(n,r,i,o,a,s){void 0===r&&(r=t.GameLayers.UI_Popup),void 0===i&&(i=!0),void 0===o&&(o=!0),void 0===a&&(a=!0),void 0===s&&(s=!0);var u=e.call(this,n,r)||this;return u._isMask=!1,u._uiMask=null,u._maskAlpha=.5,u.dg_onMaskTap=new VL.Delegate,u._centerH=a,u._centerV=s,u._isMask=i,i&&u.initMask(o),u}return __extends(n,e),n.prototype.updateLayout=function(){this._centerH&&(this.x=StageUtils.getStageWidth()-this.width>>1),this._centerV&&(this.y=StageUtils.getStageHeight()-this.height>>1),this.updateMask()},n.prototype.initMask=function(t){this.cleanUiMask(),this._uiMask=new egret.Sprite,this._uiMask.touchEnabled=t,this._uiMask.touchChildren=!1},n.prototype.updateMask=function(){if(this._isMask){var t=this._uiMask.graphics;t.clear(),t.beginFill(0,1),t.drawRect(0,0,StageUtils.getStageWidth(),StageUtils.getStageHeight()),t.endFill(),this.setMaskAlpha(this._maskAlpha),this._uiMask.parent!=this.myParent&&this.myParent.addChildAt(this._uiMask,this.myParent.getChildIndex(this))}},n.prototype.setMaskAlpha=function(t){var e=this;null!=e._uiMask&&(e._maskAlpha=t,e._uiMask.alpha=e._maskAlpha)},n.prototype.cleanUiMask=function(){var t=this;t._uiMask&&(t._uiMask.parent&&t._uiMask.parent.removeChild(t._uiMask),t._uiMask.graphics.clear(),t._uiMask=null)},n.prototype.open=function(t){void 0===t&&(t=null),e.prototype.open.call(this),this._isMask&&this._uiMask&&(this._uiMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskTap,this),this.updateMask())},n.prototype.close=function(t){void 0===t&&(t=null),e.prototype.close.call(this),this._isMask&&this._uiMask.parent&&(this._uiMask.parent.removeChild(this._uiMask),this._uiMask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskTap,this))},n.prototype.onMaskTap=function(t){this.dg_onMaskTap.boardcast()},n.prototype.destroy=function(){e.prototype.destroy.call(this),this.cleanUiMask()},n}(t.BaseEuiView);t.BaseWindow=e,__reflect(e.prototype,"App.BaseWindow")}(App||(App={}));var DropCardContainerCtrl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"tarDragItemClass",{get:function(){return Card},enumerable:!0,configurable:!0}),e}(VL.DragDrop.DropContainerCtrlBase);__reflect(DropCardContainerCtrl.prototype,"DropCardContainerCtrl");var SceneMediator=function(t){function e(){var e=t.call(this)||this;return e._scene=e.createScene(),e}return __extends(e,t),e.prototype.activate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.regMsg(SystemMsg.EnterScene,this.onEnterScene,this)},e.prototype.deactivate=function(){this.unregMsg(SystemMsg.EnterScene,this.onEnterScene,this)},e.prototype.onEnterScene=function(t){this.exit(),t.body.scene==getClassByEntity(this.scene)&&this.enter()},e.prototype.enter=function(){this.scene.enter()},e.prototype.exit=function(){this.sendMsg(create(SystemMsg.CloseAllViews).init({closeSystemView:!1})),this.scene.exit()},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),e}(VoyaMVC.Mediator);__reflect(SceneMediator.prototype,"SceneMediator");var App;!function(t){var e=function(){function e(){this._loginTs_ms=0,this._serverTs_ms=0,this.respChecker=new t.AppHttpRespChecker}return e.prototype.init=function(t,e,n,r,i){return void 0===i&&(i=1),this.http=t,this.httpServer=n,this.httpServerPort=r,this.clientVersion=e,this.gameId=i,this},Object.defineProperty(e.prototype,"serverTimestamp",{set:function(t){this._loginTs_ms=egret.getTimer(),this._serverTs_ms=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverTs_s",{get:function(){return this._serverTs_ms+Math.floor(.001*(egret.getTimer()-this._loginTs_ms))},enumerable:!0,configurable:!0}),e.prototype.createReqPack=function(t,e){t=this.ensurePackData(t);var n={"Content-Type":"application/x-www-form-urlencoded"};return create(VL.Net.HttpReqPack).init(this.httpServer,this.httpServerPort,egret.HttpMethod.POST,t,e,n)},e.prototype.ensurePackData=function(t){return t?(this.token&&(t.token=this.token),t.version=this.clientVersion,t.game_id=this.gameId,t.timestamp=this.serverTs_s,t.sig=(new Utils.md5).hex_md5(this.token+this.serverTs_s),t):void 0},e.prototype.sendHttp=function(t,e,n,r){return __awaiter(this,void 0,void 0,function(){var i,o=this;return __generator(this,function(a){switch(a.label){case 0:return i=function(t,n){var r=JSON.parse(t);e&&o.respChecker.check(r).pass&&e(r.data,n)},[4,this.http.send(this.createReqPack(t,r),i,n)];case 1:return[2,a.sent()]}})})},e}();t.AppHttpBase=e,__reflect(e.prototype,"App.AppHttpBase")}(App||(App={}));var App;!function(t){var e=function(t){function e(e,n){void 0===e&&(e=!0),void 0===n&&(n=!1);var r=t.call(this)||this;return r.touchEnabled=n,r.touchChildren=e,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAdd,r),r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemove,r),r}return __extends(e,t),e.prototype.onAdd=function(){StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)},e.prototype.onRemove=function(){StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this)},e.prototype.updateLayout=function(t){var e=t.target;this.width=e.width,this.height=e.height},e}(eui.UILayer);t.BaseEuiLayer=e,__reflect(e.prototype,"App.BaseEuiLayer",["App.IGameLayer"])}(App||(App={}));var ShareCanvasView=function(t){function e(){return t.call(this,"ShareCanvasViewSkin")||this}return __extends(e,t),e.prototype.onInit=function(){t.prototype.onInit.call(this),this.rect_bg.touchEnabled=!0},e}(App.BaseAutoSizeView);__reflect(ShareCanvasView.prototype,"ShareCanvasView");var VL;!function(t){var e;!function(e){var n=function(e){function n(){var n=e.call(this)||this;return n._autoRestore=!0,n._isOpened=!1,n.dg_commandCompleted=new t.Delegate,n}return __extends(n,e),n.prototype.openAsync=function(){this._isOpened||(this._isOpened=!0,this.execute())},n.prototype.closeAsync=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this._isOpened&&(this.clear(),this._isOpened=!1,this.dg_commandCompleted.boardcast({isAbort:t,isRecursion:e}),this.autoRestore&&this.restore())},n.prototype.run=function(){this.openAsync(),this.closeAsync()},Object.defineProperty(n.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoRestore",{get:function(){return this._autoRestore},set:function(t){this._autoRestore=t},enumerable:!0,configurable:!0}),n}(t.ObjectCache.CacheableClass);e.Command=n,__reflect(n.prototype,"VL.Command.Command",["VL.Command.ICommand"])}(e=t.Command||(t.Command={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(){function e(e){this._enableDrag=!1,this.dg_DragBegin=new t.Delegate,this.dg_DragEnd=new t.Delegate,this.dragItem=e}return e.prototype.addEvent=function(){this._dragItem.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.removeEvent=function(){this._dragItem.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.onTouchBegin=function(t){this.startDrag(t.localX,t.localY,t.stageX,t.stageY)},e.prototype.startDrag=function(t,e,n,r){var i=this._dragItem;this.backupBeforeDrag(),this._offsetX=t,this._offsetY=e;var o=StageUtils.getStage();o.addChild(i),i.x=n-t,i.y=r-e,i.touchEnabled=!1,o.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),o.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancel,this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this._isDragging=!0,this.dg_DragBegin.boardcast(this.dragItem)},e.prototype.stopDrag=function(){var t=this._dragItem;this._offsetX=null,this._offsetY=null;var e=StageUtils.getStage();e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchCancel,this),e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this._isDragging=!1,t.touchEnabled=!0,this.dg_DragEnd.boardcast(this.dragItem)},e.prototype.onTouchMove=function(t){var e=this._dragItem;e.x=t.stageX-this._offsetX,e.y=t.stageY-this._offsetY},e.prototype.onTouchCancel=function(t){this.stopDrag()},e.prototype.onDropTo=function(t){t?this.onDropSecceed(t):this.onDropFaild()},e.prototype.onDropFaild=function(){this.rollBackBeforDrag()},Object.defineProperty(e.prototype,"dragItem",{get:function(){return this._dragItem},set:function(t){this._dragItem!=t&&(this.isDragging&&this.stopDrag(),this._dragItem=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._isDragging},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableDrag",{get:function(){return this._enableDrag},set:function(t){this.enableDrag!=t&&(this.removeEvent(),this._enableDrag=t,t?this.addEvent():this.stopDrag())},enumerable:!0,configurable:!0}),e}();e.DragItemCtrlBase=n,__reflect(n.prototype,"VL.DragDrop.DragItemCtrlBase",["VL.DragDrop.IDragItemCtrl"])}(e=t.DragDrop||(t.DragDrop={}))}(VL||(VL={}));var App;!function(t){var e=function(){function t(){this.dg_checkHttpResp=new VL.Delegate}return t.prototype.check=function(t){var e=this.onCheck(t);return this.dg_checkHttpResp.boardcast(e),e},t}();t.HttpRespChecker=e,__reflect(e.prototype,"App.HttpRespChecker")}(App||(App={}));var VL;!function(t){var e;!function(t){function e(t){return Math.PI/180*t}function n(t){return 180/Math.PI*t}function r(t,e,n,r,i,o){return t>=n&&i>=t&&e>=r&&o>=e}function i(t,e){for(var n=!1,r=0,i=t.length,o=i-1;i>r;o=r++)t[r].y>e.y!=t[o].y>e.y&&e.x<(t[o].x-t[r].x)*(e.y-t[r].y)/(t[o].y-t[r].y)+t[r].x&&(n=!n);return n}t.degree2Radian=e,t.radian2Degree=n,t.isPointInRect=r,t.isPolygonContainsPoint=i}(e=t.Geom||(t.Geom={}))}(VL||(VL={}));var App;!function(t){var e=function(){function e(){this._layers=[]}return e.prototype.addLayers=function(){this.addLayer(t.GameLayers.Game_Bg),this.addLayer(t.GameLayers.Game_Main),this.addLayer(t.GameLayers.UI_Main),this.addLayer(t.GameLayers.UI_Popup),this.addLayer(t.GameLayers.UI_Guide),this.addLayer(t.GameLayers.UI_Message),this.addLayer(t.GameLayers.UI_Tips),this.addLayer(t.GameLayers.UI_Top)},e.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addLayers()},e.prototype.exit=function(){this.removeAllLayer()},e.prototype.addLayer=function(t){var e=StageUtils.getStage();e.addChild(t),this._layers.push(t),t.width=t.parent.width,t.height=t.parent.height},e.prototype.addLayerAt=function(t,e){StageUtils.getStage().addChildAt(t,e),this._layers.push(t),t.width=t.parent.width,t.height=t.parent.height},e.prototype.removeLayer=function(t){StageUtils.getStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1)},e.prototype.layerRemoveAllChildren=function(t){t.removeChildren()},e.prototype.removeAllLayer=function(){for(;this._layers.length;){var t=this._layers[0];this.layerRemoveAllChildren(t),this.removeLayer(t)}},e}();t.BaseScene=e,__reflect(e.prototype,"App.BaseScene")}(App||(App={}));var VL;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===e&&(e=Number.MAX_VALUE),this._objClass=t,this._objs=[],this.maxLength=e}return t.prototype.take=function(){var t,e=this._objs;return t=e&&e.length>0?e.pop():new this._objClass},t.prototype.restore=function(t){return null==t?!1:this._objs.length<this._maxLength?(this._objs.push(t),!0):!1},t.prototype.clear=function(){this._objs.length=0},Object.defineProperty(t.prototype,"length",{get:function(){return this._objs.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLength",{get:function(){return this._maxLength},set:function(t){t!=this._maxLength&&(this._maxLength=t,this._objs.length>t&&(this._objs.length=t))},enumerable:!0,configurable:!0}),t}();t.ObjectPool=e,__reflect(e.prototype,"VL.ObjectCache.ObjectPool")}(e=t.ObjectCache||(t.ObjectCache={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.ObjectCache.CacheableClass);e.SoundBase=n,__reflect(n.prototype,"VL.Sound.SoundBase")}(e=t.Sound||(t.Sound={}))}(VL||(VL={}));var VoyaMVC;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){return void 0===t&&(t=void 0),null!=t&&void 0!=t&&(this._body=t),this},Object.defineProperty(e.prototype,"body",{get:function(){return this._body},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._body=null},e}(VL.ObjectCache.CacheableClass);t.Msg=e,__reflect(e.prototype,"VoyaMVC.Msg",["VoyaMVC.IMsg"])}(VoyaMVC||(VoyaMVC={}));var VoyaMVC;!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"mediatorList",{get:function(){return this._mediatorList||(this._mediatorList=this.getMediatorList()),this._mediatorList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"handlerList",{get:function(){return this._handlerList||(this._handlerList=this.getControllerList()),this._handlerList},enumerable:!0,configurable:!0}),t}();t.MvcConfigBase=e,__reflect(e.prototype,"VoyaMVC.MvcConfigBase",["VoyaMVC.IMvcConfig"])}(VoyaMVC||(VoyaMVC={}));var SystemMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.EnterScene=e,__reflect(e.prototype,"SystemMsg.EnterScene");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseAllViews=n,__reflect(n.prototype,"SystemMsg.CloseAllViews");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.APP_ACTIVE_CHANGED=r,__reflect(r.prototype,"SystemMsg.APP_ACTIVE_CHANGED")}(SystemMsg||(SystemMsg={})),window.hasOwnProperty("wx")&&(wx.WxAdErrorMap={0:{code:0,desc:"观看视频次数用尽",reason:"观看视频次数用尽",solution:"次日恢复"},1e3:{code:1e3,desc:"后端错误调用失败",reason:"该项错误不是开发者的异常情况",solution:"一般情况下忽略一段时间即可恢复。"},1001:{code:1001,desc:"参数错误",reason:"使用方法错误",solution:"可以前往developers.weixin.qq.com确认具体教程（小程序和小游戏分别有各自的教程，可以在顶部选项中，“设计”一栏的右侧进行切换。"},1002:{code:1002,desc:"广告单元无效",reason:"可能是拼写错误、或者误用了其他APP的广告ID",solution:"请重新前往mp.weixin.qq.com确认广告位ID。"},1003:{code:1003,desc:"内部错误",reason:"该项错误不是开发者的异常情况",solution:"一般情况下忽略一段时间即可恢复。"},1004:{code:1004,desc:"无适合的广告",reason:"广告不是每一次都会出现，这次没有出现可能是由于该用户不适合浏览广告",solution:"属于正常情况，且开发者需要针对这种情况做形态上的兼容。"},1005:{code:1005,desc:"广告组件审核中",reason:"你的广告正在被审核，无法展现广告",solution:"请前往mp.weixin.qq.com确认审核状态，且开发者需要针对这种情况做形态上的兼容。"},1006:{code:1006,desc:"广告组件被驳回",reason:"你的广告审核失败，无法展现广告",solution:"请前往mp.weixin.qq.com确认审核状态，且开发者需要针对这种情况做形态上的兼容。"},1007:{code:1007,desc:"广告组件被驳回",reason:"你的广告能力已经被封禁，封禁期间无法展现广告",solution:"请前往mp.weixin.qq.com确认小程序广告封禁状态。"},1008:{code:1008,desc:"广告单元已关闭",reason:"该广告位的广告能力已经被关闭",solution:"请前往mp.weixin.qq.com重新打开对应广告位的展现。"}});var App;!function(t){var e=function(){function t(){}return t.prototype.addTapEvent=function(t,e,n){t.addEventListener(egret.TouchEvent.TOUCH_TAP,e,n)},t.prototype.removeTapEvent=function(t,e,n){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,n)},t}();t.EventHelper=e,__reflect(e.prototype,"App.EventHelper")
}(App||(App={}));var EventHelper=new App.EventHelper,AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var isPolygonContainsPoint=VL.Geom.isPolygonContainsPoint,Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o,a;return __generator(this,function(s){for(t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},e=new AssetAdapter,egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),n=this.ps=[egret.Point.create(300,300),egret.Point.create(600,300),egret.Point.create(500,400),egret.Point.create(600,600),egret.Point.create(300,600),egret.Point.create(400,400)],r=new egret.Sprite,r.touchEnabled=!0,this.addChild(r),i=r.graphics,i.beginFill(0),i.drawRect(0,0,1e3,1e3),i.endFill(),i.beginFill(16711680),a=0;a<n.length;a++)o=n[a],0==a?i.moveTo(o.x,o.y):i.lineTo(o.x,o.y);return o=n[0],i.lineTo(o.x,o.y),i.endFill(),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),[2]})})},e.prototype.onTap=function(t){for(var e,n=egret.Point.create(t.localX,t.localY),r=egret.getTimer(),i=0;100>i;i++)for(var o=0;6>o;o++)e=isPolygonContainsPoint(this.ps,n);r=egret.getTimer()-r,console.log("isContain: "+e),console.log("ts:"+r)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var App;!function(t){var e=function(){function e(){}return e.Game_Bg=new t.BaseSpriteLayer,e.Game_Main=new t.BaseSpriteLayer,e.UI_Main=new t.BaseEuiLayer,e.UI_Popup=new t.BaseEuiLayer,e.UI_Guide=new t.BaseEuiLayer,e.UI_Message=new t.BaseEuiLayer,e.UI_Tips=new t.BaseEuiLayer(!1,!1),e.UI_Top=new t.BaseEuiLayer,e}();t.GameLayers=e,__reflect(e.prototype,"App.GameLayers")}(App||(App={}));var App;!function(t){var e=function(){function t(){this.$log=this.$warn=this.$error=function(){}}return t.prototype.init=function(){this.$log=egret.log,this.$warn=egret.warn,this.$error=egret.error},t.prototype.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.$log.apply(this,[t].concat(e))},t.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.$warn.apply(this,[t].concat(e))},t.prototype.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.$error.apply(this,[t].concat(e))},t}();t.Logger=e,__reflect(e.prototype,"App.Logger")}(App||(App={}));var App;!function(t){var e=function(){function t(){this._mcCacheLength=10,this.MC_DATA_COMMON_GROUP_NAME="common",this._mcCache=[],this._mcFactoryCache={},this._mcDataGroups={},this._mcDataGroups[this.MC_DATA_COMMON_GROUP_NAME]={}}return t.prototype.createMc=function(){return this._mcCache.length>0?this._mcCache.pop():new egret.MovieClip},t.prototype.restoreMc=function(t){t.movieClipData=null,this._mcCache.length<this._mcCacheLength&&this._mcCache.push(t)},Object.defineProperty(t.prototype,"mcCacheLength",{get:function(){return this._mcCacheLength},set:function(t){this._mcCacheLength=t,this._mcCacheLength>t&&(this._mcCacheLength=t)},enumerable:!0,configurable:!0}),t.prototype.clearMcCache=function(){this._mcCache.length=0},t.prototype.getMcData=function(t,e,n){void 0===n&&(n=this.MC_DATA_COMMON_GROUP_NAME),n||(n=this.MC_DATA_COMMON_GROUP_NAME);var r=t+"_"+e,i=this._mcDataGroups[n],o=i?i[r]:null;if(!o){var a=this._mcFactoryCache[t];if(!a){var s=RES.getRes(t+"_json"),u=RES.getRes(t+"_png");a=new egret.MovieClipDataFactory(s,u),this._mcFactoryCache[t]=a}o=a.generateMovieClipData(e),i||(this._mcDataGroups[n]={}),this._mcDataGroups[n][r]=o}return o},t.prototype.clearMcFactoryCache=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),t)for(var n=void 0,r=0,i=t.length;i>r;r++)n=t[r],this._mcFactoryCache[n]&&delete this._mcFactoryCache[n];else this._mcFactoryCache={}},t.prototype.clearMcDataCache=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),t){var n=this._mcDataGroups;if(e)for(var r in n)t.indexOf(r)<0&&delete n[r];else for(var r=void 0,i=0,o=t.length;o>i;i++)r=t[i],n[r]&&delete n[r]}else this._mcDataGroups={}},t.prototype.clearAllCache=function(){this.clearMcCache(),this.clearMcFactoryCache(),this.clearMcDataCache()},t}();t.MCHelper=e,__reflect(e.prototype,"App.MCHelper")}(App||(App={}));var App;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.startup=function(){this.configureModuls(),this.core.sendMsg(create(StartupMsg.Startup))},e.prototype.configureModuls=function(){this.configure([new TestModuleCfg,new SystemModuleMvcCfg,new MainModuleCfg,new BattleModuleCfg,new HelpModuleMvcCfg])},e}(VoyaMVC.MVC);t.MVC=e,__reflect(e.prototype,"App.MVC")}(App||(App={}));var App;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,n,r,i){return t.prototype.init.call(this,e,n,r,i),this},e.prototype.login=function(t,e,n,r,i,o,a,s,u,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(h){switch(h.label){case 0:return[4,this.sendHttp({api_name:"weixin_reg_login",jscode:a,nikename:"",sex:"",avatar:"",content_id:o,sys:n,source:r,source_lv:i,invite_openid:t,invite_user_id:e},function(t,e){this.serverTimestamp=parseInt(t.timestamp),this.token=t.token,s.call(u,t,e)}.bind(this),this,c)];case 1:return[2,h.sent()]}})})},e.prototype.submitBattleRecord=function(t,e,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return app.log("========= submit battle record ======="),[4,this.sendHttp({api_name:"combat",lv:t,score:e},n,this,i)];case 1:return[2,r.sent()]}})})},e.prototype.getAboutShare=function(t,e,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.sendHttp({api_name:"get_share_content_image_list"},t,this,n)];case 1:return[2,e.sent()]}})})},e.prototype.shareStatistics=function(t,e,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.sendHttp({api_name:"share_log",content_id:t},e,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.getGameExamineStatus=function(t,e,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.sendHttp({api_name:"get_version_status"},t,this,n)];case 1:return[2,e.sent()]}})})},e.prototype.enterFromShare=function(t,e,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"invite_into_game",invite_openid:e,invite_user_id:t},n,r,i)];case 1:return[2,o.sent()]}})})},e.prototype.getOtherGamesInfo=function(t,e,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.sendHttp({api_name:"get_guide_image_list_new"},t,e,n)];case 1:return[2,r.sent()]}})})},e.prototype.getUseinfo=function(t,e,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.sendHttp({api_name:"get_base_info"},t,e,n)];case 1:return[2,r.sent()]}})})},e.prototype.sendWatchTVStep=function(t,e,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"video_log",type:t,action_type:e},n,r,i)];case 1:return[2,o.sent()]}})})},e.prototype.checkGroupShare=function(t,e,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,this.sendHttp({api_name:"check_share_group",encrypted:t,iv:e},n,r,i)];case 1:return[2,o.sent()]}})})},e}(t.AppHttpBase);t.AppHttp=e,__reflect(e.prototype,"App.AppHttp")}(App||(App={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getSysInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Enum_HttpRespCode;!function(t){t[t.undefined=-1]="undefined",t[t.SUCCESS=1]="SUCCESS"}(Enum_HttpRespCode||(Enum_HttpRespCode={}));var App;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onCheck=function(t){return 1!=t.code&&app.warn("====== http resp exception =======  code:"+t.code+"  msg:"+t.msg),{pass:!0}},e}(t.HttpRespChecker);t.AppHttpRespChecker=e,__reflect(e.prototype,"App.AppHttpRespChecker")}(App||(App={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var u=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(u,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(r,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var App;!function(t){var e=function(){function e(){}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:return this.reflector=new VL.Reflector.EgretReflector,n=this,r=t.GlobalCfg.bind,[4,this.loadGlobalJson()];case 1:return e=n.globalConfig=new(r.apply(t.GlobalCfg,[void 0,i.sent()])),this.logger=new t.Logger,e.isDebug&&this.logger.init(),console.log("====================== check info ======================="),console.log("client_version:"+e.client_version),console.log("pf:"+e.pf),console.log("httpServer:"+e.httpServer),console.log("serverPort:"+e.serverPort),console.log("isDebug:"+e.isDebug),console.log("========================================================="),this.resManager=new VL.Resource.EgretResManager,this.config=new t.Config,this.mcHelper=new t.MCHelper,this.easyLoadingManager=new t.EasyLoadingManager,this.soundManager=new VL.Sound.SoundMgr(VL.Sound.EgretSound),this.dragDropManager=new VL.DragDrop.DragDropManager,this._http=new VL.Net.Http,this.appHttp=(new t.AppHttp).init(this._http,e.client_version,e.httpServer,e.serverPort),[2]}})})},e.prototype.loadGlobalJson=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e,n){var r=new egret.URLRequest("resource/config/global.json"),i=new egret.URLLoader(r);i.dataFormat=egret.URLLoaderDataFormat.TEXT,i.once(egret.Event.COMPLETE,function(t){var n=JSON.parse(i.data);e(n)},t),i.once(egret.IOErrorEvent.IO_ERROR,function(t){n(t.data)},t)})]})})},e.prototype.getConfig=function(t){return this.config.getConfig(t)},e.prototype.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];(r=this.logger).log.apply(r,[t].concat(e));var r},e.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];(r=this.logger).warn.apply(r,[t].concat(e));var r},e.prototype.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];(r=this.logger).error.apply(r,[t].concat(e));var r},e}();t.App=e,__reflect(e.prototype,"App.App")}(App||(App={}));var app=new App.App,App;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.dg_onRestore=new VL.Delegate,e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.init=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this},e.prototype.clear=function(){this.parent&&this.parent.removeChild(this),this.dg_onRestore.boardcast(this),this.container.y=0,this.container.alpha=1},e.prototype.restore=function(){restore(this)},e.prototype.onShow=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.Tween.get(this.container).set({y:0,alpha:1}).to({y:-100},300,egret.Ease.circOut).wait(700).to({y:-200,alpha:0},400,egret.Ease.circIn).call(this.restore,this)},Object.defineProperty(e.prototype,"cachePool",{get:function(){return e._cachePool},enumerable:!0,configurable:!0}),e._cachePool=new VL.ObjectCache.ObjectPool(e),e}(eui.Component);t.BaseTipItem=e,__reflect(e.prototype,"App.BaseTipItem",["App.ITipItem","VL.ObjectCache.ICacheable"])}(App||(App={}));var App;!function(t){var e=function(){function t(){this.tipItemList=[]}return t.prototype.onTipItemRestore=function(t){this.tipItemList.splice(this.tipItemList.indexOf(t),1),t.dg_onRestore.unregister(this.onTipItemRestore)},Object.defineProperty(t.prototype,"gap",{get:function(){return 3},enumerable:!0,configurable:!0}),t}();t.BaseTipManager=e,__reflect(e.prototype,"App.BaseTipManager",["App.ITipManager"])}(App||(App={}));var GameData=function(){function t(){}return Object.defineProperty(t,"score",{get:function(){return Math.floor(this._score)},set:function(t){this._score=t},enumerable:!0,configurable:!0}),t.resetAttr=function(){t.score=0,t.killCount=0,t.speed=10},t._score=0,t.killCount=20,t.addScore=10,t.speed=10,t.continuePlayCount=0,t.continuePlayMaxCount=3,t.syncTime=0,t.syncDogTime=0,t.isOnlyShareGroup=!1,t.shareId=[],t.shareText=["抖音火爆游戏！","你有39个好友正在玩，一起来吧！","史上最难游戏，全球仅有四人通关。","世界上最好玩的游戏，保证你没玩过！","苹果排行榜第一的游戏，快来玩吧！","单身多年，让他们见识你的手速有多快！","说以你的智商，绝对活不过30秒。","别以为你长得帅我就不打你。","左脑发达还是右脑发达，进来就知道了！","智商超过130才能通过，来测试测试！","牛顿的棺材板压不住了，快来帮忙！","史上最难游戏，爱因斯坦很无语！","老婆在家，不要偷偷点哦！"],t.shareImg=["http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/1.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/2.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/3.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/4.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/5.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/6.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/7.jpg","http://cdn.evogames.com.cn/wxgames/qiuqiuyouxilaile/8.jpg"],t}();__reflect(GameData.prototype,"GameData");var CardConfig=function(){function t(){}return t.prototype.attrs=function(){return["id","type","value","unlock","weight"]},t}();__reflect(CardConfig.prototype,"CardConfig"),window.CardConfig=CardConfig;var App;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n._isOpened=!1,n._isInited=!1,n.dg_inited=new VL.Delegate,n.myParent=e,n.init(),n}return __extends(e,t),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.resources.length>0?[4,this.loadRes()]:[3,2];case 1:t.sent(),this.onInit(),this._isInited=!0,this.dg_inited.boardcast(),t.label=2;case 2:return[2]}})})},e.prototype.loadRes=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){app.resManager.loadResTask({keys:t.resources,taskName:getClassName(t),onComplete:function(t){e()}})})]})})},e.prototype.open=function(t){void 0===t&&(t=null),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this),this.addEventListener(egret.Event.RESIZE,this.onResize,this),this.updateLayout(),this.addToParent(),this._isOpened=!0},e.prototype.close=function(t){void 0===t&&(t=null),this.removeFromParent(),this._isOpened=!1,StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.onResize,this),this.removeEventListener(egret.Event.RESIZE,this.onResize,this)},e.prototype.onResize=function(t){this.updateLayout()},e.prototype.updateLayout=function(){var t=StageUtils.getStage();this.width=t.stageWidth,this.height=t.stageHeight},e.prototype.addToParent=function(){this._myParent.addChild(this)},e.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},e.prototype.destroy=function(){this.onDestroy(),this.removeFromParent(),this._isInited=!1},Object.defineProperty(e.prototype,"myParent",{get:function(){return this._myParent},set:function(t){this._myParent=t,this.isOpened&&this.addToParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpened",{get:function(){return this._isOpened},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInited",{get:function(){return this._isInited},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(e.prototype,"BaseSpriteView",["App.IBaseView","IBaseComponent"])}(App||(App={}));var LvConfig=function(){function t(){}return t.prototype.attrs=function(){return["id","lv","needExp"]},t}();__reflect(LvConfig.prototype,"LvConfig"),window.LvConfig=LvConfig;var BattleModuleCfg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getMediatorList=function(){return[new BattleViewMediator,new BattleMenuWindowMediator,new BattleSettleMediator,new RebirthConfirmMediator]},e.prototype.getControllerList=function(){return[new BattleModuleCtrl]},e}(VoyaMVC.MvcConfigBase);__reflect(BattleModuleCfg.prototype,"BattleModuleCfg");var BattleModuleCtrl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(BattleMsg.cmd.EnterBattle,this.onEnterBattleHandler,this),this.regMsg(BattleMsg.cmd.AppendHandCardToGroup,this.onAppendHandCardToGroup,this),this.regMsg(BattleMsg.cmd.DropCurrCardToRubbishBin,this.onDropCurrCardToRubbishBin,this),this.regMsg(BattleMsg.cmd.ClearOneRubbishCell,this.onClearOneRubbishCell,this),this.regMsg(BattleMsg.cmd.RefreshHandCard,this.onRefreshHandCard,this),this.regMsg(BattleMsg.cmd.PlayAgain,this.onPlayAgain,this),this.regMsg(BattleMsg.cmd.BackToMainView,this.onBackToMainView,this),this.regMsg(BattleMsg.cmd.Rebirth,this.onRebirth,this),this.regMsg(BattleMsg.feedBack.LvUp,this.onLvUp,this),this.regMsg(WxSdkMsg.WatchVideo_FeedBack,this.onWxWatchVideoResult,this)},e.prototype.deactivate=function(){this.unregMsg(BattleMsg.cmd.EnterBattle,this.onEnterBattleHandler,this),this.unregMsg(BattleMsg.cmd.AppendHandCardToGroup,this.onAppendHandCardToGroup,this),this.unregMsg(BattleMsg.cmd.DropCurrCardToRubbishBin,this.onDropCurrCardToRubbishBin,this),this.unregMsg(BattleMsg.cmd.ClearOneRubbishCell,this.onClearOneRubbishCell,this),this.unregMsg(BattleMsg.cmd.RefreshHandCard,this.onRefreshHandCard,this),this.unregMsg(BattleMsg.cmd.PlayAgain,this.onPlayAgain,this),this.unregMsg(BattleMsg.cmd.BackToMainView,this.onBackToMainView,this),this.unregMsg(BattleMsg.cmd.Rebirth,this.onRebirth,this),this.unregMsg(BattleMsg.feedBack.LvUp,this.onLvUp,this),this.unregMsg(WxSdkMsg.WatchVideo_FeedBack,this.onWxWatchVideoResult,this)},e.prototype.onEnterBattleHandler=function(t){this.battleModel.newGame(this.playerModel.lv),this.sendMsg(create(BattleMsg.cmd.OpenBattleView))},e.prototype.onAppendHandCardToGroup=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o=this;return __generator(this,function(a){switch(e=this.battleModel,n=e.getCardGroupByIdx(t.body.groupId),r=t.body.card,r.cfg.type){case Enum_CardType.NORMAL:n.appendCard(e.handCardList.pop()),n.mergCard(),i=e.checkGameOver(),e.unshiftNewHandCard(),i&&(this.saveBattleRecord(),e.rebirthEnable?this.sendMsg(create(BattleMsg.cmd.OpenRebirthWindow).init({onClose:function(){o.sendMsg(create(BattleMsg.cmd.CloseBattleView)),o.sendMsg(create(BattleMsg.cmd.OpenBattleSettleView))}})):(this.sendMsg(create(BattleMsg.cmd.CloseBattleView)),this.sendMsg(create(BattleMsg.cmd.OpenBattleSettleView))));break;case Enum_CardType.BOMB:}return[2]})})},e.prototype.onDropCurrCardToRubbishBin=function(t){this.battleModel.abandonCurrHandCard()},e.prototype.onClearOneRubbishCell=function(t){var e=this.battleModel;e.rubbishCount>0&&e.clearRubbishCellChance>0&&!this.getModel(WxSDKModel).isExamine&&(this.sendMsg(create(WxSdkMsg.Share)),egret.setTimeout(function(){e.removeOneRubbish()},this,3e3))},e.prototype.onRefreshHandCard=function(t){var e=this.battleModel;e.enableRefreshAllHandCards?e.refreshAllHandCards():e.resetRefreshHandCardChanceChance>0&&this.sendMsg(create(WxSdkMsg.WatchVideo_CMD).init({flag:Enum_WxWatchVideoFlag.REFRESH_HAND_CARD,showAlertWhenGiveUp:!1}))},e.prototype.onPlayAgain=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.saveBattleRecord(),this.battleModel.newGame(this.playerModel.lv),[2]})})},e.prototype.onBackToMainView=function(t){this.saveBattleRecord(),this.sendMsg(create(BattleMsg.cmd.CloseBattleView)),this.sendMsg(create(MainModuleMsg.OpenMainView))},e.prototype.onRebirth=function(t){this.sendMsg(create(WxSdkMsg.WatchVideo_CMD).init({flag:Enum_WxWatchVideoFlag.REBIRTH,showAlertWhenGiveUp:!1}))},e.prototype.onLvUp=function(t){var e=this.battleModel;e.resetClearRubbishBinChance(),e.enableRefreshAllHandCards||e.resetRefreshHandCardChance(),e.resetResetRefreshHandCardChanceChance();var n=this.playerModel;n.lv=e.currLv,n.saveBattleRecord(e.currLv,e.currScore)},e.prototype.onWxWatchVideoResult=function(t){var e=t.body.flag,n=t.body.result,r=(t.body.error,this.battleModel);switch(n){case Enum_WxWatchVideoResult.COMPLETE:switch(app.appHttp.sendWatchTVStep(e,2,null,null),e){case Enum_WxWatchVideoFlag.REFRESH_HAND_CARD:r.resetRefreshHandCardChance();break;case Enum_WxWatchVideoFlag.REBIRTH:r.rebirth(),this.sendMsg(create(BattleMsg.cmd.CloseRebirthWindow))}break;case Enum_WxWatchVideoResult.NO_AD_COUNT:this.sendMsg(create(PopupMsg.ShowPopup).init({content:"今日广告奖励机会已耗尽，无法享受相应福利",showClose:!0}));break;case Enum_WxWatchVideoResult.GIVE_UP:}},e.prototype.saveBattleRecord=function(){var t=this.playerModel,e=this.battleModel;t.saveBattleRecord(e.currLv,e.currScore)},Object.defineProperty(e.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),e}(VoyaMVC.Controller);__reflect(BattleModuleCtrl.prototype,"BattleModuleCtrl");var Enum_CardType;!function(t){t[t.NORMAL=1]="NORMAL",t[t.RESTOR=2]="RESTOR",t[t.BOMB=3]="BOMB",t[t.UNIVERSAL=4]="UNIVERSAL"}(Enum_CardType||(Enum_CardType={}));var Enum_ResetCardGroupReason;!function(t){t[t.NEW_GAME=1]="NEW_GAME",t[t.MAX_CARD_VALUE=2]="MAX_CARD_VALUE",t[t.BOMB_CARD=3]="BOMB_CARD"}(Enum_ResetCardGroupReason||(Enum_ResetCardGroupReason={}));var Enum_WxWatchVideoFlag;!function(t){t[t.REFRESH_HAND_CARD=1]="REFRESH_HAND_CARD",t[t.REBIRTH=2]="REBIRTH"}(Enum_WxWatchVideoFlag||(Enum_WxWatchVideoFlag={}));var BattleModel=function(t){function e(){var e=t.call(this)||this;e._handCardList=[],e._cardGroupList=[];for(var n,r=0;r<PublicConfigHelper.CARD_GROUP_COUNT;r++)n=new CardGroupModel(r),n.dg_cardsMerged.register(e.onCardMerged,e),e._cardGroupList.push(n);return e}return __extends(e,t),e.prototype.newGame=function(t){this._score=0,this._baseExp=LvConfigHelper.getExpByLv(t),this._scoreMultiple=1,this._rebirthChance=1,this.removeAllRubbish(),this.resetClearRubbishBinChance();for(var e=0,n=this._cardGroupList.length;n>e;e++)this._cardGroupList[e].reset(Enum_ResetCardGroupReason.NEW_GAME);this.refreshAllHandCards(),this._refreshHandCardChance=PublicConfigHelper.INITIAL_REFRESH_HAND_CARD_CHANCE,this.resetResetRefreshHandCardChanceChance(),this.sendMsg(create(BattleMsg.feedBack.NewGame))},e.prototype.unshiftNewHandCard=function(){if(this._handCardList.length<2){var t=this.getRandomCard();return this._handCardList.unshift(t),this.sendMsg(create(BattleMsg.feedBack.UnshiftNewHandCard).init({card:t})),t}return null},e.prototype.getRandomCard=function(){var t,e=app.config.getConfig(CardConfig),n=this.currLv,r=[],i=0;for(var o in e)t=e[o],n>=t.unlock&&t.type==Enum_CardType.NORMAL&&(i+=t.weight,r.push({lessThan:i,cfg:t}));Utils.ArrayUtils.quickSort(r,function(t,e){return t.lessThan-e.lessThan});for(var a=Math.random()*i,s=0,u=r.length;u>s;s++)if(a<=r[s].lessThan)return r[s].cfg;return null},Object.defineProperty(e.prototype,"enableAbandonCurrHandCard",{get:function(){return this._rubbishCount<PublicConfigHelper.MAX_RUBBISH_COUNT},enumerable:!0,configurable:!0}),e.prototype.abandonCurrHandCard=function(){return this.enableAbandonCurrHandCard?(this._handCardList.pop(),this._rubbishCount++,this.sendMsg(create(BattleMsg.feedBack.AbandonedCurrHandCard)),this.unshiftNewHandCard(),!0):!1},e.prototype.removeOneRubbish=function(){return this._rubbishCount>0&&(--this._rubbishCount,--this._clearRubbishCellChance,this.sendMsg(create(BattleMsg.feedBack.RubbishCountChanged).init({remainRubbishCount:this._rubbishCount}))),this._rubbishCount},e.prototype.removeAllRubbish=function(){this._rubbishCount=0,this.sendMsg(create(BattleMsg.feedBack.RubbishCountChanged).init({remainRubbishCount:this._rubbishCount}))},e.prototype.resetClearRubbishBinChance=function(){this._clearRubbishCellChance=PublicConfigHelper.MAX_RUBBISH_COUNT,this.sendMsg(create(BattleMsg.feedBack.ClearRubbishCellChanceChanged).init({chanceCount:this._clearRubbishCellChance}))},Object.defineProperty(e.prototype,"clearRubbishCellChance",{get:function(){return this._clearRubbishCellChance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rubbishCount",{get:function(){return this._rubbishCount},enumerable:!0,configurable:!0}),e.prototype.resetRefreshHandCardChance=function(){this._refreshHandCardChance=PublicConfigHelper.INITIAL_REFRESH_HAND_CARD_CHANCE,this.sendMsg(create(BattleMsg.feedBack.RefreshedHandCardsChanceChanged).init({chanceCount:this._refreshHandCardChance}))},e.prototype.costResetRefreshHandCardChanceChance=function(){this._resetRefreshHandCardChanceChance--,this.sendMsg(create(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged).init({chanceCount:this._resetRefreshHandCardChanceChance}))},e.prototype.resetResetRefreshHandCardChanceChance=function(){this._resetRefreshHandCardChanceChance=1,this.sendMsg(create(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged).init({chanceCount:this._resetRefreshHandCardChanceChance}))},e.prototype.refreshAllHandCards=function(){this._refreshHandCardChance--;for(var t=0;t<PublicConfigHelper.MAX_HAND_CARD_COUNT;t++)this._handCardList[t]=this.getRandomCard();return this.sendMsg(create(BattleMsg.feedBack.RefreshedHandCards).init({cards:this._handCardList})),!0},Object.defineProperty(e.prototype,"refreshHandCardChance",{get:function(){return this._refreshHandCardChance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableRefreshAllHandCards",{get:function(){return this._refreshHandCardChance>0},enumerable:!0,configurable:!0}),e.prototype.onCardMerged=function(t){var e=t.distCards,n=this.calculateAddScore(e);this.addScore(n),e[e.length-1].value==CardConfigHelper.maxValueCard.value&&(this.scoreMultiple++,this.getCardGroupByIdx(t.groupIdx).reset(Enum_ResetCardGroupReason.MAX_CARD_VALUE),this.resetClearRubbishBinChance(),this.resetRefreshHandCardChance(),this.resetResetRefreshHandCardChanceChance()),this.sendMsg(create(BattleMsg.feedBack.CardMerged).init({groupIdx:t.groupIdx,distCards:e,scoreList:n}))},e.prototype.calculateAddScore=function(t){for(var e=[],n=0,r=t.length;r>n;n++)e.push(t[n].value*(n+1)*this.scoreMultiple);return e},e.prototype.addScore=function(t){for(var e=this.currLv,n=0;n<t.length;n++)this._score+=t[n];var r=this.currLv;r>e&&this.sendMsg(create(BattleMsg.feedBack.LvUp).init({currLv:r})),app.log("currScore:",this._score)},e.prototype.checkGameOver=function(){for(var t,e=!0,n=0,r=this._cardGroupList.length;r>n;n++)t=this._cardGroupList[n],t.cardsCount<PublicConfigHelper.MAX_GROUP_CARDS_COUNT&&(e=!1);return e},e.prototype.rebirth=function(){this._rebirthChance--;for(var t,e=PublicConfigHelper.MAX_GROUP_CARDS_COUNT>>1,n=0,r=PublicConfigHelper.CARD_GROUP_COUNT;r>n;n++)t=this.getCardGroupByIdx(n),t.cardList.length>e&&(t.cardList.length=e);this.sendMsg(create(BattleMsg.feedBack.Rebirth))},Object.defineProperty(e.prototype,"rebirthEnable",{get:function(){return this._rebirthChance>0},enumerable:!0,configurable:!0}),e.prototype.getCardGroupByIdx=function(t){return this._cardGroupList[t]},Object.defineProperty(e.prototype,"currScore",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currLv",{get:function(){var t=LvConfigHelper.getLvByExp(this.exp);return t==LvConfigHelper.maxLv&&(t-=1),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseExp",{get:function(){return this._baseExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exp",{get:function(){return Math.min(Math.max(this._baseExp+this._score,0),LvConfigHelper.getExpByLv(LvConfigHelper.maxLv)-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreMultiple",{get:function(){return this._scoreMultiple},set:function(t){this._scoreMultiple=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currHandCard",{get:function(){return this._handCardList[this._handCardList.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handCardList",{get:function(){return this._handCardList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resetRefreshHandCardChanceChance",{get:function(){return this._resetRefreshHandCardChanceChance},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(BattleModel.prototype,"BattleModel");var CardGroupModel=function(t){function e(e){var n=t.call(this)||this;return n._cardList=[],n.dg_cardsMerged=new VL.Delegate,n.groupIdx=e,n}return __extends(e,t),e.prototype.appendCard=function(t){if(this.cardList.length>=PublicConfigHelper.MAX_GROUP_CARDS_COUNT)switch(t.type){case Enum_CardType.NORMAL:if(t.value!=this.lastCard.value)return!1}return this._cardList.push(t),this.sendMsg(create(BattleMsg.feedBack.CurrCardAppendedToGroup).init({groupIdx:this.groupIdx,card:t})),!0},e.prototype.mergCard=function(){for(var t,e=[];;){if(t=this.checkMergeCard(),!t){e.length>0&&this.dg_cardsMerged.boardcast({groupIdx:this.groupIdx,distCards:e});break}e.push(t)}return e},e.prototype.checkMergeCard=function(){var t=this._cardList;if(t.length>=2){var e=this.lastCard,n=this.lastButOneCard;if(n.value==e.value){var r=CardConfigHelper.getNormalCardByValue(n.value<<1);return r&&(t[t.length-2]=r,t.pop()),r}return null}return null},e.prototype.reset=function(t){for(var e=[];this._cardList.length>0;)e.push(this._cardList.pop());this.sendMsg(create(BattleMsg.feedBack.CardGroupReset).init({groupIdx:this.groupIdx,reason:t}))},Object.defineProperty(e.prototype,"cardList",{get:function(){return this._cardList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardsCount",{get:function(){return this._cardList.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastButOneCard",{get:function(){return this._cardList[this._cardList.length-2]
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastCard",{get:function(){return this._cardList[this._cardList.length-1]},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(CardGroupModel.prototype,"CardGroupModel");var BattleMsg;!function(t){var e;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.EnterBattle=e,__reflect(e.prototype,"BattleMsg.cmd.EnterBattle");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenBattleView=n,__reflect(n.prototype,"BattleMsg.cmd.OpenBattleView");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseBattleView=r,__reflect(r.prototype,"BattleMsg.cmd.CloseBattleView");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenBattleMenu=i,__reflect(i.prototype,"BattleMsg.cmd.OpenBattleMenu");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseBattleMenu=o,__reflect(o.prototype,"BattleMsg.cmd.CloseBattleMenu");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenBattleSettleView=a,__reflect(a.prototype,"BattleMsg.cmd.OpenBattleSettleView");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseBattleSettleView=s,__reflect(s.prototype,"BattleMsg.cmd.CloseBattleSettleView");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenRebirthWindow=u,__reflect(u.prototype,"BattleMsg.cmd.OpenRebirthWindow");var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseRebirthWindow=c,__reflect(c.prototype,"BattleMsg.cmd.CloseRebirthWindow");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.BackToMainView=h,__reflect(h.prototype,"BattleMsg.cmd.BackToMainView");var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.PlayAgain=p,__reflect(p.prototype,"BattleMsg.cmd.PlayAgain");var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.AppendHandCardToGroup=l,__reflect(l.prototype,"BattleMsg.cmd.AppendHandCardToGroup");var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.DropCurrCardToRubbishBin=d,__reflect(d.prototype,"BattleMsg.cmd.DropCurrCardToRubbishBin");var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ClearOneRubbishCell=g,__reflect(g.prototype,"BattleMsg.cmd.ClearOneRubbishCell");var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.RefreshHandCard=f,__reflect(f.prototype,"BattleMsg.cmd.RefreshHandCard");var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.Rebirth=_,__reflect(_.prototype,"BattleMsg.cmd.Rebirth")}(e=t.cmd||(t.cmd={}))}(BattleMsg||(BattleMsg={}));var BattleMsg;!function(t){var e;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.NewGame=e,__reflect(e.prototype,"BattleMsg.feedBack.NewGame");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CardMerged=n,__reflect(n.prototype,"BattleMsg.feedBack.CardMerged");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CurrCardAppendedToGroup=r,__reflect(r.prototype,"BattleMsg.feedBack.CurrCardAppendedToGroup");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CardGroupReset=i,__reflect(i.prototype,"BattleMsg.feedBack.CardGroupReset");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.UnshiftNewHandCard=o,__reflect(o.prototype,"BattleMsg.feedBack.UnshiftNewHandCard");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.RefreshedHandCards=a,__reflect(a.prototype,"BattleMsg.feedBack.RefreshedHandCards");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.RefreshedHandCardsChanceChanged=s,__reflect(s.prototype,"BattleMsg.feedBack.RefreshedHandCardsChanceChanged");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ResetRefreshedHandCardsChanceChanceChanged=u,__reflect(u.prototype,"BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged");var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ClearRubbishCellChanceChanged=c,__reflect(c.prototype,"BattleMsg.feedBack.ClearRubbishCellChanceChanged");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.AbandonedCurrHandCard=h,__reflect(h.prototype,"BattleMsg.feedBack.AbandonedCurrHandCard");var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.RubbishCountChanged=p,__reflect(p.prototype,"BattleMsg.feedBack.RubbishCountChanged");var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.LvUp=l,__reflect(l.prototype,"BattleMsg.feedBack.LvUp");var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.Rebirth=d,__reflect(d.prototype,"BattleMsg.feedBack.Rebirth")}(e=t.feedBack||(t.feedBack={}))}(BattleMsg||(BattleMsg={}));var BattleView=function(t){function e(){return t.call(this,"BattleViewSkin")||this}return __extends(e,t),e.prototype.getCardGroup=function(t){return this["cardGroup"+t]},Object.defineProperty(e.prototype,"resources",{get:function(){return[]},enumerable:!0,configurable:!0}),e.prototype.onDestroy=function(){},e}(App.BaseAutoSizeView);__reflect(BattleView.prototype,"BattleView");var BattleViewMediator=function(t){function e(){var e=t.call(this)||this;return e._groupReset=-1,e._handCardMediator=new HandCardMediator,e._recordMediator=new BattleRecordMediator,e}return __extends(e,t),e.prototype.onViewOpen=function(){var t=this.view;t.rect_bg.fillColor=SkinConfigHelper.getGameBgColor(this.getModel(PlayerModel).skinId);for(var e,n=PublicConfigHelper.CARD_GROUP_COUNT,r=this.getModel(SkinModel).skinMng,i=0;n>i;i++)e=t.getCardGroup(i),e.activate(i,r),e.dg_onDropIn.register(this.onCardDropToGroup,this);t.rubbishBin.activate(this.getModel(PlayerModel).skinId),this._handCardMediator.activate(t.grp_handCards),this._recordMediator.activate(t.battlePanel),t.rubbishBin.dg_onDropIn.register(this.onCardDropToRubbishBin,this),EventHelper.addTapEvent(t.rubbishBin,this.onTap,this),EventHelper.addTapEvent(t.btn_refreshHandCard,this.onTap,this),EventHelper.addTapEvent(t.btn_menu,this.onTap,this),EventHelper.addTapEvent(t.btn_help,this.onTap,this),this.regMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.regMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.regMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCarrCardAppendedToGroup,this),this.regMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.regMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.regMsg(BattleMsg.feedBack.RubbishCountChanged,this.onRubbishCountChanged,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCardsChanceChanged,this.onRefreshedHandCardsChanceChanged,this),this.regMsg(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged,this.onResetRefreshedHandCardsChanceChanceChanged,this),this.regMsg(BattleMsg.feedBack.ClearRubbishCellChanceChanged,this.onClearRubbishCellChanceChanged,this),this.regMsg(BattleMsg.feedBack.Rebirth,this.onRebirth,this),this.updateByData()},e.prototype.onViewClose=function(){for(var t,e=this.view,n=PublicConfigHelper.CARD_GROUP_COUNT,r=0;n>r;r++)t=e.getCardGroup(r),t.dg_onDropIn.unregister(this.onCardDropToGroup),t.deactivate();e.rubbishBin.deactivate(),this._handCardMediator.deactivate(),this._recordMediator.deactivate(),e.rubbishBin.dg_onDropIn.unregister(this.onCardDropToRubbishBin),EventHelper.removeTapEvent(e.rubbishBin,this.onTap,this),EventHelper.removeTapEvent(e.btn_refreshHandCard,this.onTap,this),EventHelper.removeTapEvent(e.btn_menu,this.onTap,this),EventHelper.removeTapEvent(e.btn_help,this.onTap,this),this.unregMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.unregMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.unregMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCarrCardAppendedToGroup,this),this.unregMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.unregMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.unregMsg(BattleMsg.feedBack.RubbishCountChanged,this.onRubbishCountChanged,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCardsChanceChanged,this.onRefreshedHandCardsChanceChanged,this),this.unregMsg(BattleMsg.feedBack.ResetRefreshedHandCardsChanceChanceChanged,this.onResetRefreshedHandCardsChanceChanceChanged,this),this.unregMsg(BattleMsg.feedBack.ClearRubbishCellChanceChanged,this.onClearRubbishCellChanceChanged,this),this.unregMsg(BattleMsg.feedBack.Rebirth,this.onRebirth,this)},e.prototype.updateByData=function(){for(var t,e,n,r,i=this.battleModel,o=this.view,a=this.getModel(SkinModel).skinMng,s=PublicConfigHelper.CARD_GROUP_COUNT,u=0;s>u;u++){e=o.getCardGroup(u),e.removeAllCards(),t=i.getCardGroupByIdx(u),n=t.cardList;for(var c=0,h=n.length;h>c;c++)r=create(Card).init(n[u],a),e.appendCard(r)}o.btn_refreshHandCard.enableRefresh=this.battleModel.refreshHandCardChance>0,this.updateRubbishBin()},e.prototype.onTap=function(t){var e=this.view;switch(t.currentTarget){case e.rubbishBin:this.sendMsg(create(BattleMsg.cmd.ClearOneRubbishCell));break;case e.btn_refreshHandCard:this.sendMsg(create(BattleMsg.cmd.RefreshHandCard));break;case e.btn_menu:this.sendMsg(create(BattleMsg.cmd.OpenBattleMenu));break;case e.btn_help:this.sendMsg(create(HelpModuleMsg.OPEN_HELP_VIEW))}},e.prototype.onCardDropToRubbishBin=function(t){this.sendMsg(create(BattleMsg.cmd.DropCurrCardToRubbishBin).init({card:t.dragItem}))},e.prototype.onCardDropToGroup=function(t){var e=t.container;this.sendMsg(create(BattleMsg.cmd.AppendHandCardToGroup).init({groupId:e.groupId,card:t.dragItem}))},e.prototype.onCardMerged=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:e=this.view.getCardGroup(t.body.groupIdx),n=t.body.distCards,r=t.body.scoreList,i=0,o.label=1;case 1:return i<n.length?[4,e.mergeCard(n[i],r[i])]:[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return this._groupReset!=e.groupId?[3,6]:[4,e.removeAllCardsAsync()];case 5:o.sent(),this._groupReset=-1,this._groupResetRemovedCards=null,o.label=6;case 6:return[2]}})})},e.prototype.onCarrCardAppendedToGroup=function(t){var e=this.view.getCardGroup(t.body.groupIdx),n=create(Card).init(t.body.card,this.getModel(SkinModel).skinMng);e.appendCard(n)},e.prototype.onNewGame=function(t){},e.prototype.onCardGroupReset=function(t){var e=t.body.groupIdx,n=t.body.reason;switch(n){case Enum_ResetCardGroupReason.NEW_GAME:this.view.getCardGroup(e).removeAllCards();break;case Enum_ResetCardGroupReason.MAX_CARD_VALUE:this._groupReset=e}},e.prototype.onAbandonedCurrHandCard=function(t){this.updateRubbishBin()},e.prototype.onRubbishCountChanged=function(t){this.updateRubbishBin()},e.prototype.onClearRubbishCellChanceChanged=function(t){this.updateRubbishBin()},e.prototype.updateRubbishBin=function(){var t=this.view.rubbishBin,e=this.battleModel,n=this.getModel(WxSDKModel);t.rubbishCount=e.rubbishCount,t.clearCellChance=n.isExamine?0:e.clearRubbishCellChance},e.prototype.onRefreshedHandCards=function(t){this.updateRefreshHandCardsChance()},e.prototype.onRefreshedHandCardsChanceChanged=function(t){this.updateRefreshHandCardsChance()},e.prototype.onResetRefreshedHandCardsChanceChanceChanged=function(t){this.updateRefreshHandCardsChance()},e.prototype.updateRefreshHandCardsChance=function(){this.view.btn_refreshHandCard.enableRefresh=this.battleModel.enableRefreshAllHandCards,this.view.btn_refreshHandCard.enableReset=this.battleModel.resetRefreshHandCardChanceChance>0},e.prototype.onRebirth=function(t){for(var e=PublicConfigHelper.MAX_GROUP_CARDS_COUNT>>1,n=0,r=PublicConfigHelper.CARD_GROUP_COUNT;r>n;n++)this.view.getCardGroup(n).removeCards(e)},Object.defineProperty(e.prototype,"viewClass",{get:function(){return BattleView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(BattleViewMediator.prototype,"BattleViewMediator");var PublicConfig=function(){function t(){}return t.prototype.attrs=function(){return["cardGroupCount","maxRubbishCount","maxHandCardCount","maxGroupCardCount"]},t}();__reflect(PublicConfig.prototype,"PublicConfig"),window.PublicConfig=PublicConfig;var RefreshBtn=function(t){function e(){var e=t.call(this)||this;return e.needRefresh=!1,e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.updateShow=function(){var t=this;this.needRefresh||(this.needRefresh=!0,egret.callLater(function(){t.enableRefresh?(t.icon_playVideo.visible=!1,t.icon_refresh.visible=!0,t.rect_bg.fillColor=65280):(t.icon_playVideo.visible=!0,t.icon_refresh.visible=!1,t.rect_bg.fillColor=16711680,t.enableReset?t.icon_playVideo.source="icon_playVideo_png":t.icon_playVideo.source="icon_disable_png"),t.needRefresh=!1},this))},Object.defineProperty(e.prototype,"enableRefresh",{get:function(){return this._enableRefresh},set:function(t){this._enableRefresh=t,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableReset",{get:function(){return this._enableReset},set:function(t){this._enableReset=t,this.updateShow()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(RefreshBtn.prototype,"RefreshBtn",["eui.UIComponent","egret.DisplayObject"]),window.RefreshBtn=RefreshBtn;var Card=function(t){function e(){var e=t.call(this)||this;return e._isChildCreated=!1,e.skinName="CardSkin",e.touchChildren=!1,e.dragItemCtrl=new DragCardCtrl(e),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._isChildCreated=!0,this.updateByData()},e.prototype.updateByData=function(){var t=this.cfg;if(t){2==t.value&&app.log("cardCfg:",t),this.lb_value.text=this.cfg.value.toString();var e=this._skinMng.getCardColor(this.cfg),n=this._skinMng.getCardImg(this.cfg),r=n.length>0?app.resManager.getRes(n):null;r?(this.img_bg.source=r,this.img_bg.visible=!0,this.rect_bg.visible=!1):(this.rect_bg.fillColor=e,this.img_bg.visible=!1,this.rect_bg.visible=!0)}else this.lb_value.text="",this.rect_bg.fillColor=0,this.img_bg.source=null,this.img_bg.visible=!1,this.rect_bg.visible=!0},e.prototype.init=function(t,e){return this._skinMng=e,this._skinMng.dg_SkinChanged.register(this.onSkinChanged,this),this.cfg=t,this},e.prototype.onSkinChanged=function(t){this.updateByData()},e.prototype.clear=function(){this._skinMng.dg_SkinChanged.unregister(this.onSkinChanged),this._skinMng=null,this.cfg=null,app.dragDropManager.unregDragItem(this),this.x=this.y=0,this.parent&&this.parent.removeChild(this)},e.prototype.restore=function(t){void 0===t&&(t=e.MAX_CACHE_COUNT),restore(this,t)},Object.defineProperty(e.prototype,"cfg",{get:function(){return this._cfg},set:function(t){this._cfg!=t&&(this._cfg=t,this._isChildCreated&&this.updateByData())},enumerable:!0,configurable:!0}),e.MAX_CACHE_COUNT=35,e}(eui.Component);__reflect(Card.prototype,"Card",["VL.ObjectCache.ICacheable","VL.DragDrop.IDragItem"]),window.Card=Card;var DragCardCtrl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onDropSecceed=function(t){},e.prototype.startDrag=function(e,n,r,i){t.prototype.startDrag.call(this,e,n,r,i),this.card.alpha=.5},e.prototype.stopDrag=function(){t.prototype.stopDrag.call(this),this.card.alpha=1},e.prototype.backupBeforeDrag=function(){this.origParent=this.dragItem.parent,this.origX=this.dragItem.x,this.origY=this.dragItem.y},e.prototype.rollBackBeforDrag=function(){this.dragItem.x=this.origX,this.dragItem.y=this.origY,this.origParent.addChild(this.dragItem)},Object.defineProperty(e.prototype,"card",{get:function(){return this.dragItem},enumerable:!0,configurable:!0}),e}(VL.DragDrop.DragItemCtrlBase);__reflect(DragCardCtrl.prototype,"DragCardCtrl");var CardGroup=function(t){function e(){var e=t.call(this)||this;return e.marginTop=10,e.gap=105,e._isActive=!1,e.skinName="CardGroupSkin",e._cardList=[],e.touchChildren=!1,e.touchEnabled=!0,e.dg_onDropIn=new VL.Delegate,e.dropContainerCtrl=new CardGroupDropCtrl(e),e.dg_mergeCardComplete=new VL.Delegate,e}return __extends(e,t),e.prototype.activate=function(t,e){this.stage&&!this._isActive&&(this._groupId=t,this._skinMng=e,app.dragDropManager.regDropContainer(this),this.dg_onDropIn.register(this.onDropIn,this),this._isActive=!0,this.updateDropArea())},e.prototype.deactivate=function(){app.dragDropManager.unregDropContainer(this),this.dg_onDropIn.unregister(this.onDropIn),this._skinMng=null,this._isActive=!1},e.prototype.onDropIn=function(t){this.img_border.visible=!1},e.prototype.appendCard=function(t){t.y=this.marginTop+this._cardList.length*this.gap,t.x=this.width-t.width>>1,this.addChild(t),this._cardList.push(t),this.updateDropArea()},e.prototype.mergeCard=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return this.touchEnabled=!1,n=this.lastCard,r=this.lastButOneCard,this.flyScoreTip(n,t,e),[4,this.moveLastCardToLastButOneCard()];case 1:return o.sent(),this._cardList.pop(),n.restore(),[2,new Promise(function(e,n){egret.Tween.get(r).to({scaleX:.7,scaleY:.7,x:r.x+.15*r.width,y:r.y+.15*r.height},150).call(function(){r.cfg=t}).to({scaleX:1,scaleY:1,x:i.width-r.width>>1,y:r.y},150).call(function(){i.touchEnabled=!0,i.updateDropArea(),e()})})]}})})},e.prototype.flyScoreTip=function(t,e,n){var r=create(FlyScoreTip).init(this._skinMng.getCardColor(e),n),i=this.width>>1,o=t.y+(t.height>>1),a=o-(t.height>>1);egret.Tween.get(r).set({alpha:1,x:i,y:o}).to({alpha:0,y:a},600).call(function(){r.restore()}),this.addChild(r)},e.prototype.removeCards=function(t){t=Math.min(this._cardList.length,t);for(var e=0;t>e;e++)this._cardList.pop().restore();this.updateDropArea()},e.prototype.removeAllCards=function(){for(;this._cardList.length>0;)this._cardList.pop().restore();this.updateDropArea()},e.prototype.removeAllCardsAsync=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(n){switch(n.label){case 0:this.touchEnabled=!1,n.label=1;case 1:return this._cardList.length>1?[4,this.moveLastCardToLastButOneCard()]:[3,3];case 2:return n.sent(),t=this.lastButOneCard,this.flyScoreTip(t,t.cfg,t.cfg.value),this._cardList.splice(this._cardList.length-2,1),t.restore(),[3,1];case 3:return[2,new Promise(function(t){var n=e.lastCard;n?egret.Tween.get(n).to({x:e.width>>1,y:n.y+n.height>>1,scaleX:0,scaleY:0},300).call(function(){e._cardList.pop(),n.parent.removeChild(n),n.scaleY=n.scaleX=1,n.restore(),e.updateDropArea(),e.touchEnabled=!0,t()}):(e.updateDropArea(),e.touchEnabled=!0,t())})]}})})},e.prototype.moveLastCardToLastButOneCard=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){var n=t.lastCard,r=t.lastButOneCard;egret.Tween.get(n).to({y:r.y},150).call(function(){e()})})]})})},e.prototype.checkHover=function(t){var e=t==this._currDropArea;return this.img_border.visible=e,e},e.prototype.updateDropArea=function(){this._currDropArea=this},Object.defineProperty(e.prototype,"lastCard",{get:function(){return this._cardList[this._cardList.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastButOneCard",{get:function(){return this._cardList[this._cardList.length-2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupId",{get:function(){return this._groupId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardCount",{get:function(){return this._cardList.length},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(CardGroup.prototype,"CardGroup",["VL.DragDrop.IDropContainer"]),window.CardGroup=CardGroup;var CardGroupDropCtrl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.checkEnableDrop=function(t){return this.cardGroup.cardCount<PublicConfigHelper.MAX_GROUP_CARDS_COUNT?!0:this.cardGroup.lastCard.cfg.value==t.cfg.value},Object.defineProperty(e.prototype,"cardGroup",{get:function(){return this._container},enumerable:!0,configurable:!0}),e}(DropCardContainerCtrl);__reflect(CardGroupDropCtrl.prototype,"CardGroupDropCtrl");var DropEnableFilter=function(t){function e(){return t.call(this,0,1,20,20,2)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e}(egret.GlowFilter);__reflect(DropEnableFilter.prototype,"DropEnableFilter");var FlyScoreTip=function(t){function e(){var e=t.call(this)||this;return e.isReady=!1,e.skinName="FlyScoreTipSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isReady=!0,this.updateShow()},e.prototype.init=function(t,e){return this.bgColor=t,this.score=e,this.updateShow(),this},e.prototype.updateShow=function(){this.isReady&&(this.rect_bg.fillColor=this.bgColor,this.lb_score.text="+ "+this.score,this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1)},e.prototype.clear=function(){this.score=0,this.bgColor=0,this.parent&&this.parent.removeChild(this)},e.prototype.restore=function(t){VL.ObjectCache.CacheableClass.restore(this)},e}(eui.Component);__reflect(FlyScoreTip.prototype,"FlyScoreTip",["VL.ObjectCache.ICacheable"]);var HandCardMediator=function(t){function e(){var e=t.call(this)||this;return e.gap=110,e._handCards=[],e}return __extends(e,t),e.prototype.activate=function(t){this.grp_HandCard=t,this.regMsg(BattleMsg.feedBack.UnshiftNewHandCard,this.onUnshiftNewHandCardHandler,this),this.regMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCardAppended,this),this.regMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.regMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.updateByData()},e.prototype.deactivate=function(){this.unregMsg(BattleMsg.feedBack.UnshiftNewHandCard,this.onUnshiftNewHandCardHandler,this),this.unregMsg(BattleMsg.feedBack.CurrCardAppendedToGroup,this.onCardAppended,this),this.unregMsg(BattleMsg.feedBack.AbandonedCurrHandCard,this.onAbandonedCurrHandCard,this),this.unregMsg(BattleMsg.feedBack.RefreshedHandCards,this.onRefreshedHandCards,this),this.grp_HandCard=null},e.prototype.updateByData=function(){for(var t=this._handCards;t.length>0;)t.pop().restore();for(var e,n=this.battleModel.handCardList,r=0,i=n.length;i>r;r++)e=create(Card).init(n[r],this.getModel(SkinModel).skinMng),e.x=r*this.gap,this._handCards.push(e),this.grp_HandCard.addChild(e);this.setLastCardDragable()},e.prototype.onRefreshedHandCards=function(t){for(;this._handCards.length>0;)this._handCards.pop().restore();for(var e,n=t.body.cards,r=n.length-1;r>=0;r--)e=create(Card).init(n[r],this.getModel(SkinModel).skinMng),this.unshiftNewCard(e)},e.prototype.onAbandonedCurrHandCard=function(t){var e=this._handCards.pop();e.restore()},e.prototype.onCardAppended=function(t){var e=this._handCards.pop();e.restore()},e.prototype.onUnshiftNewHandCardHandler=function(t){var e=create(Card).init(t.body.card,this.getModel(SkinModel).skinMng);this.unshiftNewCard(e)},e.prototype.unshiftNewCard=function(t){var e=this;this._handCards.unshift(t),this.grp_HandCard.addChildAt(t,0),1==this._handCards.length?(t.x=0,this.setLastCardDragable()):egret.Tween.get(this.lastCard).to({x:this.gap*(this._handCards.length-1)},300).call(function(){e.setLastCardDragable()})},Object.defineProperty(e.prototype,"battleModel",{get:function(){return this.getModel(BattleModel)},enumerable:!0,configurable:!0}),e.prototype.setLastCardDragable=function(){app.dragDropManager.regDragItem(this.lastCard)},Object.defineProperty(e.prototype,"lastCard",{get:function(){return this._handCards[this._handCards.length-1]},enumerable:!0,configurable:!0}),e}(VoyaMVC.Mediator);__reflect(HandCardMediator.prototype,"HandCardMediator");var BattleMenuWindow=function(t){function e(){var e=t.call(this,"BattleMenuWindowSkin")||this;return e.resources=[],e}return __extends(e,t),e.prototype.onInit=function(){},e.prototype.onDestroy=function(){},e}(App.BaseWindow);__reflect(BattleMenuWindow.prototype,"BattleMenuWindow");var BattleMenuWindowMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){var t=this.view;EventHelper.addTapEvent(t.icon_backHome,this.onTap,this),EventHelper.addTapEvent(t.icon_continue,this.onTap,this),EventHelper.addTapEvent(t.icon_reset,this.onTap,this)},e.prototype.onViewClose=function(){var t=this.view;EventHelper.removeTapEvent(t.icon_backHome,this.onTap,this),EventHelper.removeTapEvent(t.icon_continue,this.onTap,this),EventHelper.removeTapEvent(t.icon_reset,this.onTap,this)},e.prototype.onTap=function(t){var e=this.view;switch(t.currentTarget){case e.icon_backHome:this.sendMsg(create(BattleMsg.cmd.BackToMainView));break;case e.icon_reset:this.sendMsg(create(BattleMsg.cmd.PlayAgain));break;case e.icon_continue:}this.sendMsg(create(BattleMsg.cmd.CloseBattleMenu))},Object.defineProperty(e.prototype,"viewClass",{get:function(){return BattleMenuWindow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleMenu},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleMenu},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(BattleMenuWindowMediator.prototype,"BattleMenuWindowMediator");var RebirthConfirmMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(t){var e=this.view;this.onClose=t.onClose,EventHelper.addTapEvent(e.btn_close,this.onTap,this),EventHelper.addTapEvent(e.btn_rebirth,this.onTap,this),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},e.prototype.onViewClose=function(){var t=this.view;this.onClose=null,EventHelper.removeTapEvent(t.btn_close,this.onTap,this),EventHelper.removeTapEvent(t.btn_rebirth,this.onTap,this),this.sendMsg(create(WxSdkMsg.HideBannerAd))},e.prototype.onTap=function(t){var e=this.view;switch(t.currentTarget){case e.btn_close:this.sendMsg(create(BattleMsg.cmd.CloseRebirthWindow)),this.onClose&&this.onClose();break;case e.btn_rebirth:this.sendMsg(create(BattleMsg.cmd.Rebirth))}},Object.defineProperty(e.prototype,"viewClass",{get:function(){return RebirthConfirmWindow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenRebirthWindow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseRebirthWindow},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(RebirthConfirmMediator.prototype,"RebirthConfirmMediator");var RebirthConfirmWindow=function(t){function e(){var e=t.call(this,"RebirthConfirmWindowSkin")||this;return e.resources=[],e}return __extends(e,t),e.prototype.onInit=function(){},e.prototype.onDestroy=function(){},e}(App.BaseWindow);__reflect(RebirthConfirmWindow.prototype,"RebirthConfirmWindow");var BattleRecordMediator=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isActive=!1,e}return __extends(e,t),e.prototype.activate=function(t){this._isActive=!0,this.panel=t,this.regMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.regMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.regMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.updateByData()},e.prototype.deactivate=function(){this.unregMsg(BattleMsg.feedBack.CardMerged,this.onCardMerged,this),this.unregMsg(BattleMsg.feedBack.CardGroupReset,this.onCardGroupReset,this),this.unregMsg(BattleMsg.feedBack.NewGame,this.onNewGame,this),this.panel=null,this._isActive=!1},e.prototype.updateByData=function(){var t=this.panel,e=this.getModel(BattleModel),n=this.getModel(PlayerModel);t.updateSkin(n.skinId),this._currScore=t.currScore=e.currScore,t.currExp=e.exp,t.highScore=n.highScore,this.panel.scoreMultiple=e.scoreMultiple},e.prototype.onNewGame=function(t){this.updateByData()},e.prototype.onCardMerged=function(t){var e=t.body.scoreList;app.log("scoreList:",e),this.addSubScore(e,0)},e.prototype.onCardGroupReset=function(t){this.panel.scoreMultiple=this.getModel(BattleModel).scoreMultiple},e.prototype.addSubScore=function(t,e){if(this._isActive){var n=this.getModel(BattleModel),r=this.getModel(PlayerModel),i=t[e],o=this._currScore+=i;this.panel.currScore=o,o>=r.highScore&&(this.panel.highScore=o),this.panel.currExp=Math.min(Math.max(n.baseExp+o),LvConfigHelper.getExpByLv(LvConfigHelper.maxLv)-1),++e>=t.length||egret.setTimeout(this.addSubScore,this,450,t,e)}},e}(VoyaMVC.Mediator);__reflect(BattleRecordMediator.prototype,"BattleRecordMediator");var BattleRecordPanel=function(t){function e(){var e=t.call(this)||this;return e._skinId=1,e.skinName="BattleRecordPanelSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"currExp",{set:function(t){this._exp=t;var e=LvConfigHelper.getLvByExp(t),n=LvConfigHelper.getExpByLv(e),r=LvConfigHelper.getExpByLv(e+1);this.lvBlock_curr.lv=e,this.lvBlock_next.lv=e+1,this.expPgBar.setProgress(t-n,r-n),this.expPgBar.displayColor=SkinConfigHelper.getLvColor(this._skinId,e)},enumerable:!0,configurable:!0}),e.prototype.updateSkin=function(t){var e=LvConfigHelper.getLvByExp(this._exp);this.expPgBar.displayColor=SkinConfigHelper.getLvColor(t,e),this.lvBlock_curr.skinId=t,this.lvBlock_next.skinId=t,this.rect_bg_scoreMultiple.fillColor=SkinConfigHelper.getScoreMultipleBgColor(t)},Object.defineProperty(e.prototype,"highScore",{set:function(t){this.lb_highScore.text=Utils.NumberToUnitStringUtil.convert(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currScore",{set:function(t){this.lb_currScore.text=Utils.NumberToUnitStringUtil.convert(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreMultiple",{set:function(t){this.lb_scoreMultiple.text="X"+t},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(BattleRecordPanel.prototype,"BattleRecordPanel",["eui.UIComponent","egret.DisplayObject"]),window.BattleRecordPanel=BattleRecordPanel;
var ExpPgBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setProgress=function(t,e){var n=t/e;this.rect_value.width=this.width*n},Object.defineProperty(e.prototype,"displayColor",{set:function(t){this.rect_value.fillColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgColor",{set:function(t){this.rect_bg.fillColor=t},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(ExpPgBar.prototype,"ExpPgBar",["eui.UIComponent","egret.DisplayObject"]),window.ExpPgBar=ExpPgBar;var LvBlock=function(t){function e(){var e=t.call(this)||this;return e._lv=1,e._skinId=1,e._isReady=!1,e.touchChildren=e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._isReady=!0,this.updateShow()},e.prototype.updateShow=function(){this._isReady&&(this.rect_bg.fillColor=SkinConfigHelper.getLvColor(this._skinId,this.lv),this.lb_lv.text=this.lv.toString())},Object.defineProperty(e.prototype,"lv",{get:function(){return this._lv},set:function(t){this._lv=t,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinId",{set:function(t){this._skinId=t,this.updateShow()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(LvBlock.prototype,"LvBlock",["eui.UIComponent","egret.DisplayObject"]),window.LvBlock=LvBlock;var DropRubbishCtrl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.checkEnableDrop=function(t){return this.rubbishBin.rubbishCount<PublicConfigHelper.MAX_RUBBISH_COUNT},Object.defineProperty(e.prototype,"rubbishBin",{get:function(){return this.container},enumerable:!0,configurable:!0}),e}(DropCardContainerCtrl);__reflect(DropRubbishCtrl.prototype,"DropRubbishCtrl");var RubbishBin=function(t){function e(){var e=t.call(this)||this;return e._isReady=!1,e._rubbishCount=0,e._skinId=1,e._needUpdate=!1,e.skinName="RubbishBinSkin",e.touchChildren=!1,e.touchEnabled=!0,e.dg_onDropIn=new VL.Delegate,e.dropContainerCtrl=new DropRubbishCtrl(e),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._isReady=!0,this.updateShow(),this.updateSkin(),this.grp_cell.mask=this.rect_mask},e.prototype.activate=function(t){app.dragDropManager.regDropContainer(this),this.dg_onDropIn.register(this.onDropIn,this),this._skinId=t,this.updateSkin()},e.prototype.deactivate=function(){app.dragDropManager.regDropContainer(this),this.dg_onDropIn.unregister(this.onDropIn)},e.prototype.checkHover=function(t){var e=t==this;return this.img_border.visible=e,e},e.prototype.onDropIn=function(){this.img_border.visible=!1},e.prototype.getRubbishCell=function(t){return this["cell"+t]},e.prototype.updateShow=function(){var t=this;this._isReady&&(this._needUpdate||(this._needUpdate=!0,egret.callLater(function(){for(var e,n=PublicConfigHelper.MAX_RUBBISH_COUNT,r=0;n>r;r++)e=t.getRubbishCell(r),e.isEmpty=r>=t.rubbishCount,e.enableClear=r<t.clearCellChance;t._needUpdate=!1},this)))},e.prototype.updateSkin=function(){if(this._isReady)for(var t=PublicConfigHelper.MAX_RUBBISH_COUNT,e=0;t>e;e++)this.getRubbishCell(e).skinId=this._skinId},Object.defineProperty(e.prototype,"rubbishCount",{get:function(){return this._rubbishCount},set:function(t){var e=PublicConfigHelper.MAX_RUBBISH_COUNT;t=Math.min(e,Math.max(t,0)),this._rubbishCount=t,this.updateShow()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clearCellChance",{get:function(){return this._clearCellChance},set:function(t){var e=PublicConfigHelper.MAX_RUBBISH_COUNT;t=Math.min(e,Math.max(t,0)),this._clearCellChance=t,this.updateShow()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(RubbishBin.prototype,"RubbishBin",["eui.UIComponent","egret.DisplayObject","VL.DragDrop.IDropContainer"]),window.RubbishBin=RubbishBin;var RubbishBinCell=function(t){function e(){var e=t.call(this)||this;return e._isEmpty=!0,e._isReady=!1,e._skinId=1,e._enableClear=!1,e.needUpdate=!1,e.skinName="RubbishBinCellSkin",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._isReady=!0,this.updateIcon()},e.prototype.updateIcon=function(){var t=this;this._isReady&&(this.needUpdate||(this.needUpdate=!0,egret.callLater(function(){t._isEmpty?(t.img_icon.source="icon_rubbishBinDropable_png",t.rect_bg.fillColor=SkinConfigHelper.getRubbishCellBgColor(t._skinId)):(t._enableClear?t.img_icon.source="icon_clearRubbishBin_png":t.img_icon.source="icon_rubbishBin_disable_png",t.rect_bg.fillColor=SkinConfigHelper.getRubbishCellForeColor(t._skinId)),t.needUpdate=!1},this)))},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._isEmpty},set:function(t){this._isEmpty!=t&&(this._isEmpty=t,this.updateIcon())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinId",{get:function(){return this._skinId},set:function(t){this._skinId=t,this.updateIcon()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableClear",{get:function(){return this._enableClear},set:function(t){this._enableClear=t,this.updateIcon()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(RubbishBinCell.prototype,"RubbishBinCell",["eui.UIComponent","egret.DisplayObject"]),window.RubbishBinCell=RubbishBinCell;var BattleSettleMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){var t=this.view,e=this.getModel(BattleModel),n=this.getModel(PlayerModel);t.lb_lv.text="等级 "+n.lv,t.lb_highScore.text=Utils.NumberToUnitStringUtil.convert(n.highScore),t.lb_battleScore.text=Utils.NumberToUnitStringUtil.convert(e.currScore),EventHelper.addTapEvent(t.btn_playAgain,this.onTap,this),EventHelper.addTapEvent(t.btn_backHome,this.onTap,this),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},e.prototype.onViewClose=function(){var t=this.view;EventHelper.removeTapEvent(t.btn_playAgain,this.onTap,this),EventHelper.removeTapEvent(t.btn_backHome,this.onTap,this),this.sendMsg(create(WxSdkMsg.HideBannerAd))},e.prototype.onTap=function(t){var e=this.view;switch(t.currentTarget){case e.btn_playAgain:this.sendMsg(create(BattleMsg.cmd.PlayAgain)),this.sendMsg(create(BattleMsg.cmd.OpenBattleView)),this.sendMsg(create(BattleMsg.cmd.CloseBattleSettleView));break;case e.btn_backHome:this.sendMsg(create(BattleMsg.cmd.BackToMainView)),this.sendMsg(create(BattleMsg.cmd.CloseBattleSettleView))}},Object.defineProperty(e.prototype,"viewClass",{get:function(){return BattleSettleView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return BattleMsg.cmd.OpenBattleSettleView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return BattleMsg.cmd.CloseBattleSettleView},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(BattleSettleMediator.prototype,"BattleSettleMediator");var BattleSettleView=function(t){function e(){var e=t.call(this,"BattleSettleViewSkin")||this;return e.resources=[],e}return __extends(e,t),e.prototype.onDestroy=function(){},e}(App.BaseAutoSizeView);__reflect(BattleSettleView.prototype,"BattleSettleView");var HelpModuleMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OPEN_HELP_VIEW=e,__reflect(e.prototype,"HelpModuleMsg.OPEN_HELP_VIEW");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CLOSE_HELP_VIEW=n,__reflect(n.prototype,"HelpModuleMsg.CLOSE_HELP_VIEW")}(HelpModuleMsg||(HelpModuleMsg={}));var HelpModuleMvcCfg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getMediatorList=function(){return[new HelpWindowMediator]},e.prototype.getControllerList=function(){return null},e}(VoyaMVC.MvcConfigBase);__reflect(HelpModuleMvcCfg.prototype,"HelpModuleMvcCfg");var HelpWindow=function(t){function e(){var e=t.call(this,"HelpWindowSkin")||this;return e.resources=[],e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onInit=function(){},e.prototype.onDestroy=function(){},e}(App.BaseWindow);__reflect(HelpWindow.prototype,"HelpWindow");var HelpWindowMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){EventHelper.addTapEvent(this.view.btn_close,this.onTap,this)},e.prototype.onViewClose=function(){EventHelper.removeTapEvent(this.view.btn_close,this.onTap,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.view.btn_close:this.sendMsg(create(HelpModuleMsg.CLOSE_HELP_VIEW))}},Object.defineProperty(e.prototype,"viewClass",{get:function(){return HelpWindow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return HelpModuleMsg.OPEN_HELP_VIEW},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return HelpModuleMsg.CLOSE_HELP_VIEW},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(HelpWindowMediator.prototype,"HelpWindowMediator");var MainModuleCfg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getMediatorList=function(){return[new MainViewMediator]},e.prototype.getControllerList=function(){return null},e}(VoyaMVC.MvcConfigBase);__reflect(MainModuleCfg.prototype,"MainModuleCfg");var MainModuleMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenMainView=e,__reflect(e.prototype,"MainModuleMsg.OpenMainView");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseMainView=n,__reflect(n.prototype,"MainModuleMsg.CloseMainView");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenRankView=r,__reflect(r.prototype,"MainModuleMsg.OpenRankView");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseRankView=i,__reflect(i.prototype,"MainModuleMsg.CloseRankView")}(MainModuleMsg||(MainModuleMsg={}));var MainView=function(t){function e(){return t.call(this,"MainViewSkin")||this}return __extends(e,t),e.prototype.open=function(){t.prototype.open.call(this)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.getWxOtherGameIcon=function(t){return this["wxOtherGameIcon"+t]},e.prototype.onDestroy=function(){},Object.defineProperty(e.prototype,"resources",{get:function(){return[]},enumerable:!0,configurable:!0}),e}(App.BaseAutoSizeView);__reflect(MainView.prototype,"MainView");var MainViewMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){var t=this.view;EventHelper.addTapEvent(t.btn_start,this.onBtnStart,this),EventHelper.addTapEvent(t.btn_shop,this.onTouch,this),EventHelper.addTapEvent(t.btn_rank,this.onTouch,this),EventHelper.addTapEvent(t.btn_share,this.onTouch,this),EventHelper.addTapEvent(t.getWxOtherGameIcon(0),this.onTouch,this),EventHelper.addTapEvent(t.getWxOtherGameIcon(1),this.onTouch,this),this.regMsg(WxSdkMsg.OtherGameDataChanged,this.onOtherGameDataChanged,this),this.updateOtherGameIcon(),this.sendMsg(create(WxSdkMsg.ShowBannerAd))},e.prototype.onViewClose=function(){var t=this.view;EventHelper.removeTapEvent(t.btn_start,this.onBtnStart,this),EventHelper.removeTapEvent(t.btn_shop,this.onTouch,this),EventHelper.removeTapEvent(t.btn_rank,this.onTouch,this),EventHelper.removeTapEvent(t.btn_share,this.onTouch,this),EventHelper.removeTapEvent(t.getWxOtherGameIcon(0),this.onTouch,this),EventHelper.removeTapEvent(t.getWxOtherGameIcon(1),this.onTouch,this),this.unregMsg(WxSdkMsg.OtherGameDataChanged,this.onOtherGameDataChanged,this),this.updateOtherGameIcon(!0),this.sendMsg(create(WxSdkMsg.HideBannerAd))},e.prototype.onShop=function(){},e.prototype.onRank=function(){this.sendMsg(create(WxSdkMsg.SendOpenDataContextCmd).init({head:WxOpenDataContextMsg.FRIEND_RANK_LIST}))},e.prototype.onShare=function(){this.sendMsg(create(WxSdkMsg.Share))},e.prototype.onTouch=function(t){var e=this.view;switch(t.currentTarget){case e.btn_share:this.onShare();break;case e.btn_rank:this.onRank();break;case e.btn_shop:this.onShop();break;case e.getWxOtherGameIcon(0):this.onOtherGame(0);break;case e.getWxOtherGameIcon(1):this.onOtherGame(1)}},e.prototype.onOtherGameDataChanged=function(){this.updateOtherGameIcon()},e.prototype.updateOtherGameIcon=function(t){if(void 0===t&&(t=!1),"weixin"==app.globalConfig.pf)for(var e=this.getModel(WxSDKModel).otherGameMng,n=this.view,r=0,i=e.groupCount;i>r;r++)n.getWxOtherGameIcon(r).setData(t?null:e.getCurrGameData(r))},e.prototype.onOtherGame=function(t){this.sendMsg(create(WxSdkMsg.ToOtherGame).init({groupIdx:t}))},e.prototype.onBtnStart=function(t){this.sendMsg(create(BattleMsg.cmd.EnterBattle)),this.sendMsg(create(MainModuleMsg.CloseMainView))},Object.defineProperty(e.prototype,"viewClass",{get:function(){return MainView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return MainModuleMsg.OpenMainView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return MainModuleMsg.CloseMainView},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(MainViewMediator.prototype,"MainViewMediator");var WxOtherGameIcon=function(t){function e(){var e=t.call(this)||this;return e.isPlayingAnim=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.touchChildren=!1},e.prototype.setData=function(t){t?(this.img_gameIcon.source=t.image_small,this.visible=!0,this.playAnim()):(this.visible=!1,this.stopAnim())},e.prototype.playAnim=function(){if(!this.isPlayingAnim){var t=this.img_gameIcon;egret.Tween.removeTweens(t),t.rotation=0,egret.Tween.get(t,{loop:!0}).to({rotation:-15},50).to({rotation:0},50).to({rotation:15},50).to({rotation:0},50).wait(5e3),this.isPlayingAnim=!0}},e.prototype.stopAnim=function(){if(this.isPlayingAnim){var t=this.img_gameIcon;egret.Tween.removeTweens(t),t.rotation=0,this.isPlayingAnim=!1}},e}(eui.Component);__reflect(WxOtherGameIcon.prototype,"WxOtherGameIcon",["eui.UIComponent","egret.DisplayObject"]),window.WxOtherGameIcon=WxOtherGameIcon;var PlayerModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._lv=1,e._highScore=0,e._skinId=1,e}return __extends(e,t),e.prototype.saveBattleRecord=function(t,e){var n=this.storageData;e&&e>this.highScore&&(this.highScore=e,n.highScore=e),t>this.lv&&(this.lv=t,n.lv=t),this.storageData=n,app.appHttp.submitBattleRecord(this.lv,this.highScore),this.sendMsg(create(WxSdkMsg.SetUserCloudStorage).init({KVDataList:[{key:"score_max",value:this.highScore.toString()}],success:function(){app.log("==== SetUserCloudStorage ====  success ")},fail:function(){app.log("==== SetUserCloudStorage ====  fail ")}}))},Object.defineProperty(e.prototype,"storageData",{get:function(){var t=egret.localStorage.getItem("playerData");return"string"==typeof t&&(t=JSON.parse(t)),t||(t=this.storageData={lv:1,highScore:0}),t},set:function(t){egret.localStorage.setItem("playerData",JSON.stringify(t))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return this._lv},set:function(t){this._lv=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highScore",{get:function(){return this._highScore},set:function(t){this._highScore=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exp",{get:function(){return LvConfigHelper.getExpByLv(this.lv)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinId",{get:function(){return this._skinId},set:function(t){this._skinId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},set:function(t){this._uid=t},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(PlayerModel.prototype,"PlayerModel");var PlayerModuleMsg;!function(t){var e;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.PlayerDataChanged=e,__reflect(e.prototype,"PlayerModuleMsg.feedBack.PlayerDataChanged")}(e=t.feedBack||(t.feedBack={}))}(PlayerModuleMsg||(PlayerModuleMsg={}));var SkinManager=function(){function t(){this._skinId=0,this.dg_SkinChanged=new VL.Delegate}return t.prototype.getCardColor=function(t){return SkinConfigHelper.getCardColor(this.skinId,t)},t.prototype.getCardImg=function(t){return SkinConfigHelper.getCardImg(this.skinId,t)},t.prototype.getLvColor=function(t){return SkinConfigHelper.getLvColor(this.skinId,t)},Object.defineProperty(t.prototype,"skinId",{get:function(){return this._skinId},set:function(t){t!=this._skinId&&(this._skinId=t,this.dg_SkinChanged.boardcast({skinId:this._skinId}))},enumerable:!0,configurable:!0}),t}();__reflect(SkinManager.prototype,"SkinManager");var SkinModel=function(t){function e(){var e=t.call(this)||this;return e._skinMng=new SkinManager,e._skinMng.skinId=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"skinId",{get:function(){return this._skinMng.skinId},set:function(t){this._skinMng.skinId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinMng",{get:function(){return this._skinMng},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(SkinModel.prototype,"SkinModel");var SystemModuleMvcCfg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getMediatorList=function(){return[new LoadMediator,new MainSceneMediator,new TestSceneMediator,new PopupMediator]},e.prototype.getControllerList=function(){return[new LoadResController,new StartupController,new SdkModuleController]},e}(VoyaMVC.MvcConfigBase);__reflect(SystemModuleMvcCfg.prototype,"SystemModuleMvcCfg");var SkinConfig=function(){function t(){}return t.prototype.attrs=function(){return["Id","lvColor","cardImg","cardColor","gameBgColor","rubbishBinBgColor","rubbishBinForeColor","scoreMultipleBgColor","cardForeColor"]},t}();__reflect(SkinConfig.prototype,"SkinConfig"),window.SkinConfig=SkinConfig;var App;!function(t){var e=function(){function t(){}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadConfig()];case 1:return t=n.sent(),this.s_configs={},t.map(function(t){var n=egret.getDefinitionByName(t.name);if(n){var r=t.data,i=r.length,o={};e.s_configs[t.name]=o;for(var a=0;i>a;a++){for(var s=new n,u=s.attrs(),c=r[a],h=0,p=u.length;p>h;h++)s[u[h]]=c[h];o[s[u[0]]]=s}}else egret.log(name+"在ConfigBase文件中未定义")}),[2]}})})},t.prototype.loadConfig=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,RES.getResAsync("config_json")];case 1:return[2,t.sent()]}})})},t.prototype.getConfig=function(t){var e=egret.getQualifiedClassName(t);return this.s_configs[e]},t}();t.Config=e,__reflect(e.prototype,"App.Config")}(App||(App={}));var LoadingView=function(t){function e(){var e=t.call(this,null)||this;return e.resources=["preload"],e}return __extends(e,t),e.prototype.onInit=function(){t.prototype.onInit.call(this);var e=this.tf_progress=new egret.TextField;e.textColor=16711680,e.size=40,this.addChild(e)},e.prototype.setProgress=function(t,e){this.tf_progress.text=t+" / "+e},e.prototype.onDestroy=function(){this.removeChild(this.tf_progress),this.tf_progress=null},e}(App.BaseAutoSizeView);__reflect(LoadingView.prototype,"LoadingView");var LoadMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"viewClass",{get:function(){return LoadingView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return LoadMsg.OpenLoadingView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return LoadMsg.CloseLoadingView},enumerable:!0,configurable:!0}),e.prototype.onViewOpen=function(){this.regTaskMsg()},e.prototype.onViewClose=function(){this.unregTaskMsg()},e.prototype.onOpenViewHandler=function(e){this.taskName=e.body.taskName,this.closeAfterComplete=e.body.closeAfterComplete,t.prototype.onOpenViewHandler.call(this,e)},e.prototype.onCloseViewHandler=function(e){t.prototype.onCloseViewHandler.call(this,e),this.taskName=null},e.prototype.onTaskProgress=function(t){if(this.view&&this.view.isInited){var e=t.body;e.taskName==this.taskName&&this.view.setProgress(e.curr,e.total)}},e.prototype.onTaskCancel=function(t){var e=t.body;e.taskName==this.taskName&&this.closeAfterComplete&&this.sendMsg(create(LoadMsg.CloseLoadingView))},e.prototype.onTaskComplete=function(t){var e=t.body;e.taskName==this.taskName&&this.closeAfterComplete&&this.sendMsg(create(LoadMsg.CloseLoadingView))},e.prototype.regTaskMsg=function(){this.regMsg(LoadMsg.OnTaskProgress,this.onTaskProgress,this),this.regMsg(LoadMsg.OnTaskComplete,this.onTaskComplete,this),this.regMsg(LoadMsg.OnTaskCancel,this.onTaskCancel,this)},e.prototype.unregTaskMsg=function(){this.unregMsg(LoadMsg.OnTaskProgress,this.onTaskProgress,this),this.unregMsg(LoadMsg.OnTaskComplete,this.onTaskComplete,this),this.unregMsg(LoadMsg.OnTaskCancel,this.onTaskCancel,this)},e}(ViewMediator);__reflect(LoadMediator.prototype,"LoadMediator");var LoadMsg;!function(t){var e;!function(t){t[t.VIEW=0]="VIEW",t[t.MASK=1]="MASK",t[t.NONE=2]="NONE"}(e=t.Enum_LoadStyle||(t.Enum_LoadStyle={}));var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.LoadRes=n,__reflect(n.prototype,"LoadMsg.LoadRes");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.AddEasyLoadingTask=r,__reflect(r.prototype,"LoadMsg.AddEasyLoadingTask");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenLoadingView=i,__reflect(i.prototype,"LoadMsg.OpenLoadingView");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseLoadingView=o,__reflect(o.prototype,"LoadMsg.CloseLoadingView");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OnTaskProgress=a,__reflect(a.prototype,"LoadMsg.OnTaskProgress");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OnTaskCancel=s,__reflect(s.prototype,"LoadMsg.OnTaskCancel");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OnTaskComplete=u,__reflect(u.prototype,"LoadMsg.OnTaskComplete")}(LoadMsg||(LoadMsg={}));var LoadResController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(LoadMsg.LoadRes,this.loadResHandler,this)},e.prototype.deactivate=function(){this.unregMsg(LoadMsg.LoadRes,this.loadResHandler,this)},e.prototype.loadResHandler=function(t){var e=this,n=app.resManager;n.loadResTask({keys:t.body.sources,taskName:t.body.taskName,onComplete:function(t){e.sendMsg(create(LoadMsg.OnTaskComplete).init({taskName:t.taskName}))},onProgress:function(t,n,r){e.sendMsg(create(LoadMsg.OnTaskProgress).init({curr:n,total:r,taskName:t.taskName}))},onCancel:function(t){e.sendMsg(create(LoadMsg.OnTaskCancel).init({taskName:t.taskName}))}})},e}(VoyaMVC.Controller);__reflect(LoadResController.prototype,"LoadResController");var SDKMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ON_APP_ACTIVE=e,__reflect(e.prototype,"SDKMsg.ON_APP_ACTIVE");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ON_LOGIN_SUCCESS=n,__reflect(n.prototype,"SDKMsg.ON_LOGIN_SUCCESS");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ON_SHARE_SUCCESS=r,__reflect(r.prototype,"SDKMsg.ON_SHARE_SUCCESS")}(SDKMsg||(SDKMsg={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var PopupMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(t){app.log("PopupWindowData:",t);var e=this.view;t.title&&t.title.length>0?(e.lb_title.parent||e.addChild(e.lb_title),e.lb_title.text=t.title):e.lb_title.parent&&e.removeChild(e.lb_title),e.btn_close.visible=t.showClose,EventHelper.addTapEvent(e.btn_close,this.onTap,this),this._customOnClose=t.onClose,e.lb_content.text=t.content},e.prototype.onViewClose=function(){var t=this.view;EventHelper.removeTapEvent(t.btn_close,this.onTap,this),this._customOnClose=null},e.prototype.onTap=function(t){var e=this.view;switch(t.currentTarget){case e.btn_close:this.sendMsg(create(PopupMsg.HidePopup)),this._customOnClose&&this._customOnClose()}},Object.defineProperty(e.prototype,"viewClass",{get:function(){return PopupWindow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return PopupMsg.ShowPopup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return PopupMsg.HidePopup},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(PopupMediator.prototype,"PopupMediator");var PopupMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ShowPopup=e,__reflect(e.prototype,"PopupMsg.ShowPopup");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.HidePopup=n,__reflect(n.prototype,"PopupMsg.HidePopup")}(PopupMsg||(PopupMsg={}));var PopupWindow=function(t){function e(){var e=t.call(this,"PopupWindowSkin")||this;return e.resources=[],e}return __extends(e,t),e.prototype.onInit=function(){},e.prototype.onDestroy=function(){},e}(App.BaseWindow);__reflect(PopupWindow.prototype,"PopupWindow");var MainScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(App.BaseScene);__reflect(MainScene.prototype,"MainScene");var MainSceneMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createScene=function(){return new MainScene},e}(SceneMediator);__reflect(MainSceneMediator.prototype,"MainSceneMediator");var TestScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(App.BaseScene);__reflect(TestScene.prototype,"TestScene");var TestSceneMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createScene=function(){return new TestScene},e}(SceneMediator);__reflect(TestSceneMediator.prototype,"TestSceneMediator");var SdkModuleController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(SDKMsg.InitSdk,this.onInitSdk,this)},e.prototype.deactivate=function(){this.unregMsg(SDKMsg.InitSdk,this.onInitSdk,this)},e.prototype.onInitSdk=function(t){switch(t.body.pf){case"weixin":this.registerController(new WxSdkController),this.registerMediator(new SC_FriendsRankMediator);break;default:this.registerController(new LocalSdkController)}},e}(VoyaMVC.Controller);__reflect(SdkModuleController.prototype,"SdkModuleController");var SDKMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.InitSdk=e,__reflect(e.prototype,"SDKMsg.InitSdk");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.Login=n,__reflect(n.prototype,"SDKMsg.Login")}(SDKMsg||(SDKMsg={}));var LocalSdkController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(SDKMsg.Login,this.onLogin,this)},e.prototype.deactivate=function(){this.unregMsg(SDKMsg.Login,this.onLogin,this)},e.prototype.onLogin=function(t){},Object.defineProperty(e.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),e}(VoyaMVC.Controller);__reflect(LocalSdkController.prototype,"LocalSdkController");var WxBannerAdMng=function(){function t(t){this._isShow=!1,this._systemInfo=t,this.dg_onError=new VL.Delegate}return t.prototype.showBanner=function(t){var e=this;void 0===t&&(t=null);var n=this._systemInfo;if(!this._isShow){var r=this._bannerAd=wx.createBannerAd({adUnitId:app.globalConfig.bannerAdUnitId,style:{left:0,top:0,width:Math.min(this.maxAdWidth,t?t.width:n.windowWidth),height:0}});return r.onError(function(t){var n=wx.WxAdErrorMap[t.errCode];e.dg_onError.boardcast({err:n}),egret.log("Banner广告错误："+n.code+"\n 描述："+n.desc+" \n 原因："+n.reason+"\n 解决方案："+n.solution)}),r.onResize(function(e){r.style.left=t?t.left:n.windowWidth-e.width>>1,r.style.top=t?t.top:n.windowHeight-e.height}),r.show(),this._isShow=!0,r}},t.prototype.hideBanner=function(){if(this._isShow){this._isShow=!1;var t=this._bannerAd;t&&(t.destroy(),t=null)}},Object.defineProperty(t.prototype,"maxAdWidth",{get:function(){return 1080/this._systemInfo.pixelRatio},enumerable:!0,configurable:!0}),t}();__reflect(WxBannerAdMng.prototype,"WxBannerAdMng");var WxSdkController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.sdk.dg_onActiveChanged.register(this.onActiveChanged,this),this.regMsg(SDKMsg.Login,this.onLogin,this),this.regMsg(WxSdkMsg.SendOpenDataContextCmd,this.onSendOpenDataContextCmd,this),this.regMsg(WxSdkMsg.SetUserCloudStorage,this.onSetUserCloudStorage,this),this.regMsg(WxSdkMsg.Share,this.onShare,this),this.regMsg(WxSdkMsg.ToOtherGame,this.onToOtherGame,this),this.regMsg(WxSdkMsg.WatchVideo_CMD,this.onWatchVideo,this),this.regMsg(WxSdkMsg.ShowBannerAd,this.onShowBannerAd,this),this.regMsg(WxSdkMsg.HideBannerAd,this.onHideBannerAd,this),this.sdk.init()},e.prototype.deactivate=function(){this.sdk.dg_onActiveChanged.unregister(this.onActiveChanged),this.unregMsg(SDKMsg.Login,this.onLogin,this),this.unregMsg(WxSdkMsg.SendOpenDataContextCmd,this.onSendOpenDataContextCmd,this),this.unregMsg(WxSdkMsg.SetUserCloudStorage,this.onSetUserCloudStorage,this),this.unregMsg(WxSdkMsg.Share,this.onShare,this),this.unregMsg(WxSdkMsg.ToOtherGame,this.onToOtherGame,this),this.unregMsg(WxSdkMsg.WatchVideo_CMD,this.onWatchVideo,this),this.unregMsg(WxSdkMsg.ShowBannerAd,this.onShowBannerAd,this),this.unregMsg(WxSdkMsg.HideBannerAd,this.onHideBannerAd,this)},e.prototype.onActiveChanged=function(t){t.isActive&&this.handleShareQuery(t.showArgs.query)},e.prototype.handleShareQuery=function(t){var e=this.sdk,n=e.shareQueryData,r=e.openId,i=!1;t&&t.inviteOpenId&&t.inviteOpenId!=r&&(i=n&&n.inviteOpenId?t.inviteOpenId!=n.inviteOpenId:!0,e.shareQueryData=t),i&&app.appHttp.enterFromShare(n.inviteUserId,n.inviteOpenId,function(t,e){app.log("=== 受邀成功 ===",n)
},this)},e.prototype.onLogin=function(t){var e=this;app.log("sdkLogin"),wx.login({success:function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.reqLogin(t.code)];case 1:return e.sent(),[4,this.reqExamineStatus()];case 2:return e.sent(),[4,this.reqAboutShare()];case 3:return e.sent(),[4,this.reqGetOtherGamesInfo()];case 4:return e.sent(),[2]}})})}})},e.prototype.reqLogin=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=this.sdk,n=e.shareQueryData,[4,app.appHttp.login(n.inviteOpenId||"",n.inviteUserId||0,e.systemPf||0,n.source||"",n.source_lv||0,n.contentId||0,t,function(t,e){app.log("login resp data:",t);var n=r.sdk.pfUserInfo;n.nickname=t.nickname,n.gender=t.sex,r.sdk.openId=t.openid;var i=r.playerModel;i.uid=t.id;var o=i.storageData,a=parseFloat(t.score_max),s=parseInt(t.lv);o.highScore=Math.max(o.highScore,a),o.lv=Math.max(o.lv,s),(o.lv>s||o.highScore>a)&&app.appHttp.submitBattleRecord(o.lv,o.highScore),i.storageData=o,i.highScore=o.highScore,i.lv=o.lv,r.handleShareQuery(wx.getLaunchOptionsSync().query)})];case 1:return i.sent(),[2]}})})},e.prototype.reqAboutShare=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,app.appHttp.getAboutShare(function(e,n){var r=t.sdk;r.shareInfoList=[];for(var i=e.content_list,o=e.id_list,a=e.image_list,s=0,u=o.length;u>s;s++)r.shareInfoList.push({content:i[s],contentId:o[s],imgUrl:a[s]})})];case 1:return e.sent(),[2]}})})},e.prototype.reqGetOtherGamesInfo=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,app.appHttp.getOtherGamesInfo(function(e,n){t.sdk.otherGameMng.setInfo([e.image_list,e.image_list_2])})];case 1:return e.sent(),[2]}})})},e.prototype.reqExamineStatus=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,app.appHttp.getGameExamineStatus(function(e,n){t.sdk.isExamine=2==e.status})];case 1:return e.sent(),[2]}})})},e.prototype.onSendOpenDataContextCmd=function(t){var e=t.body.head,n=t.body.body;switch(e){case WxOpenDataContextMsg.FRIEND_RANK_LIST:this.sendMsg(create(WxSdkMsg.OpenFriendRankListView))}var r=new WxOpenDataContextMsg(e,n);wx.getOpenDataContext().postMessage(r)},e.prototype.onSetUserCloudStorage=function(t){wx.setUserCloudStorage(t.body)},e.prototype.onShare=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getUserInfo()];case 1:return t=r.sent(),e=this.sdk.getRandomShareInfo(),app.log("shareInfo:",e),n={source:t.source,source_lv:t.source_lv,inviteOpenId:t.openid,inviteUserId:t.user_id,contentId:e.contentId},wx.shareAppMessage({title:e.content,imageUrl:e.imgUrl,query:Utils.StringUtils.ObjectToQueryFormatString(n)}),app.appHttp.shareStatistics(e.contentId,null,null),[2]}})})},e.prototype.onToOtherGame=function(t){var e=t.body.groupIdx,n=this.sdk.otherGameMng;n.toOtherGame(e)},e.prototype.onWatchVideo=function(t){var e=this,n=this.sdk.videoMng,r=t.body.flag,i=t.body.showAlertWhenGiveUp,o=function(t){e.sendMsg(create(WxSdkMsg.WatchVideo_FeedBack).init({result:0==t.err.code?Enum_WxWatchVideoResult.NO_AD_COUNT:Enum_WxWatchVideoResult.ERROR,flag:r,error:t.err})),n.dg_onError.unregister(o)};n.dg_onError.register(o,this),n.show(function(t,a){n.dg_onError.unregister(o),e.sendMsg(create(WxSdkMsg.WatchVideo_FeedBack).init({result:t?Enum_WxWatchVideoResult.COMPLETE:Enum_WxWatchVideoResult.GIVE_UP,flag:r})),!t&&i&&e.sendMsg(create(PopupMsg.ShowPopup).init({content:"要将视频看完才能获得相应奖励哦~！",showClose:!0}))},this),app.appHttp.sendWatchTVStep(r,1,null,null)},e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(n){switch(n.label){case 0:return[4,app.appHttp.getUseinfo(function(n,r){e.sdk.openId=n.openid,t={user_id:n.user_id,openid:n.openid,source:n.source,source_lv:n.source_lv}})];case 1:return n.sent(),[2,t]}})})},e.prototype.onShowBannerAd=function(t){this.sdk.wxBannerAdMng.showBanner(t.body?t.body.style:null)},e.prototype.onHideBannerAd=function(t){this.sdk.wxBannerAdMng.hideBanner()},Object.defineProperty(e.prototype,"playerModel",{get:function(){return this.getModel(PlayerModel)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sdk",{get:function(){return this.getModel(WxSDKModel)},enumerable:!0,configurable:!0}),e}(VoyaMVC.Controller);__reflect(WxSdkController.prototype,"WxSdkController");var WxSDKModel=function(t){function e(){var e=t.call(this)||this;return e.dg_onActiveChanged=new VL.Delegate,e.isExamine=!1,e.pfUserInfo=new WxUserInfo,e._otherGameMng=new WxOtherGameManager,e._otherGameMng.dg_dataChanged.register(e.onOtherGameDataChanged,e),e._videoMng=new WxVideoMng,e._wxBannerAdMng=new WxBannerAdMng(e.systemInfo),e}return __extends(e,t),e.prototype.init=function(){this.initLaunchOptions(),this.initActiveChange(),this.initAppUpdateMng(),this.initShare(),this._videoMng.init()},e.prototype.initLaunchOptions=function(){var t=wx.getLaunchOptionsSync();this.shareQueryData=t.query},e.prototype.initShare=function(){var t=this;wx.showShareMenu({withShareTicket:!0}),wx.onShareAppMessage(function(e){console.log("onShareAppMessage:",e);var n=t.getRandomShareInfo();return{title:n.content,imageUrl:n.imgUrl,query:"shareContentId="+n.contentId}})},e.prototype.initActiveChange=function(){var t=this;wx.onShow(function(e){t.dg_onActiveChanged.boardcast({isActive:!0,showArgs:e})}),wx.onHide(function(){app.log("app进入后台~~~~~~~~~~~~~~~~~~~~~~~~"),t.dg_onActiveChanged.boardcast({isActive:!1})})},e.prototype.initAppUpdateMng=function(){var t=wx.getUpdateManager();t.onCheckForUpdate(function(t){console.log("请求完新版本信息的回调",t.hasUpdate)}),t.onUpdateReady(function(){wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(e){e.confirm&&t.applyUpdate()}})}),t.onUpdateFailed(function(){console.log("新的版本下载失败")})},e.prototype.onShareAppMessage=function(t){app.log("onShareAppMessage:",t);var e=this.getRandomShareInfo();return{title:e.content,imageUrl:e.imgUrl,query:"shareContentId="+e.contentId}},e.prototype.getRandomShareInfo=function(){return Utils.ArrayUtils.randomElement(this.shareInfoList)},e.prototype.onOtherGameDataChanged=function(){this.sendMsg(create(WxSdkMsg.OtherGameDataChanged))},Object.defineProperty(e.prototype,"systemPf",{get:function(){if(!this._systemPf){var t=this.systemInfo.system.toLowerCase();t.indexOf("android")>0?this._systemPf=Enum_System.ANDROID:t.indexOf("ios")>0&&(this._systemPf=Enum_System.IOS)}return this._systemPf},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"systemInfo",{get:function(){return this._systemInfo||(this._systemInfo=wx.getSystemInfoSync()),this._systemInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"otherGameMng",{get:function(){return this._otherGameMng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoMng",{get:function(){return this._videoMng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wxBannerAdMng",{get:function(){return this._wxBannerAdMng},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(WxSDKModel.prototype,"WxSDKModel");var WxSdkMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.SendOpenDataContextCmd=e,__reflect(e.prototype,"WxSdkMsg.SendOpenDataContextCmd");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.Share=n,__reflect(n.prototype,"WxSdkMsg.Share");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OtherGameDataChanged=r,__reflect(r.prototype,"WxSdkMsg.OtherGameDataChanged");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ToOtherGame=i,__reflect(i.prototype,"WxSdkMsg.ToOtherGame");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.SetUserCloudStorage=o,__reflect(o.prototype,"WxSdkMsg.SetUserCloudStorage");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.WatchVideo_CMD=a,__reflect(a.prototype,"WxSdkMsg.WatchVideo_CMD");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.WatchVideo_FeedBack=s,__reflect(s.prototype,"WxSdkMsg.WatchVideo_FeedBack");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.ShowBannerAd=u,__reflect(u.prototype,"WxSdkMsg.ShowBannerAd");var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.HideBannerAd=c,__reflect(c.prototype,"WxSdkMsg.HideBannerAd");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenFriendRankListView=h,__reflect(h.prototype,"WxSdkMsg.OpenFriendRankListView");var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseFriendRankListView=p,__reflect(p.prototype,"WxSdkMsg.CloseFriendRankListView")}(WxSdkMsg||(WxSdkMsg={}));var WxVideoMng=function(){function t(){this._isPlaying=!1,this._isError=!1,this.loadVideoFailCount=0,this._video=wx.createRewardedVideoAd({adUnitId:app.globalConfig.videoAdUnitId}),this.dg_onError=new VL.Delegate}return t.prototype.init=function(){var t=this,e=this._video;e.onError(function(e){t._isPlaying=!1,t._isError=!0;var n=wx.WxAdErrorMap[e.errCode];t.dg_onError.boardcast({err:n}),egret.log("激励视频错误："+n.code+"\n 描述："+n.desc+" \n 原因："+n.reason+"\n 解决方案："+n.solution)})},t.prototype.show=function(t,e,n){return void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return app.log("show isPlaying:"+this._isPlaying),this._isPlaying?[2]:(r=this._video,this.loadVideoFailCount=0,this._isError=!1,app.log("before showVideo isPlaying:"+this._isPlaying),o=this,[4,this.showVideo()]);case 1:return i=o._isPlaying=u.sent(),app.log("after showVideo isPlaying:"+this._isPlaying),i?(a=function(i){var o=!1;(i&&i.isEnded||void 0===i)&&(o=!0),r.offClose(a),s._isPlaying=!1,s._isError=!1,t.call(e,o,n)},r.onClose(a),[2]):[2]}})})},t.prototype.showVideo=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n=this;return __generator(this,function(r){switch(r.label){case 0:return t=this._video,e=!0,[4,t.show()["catch"](function(r){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return e=!1,!this._isError||this.loadVideoFailCount++<3?[4,t.load()]:[3,3];case 1:return n.sent(),[4,this.showVideo()];case 2:e=n.sent(),n.label=3;case 3:return[2]}})})})];case 1:return r.sent(),[2,e]}})})},t}();__reflect(WxVideoMng.prototype,"WxVideoMng");var Enum_WxWatchVideoResult;!function(t){t[t.COMPLETE=1]="COMPLETE",t[t.GIVE_UP=2]="GIVE_UP",t[t.NO_AD_COUNT=3]="NO_AD_COUNT",t[t.ERROR=4]="ERROR"}(Enum_WxWatchVideoResult||(Enum_WxWatchVideoResult={}));var WxOpenDataContextMsg=function(){function t(t,e){this.head=t,this.body=e}return t.INIT_DATA="WxOpenDataContextMsg_INIT_DATA",t.CLOSE_CONTEXT="WxOpenDataContextMsg_CLOSE",t.FRIEND_RANK_LIST="WxOpenDataContextMsg_FriendRankList",t.FRIEND_NEAREST_RANK_LIST="WxOpenDataContextMsg_FRIEND_NEAREST_RANK_LIST",t.GROUP_RANK_LIST="WxOpenDataContextMsg_GROUP_RANK_LIST",t.UPDATE_PLAYER_DATA="WxOpenDataContextMsg_UPDATE_PLAYER_DATA",t}();__reflect(WxOpenDataContextMsg.prototype,"WxOpenDataContextMsg");var Enum_WxShareCanvasOpenType;!function(t){t[t.FRIEND_RANK_LIST=1]="FRIEND_RANK_LIST",t[t.GROUP_RANK_LIST=2]="GROUP_RANK_LIST"}(Enum_WxShareCanvasOpenType||(Enum_WxShareCanvasOpenType={}));var App;!function(t){var e=function(){function t(t){this.sourceJson=t}return Object.defineProperty(t.prototype,"sourceJson",{set:function(t){this._json=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"client_version",{get:function(){return this._json.client_version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDebug",{get:function(){return this._json.isDebug},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCDN",{get:function(){return this._json.isCDN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resRoot",{get:function(){return this.isCDN?this._json.CDN_RESOURCE:this._json.LOCAL_RESOURCE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pf",{get:function(){return this._json.pf},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"httpServer",{get:function(){return this._json.HttpServer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverPort",{get:function(){return this._json.serverPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoAdUnitId",{get:function(){return this._json.videoAdUnitId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bannerAdUnitId",{get:function(){return this._json.bannerAdUnitId},enumerable:!0,configurable:!0}),t}();t.GlobalCfg=e,__reflect(e.prototype,"App.GlobalCfg")}(App||(App={}));var SC_FriendsRankView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.resources=[],e}return __extends(e,t),e.prototype.onDestroy=function(){},e}(ShareCanvasView);__reflect(SC_FriendsRankView.prototype,"SC_FriendsRankView");var SC_FriendsRankMediator=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onViewOpen=function(){t.prototype.onViewOpen.call(this)},e.prototype.onViewClose=function(){t.prototype.onViewClose.call(this)},Object.defineProperty(e.prototype,"viewClass",{get:function(){return SC_FriendsRankView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return WxSdkMsg.OpenFriendRankListView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return WxSdkMsg.CloseFriendRankListView},enumerable:!0,configurable:!0}),e.prototype.onBack=function(){this.sendMsg(create(WxSdkMsg.CloseFriendRankListView))},e}(ShareCanvasMediator);__reflect(SC_FriendsRankMediator.prototype,"SC_FriendsRankMediator");var WxOtherGameManager=function(){function t(){this.dg_dataChanged=new VL.Delegate,this._currGroupDataIdx=[]}return t.prototype.setInfo=function(t){this._otherGameDataGroups=t;for(var e=0,n=t.length;n>e;e++)this._currGroupDataIdx.push(0);this.dg_dataChanged.boardcast()},t.prototype.getCurrGameData=function(t){var e=this._otherGameDataGroups[t],n=this._currGroupDataIdx[t];return e[n]},Object.defineProperty(t.prototype,"groupCount",{get:function(){return this._otherGameDataGroups?this._otherGameDataGroups.length:0},enumerable:!0,configurable:!0}),t.prototype.toOtherGame=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(n){return[2,new Promise(function(n,r){var i=e.getCurrGameData(t);wx.navigateToMiniProgram({appId:i.game_appid,success:function(){app.log("跳转至其他游戏成功 appid："+i.game_appid)},complete:function(){++e._currGroupDataIdx[t]>=e._otherGameDataGroups[t].length&&(e._currGroupDataIdx[t]=0),e.dg_dataChanged.boardcast(),n()},fail:function(){app.log("跳转至其他游戏失败…… appid："+i.game_appid)}})})]})})},t}();__reflect(WxOtherGameManager.prototype,"WxOtherGameManager");var WxUserInfo=function(){function t(){}return t}();__reflect(WxUserInfo.prototype,"WxUserInfo");var StartupController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(StartupMsg.Startup,this.onStartup,this)},e.prototype.deactivate=function(){this.unregMsg(StartupMsg.Startup,this.onStartup,this)},e.prototype.onStartup=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.sendMsg(create(SystemMsg.EnterScene).init({scene:MainScene})),[4,this.loadCfg()];case 1:return t.sent(),this.regMsg(LoadMsg.OnTaskComplete,this.onLoadResComplete,this),this.sendMsg(create(LoadMsg.OpenLoadingView).init({taskName:"preload",closeAfterComplete:!1})),this.sendMsg(create(LoadMsg.LoadRes).init({sources:["preload"],taskName:"preload"})),[2]}})})},e.prototype.loadCfg=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=app.globalConfig.resRoot,[4,RES.loadConfig(t+"default.res.json",t)];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,app.config.init()];case 3:return n.sent(),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",StageUtils.getStage());r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})]})})},e.prototype.onLoadResComplete=function(t){"preload"==t.body.taskName&&(this.unregMsg(LoadMsg.OnTaskComplete,this.onLoadResComplete,this),this.sendMsg(create(LoadMsg.CloseLoadingView)),this.sendMsg(create(SDKMsg.InitSdk).init({pf:app.globalConfig.pf})),this.sendMsg(create(SDKMsg.Login)),this.sendMsg(create(MainModuleMsg.OpenMainView)))},e}(VoyaMVC.Controller);__reflect(StartupController.prototype,"StartupController");var StartupMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.Startup=e,__reflect(e.prototype,"StartupMsg.Startup")}(StartupMsg||(StartupMsg={}));var TestEvent=function(){function t(){this.testDg=new VL.Delegate,this.testDg1=new VL.Delegate,this.testDg2=new VL.Delegate,this.testDg3=new VL.Delegate}return t}();__reflect(TestEvent.prototype,"TestEvent",["VoyaMVC.IEvent"]);var TestController=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(){this.regMsg(TestModuleMsg.RunTest,this.runTestHandler,this)},e.prototype.deactivate=function(){this.unregMsg(TestModuleMsg.RunTest,this.runTestHandler,this)},e.prototype.runTestHandler=function(){var t=this.getModel(TestModel).dataContent;this.sendMsg(create(TestModuleMsg.SetTfContent).init(t)),this.sendMsg(create(TestModuleMsg.SetTfVisible).init({visible:!0}))},e}(VoyaMVC.Controller);__reflect(TestController.prototype,"TestController");var TestMediator=function(t){function e(){var e=t.call(this)||this;return e.viewClass=TestView,e.tf=new egret.TextField,e}return __extends(e,t),e.prototype.onViewOpen=function(){this.regMsg(TestModuleMsg.SetTfVisible,this.tfVisibleHandler,this),this.regMsg(TestModuleMsg.SetTfContent,this.setTfContentHandler,this)},e.prototype.onViewClose=function(){this.unregMsg(TestModuleMsg.SetTfVisible,this.tfVisibleHandler,this),this.unregMsg(TestModuleMsg.SetTfContent,this.setTfContentHandler,this)},e.prototype.tfVisibleHandler=function(t){var e=t.body.visible,n=this.tf;e?StageUtils.getStage().addChild(n):n.parent&&n.parent.removeChild(n)},e.prototype.setTfContentHandler=function(t){var e=t.body;this.tf.text=e.num+"  "+e.str},Object.defineProperty(e.prototype,"openViewMsg",{get:function(){return TestModuleMsg.OpenTestView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeViewMsg",{get:function(){return TestModuleMsg.CloseTestView},enumerable:!0,configurable:!0}),e}(ViewMediator);__reflect(TestMediator.prototype,"TestMediator");var TestModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"dataContent",{get:function(){return{num:1,str:"hello world~"}},enumerable:!0,configurable:!0}),e}(VoyaMVC.Model);__reflect(TestModel.prototype,"TestModel");var TestModuleCfg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getMediatorList=function(){return[new TestMediator]},e.prototype.getControllerList=function(){return[new TestController]},e}(VoyaMVC.MvcConfigBase);__reflect(TestModuleCfg.prototype,"TestModuleCfg");var TestModuleMsg;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.RunTest=e,__reflect(e.prototype,"TestModuleMsg.RunTest");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.SetTfVisible=n,__reflect(n.prototype,"TestModuleMsg.SetTfVisible");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.SetTfContent=r,__reflect(r.prototype,"TestModuleMsg.SetTfContent");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.OpenTestView=i,__reflect(i.prototype,"TestModuleMsg.OpenTestView");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(VoyaMVC.Msg);t.CloseTestView=o,__reflect(o.prototype,"TestModuleMsg.CloseTestView")}(TestModuleMsg||(TestModuleMsg={}));var TestView=function(t){function e(){var e=t.call(this,null)||this;e.resources=[];var n=new egret.Shape,r=n.graphics;return r.beginFill(0),r.drawRect(0,0,1334,750),r.endFill(),e.addChild(n),e}return __extends(e,t),e.prototype.onInit=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.bg=new egret.Bitmap,t=this.bg,[4,app.resManager.getResAsync_promise("bg_jpg")];case 1:return t.texture=e.sent(),this.addChild(this.bg),[2]}})})},e.prototype.onDestroy=function(){this.bg=null},e}(App.BaseAutoSizeView);__reflect(TestView.prototype,"TestView");var VL;!function(t){var e=function(){function t(){this.reset()}return t.prototype.reset=function(){this._matrix||(this._matrix=[]);for(var t=this._matrix,e=0,n=t.length;n>e;e++)t[e]=0;t[0]=t[6]=t[12]=t[18]=1},t.prototype.getMatrix=function(){return this._isChanged&&(this.reset(),this.setRGB(),this.setSaturation(),this.setContrastRatio(),this.setBrightness(),this.setAlpha(),this._isChanged=!1),this._matrix.concat()},t.prototype.setRGB=function(){var t=this.r,e=this.g,n=this.b,r=Math.max(t,e,n),i=Math.min(t,e,n),o=r+i>>1,a=this._matrix;a[0]+=(t-o)/o,a[6]+=(e-o)/o,a[12]+=(n-o)/o},t.prototype.setSaturation=function(){var t=this._matrix,e=this.saturation;t[0]=.3086*(t[0]-e)+e,t[1]=.6094*(t[1]-e),t[2]=.082*(t[2]-e),t[5]=.3086*(t[5]-e),t[6]=.6094*(t[6]-e)+e,t[7]=.082*(t[7]-e),t[10]=.3086*(t[10]-e),t[11]=.6094*(t[11]-e),t[12]=.082*(t[12]-e)+e},t.prototype.setBrightness=function(){var t=this.brightness,e=this._matrix;e[4]+=t,e[9]+=t,e[14]+=t},t.prototype.setAlpha=function(){this._matrix[18]=this.a},t.prototype.setContrastRatio=function(){var t=this.contrastRatio,e=this._matrix;e[0]*=t,e[4]+=128*(e[4]-t),e[6]*=t,e[9]+=128*(e[9]-t),e[12]*=t,e[14]+=128*(e[14]-t)},Object.defineProperty(t.prototype,"r",{get:function(){return this._r},set:function(t){this._r!=t&&(this._r=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._g},set:function(t){this._g!=t&&(this._g=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._b},set:function(t){this._b!=t&&(this._b=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._a},set:function(t){this._a!=t&&(this._a=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"saturation",{get:function(){return this._saturation},set:function(t){this._saturation!=t&&(this._saturation=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"brightness",{get:function(){return this._brightness},set:function(t){this._brightness!=t&&(this._brightness=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrastRatio",{get:function(){return this._contrastRatio},set:function(t){this._contrastRatio!=t&&(this._contrastRatio=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this._matrix},set:function(t){this._matrix!=t&&(this._matrix=t,this._isChanged=!0)},enumerable:!0,configurable:!0}),t}();t.ColorMatrix=e,__reflect(e.prototype,"VL.ColorMatrix")}(VL||(VL={}));var CardConfigHelper=function(){function t(){}return t.getNormalCardByValue=function(t){var e,n=app.config.getConfig(CardConfig);for(var r in n)if(e=n[r],e.type==Enum_CardType.NORMAL&&e.value==t)return e;return null},Object.defineProperty(t,"maxValueCard",{get:function(){if(!this._maxValueCard)for(var t=this.getCardsByType(Enum_CardType.NORMAL),e=0,n=void 0,r=0,i=t.length;i>r;r++)n=t[r],n.value>e&&(e=n.value,this._maxValueCard=n);return this._maxValueCard},enumerable:!0,configurable:!0}),t.getCardsByType=function(t){var e=this._cardsByType[t];if(e)return e;var n,r=app.config.getConfig(CardConfig);e=[];for(var i in r)if(n=r[i],n.type==t&&(e.push(n),t!=Enum_CardType.NORMAL))break;return Object.freeze(e),this._cardsByType[t]=e,e},t._cardsByType={},t}();__reflect(CardConfigHelper.prototype,"CardConfigHelper");var VL;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cmdList=[],e._currIdx=-1,e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=[]);var e,n;for(n=t.length,e=0;n>e;e++)this.add(t[e]);return this},e.prototype.add=function(t){return this._cmdList.indexOf(t)<0&&this._cmdList.push(t),this},e.prototype.remove=function(t){var e=this._cmdList.indexOf(t);return e>0&&this._cmdList.splice(e,1),this},e.prototype.execute=function(){this.executeNext()},e.prototype.executeNext=function(){if(null==this._cmdList[this._currIdx+1])return void this.closeAsync();this._currIdx++;var t=this._cmdList[this._currIdx];this._currCmd=t,t.dg_commandCompleted.register(this.onSingleCmdCompleted,this),t.autoRestore&&(t.autoRestore=!1),t.openAsync()},e.prototype.onSingleCmdCompleted=function(t){this._currCmd.dg_commandCompleted.unregister(this.onSingleCmdCompleted),t.isAbort?this.closeAsync(t.isRecursion):this._currIdx==this._cmdList.length-1?this.closeAsync():this.executeNext()},e.prototype.closeAsync=function(t){void 0===t&&(t=!1),this.isOpened&&(this._currCmd&&this._currCmd.dg_commandCompleted.unregister(this.onSingleCmdCompleted),this._currCmd=null,this._currIdx=-1,this.clear(),this._isOpened=!1,this.dg_commandCompleted.boardcast({isAbort:t,isRecursion:t}),this.autoRestore&&this.restore())},e.prototype.clear=function(){var t,e;for(e=this._cmdList.length,t=0;e>t;t++)this._cmdList[t].restore();this._cmdList.length=0},e}(t.Command);t.CommandGroup=e,__reflect(e.prototype,"VL.Command.CommandGroup")}(e=t.Command||(t.Command={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=null),this._fun=t,this._argsArr=n,this._thisArg=e,this},e.prototype.execute=function(){null!=this._fun&&this._fun.apply(this._thisArg,this._argsArr),this.closeAsync()},e.prototype.clear=function(){this._fun=null,this._thisArg=null,this._argsArr=null},e}(t.Command);__reflect(e.prototype,"DelegateCommand")}(e=t.Command||(t.Command={}))}(VL||(VL={}));var VL;!function(t){var e=function(){function t(){this._funList=[],this._thisArgList=[]}return Object.defineProperty(t.prototype,"count",{get:function(){return this._funList.length},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return-1!=this._funList.indexOf(t)},t.prototype.register=function(t,e){!this.has(t)&&t&&(this._funList.push(t),this._thisArgList.push(e))},t.prototype.unregister=function(t){if(this.has(t)){var e=this._funList.indexOf(t);this._funList.splice(e,1),this._thisArgList.splice(e,1)}},t.prototype.clear=function(){this._funList.length=0,this._thisArgList.length=0},t.prototype.boardcast=function(t){for(var e=0;e<this._funList.length;e++){var n=this._funList[e],r=this._thisArgList[e];r?n.call(r,t):n(t)}},t}();t.Delegate=e,__reflect(e.prototype,"VL.Delegate")}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(){this._containerList=[]}return t.prototype.regDragItem=function(t){t.dragItemCtrl.dg_DragBegin.register(this.onDragBegin,this),t.dragItemCtrl.dg_DragEnd.register(this.onDragEnd,this),t.dragItemCtrl.enableDrag=!0},t.prototype.unregDragItem=function(t){t.dragItemCtrl.dg_DragBegin.unregister(this.onDragBegin),t.dragItemCtrl.dg_DragEnd.unregister(this.onDragEnd),t.dragItemCtrl.enableDrag=!1},t.prototype.regDropContainer=function(t){this._containerList.indexOf(t)<0&&(this._containerList.push(t),t.dropContainerCtrl.dg_onDragIn.register(this.onDragIn,this),t.dropContainerCtrl.dg_onDragOut.register(this.onDragOut,this),t.dropContainerCtrl.enableDrop=!0,this._currDragItem&&t.dropContainerCtrl.onDragBegin(this._currDragItem))},t.prototype.unregDropContainer=function(t){var e=this._containerList.indexOf(t);e>=0&&(this._containerList.splice(e,1),t.dropContainerCtrl.dg_onDragIn.unregister(this.onDragIn),t.dropContainerCtrl.dg_onDragOut.unregister(this.onDragOut),t.dropContainerCtrl.enableDrop=!1,t.dropContainerCtrl.onDragEnd(this._currDragItem))},t.prototype.onDragBegin=function(t){this._currDragItem=t;for(var e=0,n=this._containerList.length;n>e;e++)this._containerList[e].dropContainerCtrl.onDragBegin(t)},t.prototype.onDragEnd=function(t){for(var e=0;e<this._containerList.length;e++)this._containerList[e].dropContainerCtrl.onDragEnd(t);t.dragItemCtrl.onDropTo(this._currContainer),this._currDragItem=null,this._currContainer=null},t.prototype.onDragIn=function(t){this._currContainer=t},t.prototype.onDragOut=function(t){this._currContainer==t&&(this._currContainer=null)},t}();t.DragDropManager=e,__reflect(e.prototype,"VL.DragDrop.DragDropManager")}(e=t.DragDrop||(t.DragDrop={}))}(VL||(VL={}));var LvConfigHelper=function(){function t(){}return Object.defineProperty(t,"arrLvExp",{get:function(){if(!this._arrLvExp){var t=[],e=app.config.getConfig(LvConfig);for(var n in e)t.push(e[n].needExp);Utils.ArrayUtils.quickSort(t,function(t,e){return t-e}),this._arrLvExp=t}return this._arrLvExp},enumerable:!0,configurable:!0}),t.getLvByExp=function(t){for(var e,n,r,i=0,o=this.arrLvExp.length;o>i;i++){if(n=this.arrLvExp[i],r=this.arrLvExp[i+1],!r&&0!=r){e=i+1;break}if(t>=n&&r>t){e=i+1;break}}return e},t.getExpByLv=function(t){return this.arrLvExp[t-1]},Object.defineProperty(t,"maxLv",{get:function(){return this.arrLvExp.length},enumerable:!0,configurable:!0}),t}();__reflect(LvConfigHelper.prototype,"LvConfigHelper");var PublicConfigHelper=function(){function t(){}return t.CARD_GROUP_COUNT=4,t.MAX_RUBBISH_COUNT=2,t.MAX_HAND_CARD_COUNT=2,t.MAX_GROUP_CARDS_COUNT=8,t.INITIAL_REFRESH_HAND_CARD_CHANCE=1,t}();__reflect(PublicConfigHelper.prototype,"PublicConfigHelper");var VL;!function(t){var e;!function(e){var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.init=function(t,e){return this._degree=t,this._r=e,this},n.prototype.clear=function(){this._degree=0,this._r=0},n.prototype.fromPoint=function(t){return this._r=Math.sqrt(t.x*t.x+t.y*t.y),this._degree=e.radian2Degree(Math.atan2(t.y,t.x)),this},n.prototype.toPoint=function(t){void 0===t&&(t=null);var n=this.r*Math.cos(e.degree2Radian(this._degree)),r=this.r*Math.sin(e.degree2Radian(this._degree));return t?t.setTo(n,r):egret.Point.create(n,r)},n.prototype.fromVector2D=function(t){return this._r=Math.sqrt(t.x*t.x+t.y*t.y),this._degree=e.radian2Degree(Math.atan2(t.y,t.x)),this
},n.prototype.toVector=function(t){void 0===t&&(t=null);var n=this.r*Math.cos(e.degree2Radian(this._degree)),r=this.r*Math.sin(e.degree2Radian(this._degree));return t?t.init(n,r):create(e.Vector2D).init(n,r)},n.prototype.setDegreeByArcLength=function(t){return 0!=this.r&&(this._degree=180*t/(Math.PI*this.r)),this},n.prototype.addDegreeByArcLength=function(t){return 0!=this.r&&(this._degree+=180*t/(Math.PI*this.r)),this},Object.defineProperty(n.prototype,"degree",{get:function(){return this._degree},set:function(t){this._degree=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"r",{get:function(){return this._r},set:function(t){this._r=t},enumerable:!0,configurable:!0}),n}(t.ObjectCache.CacheableClass);e.PolarCoordinates=n,__reflect(n.prototype,"VL.Geom.PolarCoordinates")}(e=t.Geom||(t.Geom={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t,e,n,r){return this._x1=t,this._y1=e,this._x2=n,this._y2=r,this},e.prototype.initByPoint=function(t,e){return this._x1=t.x,this._y1=t.y,this._x2=e.x,this._y2=e.y,this},e.prototype.setPoint1=function(t,e){return this._x1=t,this._y1=e,this},e.prototype.setPoint1ByPoint=function(t){return this._x1=t.x,this._y1=t.y,this},e.prototype.setPoint2=function(t,e){return this._x2=t,this._y2=e,this},e.prototype.setPoint2ByPoint=function(t){return this._x2=t.x,this._y2=t.y,this},e.prototype.clear=function(){this._x1=0,this._y1=0,this._x2=0,this._y2=0},e.prototype.dist2Point=function(t){var e=t.x,n=t.y,r=this.x1,i=this.y1,o=this.x2,a=this.y2,s=(o-r)*(e-r)+(a-i)*(n-i);if(0>=s)return Math.sqrt((e-r)*(e-r)+(n-i)*(n-i));var u=(o-r)*(o-r)+(a-i)*(a-i);if(s>=u)return Math.sqrt((e-o)*(e-o)+(n-a)*(n-a));var c=s/u,h=r+(o-r)*c,p=i+(a-i)*c;return Math.sqrt((e-h)*(e-h)+(p-i)*(p-i))},e.prototype.checkCross=function(t){var e=this.determinant(this.x2-this.x1,t.x1-t.x2,this.y2-this.y1,t.y1-t.y2);if(0==e)return!1;var n=this.determinant(t.x1-this.x1,t.x1-t.x2,t.y1-this.y1,t.y1-t.y2)/e;if(n>1||0>n)return!1;var r=this.determinant(this.x2-this.x1,t.x1-this.x1,this.y2-this.y1,t.y1-this.y1)/e;return r>1||0>r?!1:!0},e.prototype.determinant=function(t,e,n,r){return t*r-e*n},e.prototype.move=function(t,e){this._x1+=t,this._x2+=t,this._y1+=e,this._y2+=e},Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),e}(t.ObjectCache.CacheableClass);e.Segment=n,__reflect(n.prototype,"VL.Geom.Segment")}(e=t.Geom||(t.Geom={}))}(VL||(VL={}));var SkinConfigHelper=function(){function t(){}return t.getCfg=function(t){return app.config.getConfig(SkinConfig)[t]},t.getArrCardSkin=function(t){if(!this.cardSkinMap[t])for(var e=this.cardSkinMap[t]=[],n=this.getCfg(t),r=n.cardColor.split(","),i=n.cardImg.split(","),o=0,a=r.length;a>o;o++)e.push({color:parseInt("0x"+r[o],16),img:i[o]});return this.cardSkinMap[t]},t.getCardColor=function(t,e){return this.getArrCardSkin(t)[e.id-1].color},t.getCardImg=function(t,e){return this.getArrCardSkin(t)[e.id-1].img},t.getLvColor=function(t,e){if(!this.arrLvColor){this.arrLvColor=[];for(var n=this.getCfg(t).lvColor.split(","),r=0,i=n.length;i>r;r++)this.arrLvColor.push(parseInt("0x"+n[r],16))}return this.arrLvColor[e-1]},t.getScoreMultipleBgColor=function(t){return parseInt("0x"+this.getCfg(t).scoreMultipleBgColor,16)},t.getGameBgColor=function(t){return parseInt("0x"+this.getCfg(t).gameBgColor,16)},t.getRubbishCellForeColor=function(t){return parseInt("0x"+this.getCfg(t).rubbishBinForeColor,16)},t.getRubbishCellBgColor=function(t){return parseInt("0x"+this.getCfg(t).rubbishBinBgColor,16)},t.cardSkinMap={},t}();__reflect(SkinConfigHelper.prototype,"SkinConfigHelper");var VL;!function(t){var e;!function(e){var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.init=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this._x=t,this._y=e,this},n.prototype.clear=function(){this._x=0,this._y=0},n.prototype.draw=function(t,e){void 0===e&&(e=0),t.lineStyle(0,e),t.moveTo(0,0),t.lineTo(this._x,this._y)},n.prototype.clone=function(){return create(n).init(this.x,this.y)},n.prototype.zero=function(){return this._x=0,this._y=0,this},n.prototype.isZero=function(){return 0==this._x&&0==this._y},Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)},set:function(t){var e=this.angle;this._x=Math.cos(e)*t,this._y=Math.sin(e)*t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lengthSQ",{get:function(){return this._x*this._x+this._y*this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angle",{get:function(){return Math.atan2(this._y,this._x)},set:function(t){var e=this.length;this._x=Math.cos(t)*e,this._y=Math.sin(t)*e},enumerable:!0,configurable:!0}),n.prototype.normalize=function(){if(0==this.length)return this._x=1,this;var t=this.length;return this._x/=t,this._y/=t,this},n.prototype.truncate=function(t){return this.length=Math.min(t,this.length),this},n.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this},n.prototype.isNormalized=function(){return 1==this.length},n.prototype.dotProd=function(t){return this._x*t.x+this._y*t.y},n.prototype.crossProd=function(t){return this._x*t.y-this._y*t.x},n.angleBetween=function(t,e){var n=!1,r=!1;t.isNormalized()||(t=t.clone().normalize(),n=!0),e.isNormalized()||(e=e.clone().normalize(),r=!0);var i=Math.acos(t.dotProd(e));return n&&t.restore(),r&&e.restore(),i},n.prototype.dist=function(t){return Math.sqrt(this.distSQ(t))},n.prototype.distSQ=function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},n.prototype.add=function(t,e){void 0===e&&(e=!0);var r=e?this:create(n);return r.init(this._x+t.x,this._y+t.y)},n.prototype.subtract=function(t,e){void 0===e&&(e=!0);var r=e?this:create(n);return r.init(this._x-t.x,this.y-t.y)},n.prototype.multiply=function(t,e){void 0===e&&(e=!0);var r=e?this:create(n);return r.init(this._x*t,this._y*t)},n.prototype.divide=function(t,e){void 0===e&&(e=!0);var r=e?this:create(n);return r.init(this._x/t,this._y/t)},n.prototype.equals=function(t){return this._x==t.x&&this._y==t.y},n.prototype.fromPoint=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.toPoint=function(t){return void 0===t&&(t=null),t?t.setTo(this.x,this.y):egret.Point.create(this.x,this.y)},n.prototype.fromPolarCoordinates=function(t){var n=t.r*e.radian2Degree(Math.cos(e.degree2Radian(t.degree))),r=t.r*e.radian2Degree(Math.sin(e.degree2Radian(t.degree)));return this.init(n,r)},n.prototype.toPolarCoordinates=function(t){void 0===t&&(t=null);var n=Math.sqrt(this.x*this.x+this.y*this.y),r=e.radian2Degree(Math.atan2(this.y,this.x));return t?t.init(r,n):create(e.PolarCoordinates).init(r,n)},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return"[Vector2D(X:"+this._x+",y:"+this._y+")]"},n}(t.ObjectCache.CacheableClass);e.Vector2D=n,__reflect(n.prototype,"VL.Geom.Vector2D")}(e=t.Geom||(t.Geom={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(){function n(){this.reqHeader=null,this.dg_HttpError=new t.Delegate}return n.prototype.send=function(t,n,r){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,create(e.HttpTransaction).init(t,function(e,o){i.onResult(e,n.bind(r),t)}).send()];case 1:return[2,o.sent()]}})})},n.prototype.onResult=function(t,e,n){t.isSuccess?this.onSuccess(t,e,n):this.onFail(t,e,n),t.restore()},n.prototype.onSuccess=function(t,e,n){e(t.data,n.otherData),n.restore()},n.prototype.onFail=function(t,e,n){this.dg_HttpError.boardcast({key:n.key,data:t.data,otherData:n.otherData})},n}();e.Http=n,__reflect(n.prototype,"VL.Net.Http")}(e=t.Net||(t.Net={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t,e,n,r,i,o,a,s){return void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=egret.HttpResponseType.TEXT),void 0===s&&(s=egret.URLLoaderDataFormat.TEXT),this._baseUrl=t,this._key=e,this._method=n,this._reqHead=o,this._respFormat=a,this._reqFormat=s,s==egret.URLLoaderDataFormat.TEXT?this._data=Utils.StringUtils.ObjectToQueryFormatString(r):this._data=r,this._otherData=i,this},e.prototype.clear=function(){this._baseUrl=this._key=this._reqHead=this._method=this._respFormat=this._data=this._otherData=this._reqFormat=null},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reqHead",{get:function(){return this._reqHead},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"respFormat",{get:function(){return this._respFormat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"otherData",{get:function(){return this._otherData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reqFormat",{get:function(){return this._reqFormat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseUrl",{get:function(){return this._baseUrl},enumerable:!0,configurable:!0}),e}(t.ObjectCache.CacheableClass);e.HttpReqPack=n,__reflect(n.prototype,"VL.Net.HttpReqPack");var r=function(){function t(){}return t.process=function(e,n,r){t.completeCall["call_"+t._regID]=n.bind(r),t.startLoader(e,t._regID++)},t.startLoader=function(t,e){var n=document.createElement("script");n.src=t+"JsonpReq.completeCall.call_"+e,document.body.appendChild(n)},t._regID=0,t.completeCall={},t}();__reflect(r.prototype,"JsonpReq")}(e=t.Net||(t.Net={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t,e,n){return this._isSuccess=t,this._header=e,this._data=n,this},e.prototype.clear=function(){this._isSuccess=null,this._header=null,this._data=null},Object.defineProperty(e.prototype,"isSuccess",{get:function(){return this._isSuccess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),e}(t.ObjectCache.CacheableClass);e.HttpRespPack=n,__reflect(n.prototype,"VL.Net.HttpRespPack")}(e=t.Net||(t.Net={}))}(VL||(VL={}));var VL;!function(t){var e;!function(e){var n=function(t){function n(){var e=t.call(this)||this;return e._isRequesting=!1,e._httpReq=new egret.HttpRequest,e}return __extends(n,t),n.prototype.init=function(t,e){return this._reqPack=t,this._onResult=e,this},n.prototype.send=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n,r){t._isRequesting&&(app.log("============= 请求未返回，勿重复发送请求 ======================"),n(null));var i,o=t._httpReq,a=t._reqPack,s=a.baseUrl;a.method==egret.HttpMethod.POST&&a.data?(o.open(s+a.key,a.method),i=a.data):o.open(s+a.key+"?"+a.data,a.method);var u=a.reqHead;for(var c in u)o.setRequestHeader(c,u[c]),u[c]=u[c];o.responseType=a.respFormat,t._isRequesting=!0;var h=function(t){o.removeEventListener(egret.Event.COMPLETE,h,this),o.removeEventListener(egret.IOErrorEvent.IO_ERROR,p,this),this._isRequesting=!1;var r=create(e.HttpRespPack).init(!0,o.getAllResponseHeaders(),o.response);this._onResult(r,a.otherData),n(r),this.restore()},p=function(t){o.removeEventListener(egret.Event.COMPLETE,h,this),o.removeEventListener(egret.IOErrorEvent.IO_ERROR,p,this),this._isRequesting=!1;var r=create(e.HttpRespPack).init(!1,o.getAllResponseHeaders(),o.response);this._onResult(r,a.otherData),n(r),this.restore()};o.addEventListener(egret.Event.COMPLETE,h,t),o.addEventListener(egret.IOErrorEvent.IO_ERROR,p,t),o.send(i)})]})})},n.prototype.clear=function(){this._reqPack=this._onResult=null},n}(t.ObjectCache.CacheableClass);e.HttpTransaction=n,__reflect(n.prototype,"VL.Net.HttpTransaction")}(e=t.Net||(t.Net={}))}(VL||(VL={}));var App;!function(t){var e=function(){function e(){this._caseIDSeed=0,this.loadingCaseList=[],this.loadingPanel=new EasyLoadingPanel}return e.prototype.getNewCaseID=function(){return this._caseIDSeed>=1e6&&(this._caseIDSeed=0),""+this._caseIDSeed++},e.prototype.add=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var n=t||this.getNewCaseID();return this.loadingCaseList.push(n),this.isShow||this.show(e),n},e.prototype.remove=function(t){var e=this.loadingCaseList.indexOf(t);-1!=e&&(this.loadingCaseList.splice(e,1),this.loadingCaseList.length<=0&&this.hide())},e.prototype.clear=function(){this.loadingCaseList.length=0,this.hide()},e.prototype.show=function(e){void 0===e&&(e=null),this.loadingPanel.show(t.GameLayers.UI_Top,e)},e.prototype.hide=function(){this.loadingPanel.hide()},Object.defineProperty(e.prototype,"isShow",{get:function(){return this.loadingPanel.isShow},enumerable:!0,configurable:!0}),e}();t.EasyLoadingManager=e,__reflect(e.prototype,"App.EasyLoadingManager")}(App||(App={}));var EasyLoadingPanel=function(t){function e(e,n,r){void 0===e&&(e="x-jiazai_png"),void 0===n&&(n=0),void 0===r&&(r=.5);var i=t.call(this)||this;return i.rollSpeed=6,i._isShow=!1,i.roller=new egret.Bitmap,i._rollerRes=e,i.opacity=r,i.bgColor=n,i.touchChildren=!1,i.touchEnabled=!0,i}return __extends(e,t),e.prototype.show=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return e=this.roller,e.texture?[3,2]:(n=e,[4,RES.getResAsync(this._rollerRes)]);case 1:n.texture=r.sent(),e.anchorOffsetX=e.width>>1,e.anchorOffsetY=e.height>>1,this.updateLayout(),this.addChild(this.roller),r.label=2;case 2:return egret.setTimeout(function(){this.isShow&&t.addChild(this)},this,500),this._isShow||(this._isShow=!0,this.interval=egret.setInterval(this.roll,this,20),StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.updateLayout,this)),this.updateLayout(),[2]}})})},e.prototype.hide=function(){this.parent&&this.parent.removeChild(this),egret.clearInterval(this.interval),StageUtils.getStage().removeEventListener(egret.Event.RESIZE,this.updateLayout,this),this._isShow=!1},e.prototype.updateLayout=function(){var t=StageUtils.getStageWidth(),e=StageUtils.getStageHeight(),n=this.graphics;n.clear(),n.beginFill(this.bgColor,this.opacity),n.drawRect(0,0,t,e),n.endFill(),this.roller.x=this.width>>1,this.roller.y=this.height>>1},e.prototype.roll=function(){var t=this.roller;t.rotation>360?t.rotation=t.rotation-360+this.rollSpeed:t.rotation+=this.rollSpeed},Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(EasyLoadingPanel.prototype,"EasyLoadingPanel"),window.EasyLoadingPanel=EasyLoadingPanel;var VL;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.getClassName=function(t){return egret.getQualifiedClassName(t)},t.prototype.getClass=function(t){return egret.getDefinitionByName(t)},t.prototype.getClassByEntity=function(t){return t?t.__proto__.constructor:null},t.prototype.isExtends=function(t,e){var n=this.getClassName(t);return e!=n&&t.prototype.__types__.indexOf(e)>=0},t}();t.EgretReflector=e,__reflect(e.prototype,"VL.Reflector.EgretReflector",["VL.Reflector.IReflector"])}(e=t.Reflector||(t.Reflector={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(t){void 0===t&&(t="tempLoadTask"),this.tempGroupIdx=0,this.taskCanceled=!1,this.tempGroupBaseName=t,this.loadTaskQueue=[],this.taskReporter={onProgress:this.onProgress.bind(this),onCancel:this.onCancel.bind(this)}}return t.prototype.loadConfig=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,RES.loadConfig(t,e)]})})},t.prototype.loadResTask=function(t){var e=this.tempGroupBaseName+this.tempGroupIdx;t.taskName=t.taskName||e,this.loadTaskQueue.push(t),this.loadNextTask()},t.prototype.loadNextTask=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r;return __generator(this,function(i){switch(i.label){case 0:return this.isRunningTask?[2]:(t=this.loadTaskQueue.shift())?(this.currTask=t,e=t.keys,n=t.taskName,r=this.tempGroupBaseName+this.tempGroupIdx++,n=n||r,e&&e.length>0?RES.createGroup(r,e,!0)?(app.log("加载任务 taskName:"+n+"  keys:"+e),[4,RES.loadGroup(r,0,this.taskReporter)]):[3,2]:[3,4]):[2];case 1:return i.sent(),this.onTaskOver(),[3,3];case 2:app.warn("资源组创建失败 taskName:"+n+",  keys:"+e),this.onCancel(),this.onTaskOver(),i.label=3;case 3:return[3,5];case 4:this.onTaskOver(),i.label=5;case 5:return[2]}})})},t.prototype.onTaskOver=function(){var t=this.currTask;this.currTask=null,this.taskCanceled?(this.taskCanceled=!1,t.onCancel&&(app.warn("加载任务被取消 taskName:"+t.taskName),t.onCancel(t))):t.onComplete&&(app.log("加载任务结束 taskName:"+t.taskName),t.onComplete(t)),this.loadNextTask()},t.prototype.onProgress=function(t,e){var n=this.currTask;app.log(t+" / "+e),n.onProgress&&n.onProgress(n,t,e)},t.prototype.onCancel=function(){this.taskCanceled=!0},t.prototype.getRes=function(t){return RES.getRes(t)},t.prototype.getResAsync_promise=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,RES.getResAsync(t)]})})},t.prototype.getResAsync_callback=function(t,e,n){return RES.getResAsync(t,e,n)},t.prototype.destroyRes=function(t,e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,!RES.getRes(t)||RES.destroyRes(t,e)]})})},t.prototype.destroyReses=function(t,e){void 0===e&&(e=!0);for(var n=0,r=t.length;r>n;n++)this.destroyRes(t[n],e)},t.prototype.loadResByURL=function(t,e){return void 0===e&&(e=egret.URLLoaderDataFormat.TEXTURE),__awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return[2,new Promise(function(r,i){var o=new egret.URLRequest(t),a=new egret.URLLoader(o);a.dataFormat=e,a.once(egret.Event.COMPLETE,function(t){r(t.data)},n),a.once(egret.IOErrorEvent.IO_ERROR,function(t){i(t.data)},n)})]})})},Object.defineProperty(t.prototype,"isRunningTask",{get:function(){return!!this.currTask},enumerable:!0,configurable:!0}),t}();t.EgretResManager=e,__reflect(e.prototype,"VL.Resource.EgretResManager")}(e=t.Resource||(t.Resource={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.adapt=function(t,e){t.scaleX=e.width/t.width,t.scaleY=e.height/t.height},t}();__reflect(e.prototype,"ScaleMode_Draw",["VL.ScaleMode.IScaleMode"]),t.DRAW=new e}(e=t.ScaleMode||(t.ScaleMode={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.adapt=function(t,e){t.scaleX=t.scaleY=1;var n=t.width,r=t.height,i=e.width,o=e.height,a=Math.max(i/n,o/r);t.scaleY=t.scaleX=a},t}();__reflect(e.prototype,"ScaleMode_NoBorder",["VL.ScaleMode.IScaleMode"]),t.NO_BORDER=new e}(e=t.ScaleMode||(t.ScaleMode={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.adapt=function(t,e){t.scaleX=t.scaleY=1;var n=t.width,r=t.height,i=e.width,o=e.height,a=Math.min(i/n,o/r);t.scaleY=t.scaleX=a},t}();__reflect(e.prototype,"ScaleMode_ShowAll_Fill",["VL.ScaleMode.IScaleMode"]),t.SHOW_ALL_FILL=new e}(e=t.ScaleMode||(t.ScaleMode={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.adapt=function(t,e){t.scaleX=t.scaleY=1;var n=t.width,r=t.height,i=e.width,o=e.height,a=Math.min(1,Math.min(i/n,o/r));t.scaleY=t.scaleX=a},t}();__reflect(e.prototype,"ScaleMode_ShowAll",["VL.ScaleMode.IScaleMode"]),t.SHOW_ALL=new e}(e=t.ScaleMode||(t.ScaleMode={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e=function(e){function n(n,r){void 0===n&&(n=null),void 0===r&&(r=t.SoundType.EFFECT);var i=e.call(this)||this;return i._soundType=egret.Sound.EFFECT,i._volume=1,i._pausedPos=0,i.init(n,r),i}return __extends(n,e),n.prototype.init=function(e,n){return void 0===e&&(e=null),void 0===n&&(n=t.SoundType.EFFECT),this.isPlaying&&this.stop(),this.source=e,this.soundType=n,this._sound=null,this._isLoading=!1,this.volume=1,this._pausedPos=0,this},n.prototype.play=function(t,e){void 0===t&&(t=1),void 0===e&&(e=!0),this.isPlaying&&this.stop();var n=this._sound;n&&(this._channel=n.play(e?this._pausedPos:0,t),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel.volume=this._volume),this._pausedPos=0},n.prototype.onPlayComplete=function(t){this.stop()},n.prototype.pause=function(){this.isPlaying&&(this._pausedPos=this._channel.position,this.stop())},n.prototype.stop=function(){this.isPlaying&&this._channel.stop(),this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel=null},n.prototype.load=function(t,e,n){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){r.source==t&&r._sound?(e.call(n,r),i(r)):(r._isLoading=!0,RES.getResAsync(t,function(a,s){getClassByEntity(a)!=egret.Sound&&o(s+" 的资源类型不是 egret.Sound"),r._sound=a,r.source=t,r._isLoading=!1,e.call(n,r),i(r)},r))})]})})},n.prototype.clear=function(){RES.destroyRes(this.source),this.init()},n.prototype.dispose=function(){this.restore()},Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._channel&&(this._channel.volume=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"source",{get:function(){return this._source},set:function(t){this._source=t;var e=RES.getRes(this.source);this._sound!=e&&(this._sound=e,this._sound&&(this._sound.type=this._soundType))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"soundType",{get:function(){var e=t.SoundType.EFFECT;switch(this._soundType){case egret.Sound.MUSIC:e=t.SoundType.MUSIC;break;case egret.Sound.EFFECT:e=t.SoundType.EFFECT}return e},set:function(e){switch(e){case t.SoundType.MUSIC:this._soundType=egret.Sound.MUSIC;break;case t.SoundType.EFFECT:this._soundType=egret.Sound.EFFECT}this._sound&&(this._sound.type=this._soundType)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return null!=this._channel},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pausedPos",{get:function(){return this._pausedPos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPaused",{get:function(){return this._pausedPos>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._sound?this._sound.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!this.isLoading&&this.source&&this.source.length>0?null!=this._sound:!1},enumerable:!0,configurable:!0}),n}(t.SoundBase);t.EgretSound=e,__reflect(e.prototype,"VL.Sound.EgretSound",["VL.Sound.ISound","VL.ObjectCache.ICacheable"])}(e=t.Sound||(t.Sound={}))}(VL||(VL={}));var SDK;!function(t){var e;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.MALE=1]="MALE",t[t.FEMALE=2]="FEMALE"}(e=t.Enum_Gender||(t.Enum_Gender={}))}(SDK||(SDK={}));var VL;!function(t){var e;!function(t){var e=function(){function e(t){this._soundClass=t,this._musicList={},this._effList={}}return e.prototype.createSound=function(){return create(this._soundClass)},e.prototype.playEffect=function(t,e){var n=this.getSoundEffect(t);if(!n)throw new Error("sound effect entity is not exist !  source:"+t);n.play(e,!1)},e.prototype.playMusic=function(t,e,n){var r=this.getMusic(t);if(!r)throw new Error("music entity is not exist !  source:"+t);r.play(e,n)},e.prototype.loadSounds=function(e){for(var n,r=function(r,o){n=e[r];var a;switch(n.soundType){case t.SoundType.EFFECT:a=i._effList;break;case t.SoundType.MUSIC:a=i._musicList}var s=a[n.source];if(s)n.onLoaded.call(n.thisObj,s);else{s=i.createSound();var u=function(t){a[t.source]=t,n.onLoaded.call(n.thisObj,t)};s.load(n.source,u,i)}},i=this,o=0,a=e.length;a>o;o++)r(o,a)},e.prototype.releaseSound=function(t){var e=this.getSoundEffect(t);return e?(delete this._effList[t],void e.restore()):(e=this.getMusic(t),void(e&&(delete this._musicList[t],e.restore())))},e.prototype.getSoundEffect=function(t){return this._effList[t]},e.prototype.getMusic=function(t){return this._musicList[t]},e}();t.SoundMgr=e,__reflect(e.prototype,"VL.Sound.SoundMgr")}(e=t.Sound||(t.Sound={}))}(VL||(VL={}));var VL;!function(t){var e;!function(t){var e;!function(t){t[t.MUSIC=0]="MUSIC",t[t.EFFECT=1]="EFFECT"}(e=t.SoundType||(t.SoundType={}))}(e=t.Sound||(t.Sound={}))}(VL||(VL={}));var Utils;!function(t){var e=function(){function t(){}return t.init=function(){t._propertyChange=Object.create(null),t._anchorChange=Object.create(null),t.injectAnchor()},t.setAnchorX=function(t,e){t.anchorX=e},t.setAnchorY=function(t,e){t.anchorY=e},t.setAnchor=function(t,e){t.anchorX=t.anchorY=e},t.getAnchor=function(t){return t.anchorX!=t.anchorY&&console.log("target's anchorX != anchorY"),t.anchorX||0},t.getAnchorY=function(t){return t.anchorY||0},t.getAnchorX=function(t){return t.anchorX||0},t.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var n=this;this.$setWidth(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var n=this;this.$setHeight(e),t._propertyChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var n=this;this._anchorX=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var n=this;this._anchorY=e,t._propertyChange[this.hashCode]=!0,t._anchorChange[this.hashCode]=!0,egret.callLater(function(){t.changeAnchor(n)},this)},enumerable:!0,configurable:!0})},t.changeAnchor=function(e){t._propertyChange[e.hashCode]&&t._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete t._propertyChange[e.hashCode])},t}();t.AnchorUtil=e,__reflect(e.prototype,"Utils.AnchorUtil")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function e(){}return e.quickSort=function(t,e){if(t.length<=1)return t;for(var n,r,i=Math.floor(t.length>>1),o=t[i],a=[],s=[],u=[],c=0;c<t.length;c++)r=t[c],n=e(t[c],o),0>n?a.push(r):0==n?s.push(r):n>0&&u.push(r);return this.quickSort(a,e).concat(s,this.quickSort(u,e))},e.randomElement=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},e.upsetArr=function(e,n){var r,i=e.concat();if(n){r=[];for(var o=void 0,a=0,s=n.length;s>a;a++)o=i.splice(n[a],1),r.push(o[0])}for(var u=i.length,c=[];u>0;){var h=t.RandomUtils.limitInteger(0,--u);c.push(i.splice(h,1)[0])}if(r)for(var a=0,p=n.length;p>a;a++){var l=n[a];c.splice(l,0,r[a])}return c},e}();t.ArrayUtils=e,__reflect(e.prototype,"Utils.ArrayUtils")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.play=function(t){function e(t){C++,C==a&&n.removeChild(o)}var n=StageUtils.getStage(),r=n.width,i=n.height,o=new eui.Group;o.width=r,o.height=i,n.addChild(o);for(var a=40,s=5,u=a/s,c=0;a>c;c++){var h=r/s,p=i/u,l=c%s*h,d=Math.floor(c/s)*p,g=new egret.RenderTexture,f=(g.drawToTexture(n,new egret.Rectangle(l,d,h,p)),new egret.Bitmap);switch(f.texture=g,f.anchorOffsetX=h>>1,f.anchorOffsetY=p>>1,f.x=l+h>>1,f.y=d+p>>1,o.addChild(f),5==t&&(t=Math.ceil(4*Math.random())),t){case 1:var _=egret.Tween.get(f);_.to({scaleX:0,scaleY:0,alpha:0,rotation:359},800,egret.Ease.circIn).call(e,this);break;case 2:var y=-r;c%2||(y=2*r);var _=egret.Tween.get(f);_.to({x:y,alpha:0},800,egret.Ease.circIn).call(e,this);break;case 3:var _=egret.Tween.get(f);_.to({scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,egret.Ease.backInOut).call(e,this);break;case 4:var _=egret.Tween.get(f);_.to({alpha:0},900,egret.Ease.circIn).call(e,this);break;default:var _=egret.Tween.get(f);_.to({scaleX:1,scaleY:0,alpha:0},800,egret.Ease.circIn).call(e,this)}}var C=0},t}();t.ChangeSceneEffect=e,__reflect(e.prototype,"Utils.ChangeSceneEffect")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.drawSector=function(t,e,n,r,i,o,a,s){void 0===e&&(e=100),void 0===n&&(n=0),void 0===r&&(r=360),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=16711680),void 0===s&&(s=1),t.clear(),t.beginFill(a,s),t.moveTo(i,o),r=Math.abs(r)>360?360:r;var u=Math.ceil(Math.abs(r)/45),c=r/u;c=c*Math.PI/180,n=n*Math.PI/180,t.lineTo(i+e*Math.cos(n),o+e*Math.sin(n));for(var h=1;u>=h;h++){n+=c;var p=n-c>>1,l=i+e/Math.cos(c>>1)*Math.cos(p),d=o+e/Math.cos(c>>1)*Math.sin(p),g=i+e*Math.cos(n),f=o+e*Math.sin(n);t.curveTo(l,d,g,f)}360!=r&&t.lineTo(i,o),t.endFill()},t}();t.GraphicsUtil=e,__reflect(e.prototype,"Utils.GraphicsUtil")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){this.hexcase=0,this.b64pad=""}return t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,n){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),n)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var n=this.rstr2binl(t);n.length>16&&(n=this.binl_md5(n,8*t.length));for(var r=Array(16),i=Array(16),o=0;16>o;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var a=this.binl_md5(r.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(i.concat(a),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var n,r=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",o=0;o<t.length;o++)n=t.charCodeAt(o),i+=r.charAt(n>>>4&15)+r.charAt(15&n);return i},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=t.length,o=0;i>o;o+=3)for(var a=t.charCodeAt(o)<<16|(i>o+1?t.charCodeAt(o+1)<<8:0)|(i>o+2?t.charCodeAt(o+2):0),s=0;4>s;s++)r+=8*o+6*s>8*t.length?this.b64pad:n.charAt(a>>>6*(3-s)&63);
return r},t.prototype.rstr2any=function(t,e){var n,r,i,o,a,s=e.length,u=Array(Math.ceil(t.length/2));for(n=0;n<u.length;n++)u[n]=t.charCodeAt(2*n)<<8|t.charCodeAt(2*n+1);var c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),h=Array(c);for(r=0;c>r;r++){for(a=Array(),o=0,n=0;n<u.length;n++)o=(o<<16)+u[n],i=Math.floor(o/s),o-=i*s,(a.length>0||i>0)&&(a[a.length]=i);h[r]=o,u=a}var p="";for(n=h.length-1;n>=0;n--)p+=e.charAt(h[n]);return p},t.prototype.str2rstr_utf8=function(t){for(var e,n,r="",i=-1;++i<t.length;)e=t.charCodeAt(i),n=i+1<t.length?t.charCodeAt(i+1):0,e>=55296&&56319>=e&&n>=56320&&57343>=n&&(e=65536+((1023&e)<<10)+(1023&n),i++),127>=e?r+=String.fromCharCode(e):2047>=e?r+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?r+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(r+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return r},t.prototype.str2rstr_utf16le=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(255&t.charCodeAt(n),t.charCodeAt(n)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t.charCodeAt(n)>>>8&255,255&t.charCodeAt(n));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(var n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},t.prototype.binl2rstr=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,a=0;a<t.length;a+=16){var s=n,u=r,c=i,h=o;n=this.md5_ff(n,r,i,o,t[a+0],7,-680876936),o=this.md5_ff(o,n,r,i,t[a+1],12,-389564586),i=this.md5_ff(i,o,n,r,t[a+2],17,606105819),r=this.md5_ff(r,i,o,n,t[a+3],22,-1044525330),n=this.md5_ff(n,r,i,o,t[a+4],7,-176418897),o=this.md5_ff(o,n,r,i,t[a+5],12,1200080426),i=this.md5_ff(i,o,n,r,t[a+6],17,-1473231341),r=this.md5_ff(r,i,o,n,t[a+7],22,-45705983),n=this.md5_ff(n,r,i,o,t[a+8],7,1770035416),o=this.md5_ff(o,n,r,i,t[a+9],12,-1958414417),i=this.md5_ff(i,o,n,r,t[a+10],17,-42063),r=this.md5_ff(r,i,o,n,t[a+11],22,-1990404162),n=this.md5_ff(n,r,i,o,t[a+12],7,1804603682),o=this.md5_ff(o,n,r,i,t[a+13],12,-40341101),i=this.md5_ff(i,o,n,r,t[a+14],17,-1502002290),r=this.md5_ff(r,i,o,n,t[a+15],22,1236535329),n=this.md5_gg(n,r,i,o,t[a+1],5,-165796510),o=this.md5_gg(o,n,r,i,t[a+6],9,-1069501632),i=this.md5_gg(i,o,n,r,t[a+11],14,643717713),r=this.md5_gg(r,i,o,n,t[a+0],20,-373897302),n=this.md5_gg(n,r,i,o,t[a+5],5,-701558691),o=this.md5_gg(o,n,r,i,t[a+10],9,38016083),i=this.md5_gg(i,o,n,r,t[a+15],14,-660478335),r=this.md5_gg(r,i,o,n,t[a+4],20,-405537848),n=this.md5_gg(n,r,i,o,t[a+9],5,568446438),o=this.md5_gg(o,n,r,i,t[a+14],9,-1019803690),i=this.md5_gg(i,o,n,r,t[a+3],14,-187363961),r=this.md5_gg(r,i,o,n,t[a+8],20,1163531501),n=this.md5_gg(n,r,i,o,t[a+13],5,-1444681467),o=this.md5_gg(o,n,r,i,t[a+2],9,-51403784),i=this.md5_gg(i,o,n,r,t[a+7],14,1735328473),r=this.md5_gg(r,i,o,n,t[a+12],20,-1926607734),n=this.md5_hh(n,r,i,o,t[a+5],4,-378558),o=this.md5_hh(o,n,r,i,t[a+8],11,-2022574463),i=this.md5_hh(i,o,n,r,t[a+11],16,1839030562),r=this.md5_hh(r,i,o,n,t[a+14],23,-35309556),n=this.md5_hh(n,r,i,o,t[a+1],4,-1530992060),o=this.md5_hh(o,n,r,i,t[a+4],11,1272893353),i=this.md5_hh(i,o,n,r,t[a+7],16,-155497632),r=this.md5_hh(r,i,o,n,t[a+10],23,-1094730640),n=this.md5_hh(n,r,i,o,t[a+13],4,681279174),o=this.md5_hh(o,n,r,i,t[a+0],11,-358537222),i=this.md5_hh(i,o,n,r,t[a+3],16,-722521979),r=this.md5_hh(r,i,o,n,t[a+6],23,76029189),n=this.md5_hh(n,r,i,o,t[a+9],4,-640364487),o=this.md5_hh(o,n,r,i,t[a+12],11,-421815835),i=this.md5_hh(i,o,n,r,t[a+15],16,530742520),r=this.md5_hh(r,i,o,n,t[a+2],23,-995338651),n=this.md5_ii(n,r,i,o,t[a+0],6,-198630844),o=this.md5_ii(o,n,r,i,t[a+7],10,1126891415),i=this.md5_ii(i,o,n,r,t[a+14],15,-1416354905),r=this.md5_ii(r,i,o,n,t[a+5],21,-57434055),n=this.md5_ii(n,r,i,o,t[a+12],6,1700485571),o=this.md5_ii(o,n,r,i,t[a+3],10,-1894986606),i=this.md5_ii(i,o,n,r,t[a+10],15,-1051523),r=this.md5_ii(r,i,o,n,t[a+1],21,-2054922799),n=this.md5_ii(n,r,i,o,t[a+8],6,1873313359),o=this.md5_ii(o,n,r,i,t[a+15],10,-30611744),i=this.md5_ii(i,o,n,r,t[a+6],15,-1560198380),r=this.md5_ii(r,i,o,n,t[a+13],21,1309151649),n=this.md5_ii(n,r,i,o,t[a+4],6,-145523070),o=this.md5_ii(o,n,r,i,t[a+11],10,-1120210379),i=this.md5_ii(i,o,n,r,t[a+2],15,718787259),r=this.md5_ii(r,i,o,n,t[a+9],21,-343485551),n=this.safe_add(n,s),r=this.safe_add(r,u),i=this.safe_add(i,c),o=this.safe_add(o,h)}return[n,r,i,o]},t.prototype.md5_cmn=function(t,e,n,r,i,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(r,o)),i),n)},t.prototype.md5_ff=function(t,e,n,r,i,o,a){return this.md5_cmn(e&n|~e&r,t,e,i,o,a)},t.prototype.md5_gg=function(t,e,n,r,i,o,a){return this.md5_cmn(e&r|n&~r,t,e,i,o,a)},t.prototype.md5_hh=function(t,e,n,r,i,o,a){return this.md5_cmn(e^n^r,t,e,i,o,a)},t.prototype.md5_ii=function(t,e,n,r,i,o,a){return this.md5_cmn(n^(e|~r),t,e,i,o,a)},t.prototype.safe_add=function(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);return r<<16|65535&n},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();t.md5=e,__reflect(e.prototype,"Utils.md5")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.convert=function(t,e,n,r){void 0===e&&(e=44),void 0===n&&(n=4),void 0===r&&(r=2);for(var i,o,a=e;a>=4;a-=n)if(t/Math.pow(10,a)>=1)return i=Math.pow(10,a-r),o=this.unit[a]||"",Math.floor(t/(i>0?i:1))/Math.pow(10,r)+o;return t.toString()},t.unit={2:"百",3:"千",4:"万",5:"十万",6:"百万",7:"千万",8:"亿",9:"十亿",10:"百亿",11:"千亿",12:"兆",16:"京",20:"垓",24:"秭",28:"穰",32:"沟",36:"涧",40:"正",44:"载"},t}();t.NumberToUnitStringUtil=e,__reflect(e.prototype,"Utils.NumberToUnitStringUtil")}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var n=e-t;return t+Math.random()*n},t.limitInteger=function(t,e){return Math.round(this.limit(t,e))},t}();t.RandomUtils=e,__reflect(e.prototype,"Utils.RandomUtils")}(Utils||(Utils={}));var StageUtils;!function(t){function e(){return h||(h=egret.MainContext.instance.stage),h}function n(){return e().stageHeight}function r(){return e().stageWidth}function i(){return e().height}function o(){return e().width}function a(t){e().touchChildren=t}function s(t){e().maxTouches=t}function u(t){e().frameRate=t}function c(t){e().scaleMode=t}var h;t.getStage=e,t.getStageHeight=n,t.getStageWidth=r,t.getGameHeight=i,t.getGameWidth=o,t.setTouchChildren=a,t.setMaxTouches=s,t.setFrameRate=u,t.setScaleMode=c}(StageUtils||(StageUtils={}));var Utils;!function(t){var e=function(){function t(){}return t.queryFormatToObject=function(t){for(var e,n=t.split("&"),r={},i=0,o=n.length;o>i;i++)e=n[i].split("="),e.length>=2&&(r[e[0]]=e[1]);return r},t.ObjectToQueryFormatString=function(t){var e=[];for(var n in t){var r=n+"="+t[n];e.push(r)}return e.join("&")},t}();t.StringUtils=e,__reflect(e.prototype,"Utils.StringUtils")}(Utils||(Utils={}));var SDK;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"LOCAL",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WANBA",{get:function(){return"wanba_ts"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"YYB",{get:function(){return"yingyongbao"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WX",{get:function(){return"weixin"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"H5SDK",{get:function(){return"h5sdk"},enumerable:!0,configurable:!0}),t}();t.Enum_PF=e,__reflect(e.prototype,"SDK.Enum_PF")}(SDK||(SDK={}));var SDK;!function(t){var e;!function(t){t[t.FAILD=0]="FAILD",t[t.SUCCESE=1]="SUCCESE"}(e=t.Enum_SDKShareResult||(t.Enum_SDKShareResult={}))}(SDK||(SDK={}));var Enum_System;!function(t){t[t.ANDROID=1]="ANDROID",t[t.IOS=2]="IOS"}(Enum_System||(Enum_System={}));var VoyaMVC;!function(t){var e=function(){function t(){this.msgHandlerMap={}}return t.prototype.sendMsg=function(t){var e=getClassName(t),n=this.msgHandlerMap[e];if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i.handler.call(i.thisObj,t)}t.restore()},t.prototype.regMsg=function(t,e,n,r){void 0===r&&(r=!1);var i=getClassName(t),o=this.msgHandlerMap[i];o||(this.msgHandlerMap[i]=[]),r?this.existMsgHandler(t,e,n)||this.msgHandlerMap[i].push({handler:e,thisObj:n}):this.msgHandlerMap[i].push({handler:e,thisObj:n})},t.prototype.unregMsg=function(t,e,n){void 0===n&&(n=null);var r=getClassName(t),i=this.msgHandlerMap[r];if(i&&i.length>0&&e)for(var o=void 0,a=0;a<i.length;a++)o=i[a],o.handler==e&&(n?o.thisObj==n&&i.splice(a--,1):i.splice(a--,1))},t.prototype.existMsgHandler=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var r=getClassName(t),i=this.msgHandlerMap[r],o=!1;if(i&&i.length>0)if(e){for(var a=void 0,s=0,u=i.length;u>s;s++)if(a=i[s],a.handler==e){if(!n){o=!0;break}if(a.thisObj==n){o=!0;break}}}else o=!0;return o},t}();t.MsgSender=e,__reflect(e.prototype,"VoyaMVC.MsgSender",["VoyaMVC.IMsgSender"])}(VoyaMVC||(VoyaMVC={}));